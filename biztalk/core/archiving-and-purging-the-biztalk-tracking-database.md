---
title: "Archiver et purger la base de données de suivi | Documents Microsoft"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 7014cf31-86e8-4829-8055-056442329009
caps.latest.revision: 
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 52e1f7b75f677bfd4818ddedcb74927633031a14
ms.sourcegitcommit: 32f380810b90b70e5df7be72a6a14988a747868e
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/28/2018
---
# <a name="archive-and-purge-the-biztalkdtadb-database"></a><span data-ttu-id="74b9a-102">Archiver et purger la base de données BizTalkDTADb</span><span class="sxs-lookup"><span data-stu-id="74b9a-102">Archive and Purge the BizTalkDTADb Database</span></span>

## <a name="overview"></a><span data-ttu-id="74b9a-103">Vue d'ensemble</span><span class="sxs-lookup"><span data-stu-id="74b9a-103">Overview</span></span>
<span data-ttu-id="74b9a-104">BizTalk Server traitant de plus en plus de données sur votre système, la taille de la base de données des suivis BizTalk (BizTalkDTADb) ne cesse d'augmenter.</span><span class="sxs-lookup"><span data-stu-id="74b9a-104">As BizTalk Server processes more and more data on your system, the BizTalk Tracking (BizTalkDTADb) database continues to grow in size.</span></span> <span data-ttu-id="74b9a-105">Cette croissance non contrôlée affecte la performance du système et peut générer des erreurs dans le service TDDS (Tracking Data Decode Service).</span><span class="sxs-lookup"><span data-stu-id="74b9a-105">Unchecked growth decreases system performance and may generate errors in the Tracking Data Decode Service (TDDS).</span></span> <span data-ttu-id="74b9a-106">Outre les données de suivi générales, les messages suivis peuvent également s'accumuler dans la base de données MessageBox, affectant ainsi les performances du disque.</span><span class="sxs-lookup"><span data-stu-id="74b9a-106">In addition to general tracking data, tracked messages can also accumulate in the MessageBox database, causing poor disk performance.</span></span>  
  
<span data-ttu-id="74b9a-107">BizTalk Server automatise les processus à l’aide de la tâche de Purge et archivage.</span><span class="sxs-lookup"><span data-stu-id="74b9a-107">BizTalk Server automates both processes using the DTA Purge and Archive job.</span></span> <span data-ttu-id="74b9a-108">Grâce à l'archivage et à la purge des données à partir de la base de données des suivis BizTalk, vous pouvez maintenir un bon fonctionnement du système tout en conservant vos données de suivi archivées pour une utilisation ultérieure.</span><span class="sxs-lookup"><span data-stu-id="74b9a-108">By archiving and purging data from the BizTalk Tracking database, you can maintain a healthy system, as well as keep your tracking data archived for future use.</span></span> <span data-ttu-id="74b9a-109">Les archives de la base de données des suivis BizTalk ayant tendance à s'accumuler et à saturer l'espace disque, il est recommandé de les transférer régulièrement sur un périphérique de stockage secondaire.</span><span class="sxs-lookup"><span data-stu-id="74b9a-109">Because BizTalk Tracking database archives accumulate over time and consume disk space, it is a good idea to move the BizTalk Tracking database archives to secondary storage on a regular basis.</span></span>  
  
 <span data-ttu-id="74b9a-110">Lors de la purge des données de la base de données des suivis BizTalk, le travail de purge et d'archivage DTA implique l'élimination de divers types d'informations de suivis, comme les informations d'instance de service et de message, les informations d'événement d'orchestration et les données de suivi du moteur des règles.</span><span class="sxs-lookup"><span data-stu-id="74b9a-110">When you purge data from the BizTalk Tracking database, the DTA Purge and Archive job purges different types of tracking information such as message and service instance information, orchestration event information, and rules engine tracking data.</span></span>  
  
 <span data-ttu-id="74b9a-111">L'âge d'un enregistrement de données de suivis est basé sur la date et l'heure auxquelles les données ont été placées dans la base de données des suivis BizTalk.</span><span class="sxs-lookup"><span data-stu-id="74b9a-111">The age of a tracking data record is based on the time the tracking data was inserted into the BizTalk Tracking database.</span></span> <span data-ttu-id="74b9a-112">Le travail de purge et d'archivage DTA utilise l'horodatage pour vérifier de manière continue si l'enregistrement est antérieur à l'intervalle de données actives.</span><span class="sxs-lookup"><span data-stu-id="74b9a-112">The DTA Purge and Archive job uses the time stamp to continuously verify whether the record is older than the live window of data.</span></span> <span data-ttu-id="74b9a-113">Après chaque période de données actives, la base de données des suivis BizTalk est archivée et un nouveau fichier d'archive est créé.</span><span class="sxs-lookup"><span data-stu-id="74b9a-113">After every live window period, the BizTalk Tracking database is archived and a new archive file is created.</span></span> <span data-ttu-id="74b9a-114">À chaque intervalle de travail de SQL Server Agent spécifié par la planification des travaux, toutes les données de suivi terminées antérieures à la période de données actives sont purgées.</span><span class="sxs-lookup"><span data-stu-id="74b9a-114">At each SQL Server Agent job interval specified by the job schedule, all completed tracking data older than the live window period is purged.</span></span>  
  
 <span data-ttu-id="74b9a-115">BizTalk Server utilise le concept de purge normale et de purge complète.</span><span class="sxs-lookup"><span data-stu-id="74b9a-115">BizTalk Server uses the concept of a soft purge and a hard purge.</span></span> <span data-ttu-id="74b9a-116">La purge normale permet d'éliminer les instances terminées, alors que la purge complète permet de purger les instances non achevées.</span><span class="sxs-lookup"><span data-stu-id="74b9a-116">The soft purge is used to purge completed instances, while the hard purge is only used to purge incomplete instances.</span></span>  
  
## <a name="soft-purge"></a><span data-ttu-id="74b9a-117">Purge normale</span><span class="sxs-lookup"><span data-stu-id="74b9a-117">Soft purge</span></span>
  
 <span data-ttu-id="74b9a-118">Pour le travail de purge et d'archivage DTA, la somme du nombre d'heures et du nombre de jours d'activité est égale aux données de la fenêtre active que vous souhaitez conserver dans votre environnement BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="74b9a-118">In the DTA Archive and Purge job, the sum of the LiveHours and LiveDays parameters is the live window of data you want to maintain in your BizTalk Server environment.</span></span> <span data-ttu-id="74b9a-119">Les données associées à une instance terminée et antérieures à cet intervalle de données actives sont purgées.</span><span class="sxs-lookup"><span data-stu-id="74b9a-119">All data associated with a completed instance older than this live window of data is purged.</span></span> <span data-ttu-id="74b9a-120">Par défaut, le travail de purge et d'archivage DTA n'est pas activé.</span><span class="sxs-lookup"><span data-stu-id="74b9a-120">By default, the DTA Archive and Purge job is not enabled.</span></span> <span data-ttu-id="74b9a-121">Vous devez d'abord configurer le travail, puis l'activer.</span><span class="sxs-lookup"><span data-stu-id="74b9a-121">You must first configure and then enable the job.</span></span>  
  
 <span data-ttu-id="74b9a-122">Par exemple, vous pouvez configurer le travail DTA Purge and Archive pour exécuter toutes les 20 minutes et définir les paramètres LiveHours = 1 et nombre = 0.</span><span class="sxs-lookup"><span data-stu-id="74b9a-122">For example, you can configure the DTA Purge and Archive job to run every 20 minutes, and set LiveHours=1 and LiveDays=0.</span></span> <span data-ttu-id="74b9a-123">La première fois que ce travail de l’Agent SQL Server s’exécute (T0), il effectue une sauvegarde de la base de données de suivi en créant une archive et une entrée est enregistrée dans la base de données avec cet horodatage.</span><span class="sxs-lookup"><span data-stu-id="74b9a-123">The first time this SQL Server Agent job runs (T0), it takes a backup of the tracking database by creating an archive and an entry is saved in the database with this timestamp.</span></span> <span data-ttu-id="74b9a-124">L'archivage doit avoir réussi pour pouvoir purger les données de suivi.</span><span class="sxs-lookup"><span data-stu-id="74b9a-124">A successful archive is necessary in order to purge tracking data.</span></span> <span data-ttu-id="74b9a-125">Si l'archivage a réussi, toutes les données associées aux instances qui se sont terminées il y a plus d'une heure sont purgées.</span><span class="sxs-lookup"><span data-stu-id="74b9a-125">If the archive was successful, then all the data associated with the instances that completed over an hour ago is purged.</span></span> <span data-ttu-id="74b9a-126">À chaque exécution du travail, les données terminées depuis plus d'une heure sont supprimées.</span><span class="sxs-lookup"><span data-stu-id="74b9a-126">Each time the job runs, completed data over one hour old is purged.</span></span> <span data-ttu-id="74b9a-127">Lors de la troisième exécution (après une heure), une nouvelle archive est créée contenant les données de toutes les instances insérées dans la base de données des suivis au cours de la dernière heure.</span><span class="sxs-lookup"><span data-stu-id="74b9a-127">On the 3rd run (after one hour), a new archive is created that contains the data for all instances that were inserted into the tracking database in the last one hour segment.</span></span>  
  
 <span data-ttu-id="74b9a-128">Voici comment vous pouvez configurer l’archivage et Purge étape du travail DTA Purge and Archive correspondant à l’exemple :</span><span class="sxs-lookup"><span data-stu-id="74b9a-128">Here is how you would configure the Archive and Purge step in the DTA Purge and Archive job to match the example:</span></span>  
  
```  
exec dtasp_BackupAndPurgeTrackingDatabase  
1, --@nLiveHours 1,   
0, --@nLiveDays   
1, --@nHardDeleteDays   
‘\\server\backup’, --@nvcFolder   
null, --@nvcValidatingServer   
0 --@fForceBackup Soft purge process  
```  
  
 <span data-ttu-id="74b9a-129">L'horodatage de la dernière sauvegarde est stocké dans la base de données des suivis BizTalk et permet de garantir que les données sont purgées uniquement si elles sont contenues dans l'archive précédente.</span><span class="sxs-lookup"><span data-stu-id="74b9a-129">The time stamp of the last backup is stored in the BizTalk Tracking database and ensures that data is only purged if it is in the previous archive.</span></span> <span data-ttu-id="74b9a-130">Pour plus de fiabilité, les archivages sont effectués environ toutes les 10 minutes.</span><span class="sxs-lookup"><span data-stu-id="74b9a-130">For additional reliability, archives are overlapped by approximately 10 minutes.</span></span> <span data-ttu-id="74b9a-131">La figure ci-dessous, basée sur l'exemple précédent, illustre le processus de purge normale.</span><span class="sxs-lookup"><span data-stu-id="74b9a-131">The following figure, based on the example above, shows the soft purge process.</span></span> <span data-ttu-id="74b9a-132">Notez que les tâches d'archivage et de purge ne sont pas nécessairement simultanées.</span><span class="sxs-lookup"><span data-stu-id="74b9a-132">Note that the archiving and purging tasks do not necessarily happen at the same time.</span></span>  
  
 <span data-ttu-id="74b9a-133">**Processus de purge**</span><span class="sxs-lookup"><span data-stu-id="74b9a-133">**Soft purge process**</span></span>  
  
 <span data-ttu-id="74b9a-134">![Processus de purge](../core/media/archivingandpurging.gif "archivingandpurging")</span><span class="sxs-lookup"><span data-stu-id="74b9a-134">![Soft purge process](../core/media/archivingandpurging.gif "archivingandpurging")</span></span>  
  
## <a name="hard-purge"></a><span data-ttu-id="74b9a-135">Purge complète</span><span class="sxs-lookup"><span data-stu-id="74b9a-135">Hard purge</span></span>
  
 <span data-ttu-id="74b9a-136">Seules les données associées à des instances terminées étant supprimées, si un nombre important d'instances de boucle s'exécutent indéfiniment, votre base de données risque d'augmenter de taille et d'être impossible à purger.</span><span class="sxs-lookup"><span data-stu-id="74b9a-136">Because the soft purge only purges data associated with completed instances, if you have many looping instances that run indefinitely, then your tracking database would grow and these instances would never be purged.</span></span> <span data-ttu-id="74b9a-137">La date de purge complète permet de purger toutes les informations antérieures à l'intervalle spécifié, à l'exception des informations indiquant l'existence d'un service.</span><span class="sxs-lookup"><span data-stu-id="74b9a-137">The hard purge date allows all information older than the specified interval to be purged except for information indicating a service's existence.</span></span> <span data-ttu-id="74b9a-138">Vous définissez la purge dur à l’aide de la  **@nHardDeleteDays**  paramètre Purge et d’archivage étape dans le travail de Purge et d’archivage DTA.</span><span class="sxs-lookup"><span data-stu-id="74b9a-138">You set the hard purge using the **@nHardDeleteDays** parameter in the Archive and Purge step in the DTA Archive and Purge job.</span></span> <span data-ttu-id="74b9a-139">Le paramètre de purge complète doit toujours être supérieur à votre paramètre de purge normale.</span><span class="sxs-lookup"><span data-stu-id="74b9a-139">The hard purge setting should always be greater than your soft purge setting.</span></span> <span data-ttu-id="74b9a-140">En d’autres termes,  **@nHardDeleteDays**  doit être supérieure à la somme des  **@nLiveHours**  et  **@nLiveDays** .</span><span class="sxs-lookup"><span data-stu-id="74b9a-140">In other words, **@nHardDeleteDays** should be greater than the sum of **@nLiveHours** and **@nLiveDays**.</span></span>  
  
 <span data-ttu-id="74b9a-141">L'archivage et la purge incluent les fonctions décrites dans le tableau suivant :</span><span class="sxs-lookup"><span data-stu-id="74b9a-141">Archiving and purging includes the features described in the following table:</span></span>  
  
|<span data-ttu-id="74b9a-142">Fonctionnalité</span><span class="sxs-lookup"><span data-stu-id="74b9a-142">Feature</span></span>|<span data-ttu-id="74b9a-143"> Description</span><span class="sxs-lookup"><span data-stu-id="74b9a-143">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="74b9a-144">Purge complète</span><span class="sxs-lookup"><span data-stu-id="74b9a-144">Hard purge</span></span>|<span data-ttu-id="74b9a-145">Vous permet de configurer un intervalle de temps pour purger les informations relatives aux instances non achevées antérieures à une date spécifiée.</span><span class="sxs-lookup"><span data-stu-id="74b9a-145">Enables you to configure a time interval to purge information for incomplete instances older than a specified date.</span></span>|  
|<span data-ttu-id="74b9a-146">Copie des messages suivis dans la base de données des suivis</span><span class="sxs-lookup"><span data-stu-id="74b9a-146">Copying tracked messages to tracking database</span></span>|<span data-ttu-id="74b9a-147">À l'aide de l'option CopyTrackedMessageToDTA, vous pouvez copier directement les messages suivis à partir des serveurs MessageBox vers votre base de données des suivis BizTalk.</span><span class="sxs-lookup"><span data-stu-id="74b9a-147">Using the CopyTrackedMessageToDTA option, you can directly copy tracked messages from the MessageBox servers to your BizTalk Tracking database.</span></span> <span data-ttu-id="74b9a-148">Cette opération est obligatoire pour pouvoir purger les données avec le travail DTA Purge and Archive.</span><span class="sxs-lookup"><span data-stu-id="74b9a-148">This is required in order to purge data using the DTA Purge and Archive job.</span></span>|  
|<span data-ttu-id="74b9a-149">Validation des archives</span><span class="sxs-lookup"><span data-stu-id="74b9a-149">Archive validation</span></span>|<span data-ttu-id="74b9a-150">Vous permet de configurer en option un serveur de base de données secondaire pour valider les archives à mesure de leur création.</span><span class="sxs-lookup"><span data-stu-id="74b9a-150">Enables you to optionally set up a secondary database server to validate the archives as they are created.</span></span>|  
|<span data-ttu-id="74b9a-151">Prise en charge du suivi pour plusieurs versions de base de données des suivis BizTalk</span><span class="sxs-lookup"><span data-stu-id="74b9a-151">Tracking support for multiple BizTalk Tracking database versions</span></span>|<span data-ttu-id="74b9a-152">Permet de vous permet d’utiliser le suivi de la prise en charge avec BizTalk Server base de données des archives.</span><span class="sxs-lookup"><span data-stu-id="74b9a-152">Enables you to use tracking support with BizTalk Server database archives.</span></span>|  
|<span data-ttu-id="74b9a-153">Réduction des données de suivi</span><span class="sxs-lookup"><span data-stu-id="74b9a-153">Reduction of tracking data</span></span>|<span data-ttu-id="74b9a-154">Réduit de manière substantielle la quantité de données de suivi stockées sans réduire les informations de suivi générées.</span><span class="sxs-lookup"><span data-stu-id="74b9a-154">Substantially reduces the amount of tracking data stored without reducing any tracking information generated.</span></span> <span data-ttu-id="74b9a-155">Ceci permet de limiter la croissance de la base de données des suivis.</span><span class="sxs-lookup"><span data-stu-id="74b9a-155">This results in slower growth of the tracking database.</span></span>|  
|<span data-ttu-id="74b9a-156">Opérations de suivi plus rapides, optimisation significative des schémas de base de données</span><span class="sxs-lookup"><span data-stu-id="74b9a-156">Faster tracking operations, significant optimization in database schemas</span></span>|<span data-ttu-id="74b9a-157">Permet d'utiliser des tâches de suivi pour rechercher des messages et des instances de service dans des bases de données volumineuses. Cette fonction a été considérablement améliorée.</span><span class="sxs-lookup"><span data-stu-id="74b9a-157">Enables you to use tracking tasks for finding messages and service instances on large databases; this feature has been significantly optimized.</span></span>|  
  
> [!NOTE]
>  <span data-ttu-id="74b9a-158">Si vous rencontrez des problèmes de performances qui sont momentanément résolus par une purge de la base de données de suivi BizTalk, et que vous souhaitez configurer BizTalk de sorte que les informations de suivi ne soient plus collectées, vous pouvez envisager de désactiver le suivi global.</span><span class="sxs-lookup"><span data-stu-id="74b9a-158">If you are having performance issues that are momentarily addressed by purging the BizTalk tracking database, and you want to configure BizTalk to no longer collect tracking information, you may want to consider turning off global tracking.</span></span> <span data-ttu-id="74b9a-159">Consultez [désactiver le suivi Global](../core/how-to-turn-off-global-tracking.md).</span><span class="sxs-lookup"><span data-stu-id="74b9a-159">See [Turn Off Global Tracking](../core/how-to-turn-off-global-tracking.md).</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="74b9a-160">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="74b9a-160">Next steps</span></span>
  
-   [<span data-ttu-id="74b9a-161">Liste de vérification : archivage et purge de la base de données de suivi BizTalk</span><span class="sxs-lookup"><span data-stu-id="74b9a-161">Checklist: Archiving and Purging the BizTalk Tracking Database</span></span>](../core/checklist-archiving-and-purging-the-biztalk-tracking-database.md)  
  
-   [<span data-ttu-id="74b9a-162">Configurer le rôle BTS_BACKUP_USERS pour l’archivage et la purge des données de la base de données de suivi BizTalk</span><span class="sxs-lookup"><span data-stu-id="74b9a-162">Configure the BTS_BACKUP_USERS Role for Archiving and Purging Data from the BizTalk Tracking Database</span></span>](../core/configure-bts_backup_users-role-to-archive-and-purge-from-tracking-database.md)  
  
-   [<span data-ttu-id="74b9a-163">Configurer le travail de purge et d’archivage DTA</span><span class="sxs-lookup"><span data-stu-id="74b9a-163">Configure the DTA Purge and Archive Job</span></span>](../core/how-to-configure-the-dta-purge-and-archive-job.md)  
  
-   [<span data-ttu-id="74b9a-164">Purger des données de base de données de suivi BizTalk</span><span class="sxs-lookup"><span data-stu-id="74b9a-164">Purge Data from the BizTalk Tracking Database</span></span>](../core/how-to-purge-data-from-the-biztalk-tracking-database.md)  
  
-   [<span data-ttu-id="74b9a-165">Purger manuellement des données de la base de données de suivi BizTalk</span><span class="sxs-lookup"><span data-stu-id="74b9a-165">Manually Purge Data from the BizTalk Tracking Database</span></span>](../core/how-to-manually-purge-data-from-the-biztalk-tracking-database.md)  
  
-   [<span data-ttu-id="74b9a-166">Activer la validation automatique des archives</span><span class="sxs-lookup"><span data-stu-id="74b9a-166">Enable Automatic Archive Validation</span></span>](../core/how-to-enable-automatic-archive-validation.md)  
  
-   [<span data-ttu-id="74b9a-167">Copier des messages suivis dans la base de données de suivi BizTalk</span><span class="sxs-lookup"><span data-stu-id="74b9a-167">Copy Tracked Messages into the BizTalk Tracking Database</span></span>](../core/how-to-copy-tracked-messages-into-the-biztalk-tracking-database.md)  
  
-   [<span data-ttu-id="74b9a-168">Amélioration des performances des processus d’archivage et de purge</span><span class="sxs-lookup"><span data-stu-id="74b9a-168">Improving the Performance of the Archiving and Purging Process</span></span>](../core/improving-the-performance-of-the-archiving-and-purging-process.md)  
  
-   [<span data-ttu-id="74b9a-169">Désactiver le suivi global</span><span class="sxs-lookup"><span data-stu-id="74b9a-169">Turn Off Global Tracking</span></span>](../core/how-to-turn-off-global-tracking.md)