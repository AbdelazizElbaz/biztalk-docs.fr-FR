---
title: "Comment créer une tâche d’analyse personnalisé | Documents Microsoft"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- BAM, DTS tasks
- DTS tasks
- DTS packages, tasks
- BAM, processing
ms.assetid: 6046c113-fb58-4e72-8f48-5470e52be9a8
caps.latest.revision: "7"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: b3566e40deaa05886ead701e1871634cf6fb94e2
ms.sourcegitcommit: 5abd0ed3f9e4858ffaaec5481bfa8878595e95f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/28/2017
---
# <a name="how-to-create-a-custom-analysis-task"></a><span data-ttu-id="510d6-102">Création d'une tâche d'analyse personnalisée</span><span class="sxs-lookup"><span data-stu-id="510d6-102">How to Create a Custom Analysis Task</span></span>
<span data-ttu-id="510d6-103">Le moyen le plus simple de créer une tâche DTS personnalisée pour traiter des données BAM consiste à démarrer à partir du lot généré automatiquement par BAM et à remplacer l'ensemble du processus existant.</span><span class="sxs-lookup"><span data-stu-id="510d6-103">The easiest way to create a custom DTS task for processing BAM data is to start from the package that is auto-generated by BAM and replace all the actual data processing.</span></span>  
  
### <a name="to-create-a-custom-dts-task"></a><span data-ttu-id="510d6-104">Pour créer une tâche DTS personnalisée</span><span class="sxs-lookup"><span data-stu-id="510d6-104">To create a custom DTS task</span></span>  
  
1.  <span data-ttu-id="510d6-105">Créez une définition BAM nécessitant un cube OLAP.</span><span class="sxs-lookup"><span data-stu-id="510d6-105">Create a BAM Definition that requires an OLAP cube.</span></span> <span data-ttu-id="510d6-106">Utilisez par exemple les Assistants Excel et gardez un rapport de tableau croisé dynamique sous la forme d'une vue non-RTA.</span><span class="sxs-lookup"><span data-stu-id="510d6-106">For example use the Excel wizards, and leave one PivotTable® report as non-RTA view.</span></span>  
  
2.  <span data-ttu-id="510d6-107">Ouvrez le lot DTS de traitement des cubes créé par BAM.</span><span class="sxs-lookup"><span data-stu-id="510d6-107">Open the DTS package for cube processing that BAM creates.</span></span> <span data-ttu-id="510d6-108">BAM crée un tel package pour chaque vue, intitulé BAM_AN_\<*nom de la vue*\>.</span><span class="sxs-lookup"><span data-stu-id="510d6-108">BAM creates one such package for each view, known as BAM_AN_\<*View Name*\>.</span></span>  
  
3.  <span data-ttu-id="510d6-109">Ouvrez le lot dans le Concepteur DTS, puis supprimez toutes les étapes à l'exception des deux premières et de la dernière.</span><span class="sxs-lookup"><span data-stu-id="510d6-109">Open the Package in the DTS Designer and remove all steps except the first two steps and the last step.</span></span> <span data-ttu-id="510d6-110">Peut-être voudrez-vous aussi conserver la connexion avec la base de données d'importation principale.</span><span class="sxs-lookup"><span data-stu-id="510d6-110">You may also want to keep the connection to the Primary Import database.</span></span>  
  
4.  <span data-ttu-id="510d6-111">Modifiez les propriétés de la première tâche ActiveX®.</span><span class="sxs-lookup"><span data-stu-id="510d6-111">Edit the properties of the first ActiveX® task.</span></span> <span data-ttu-id="510d6-112">Supprimez toutes les lignes contenant DTSGlobalVariables.Parent.Steps car elles font référence aux étapes supprimées.</span><span class="sxs-lookup"><span data-stu-id="510d6-112">Remove all lines that contain DTSGlobalVariables.Parent.Steps, because they refer to the deleted steps.</span></span> <span data-ttu-id="510d6-113">Le script commence ainsi :</span><span class="sxs-lookup"><span data-stu-id="510d6-113">The script begins with:</span></span>  
  
    ```  
    serverName = "<your server here>"   
    databaseName = "<your analysis database here>"  
    cubeName = "<your cube name here>"  
    ```  
  
    > [!NOTE]
    >  <span data-ttu-id="510d6-114">La tâche Commencer l'analyse de données, qui est la deuxième du lot, est très importante car elle fournit à votre lot :</span><span class="sxs-lookup"><span data-stu-id="510d6-114">The task "Begin Data Analysis" (the second task in the package) is very important because it gives your package:</span></span>  
    >   
    >  -   <span data-ttu-id="510d6-115">Une fenêtre interactive pour un traitement incrémentiel des activités terminées (vue SQL dynamique intitulée bam_(BamView)_View(Activity)_CompletedInstancesWindow</span><span class="sxs-lookup"><span data-stu-id="510d6-115">A moving window for incremental processing of the completed Activities (the dynamic SQL view named  bam_(BamView)_View(Activity)_CompletedInstancesWindow</span></span>  
    > -   <span data-ttu-id="510d6-116">Un instantané des activités qui sont en cours, une table nommée bam\_(BamView) _View (Activity) _ActiveInstancesSnapshot.</span><span class="sxs-lookup"><span data-stu-id="510d6-116">A Snapshot of the Activities that are in progress - a table named  bam\_(BamView)_View(Activity)_ActiveInstancesSnapshot.</span></span>  
  
5.  <span data-ttu-id="510d6-117">Vous obtenez la vue et la table grâce à une courte transaction, au cours de laquelle vous n'insérez aucune donnée, de façon à ce que les données représentent un véritable instantané de la base de données d'importation principale.</span><span class="sxs-lookup"><span data-stu-id="510d6-117">Obtain the view and table in a short transaction, during which you insert no data, so that the data represents a real instantaneous snapshot of the Primary Import database.</span></span> <span data-ttu-id="510d6-118">Effectuez une ou plusieurs étapes pour réaliser la véritable transformation des données en fonction de la vue et de la table.</span><span class="sxs-lookup"><span data-stu-id="510d6-118">Implement one or more steps to do the actual data transformations based on the view and table as input data.</span></span> <span data-ttu-id="510d6-119">Si l'objectif de votre tâche d'analyse est autre que le remplissage d'un cube OLAP, veillez à conserver un horodatage du moment où la tâche est effectuée pour la dernière fois et à remplacer la première tâche ActiveX par le code qui associe cet horodatage à la variable globale CompletedCubeLastProcessTime.</span><span class="sxs-lookup"><span data-stu-id="510d6-119">If the purpose of your analysis task is something other than filling an OLAP cube, remember to keep a timestamp of when your job committed for the last time and replace the first ActiveX task with code that assigns this timestamp to the global variable "CompletedCubeLastProcessTime".</span></span> <span data-ttu-id="510d6-120">La deuxième tâche utilise cette variable pour garantir qu'aucune donnée n'est perdue, ni traitée deux fois en cas d'incident et de redémarrage du lot DTS.</span><span class="sxs-lookup"><span data-stu-id="510d6-120">The second task uses this variable to make sure that there is no missed data and that no data processes twice in case of a crash and restart of the DTS package.</span></span>  
  
6.  <span data-ttu-id="510d6-121">Vous devez enfin appeler la dernière tâche, intitulée Terminer l'analyse de données.</span><span class="sxs-lookup"><span data-stu-id="510d6-121">Finally, you must call the last task, which is "end data analysis".</span></span> <span data-ttu-id="510d6-122">Cette tâche libère les activités traitées et terminées de façon à ce qu'elles soient archivées et supprimées de l'importation principale dès qu'elles se trouvent en dehors de la fenêtre en ligne.</span><span class="sxs-lookup"><span data-stu-id="510d6-122">This task releases the completed activities that were processed, so that they can be archived and removed from the primary import once they are outside of the online window.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="510d6-123">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="510d6-123">See Also</span></span>  
 [<span data-ttu-id="510d6-124">À l’aide de Business Activity Monitoring</span><span class="sxs-lookup"><span data-stu-id="510d6-124">Using Business Activity Monitoring</span></span>](../core/using-business-activity-monitoring.md)