---
title: "Comment identifier les goulots d’étranglement dans la MessageBox Database2 | Documents Microsoft"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 10b2eb1e-541c-457d-9735-ac6fb069b209
caps.latest.revision: "7"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: e69966f0f3ecff5a27788c9a92d4e3f1ac0eae68
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/20/2017
---
# <a name="how-to-identify-bottlenecks-in-the-messagebox-database"></a><span data-ttu-id="bd3c7-102">Identification des goulots d'étranglement dans la base de données MessageBox</span><span class="sxs-lookup"><span data-stu-id="bd3c7-102">How to Identify Bottlenecks in the MessageBox Database</span></span>
<span data-ttu-id="bd3c7-103">Pour identifier les goulots d'étranglement dans la base de données MessageBox, commencez par vous assurer que le service SQL-Server-Agent est démarré.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-103">To identify bottlenecks in the MessageBox database, first ensure that the SQL-Server-Agent Service is started.</span></span> <span data-ttu-id="bd3c7-104">Modifiez le mode de démarrage du service de Manuel à Auto : ainsi, le service redémarrera automatiquement en cas de redémarrage du serveur.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-104">Change the Service startup state from Manual to Auto so that even if the server is restarted, the service will automatically restart.</span></span>  
  
 <span data-ttu-id="bd3c7-105">Par défaut, le service BizTalk est limité si le spouleur ou les tables TrackingData ou ApplicationQ augmentent.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-105">By default the BizTalk service will throttle if the Spool, TrackingData or ApplicationQ tables grow.</span></span> <span data-ttu-id="bd3c7-106">Ces tables sont nettoyées par les travaux de SQL-Agent qui, s'ils ne s'exécutent pas, font augmenter le spouleur et entraînent l'activation des limitations visant à protéger la base de données de toute pression supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-106">These tables are pruned by SQL-Agent jobs, which, if not running will cause the Spool to grow causing throttling to kick in protecting the database from additional pressure.</span></span> <span data-ttu-id="bd3c7-107">Vérifiez l'état des compteurs de performances suivants :</span><span class="sxs-lookup"><span data-stu-id="bd3c7-107">Check the status of the following performance counters:</span></span>  
  
-   <span data-ttu-id="bd3c7-108">BizTalk : agent des messages (nom de l'hôte) état de limitation de remise de messages</span><span class="sxs-lookup"><span data-stu-id="bd3c7-108">BizTalk:Message Agent (Host Name) Message Delivery Throttling State</span></span>  
  
-   <span data-ttu-id="bd3c7-109">BizTalk : agent des messages (nom de l'hôte) état de limitation de publication de messages</span><span class="sxs-lookup"><span data-stu-id="bd3c7-109">BizTalk:Message Agent (Host Name) Message Publishing Throttling State</span></span>  
  
 <span data-ttu-id="bd3c7-110">La valeur 0 indique qu'aucune limitation n'est appliquée.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-110">A value of 0 indicates no throttling is occurring.</span></span> <span data-ttu-id="bd3c7-111">La valeur 6 indique que le système est limité à cause d'une augmentation de la base de données.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-111">A value of 6 is indicative the system is throttling due to database growth.</span></span> <span data-ttu-id="bd3c7-112">Reportez-vous à la documentation relative à l'interprétation des valeurs de ces compteurs.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-112">Please refer to the documentation on how to interpret other values of these counters.</span></span>  
  
## <a name="spool-table-growth"></a><span data-ttu-id="bd3c7-113">Augmentation du spouleur</span><span class="sxs-lookup"><span data-stu-id="bd3c7-113">Spool Table Growth</span></span>  
 <span data-ttu-id="bd3c7-114">Le spouleur peut augmenter pour de multiples raisons.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-114">The Spool can start growing for multiple reasons.</span></span> <span data-ttu-id="bd3c7-115">L'augmentation du spouleur peut être due à l'augmentation des files d'attente de l'application.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-115">One reason for Spool growth is if the application queues are growing.</span></span> <span data-ttu-id="bd3c7-116">Celles-ci peuvent augmenter pour diverses raisons, à cause de goulots d'étranglement en aval et/ou un conflit de ressources par exemple.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-116">They could grow due to various reasons like downstream bottlenecks and/or resource contention.</span></span>  
  
 <span data-ttu-id="bd3c7-117">Si les files d'attente de l'application sont courtes et si le spouleur reste important, vérifiez que les travaux de purge suivent la cadence.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-117">If the application queues are small and the Spool is still large, verify that the purge jobs are keeping up.</span></span> <span data-ttu-id="bd3c7-118">Vérifiez que le service SQL-Agent est en cours d'exécution puis que les travaux suivants s'effectuent correctement :</span><span class="sxs-lookup"><span data-stu-id="bd3c7-118">Ensure that the SQL-Agent Service is running and then verify that the following jobs are successfully completing:</span></span>  
  
-   <span data-ttu-id="bd3c7-119">MessageBox_Message_Cleanup_BizTalkMessageBoxDb</span><span class="sxs-lookup"><span data-stu-id="bd3c7-119">MessageBox_Message_Cleanup_BizTalkMessageBoxDb</span></span>  
  
-   <span data-ttu-id="bd3c7-120">MessageBox_Parts_Cleanup_BizTalkMessageBoxDb</span><span class="sxs-lookup"><span data-stu-id="bd3c7-120">MessageBox_Parts_Cleanup_BizTalkMessageBoxDb</span></span>  
  
 <span data-ttu-id="bd3c7-121">Si la table MessageZeroSum est importante, cela signifie que les messages ont été traités (DeQueue s'est terminé avec succès et a supprimé les données des tables de la file d'attente de l'application) et les rangées ont été marquées pour suppression.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-121">If the MessageZeroSum table is large it indicates that the messages have been processed (DeQueue has successfully completed and deleted data from the Application Queue tables) and the rows have been flagged for deletion.</span></span> <span data-ttu-id="bd3c7-122">Cependant, les travaux de purge ne sont pas capables de suivre la cadence de suppression des données.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-122">However, the purge jobs are unable to keep up with deleting the data.</span></span> <span data-ttu-id="bd3c7-123">Cela s'explique en partie par les conflits d'UC importants que rencontre SQL Server, qui ont un impact sur la capacité des travaux de purge à suivre la cadence (du fait d'une UC insuffisante).</span><span class="sxs-lookup"><span data-stu-id="bd3c7-123">One reason for this is if the SQL-Server machine is experiencing severe CPU contention, impacting the ability of the purge jobs to keep up due to CPU starvation.</span></span>  
  
## <a name="application-queue-table-growth"></a><span data-ttu-id="bd3c7-124">Augmentation de la file d'attente de l'application</span><span class="sxs-lookup"><span data-stu-id="bd3c7-124">Application Queue Table Growth</span></span>  
 <span data-ttu-id="bd3c7-125">Les files d'attente de l'application hébergent les données en cours de transition qui, une fois traitées, sont nettoyées par DeQueue.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-125">Application queues host in-flight transition data that, once processed, are cleaned up by DeQueue.</span></span>  
  
 <span data-ttu-id="bd3c7-126">Une fois ces messages traités, le spouleur (qui détient les références à ces rangées) peut être nettoyé.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-126">After these messages are processed the Spool (holding references to these rows) can be cleaned.</span></span>  
  
 <span data-ttu-id="bd3c7-127">Par exemple, la file RxHostQ publie des données dans la file PxHostQ de l'orchestration, qui à son tour publie des données dans la file d'envoi TxHostQ, chaque file référençant une rangée dans le spouleur.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-127">For example, the RxHostQ publishes data to the orchestration PxHostQ which in turn publishes data to the sending TxHostQ each referencing a row in the Spool table.</span></span> <span data-ttu-id="bd3c7-128">Une fois les messages d'une file HostQ particulière traités avec succès par le système, ces rangées sont supprimées par DeQueue.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-128">After the messages for a particular HostQ have successfully processed through the system these rows are deleted by DeQueue.</span></span> <span data-ttu-id="bd3c7-129">Une fois ces rangées supprimées, le spouleur (qui n'est plus référencé par ces rangées) peut alors être nettoyé par les travaux de purge.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-129">After these rows are deleted, the Spool (which is no longer referenced by these rows) can then be cleaned by the purge jobs.</span></span>  
  
 <span data-ttu-id="bd3c7-130">L'augmentation de la file d'attente de l'application indique que les instances de l'hôte chargées de la drainer ne sont pas capables de suivre la vitesse d'entrée, c'est-à-dire la vitesse à laquelle les messages sont publiés dans une file d'attente donnée de l'application.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-130">Application Queue growth indicates that the Host Instances responsible for draining the Application Queue are unable to keep up with the incoming rate, that is, the rate at which messages are being published to the particular application queue.</span></span>  
  
 <span data-ttu-id="bd3c7-131">Par exemple, la file d'attente de l'application d'orchestration (PxHostQ) peut augmenter parce que le serveur chargé du traitement des orchestrations est lié à l'UC et incapable de les traiter plus rapidement.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-131">For example, the orchestration application queue (PxHostQ) may grow because the server responsible for processing orchestrations is CPU bound and unable to process any faster.</span></span> <span data-ttu-id="bd3c7-132">Cependant, si le serveur de réception est rapide, il peut publier les messages plus rapidement que le serveur d'orchestration ne peut les traiter, ce qui entraîne également une augmentation de la file d'attente de l'application.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-132">However, if the receiving server is fast it may publish faster than what the orchestration server can process leading to the application queue growth.</span></span>  
  
 <span data-ttu-id="bd3c7-133">L'augmentation de la file d'attente de l'orchestration peut également être due à un conflit de mémoire : lorsque de nombreuses instances d'orchestration à long terme sont toutes instanciées en même temps dans la mémoire, celle-ci est alors encombrée et active indirectement la limitation de la réserve de threads, jusqu'à-ce que la pression exercée sur la mémoire se relâche.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-133">Another reason for orchestration queue growth could be due to memory contention whereby numerous long running orchestration instances are all concurrently instantiated in memory, causing memory bloat indirectly causing throttling to shrink the thread pool until memory pressure is relieved.</span></span> <span data-ttu-id="bd3c7-134">La file d'attente de l'application d'envoi peut augmenter si le système en aval est incapable de recevoir les messages sortants de BizTalk suffisamment rapidement.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-134">One reason why the send application queue may grow is if the downstream system is unable to receive (outgoing from BizTalk) messages fast enough.</span></span> <span data-ttu-id="bd3c7-135">Les messages restent donc dans le système BizTalk, ce qui entraîne l'augmentation de la file d'attente de l'application qui finit par activer la limitation de la vitesse de réception, celle-ci ayant un impact sur le débit global du système.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-135">Thus the messages will continue to reside within the BizTalk system causing Application queue growth which will ultimately cause throttling to kick in reducing the receiving rate impacting the overall throughput of the system.</span></span>  
  
## <a name="trackingdata-table-growth"></a><span data-ttu-id="bd3c7-136">Augmentation de la table TrackingData</span><span class="sxs-lookup"><span data-stu-id="bd3c7-136">TrackingData Table Growth</span></span>  
 <span data-ttu-id="bd3c7-137">La table TrackingData de la base de données MessageBox est une table de transition dans laquelle les intercepteurs écrivent des données de suivi pour le suivi BAM, ainsi que le suivi des messages et des instances de service.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-137">The TrackingData table in the MessageBox database is a transition table into which interceptors write tracking data for both message and service instance tracking and BAM tracking.</span></span> <span data-ttu-id="bd3c7-138">Si le suivi a été désactivé, cette table doit être vide.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-138">If tracking is disabled, this table should be empty.</span></span> <span data-ttu-id="bd3c7-139">Le suivi des messages et des instances de service est activé par défaut pour les pipelines et les orchestrations dans les événements d'entrée/de sortie.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-139">By default message and service instance tracking is enabled for the pipelines and orchestrations In/Out events.</span></span>  
  
 <span data-ttu-id="bd3c7-140">Si le suivi des corps de message est activé, assurez-vous que le serveur MessageBox (c'est-à-dire l'hôte dont le suivi est autorisé) est en cours d'exécution.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-140">If Message Body Tracking is enabled, ensure that the MessageBox server (that is, the host with "allow host tracking") is running.</span></span> <span data-ttu-id="bd3c7-141">Il limitera le goulot d'étranglement en déplaçant les données de la table TrackingData de la base de données MessageBox vers les tables BizTalkDTADb.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-141">It will reduce a bottleneck as it moves data from TrackingData table in the MessageBox database to the BizTalkDTADb tables.</span></span>  
  
 <span data-ttu-id="bd3c7-142">Il est possible de suivre des événements personnalisés en activant le suivi des messages et des instances de services personnalisé (sur des propriétés promues, par exemple) et le suivi des corps de message.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-142">It is possible to track custom events by enabling custom message and service instance  tracking, for example, on promoted properties and message body tracking.</span></span> <span data-ttu-id="bd3c7-143">En plus des données de suivi, les données BAM sont également écrites dans cette table.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-143">In addition to tracking data, BAM data is also written to this table.</span></span> <span data-ttu-id="bd3c7-144">Il incombe à TDDS (l'hôte pour lequel le suivi est activé) de déplacer ces données de la base de données MessageBox vers les bases de données BizTalkDTADb et BAMPrimaryImport, puis de les supprimer une fois le transfert réussi.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-144">It is the responsibility of TDDS (the host on which tracking is enabled) to move this data from the MessageBox database to the BizTalkDTADb and BAMPrimaryImport databases, and then once successfully moved, delete this data.</span></span> <span data-ttu-id="bd3c7-145">Les données de suivi des corps de message sont déplacées séparément par le travail de SQL-Agent TrackedMessages_Copy_BizTalkMsgBoxDb.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-145">Message body tracking data is moved separately by a SQL-Agent job TrackedMessages_Copy_BizTalkMsgBoxDb.</span></span>  
  
 <span data-ttu-id="bd3c7-146">Si TDDS est incapable de suivre la cadence à laquelle les intercepteurs écrivent les données dans la table TrackingData, cette table augmentera, ce qui activera des limitations qui auront un impact sur le débit constant.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-146">If TDDS is unable to keep up with the rate at which the interceptors are writing data to the TrackingData table, this table will grow, causing throttling to kick in, ultimately impacting sustainable throughput.</span></span> <span data-ttu-id="bd3c7-147">Pour résoudre ce problème, vérifiez qu'au moins 1 hôte est en cours d'exécution avec la fonction de suivi activée.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-147">To alleviate this problem, ensure that at least 1 host is running with tracking enabled.</span></span>  
  
 <span data-ttu-id="bd3c7-148">Si les données continuent de s'accumuler, vérifiez que la base de données BizTalkDTADb n'augmente pas de manière anarchique.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-148">If the data still builds up, verify the BizTalkDTADb database to ensure that the database is not growing out of control.</span></span> <span data-ttu-id="bd3c7-149">Vérifiez que le travail d'archivage et de purge est en cours d'exécution et qu'il est capable de suivre la cadence à laquelle les données arrivent.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-149">Ensure that the archiving and purging job is running and is able to keep up with the rate at which data is arriving.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="bd3c7-150">Le travail de purge est incapable de supprimer les données des tables BizTalkDTADb tant que ces données n'ont pas été archivées.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-150">The purge job is unable to delete data from the BizTalkDTADb tables until this data has been archived.</span></span>  
  
 <span data-ttu-id="bd3c7-151">Vérifiez que la table TrackingData n'augmente pas.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-151">Verify that the TrackingData table is not growing.</span></span> <span data-ttu-id="bd3c7-152">Vérifiez que le suivi (TDDS) est activé dans au moins 1 instance d'hôte en cours d'exécution.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-152">Ensure that at least 1 host instance that is running has tracking enabled (TDDS).</span></span> <span data-ttu-id="bd3c7-153">Si la base de données BizTalkDTADb devient trop volumineuse, cela peut nuire à la capacité de TDDS à déplacer les données de la base de données MessageBox vers la base de données BizTalkDTADb.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-153">If the BizTalkDTADb database has grown too large, it can have a negative impact on the ability of TDDS to move data from the MessageBox database to the BizTalkDTADb database.</span></span>  
  
 <span data-ttu-id="bd3c7-154">L'augmentation de la table TrackingData peut entraîner l'activation de limitations ayant un impact sur le débit d'exécution constant.</span><span class="sxs-lookup"><span data-stu-id="bd3c7-154">Growth in the TrackingData table can cause throttling to kick in, impacting sustainable runtime throughput.</span></span>