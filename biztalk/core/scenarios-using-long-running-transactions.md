---
title: "Scénarios à l’aide de Transactions à Long terme | Documents Microsoft"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- transactions, long-running
- long-running transactions, timeouts
- transactions, examples
- long-running transactions, examples
- long-running compensations
- examples, long-running transactions
- examples, custom compensations
ms.assetid: 76b3e0f8-44dc-419e-a73a-c2908b1d8795
caps.latest.revision: "3"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 05ac14bc6e333f963dda7cb9b33d1ebf371c0546
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/20/2017
---
# <a name="scenarios-using-long-running-transactions"></a><span data-ttu-id="a9a8a-102">Utilisation de transactions à long terme</span><span class="sxs-lookup"><span data-stu-id="a9a8a-102">Scenarios Using Long-Running Transactions</span></span>
<span data-ttu-id="a9a8a-103">Les scénarios suivants décrivent l'utilisation des transactions à long terme.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-103">The following scenarios describe the use of long running transactions.</span></span>  
  
## <a name="scenario-1-using-long-running-transactions-with-timeouts"></a><span data-ttu-id="a9a8a-104">Scénario 1 : Utilisation de longues Transactions avec des délais d’attente</span><span class="sxs-lookup"><span data-stu-id="a9a8a-104">Scenario 1: Using Long Running Transactions with Timeouts</span></span>  
 <span data-ttu-id="a9a8a-105">Les étendues à long terme peuvent être associées à un délai, qui est une durée logique au terme de laquelle le travail à long terme doit être fini.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-105">Long running scopes can be associated with a timeout, which is a logical time within which the long-running work must complete.</span></span> <span data-ttu-id="a9a8a-106">Si l’étendue ne se termine pas dans le délai spécifié, une exception de système prédéfini **TimeoutException** est déclenché.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-106">If the scope does not complete within the specified time, a pre-defined system exception **TimeoutException** is raised.</span></span>  
  
 <span data-ttu-id="a9a8a-107">Vous pouvez créer des processus à long terme soit en marquant l'intégralité de l'orchestration à long terme soit en imbriquant les autres étendues dans une étendue à long terme externe.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-107">You can create long running processes by either marking the entire orchestration as long running or having an outer long running scope nest any other scopes.</span></span> <span data-ttu-id="a9a8a-108">Dans le premier cas, un gestionnaire d'exceptions fourni par le système est exécuté, tandis que le second cas permet l'association de gestionnaires d'exceptions spécifiques à l'étendue externe.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-108">In the former scenario, a system-provided exception handler runs, whereas the latter allows associating specific exception handlers to the outer scope.</span></span> <span data-ttu-id="a9a8a-109">Le gestionnaire d'exceptions fourni par le système exécute le gestionnaire de compensation pour chacune des étendues transactionnelles imbriquées correctement terminées, le cas échéant, dans l'ordre inverse de leur achèvement.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-109">The default system-provided exception handler will run the compensation handler for each of the successfully completed nested transactional scopes, if any, in reverse order of their completion.</span></span> <span data-ttu-id="a9a8a-110">Vous pouvez obtenir le même résultat par le biais d'une auto-compensation en utilisant la forme Compenser dans le gestionnaire d'exceptions pour une transaction à long terme.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-110">You can achieve the same through self compensating by using the Compensate shape in the exception handler for a long running transaction.</span></span>  
  
 <span data-ttu-id="a9a8a-111">L'orchestration suivante illustre l'association des délais aux transactions à long terme.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-111">The following orchestration is a representation of how to associate timeouts with long running transactions.</span></span>  
  
 <span data-ttu-id="a9a8a-112">**Transactions à long terme avec délais d’attente**</span><span class="sxs-lookup"><span data-stu-id="a9a8a-112">**Long running transactions with timeouts**</span></span>  
  
 <span data-ttu-id="a9a8a-113">![Transactions de longue avec délais d’attente](../core/media/bts-trans-orch-fig7.gif "BTS_Trans_Orch_Fig7")</span><span class="sxs-lookup"><span data-stu-id="a9a8a-113">![Long running transactions with timeouts](../core/media/bts-trans-orch-fig7.gif "BTS_Trans_Orch_Fig7")</span></span>  
  
 <span data-ttu-id="a9a8a-114">Parfois, il est nécessaire d'assurer l'interface avec les systèmes hérités fonctionnant en mode par lots.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-114">Sometimes you may need to interface with legacy systems that operate in a batch fashion.</span></span> <span data-ttu-id="a9a8a-115">Ce scénario présente un bon de commande reçu et envoyé au système hérité.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-115">This scenario shows a purchase order being received and sent to the legacy system.</span></span> <span data-ttu-id="a9a8a-116">Le système hérité traite le bon de commande et renvoi un accusé de réception de bon de commande.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-116">The legacy system processes the purchase order and sends back a purchase order acknowledgement.</span></span> <span data-ttu-id="a9a8a-117">L'opération d'envoi initialise un ensemble de corrélations en utilisant le numéro du bon de commande et l'opération de réception suit cet ensemble de corrélations.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-117">The send operation initializes a correlation set using the purchase order number and the receive operation follows that correlation set.</span></span> <span data-ttu-id="a9a8a-118">L'opération de réception est une étendue à long terme avec une valeur de délai.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-118">The receive operation is also in a long running scope with a timeout value.</span></span>  
  
 <span data-ttu-id="a9a8a-119">Le moteur d'orchestration met l'instance d'orchestration en attente de la réception.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-119">The orchestration engine will dehydrate the orchestration instance waiting for the receive.</span></span> <span data-ttu-id="a9a8a-120">La corrélation garantit que la même instance d'orchestration est appelée une fois le message reçu.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-120">The correlation will ensure that the same orchestration instance is invoked after the message is received.</span></span> <span data-ttu-id="a9a8a-121">Si l’accusé de réception de commande d’achat n’arrive pas dans l’intervalle de temps spécifié par les valeurs de délai d’attente, un **TimeoutException** sera levée.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-121">If the purchase order acknowledgement does not arrive within the time interval specified by the timeout values, a **TimeoutException** will be thrown.</span></span>  
  
## <a name="scenario-2-using-long-running-transactions-with-custom-compensation"></a><span data-ttu-id="a9a8a-122">Scénario 2 : Utilisation de longues Transactions avec Compensation personnalisée</span><span class="sxs-lookup"><span data-stu-id="a9a8a-122">Scenario 2: Using Long Running Transactions with Custom Compensation</span></span>  
 <span data-ttu-id="a9a8a-123">Les orchestrations suivantes montrent comment associer et appeler des compensations personnalisées liées à des orchestrations entières.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-123">The following orchestrations demonstrate how to associate and invoke custom compensations associated with entire orchestrations.</span></span> <span data-ttu-id="a9a8a-124">Ce scénario insère un nouveau client et des informations de commande pour le client.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-124">This scenario inserts a new customer and inserts order details for the customer.</span></span> <span data-ttu-id="a9a8a-125">La logique de l'orchestration impose qu'en cas d'échec de l'insertion de la commande, l'insertion du client doit être annulée.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-125">The logic of the orchestration dictates that if the order insert fails, you should roll back the customer insert.</span></span> <span data-ttu-id="a9a8a-126">L'insertion du client peut être effectuée par un système hérité, et donc illustrée dans une orchestration pouvant être appelée séparément.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-126">The customer insert could be done by a legacy system, and is therefore, demonstrated in a separate callable orchestration.</span></span> <span data-ttu-id="a9a8a-127">L’orchestration appelée a la **personnalisé** propriété définie pour la compensation, qui fournit une feuille distincte pour le processus de compensation.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-127">The called orchestration has the **Custom** property set for compensation, which provides a separate sheet to do the compensation process.</span></span> <span data-ttu-id="a9a8a-128">La compensation doit supprimer le client récemment inséré.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-128">The compensation is to delete the newly inserted customer.</span></span>  
  
 <span data-ttu-id="a9a8a-129">L'orchestration appelante dispose d'une étendue à long terme pour effectuer l'insertion de la commande.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-129">The calling orchestration has a long running scope to do the order insert.</span></span> <span data-ttu-id="a9a8a-130">Cette étendue est imbriquée dans une étendue à long terme.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-130">This scope is nested within an outer long running scope.</span></span> <span data-ttu-id="a9a8a-131">L'étendue externe dispose d'un gestionnaire d'exceptions associé pour intercepter les exceptions.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-131">The outer scope has an exception handler associated to catch any exceptions.</span></span> <span data-ttu-id="a9a8a-132">Le gestionnaire utilise la forme Compenser pour appeler l'exception personnalisée associée à l'orchestration appelée pour annuler les modifications qui pourraient avoir été apportées pendant l'appel de l'orchestration.</span><span class="sxs-lookup"><span data-stu-id="a9a8a-132">The handler uses the Compensate shape to invoke the custom exception associated with the called orchestration to roll back any changes that might have occurred in the call to the orchestration.</span></span>  
  
 <span data-ttu-id="a9a8a-133">**Transactions à long terme avec compensation personnalisée**</span><span class="sxs-lookup"><span data-stu-id="a9a8a-133">**Long running transactions with custom compensation**</span></span>  
  
 <span data-ttu-id="a9a8a-134">![Transactions de longue avec compensation personnalisée](../core/media/bts-trans-orch-fig8.gif "BTS_Trans_Orch_Fig8")</span><span class="sxs-lookup"><span data-stu-id="a9a8a-134">![Long running transactions with custom compensation](../core/media/bts-trans-orch-fig8.gif "BTS_Trans_Orch_Fig8")</span></span>  
  
 <span data-ttu-id="a9a8a-135">**Orchestration appelée (principal)**</span><span class="sxs-lookup"><span data-stu-id="a9a8a-135">**Called orchestration (main)**</span></span>  
  
 <span data-ttu-id="a9a8a-136">![Appelée orchestration &#40; principal &#41; ] (../core/media/bts-trans-orch-fig9.gif "BTS_Trans_Orch_Fig9")</span><span class="sxs-lookup"><span data-stu-id="a9a8a-136">![Called orchestration &#40;main&#41;](../core/media/bts-trans-orch-fig9.gif "BTS_Trans_Orch_Fig9")</span></span>  
  
 <span data-ttu-id="a9a8a-137">**Orchestration appelée (compensation)**</span><span class="sxs-lookup"><span data-stu-id="a9a8a-137">**Called orchestration (compensation)**</span></span>  
  
 <span data-ttu-id="a9a8a-138">![Appelée orchestration &#40; compensation &#41; ] (../core/media/bts-trans-orch-fig10.gif "BTS_Trans_Orch_Fig10")</span><span class="sxs-lookup"><span data-stu-id="a9a8a-138">![Called orchestration &#40;compensation&#41;](../core/media/bts-trans-orch-fig10.gif "BTS_Trans_Orch_Fig10")</span></span>