---
title: Utilisation des convois | Documents Microsoft
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 1028ab37-7ead-41a6-a186-53e5344d1a28
caps.latest.revision: "19"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 42f1c9931fe91b284c53a05c7868554c622306fb
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/20/2017
---
# <a name="working-with-convoy-scenarios"></a><span data-ttu-id="9d7af-102">Utilisation des convois</span><span class="sxs-lookup"><span data-stu-id="9d7af-102">Working with Convoy Scenarios</span></span>
<span data-ttu-id="9d7af-103">A *convoi* chaque fois que plusieurs messages doivent être liées pour obtenir le résultat requis.</span><span class="sxs-lookup"><span data-stu-id="9d7af-103">A *convoy* exists any time that multiple single messages must be related to achieve the required result.</span></span> <span data-ttu-id="9d7af-104">Il existe deux types principaux de convois : séquentielles et parallèles.</span><span class="sxs-lookup"><span data-stu-id="9d7af-104">There are two main types of convoys: sequential and parallel.</span></span>  
  
 <span data-ttu-id="9d7af-105">Dans certaines conditions, une instance d'orchestration instance peut recevoir un groupe de messages corrélés en même temps.</span><span class="sxs-lookup"><span data-stu-id="9d7af-105">Under certain conditions, an orchestration instance might receive a group of correlated messages all at the same time.</span></span> <span data-ttu-id="9d7af-106">Dans ce cas, une condition d'engorgement risque de se produire : l'un des messages du groupe doit initialiser un ensemble de corrélations dans l'instance d'orchestration avant que les autres messages ne puissent être corrélés à cette instance d'orchestration. </span><span class="sxs-lookup"><span data-stu-id="9d7af-106">In this situation, a race condition might occur, in which one of the messages in the group must initialize a correlation set in the orchestration instance before the other messages can be correlated to that orchestration instance.</span></span>  
  
 <span data-ttu-id="9d7af-107">Pour vérifier que tous les messages corrélés sont reçus par la même instance d'orchestration, BizTalk Server détecte le risque d'engorgement et traite ces messages sous la forme d'un convoi.</span><span class="sxs-lookup"><span data-stu-id="9d7af-107">To ensure that all of the correlated messages are received by the same orchestration instance, BizTalk Server detects the potential for such a race condition and treats these messages as a convoy.</span></span> <span data-ttu-id="9d7af-108">À l'inscription, l'exécution crée un abonnement général et l'identifie comme une partie d'un convoi.</span><span class="sxs-lookup"><span data-stu-id="9d7af-108">At enlistment, the runtime creates a general subscription and identifies it as part of a convoy.</span></span> <span data-ttu-id="9d7af-109">Une fois cet abonnement complété, le moteur de messagerie crée un abonnement temporaire basé sur les valeurs des propriétés de corrélation prédéfinies.</span><span class="sxs-lookup"><span data-stu-id="9d7af-109">After filling this subscription, the messaging engine creates a temporary subscription based on the values in the predefined correlation properties.</span></span> <span data-ttu-id="9d7af-110">Cet abonnement temporaire est appelé un *convoi ensemble*.</span><span class="sxs-lookup"><span data-stu-id="9d7af-110">This temporary subscription is called a *convoy set*.</span></span> <span data-ttu-id="9d7af-111">Un ensemble de convois est un groupe d'ensemble de corrélations utilisées dans un convoi.</span><span class="sxs-lookup"><span data-stu-id="9d7af-111">A convoy set is a group of correlation sets that are used in a convoy.</span></span> <span data-ttu-id="9d7af-112">Tous les messages supplémentaires correspondant à l'abonnement général sont évalués en fonction de l'ensemble de convois, et ceux qui lui correspondent sont acheminés vers un port existant.</span><span class="sxs-lookup"><span data-stu-id="9d7af-112">All subsequent messages that match the general subscription are evaluated against the convoy set, and those that match are routed to an existing port.</span></span>  
  
## <a name="using-convoys-with-business-processes"></a><span data-ttu-id="9d7af-113">Utilisation des convois dans les processus d'entreprise</span><span class="sxs-lookup"><span data-stu-id="9d7af-113">Using Convoys with Business Processes</span></span>  
 <span data-ttu-id="9d7af-114">Prenez en compte les éléments suivants lorsque vous utilisez le traitement en convoi dans un processus d'entreprise :</span><span class="sxs-lookup"><span data-stu-id="9d7af-114">Consider the following when using convoy processing with a business process:</span></span>  
  
-   <span data-ttu-id="9d7af-115">A *ensemble de corrélations* est une liste de propriétés avec des valeurs spécifiques que vous utilisez pour acheminer les messages vers un processus d’entreprise spécifiques.</span><span class="sxs-lookup"><span data-stu-id="9d7af-115">A *correlation set* is a list of properties with specific values that you use to route messages to a specific business process.</span></span> <span data-ttu-id="9d7af-116">L’ensemble de corrélations une **réception** forme ne peut pas contenir plus de trois propriétés utilisées pour la corrélation.</span><span class="sxs-lookup"><span data-stu-id="9d7af-116">The correlation set used on a **Receive** shape cannot contain more than three properties used for correlation.</span></span> <span data-ttu-id="9d7af-117">Cela est dû au fait que ces valeurs sont identifiées et stockées au niveau de la base de données, qui ne prend en charge que trois paramètres au maximum.</span><span class="sxs-lookup"><span data-stu-id="9d7af-117">This is because these values are identified and stored at the database level, which supports a maximum of three parameters.</span></span>  
  
-   <span data-ttu-id="9d7af-118">Des convois séquentiels et parallèles peuvent coexister dans le même processus d'entreprise, mais ils ne peuvent partager les mêmes ensembles de corrélations.</span><span class="sxs-lookup"><span data-stu-id="9d7af-118">Parallel and sequential convoys can coexist in the same business process, but they cannot share any correlation sets with each other.</span></span> <span data-ttu-id="9d7af-119">En effet, un ensemble de corrélations ne peut appartenir qu'à un convoi.</span><span class="sxs-lookup"><span data-stu-id="9d7af-119">This is because each correlation set can belong to only one convoy.</span></span>  
  
-   <span data-ttu-id="9d7af-120">BizTalk Server ne prend pas en charge le traitement en convoi lorsque vous utilisez la **démarrer Orchestration** forme pour transmettre une ensemble dans une nouvelle orchestration de corrélations déjà initialisé.</span><span class="sxs-lookup"><span data-stu-id="9d7af-120">BizTalk Server does not support convoy processing when you use the **Start Orchestration** shape to pass an already-initialized correlation set into a new orchestration.</span></span> <span data-ttu-id="9d7af-121">Cela est dû au fait que les ensembles de convois sont gérés au niveau de la base de données, indépendamment des instances d'orchestration en cours d'exécution.</span><span class="sxs-lookup"><span data-stu-id="9d7af-121">This is because convoy sets are handled at the database level, independent of already-running orchestration instances.</span></span>  
  
-   <span data-ttu-id="9d7af-122">Vous ne pouvez pas utiliser un seul **réception** forme pour initialiser deux ou plusieurs ensembles de corrélations qui seront utilisées dans des convois séparés.</span><span class="sxs-lookup"><span data-stu-id="9d7af-122">You cannot use a single **Receive** shape to initialize two or more correlation sets that will be used in separate convoys.</span></span> <span data-ttu-id="9d7af-123">Prenons l'exemple suivant : la réception r1 initialise les ensembles de corrélations c1 et c2 pour le premier convoi, la réception r2 suit c1 pour le deuxième convoi, et la réception r3 suit c2 pour le troisième convoi.</span><span class="sxs-lookup"><span data-stu-id="9d7af-123">For example, suppose that receive r1 initializes correlation sets c1 and c2 for the first convoy, receive r2 follows c1 for the second convoy, and receive r3 follows c2 for the third convoy.</span></span> <span data-ttu-id="9d7af-124">Les ensembles de convois prévus pour le deuxième convoi sont c1, r2 et les ensembles de convois prévus pour le troisième convoi sont c2, r3, lesquels sont tous initialisés par r1.</span><span class="sxs-lookup"><span data-stu-id="9d7af-124">The intended convoy sets for the second convoy are c1, r2 and the intended convoy sets for the third convoy are c2, r3, which are all initialized by r1.</span></span> <span data-ttu-id="9d7af-125">Dans ce cas, le moteur d’orchestration ne les traitera pas comme des convois.</span><span class="sxs-lookup"><span data-stu-id="9d7af-125">In this case, the orchestration engine will not treat these as convoys.</span></span> <span data-ttu-id="9d7af-126">Cet exemple constitue un scénario de convoi valide si r2 et r3 suivent tous deux c1 et c2 (c1, r2, r3 et c2, r2, r3), si tous deux ne suivent que c1 (c1, r2, r3), ou si tous deux ne suivent que c2 (c2, r2, r3).</span><span class="sxs-lookup"><span data-stu-id="9d7af-126">The example is a valid convoy scenario if both r2 and r3 follow both c1 and c2 (c1, r2, r3 and c2, r2, r3), both follow c1 only (c1, r2, r3), or both follow c2 only (c2, r2, r3).</span></span>  
  
## <a name="zombies"></a><span data-ttu-id="9d7af-127">Zombies</span><span class="sxs-lookup"><span data-stu-id="9d7af-127">Zombies</span></span>  
 <span data-ttu-id="9d7af-128">L'utilisation de convois peut déboucher sur des messages "perdus" appelés zombies.</span><span class="sxs-lookup"><span data-stu-id="9d7af-128">The use of convoys can result in "lost" messages called zombies.</span></span> <span data-ttu-id="9d7af-129">Lorsqu'un abonnement de réception de désactivation dans une orchestration en cours d'exécution correspond à un message dans la base de données MessageBox, celle-ci livre le message à l'orchestration.</span><span class="sxs-lookup"><span data-stu-id="9d7af-129">When a non-activating receive subscription in a running orchestration matches a message in the MessageBox database, then the MessageBox delivers the message to the orchestration.</span></span> <span data-ttu-id="9d7af-130">Vu que la MessageBox ne connaît pas la logique d'entreprise de l'orchestration, elle ne fait que livrer à l'orchestration tous les messages qui correspondent à l'abonnement.</span><span class="sxs-lookup"><span data-stu-id="9d7af-130">Because the MessageBox does not know the business logic inside the orchestration, it simply delivers to the orchestration all the messages that match the subscription.</span></span> <span data-ttu-id="9d7af-131">Si l'un de ces messages est livré alors que le flux d'exécution de l'orchestration a déjà traité les abonnements de réception susceptibles d'utiliser ce message, alors ce dernier devient un zombie.</span><span class="sxs-lookup"><span data-stu-id="9d7af-131">If any of these messages are delivered when the orchestration execution flow has passed the receive subscriptions that can consume the messages, then such messages become zombies.</span></span>  
  
 <span data-ttu-id="9d7af-132">Des zombies sont par exemple créés par une boucle de réception qui effectue 17 itérations et qui livre 18 messages correspondant à l'abonnement de réception de la boucle </span><span class="sxs-lookup"><span data-stu-id="9d7af-132">An example of a situation that creates zombies is a receive inside a loop that iterates 17 times, but 18 messages are delivered that match the receive subscription in the loop.</span></span> <span data-ttu-id="9d7af-133">(La MessageBox ne sait pas que la logique d’orchestration gère uniquement les 17 messages.) Le 18e message livré n’est pas utilisé par l’orchestration, car le flux d’exécution a déjà quitté la boucle.</span><span class="sxs-lookup"><span data-stu-id="9d7af-133">(The MessageBox does not know that the orchestration logic only handles 17 messages.) The 18th message delivered is not consumed by the orchestration because execution flow has already exited the loop.</span></span> <span data-ttu-id="9d7af-134">L'orchestration se termine avec des messages ignorés (zombies), qui ne peuvent être repris parce que l'instance d'orchestration a déjà pris fin.</span><span class="sxs-lookup"><span data-stu-id="9d7af-134">The orchestration is completed with discarded messages (zombies), which are not resumable because the orchestration instance has already completed.</span></span>  
  
 <span data-ttu-id="9d7af-135">Vous pouvez gérer les zombies à l'aide d'un script Windows Management Instrumentation (WMI) qui recherchera les instances dont l'état est "Suspendu - Ne peut être repris".</span><span class="sxs-lookup"><span data-stu-id="9d7af-135">You can manage zombies by using a Windows Management Instrumentation (WMI) script to query the instances with the "Suspended-NonResumable" state.</span></span> <span data-ttu-id="9d7af-136">Le moteur de messagerie écrit le message d'erreur "Terminé avec des messages ignorés" dans le journal des événements.</span><span class="sxs-lookup"><span data-stu-id="9d7af-136">In addition, the messaging engine writes an error message, "Completed with discarded messages", to the event log.</span></span>  
  
 <span data-ttu-id="9d7af-137">De plus, si vous avez un convoi séquentiel avec une étendue transactionnelle à long terme et si cette étendue a un délai d'expiration, certaines instances d'orchestration peuvent se terminer dans l'état "Suspendu - Ne peut être repris".</span><span class="sxs-lookup"><span data-stu-id="9d7af-137">Moreover, if you have a sequential convoy with a long-running transactional scope, and the scope has a time-out setting, some orchestration instances may end up in the "Suspended-NonResumable" state.</span></span> <span data-ttu-id="9d7af-138">Vous pouvez également remarquer que la somme du nombre de messages sortants et du nombre d'instances dans l'état "Suspendu - Ne peur être repris" est inférieure au nombre de messages entrants.</span><span class="sxs-lookup"><span data-stu-id="9d7af-138">You may also notice that the number of output messages plus the number of "Suspended-NonResumable" instances is less than the number of input messages.</span></span> <span data-ttu-id="9d7af-139">Ce comportement est par défaut.</span><span class="sxs-lookup"><span data-stu-id="9d7af-139">This behavior is by design.</span></span> <span data-ttu-id="9d7af-140">Lorsqu'une exception d'expiration se produit, le code est envoyé dans le gestionnaire d'exception.</span><span class="sxs-lookup"><span data-stu-id="9d7af-140">When a time-out exception happens, the code goes into the exception handler.</span></span> <span data-ttu-id="9d7af-141">BizTalk Server appelle le gestionnaire d'exception pour qu'il traite l'exception, ainsi que les zombies.</span><span class="sxs-lookup"><span data-stu-id="9d7af-141">BizTalk Server calls the exception handler to let it handle the exception, including handling the zombies.</span></span> <span data-ttu-id="9d7af-142">Vous pouvez utiliser un port d'envoi du gestionnaire d'exception pour envoyer les zombies vers une autre destination spécifique à des fins d'étude et de traitement.</span><span class="sxs-lookup"><span data-stu-id="9d7af-142">You can use a send port in the exception handler to send the zombies to a destination for further review and processing.</span></span>  
  
 <span data-ttu-id="9d7af-143">Les zombies peuvent être générés par d'autres scénarios.</span><span class="sxs-lookup"><span data-stu-id="9d7af-143">Scenarios other than convoys can also generate zombies.</span></span> <span data-ttu-id="9d7af-144">Prenons par exemple une instance d'orchestration qui attend un message de réponse de la part d'un processus d'entreprise et qui, pour une raison quelconque, reçoit deux messages de réponses correspondant à l'abonnement.</span><span class="sxs-lookup"><span data-stu-id="9d7af-144">For example, suppose that an orchestration instance is expecting one response message from a business process, and for some reason, it receives two matching subscription response messages.</span></span> <span data-ttu-id="9d7af-145">Dans ce cas, le deuxième message de réponse devient un zombie.</span><span class="sxs-lookup"><span data-stu-id="9d7af-145">In this case, the second response message becomes a zombie.</span></span> <span data-ttu-id="9d7af-146">Un autre exemple est lorsque vous avez un **écouter** mettre en forme avec un **réception** forme sur une autre branche et un **délai** forme à l’autre branche.</span><span class="sxs-lookup"><span data-stu-id="9d7af-146">Another example is when you have a **Listen** shape with a **Receive** shape at one branch and a **Delay** shape at the other branch.</span></span> <span data-ttu-id="9d7af-147">Si un message arrive au moment de l'expiration, il devient un zombie.</span><span class="sxs-lookup"><span data-stu-id="9d7af-147">If a message arrives at the same time that the time-out occurs, the message becomes a zombie.</span></span>  
  
 <span data-ttu-id="9d7af-148">Pour plus d’informations sur la gestion des zombies, voir **suppression des Instances de Service suspendues** [!INCLUDE[ui-guidance-developers-reference](../includes/ui-guidance-developers-reference.md)].</span><span class="sxs-lookup"><span data-stu-id="9d7af-148">For more information about how to manage zombies, see **Removing Suspended Service Instances** [!INCLUDE[ui-guidance-developers-reference](../includes/ui-guidance-developers-reference.md)].</span></span>
  
## <a name="next-steps"></a><span data-ttu-id="9d7af-149">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="9d7af-149">Next steps</span></span>
 [<span data-ttu-id="9d7af-150">Convois séquentiels</span><span class="sxs-lookup"><span data-stu-id="9d7af-150">Sequential Convoys</span></span>](../core/sequential-convoys.md)  
  
 [<span data-ttu-id="9d7af-151">Convois parallèles</span><span class="sxs-lookup"><span data-stu-id="9d7af-151">Parallel Convoys</span></span>](../core/parallel-convoys.md)  
  
## <a name="see-also"></a><span data-ttu-id="9d7af-152">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="9d7af-152">See Also</span></span>  
 [<span data-ttu-id="9d7af-153">À l’aide de corrélations dans les Orchestrations</span><span class="sxs-lookup"><span data-stu-id="9d7af-153">Using Correlations in Orchestrations</span></span>](../core/using-correlations-in-orchestrations.md)