---
title: Comment BizTalk Server traite les Messages volumineux | Documents Microsoft
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 62c070be-dff5-4349-9e36-dd3a7caf1752
caps.latest.revision: "33"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 26ecae241e1e41fdb67204c7975741a240979c2d
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/20/2017
---
# <a name="how-biztalk-server-processes-large-messages"></a><span data-ttu-id="a43eb-102">Traitement des messages volumineux par BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="a43eb-102">How BizTalk Server Processes Large Messages</span></span>
## <a name="what-is-a-large-message"></a><span data-ttu-id="a43eb-103">Qu'est-ce qu'un message volumineux ?</span><span class="sxs-lookup"><span data-stu-id="a43eb-103">What is a large message?</span></span>  
 <span data-ttu-id="a43eb-104">Malheureusement, la réponse à cette question ne se trouve pas dans la taille d'un message. Elle est plutôt fonction des engorgements spécifiques qui peuvent se produire dans votre système Microsoft [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="a43eb-104">Unfortunately, the answer to this question isn't tied directly to a specific message size, but rather, depends on specific bottlenecks in your Microsoft [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] system.</span></span> <span data-ttu-id="a43eb-105">Les problèmes associés aux messages volumineux peuvent se répartir dans les catégories suivantes :</span><span class="sxs-lookup"><span data-stu-id="a43eb-105">The problems associated with large messages can be divided into the following categories:</span></span>  
  
-   <span data-ttu-id="a43eb-106">**Erreurs de mémoire insuffisante** certains types de traitement des messages - telles que le mappage, la validation et promotion de propriétés - chargent la totalité du message en mémoire.</span><span class="sxs-lookup"><span data-stu-id="a43eb-106">**Out of memory errors** Certain types of message processing - such as mapping, validation, and property promotion - load the entire message into memory.</span></span> <span data-ttu-id="a43eb-107">Si la taille du message en mémoire dépasse les ressources disponibles, une erreur se produit.</span><span class="sxs-lookup"><span data-stu-id="a43eb-107">If the size of the message in memory exceeds available resources, then an out of memory error occurs.</span></span> <span data-ttu-id="a43eb-108">Le seuil de taille des messages qui font partie de cette catégorie est bien inférieur au seuil de taille des messages qui ne sont pas chargés en mémoire.</span><span class="sxs-lookup"><span data-stu-id="a43eb-108">The size threshold for messages that fall into this category is much lower than the size threshold for messages that are not loaded into memory.</span></span> <span data-ttu-id="a43eb-109">Par exemple, un fichier plat de 10 Mo converti en XML,  puis mappé peut décupler et consommer plus de 100 Mo de mémoire, alors qu'un document XML de 100 Mo non converti ni mappé peut ne consommer que 1 Mo, car il est transmis à la base de données MessageBox.</span><span class="sxs-lookup"><span data-stu-id="a43eb-109">For example, a 10 MB flat file that is parsed into XML and then mapped may grow by a factor of 10 or more to consume over 100 MB of memory, whereas a 100 MB XML document that is not parsed or mapped may actually only consume 1 MB of memory as it is streamed to the MessageBox database.</span></span>  
  
-   <span data-ttu-id="a43eb-110">**Des problèmes de performances pour les messages qui ne sont pas chargés en mémoire** les Messages qui ne doivent pas être chargées en mémoire sont transmis à la base de données MessageBox à l’aide de l’interface .NET XmlReader.</span><span class="sxs-lookup"><span data-stu-id="a43eb-110">**Performance problems for messages that are not loaded into memory** Messages that are not required to be loaded into memory are streamed to the MessageBox database using the .NET XmlReader interface.</span></span> <span data-ttu-id="a43eb-111">Bien que ces messages ne soient pas soumis aux limitations des messages devant être chargés en mémoire, de nombreux facteurs importants ont une incidence sur la façon dont BizTalk Server traite les messages qui sont envoyés dans la base de données MessageBox.</span><span class="sxs-lookup"><span data-stu-id="a43eb-111">While they are not subject to the size limitations on messages that must be loaded into memory, there are some important factors that impact how BizTalk Server processes messages that are streamed to the MessageBox database.</span></span>  
  
## <a name="factors-that-affect-the-processing-of-large-messages"></a><span data-ttu-id="a43eb-112">Facteurs ayant une incidence sur le traitement de messages volumineux</span><span class="sxs-lookup"><span data-stu-id="a43eb-112">Factors that affect the processing of large messages</span></span>  
 <span data-ttu-id="a43eb-113">La taille du message d'origine, son format et le type de traitement ont tous une incidence sur la façon dont BizTalk Server traite les messages volumineux.</span><span class="sxs-lookup"><span data-stu-id="a43eb-113">The original message size, message format, and type of message processing all affect how BizTalk Server processes large messages.</span></span>  
  
-   <span data-ttu-id="a43eb-114">**Taille de message d’origine** la taille du message reçu par BizTalk Server est l’indication la plus visible de la taille du message sera lorsqu’il est traité par BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="a43eb-114">**Original message size** The size of the message received by BizTalk Server is the most visible indication of how large the message will be when it is processed by BizTalk Server.</span></span> <span data-ttu-id="a43eb-115">Elle peut avoir un impact significatif sur les performances si l'intégralité du message est chargé en mémoire, plus que si le message est transmis à la base de données MessageBox.</span><span class="sxs-lookup"><span data-stu-id="a43eb-115">The original size of a message has a much greater impact on performance if the entire message is loaded into memory than if the message is streamed to the MessageBox database.</span></span>  
  
-   <span data-ttu-id="a43eb-116">**Format de message** Messages sont reçus dans BizTalk Server dans un des deux principaux formats : XML fichiers ou fichiers plats.</span><span class="sxs-lookup"><span data-stu-id="a43eb-116">**Message format** Messages are received into BizTalk Server in one of two primary formats: XML files or flat files.</span></span>  
  
    -   <span data-ttu-id="a43eb-117">**Fichiers XML** afin que BizTalk Server exécuter tout traitement sur un message autre que le routage, le message doit être au format de fichier XML.</span><span class="sxs-lookup"><span data-stu-id="a43eb-117">**XML files** In order for BizTalk Server to perform any processing on a message other than pass through routing, the message must be in the XML file format.</span></span> <span data-ttu-id="a43eb-118">Si les fichiers à traiter sont reçus au format XML, la plupart d'entre eux conserveront leur taille d'origine.</span><span class="sxs-lookup"><span data-stu-id="a43eb-118">If the files to be processed are received in XML format then they will retain their original size for the most part.</span></span>  
  
    -   <span data-ttu-id="a43eb-119">**Fichiers plats** fichiers plats doivent être analysées dans un format XML avant que BizTalk Server puisse effectuer tout traitement autre que le routage.</span><span class="sxs-lookup"><span data-stu-id="a43eb-119">**Flat files** Flat files must be parsed into an XML format before BizTalk Server can perform any processing other than pass through routing.</span></span> <span data-ttu-id="a43eb-120">La conversion d'un fichier plat au format XML peut considérablement augmenter la taille du fichier.</span><span class="sxs-lookup"><span data-stu-id="a43eb-120">Parsing a flat file into an XML file can greatly increase the size of the file.</span></span> <span data-ttu-id="a43eb-121">Les fichiers plats ne contiennent pas de balises XML qui décrivent leurs données,</span><span class="sxs-lookup"><span data-stu-id="a43eb-121">Flat files do not contain XML tags with descriptive information about their data.</span></span> <span data-ttu-id="a43eb-122">alors que les fichiers XML enveloppent toutes leurs données dans des balises XML descriptives.</span><span class="sxs-lookup"><span data-stu-id="a43eb-122">XML files, on the other hand, wrap all of their data in descriptive XML tags.</span></span> <span data-ttu-id="a43eb-123">Dans certains scénarios, l'analyse peut décupler la taille d'un fichier plat en fonction du volume de données descriptives contenues dans les balises du fichier XML obtenu.</span><span class="sxs-lookup"><span data-stu-id="a43eb-123">In some scenarios parsing can increase the size of a flat file by a factor of 10 or more, depending on how much descriptive data is contained in the XML tags for the file.</span></span>  
  
    -   <span data-ttu-id="a43eb-124">**Documents de fichier encapsulés dans un seul nœud de section CDATA dans un document XML plat** ce type de document est une combinaison de XML et de fichier plat et peut être problématique, car BizTalk Server doit charger l’intégralité du fichier plat enveloppé en mémoire avant son traitement.</span><span class="sxs-lookup"><span data-stu-id="a43eb-124">**Flat file documents wrapped in a single CDATA section node in an XML document** This type of document is a combination of both XML and flat file and can be problematic because BizTalk Server must load the entire wrapped flat file document into memory before processing it.</span></span>  
  
-   <span data-ttu-id="a43eb-125">**Type de traitement de message** dans BizTalk Server, il existe deux types de traitement du message : uniquement le routage et de mappage.</span><span class="sxs-lookup"><span data-stu-id="a43eb-125">**Type of message processing** In BizTalk Server, there are two types of message processing: Routing only and Mapping.</span></span> <span data-ttu-id="a43eb-126">Les variables de performance liées au type de traitement des messages mis en œuvre concernent la taille des messages et le chargement éventuel des messages en mémoire.</span><span class="sxs-lookup"><span data-stu-id="a43eb-126">The performance variables tied to the type of message processing that is performed are message size and whether the message is loaded into memory.</span></span>  
  
    -   <span data-ttu-id="a43eb-127">**Routage seul** si BizTalk Server est uniquement utilisé uniquement pour le routage des messages en fonction des propriétés de message promues, puis le message est transmis à la base de données Messagebox à l’aide de l’interface XmlReader .NET et les parties de message ne sont pas individuellement chargée en mémoire.</span><span class="sxs-lookup"><span data-stu-id="a43eb-127">**Routing only** If BizTalk Server is only used only for routing messages based upon promoted message properties, then the message is streamed into the Messagebox database using the .NET XmlReader interface, and message parts are not individually loaded into memory.</span></span> <span data-ttu-id="a43eb-128">Dans ce scénario, les erreurs de mémoire insuffisante ne sont pas un problème. En fait, la considération principale est la durée d'écriture des messages volumineux (supérieurs à 100 Mo) dans la base de données MessageBox.</span><span class="sxs-lookup"><span data-stu-id="a43eb-128">In this scenario, out of memory errors are not an issue and the primary consideration is the amount of time that is required to write very large messages (over 100 MB) into the Messagebox database.</span></span> <span data-ttu-id="a43eb-129">L'équipe de développement de BizTalk Server a testé avec succès le traitement des messages d'une taille allant jusqu'à 1 Go pour le routage seul.</span><span class="sxs-lookup"><span data-stu-id="a43eb-129">The BizTalk Server development team has successfully tested the processing of messages up to 1 GB in size when performing routing only.</span></span>  
  
         <span data-ttu-id="a43eb-130">Le principal facteur qui détermine les performances dans ce scénario est la **taille des fragments de message volumineux** utilisée pour fragmenter les données dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="a43eb-130">The primary factor that determines performance in this scenario is the **Large message fragment size** used to fragment the data into the database.</span></span> <span data-ttu-id="a43eb-131">Le **taille des fragments de message volumineux** est une option configurable sur le **propriétés du groupe BizTalk** page de configuration et a la valeur par défaut est 102 400 octets (100 Ko).</span><span class="sxs-lookup"><span data-stu-id="a43eb-131">The **Large message fragment size** is a configurable option on the **BizTalk Group Properties** configuration page and has a default value of 102400 bytes (100 KB).</span></span> <span data-ttu-id="a43eb-132">L'augmentation de cette valeur réduit le nombre d'allers-retours requis pour transmettre un message à la base de données MessageBox.</span><span class="sxs-lookup"><span data-stu-id="a43eb-132">Increasing this value reduces the number of round trips required to stream a message into the MessageBox database.</span></span>  
  
    -   <span data-ttu-id="a43eb-133">**Mappage** transformation d’un document avec une carte peut être une opération nécessitant beaucoup de mémoire.</span><span class="sxs-lookup"><span data-stu-id="a43eb-133">**Mapping** Transforming a document with a map can be a memory-intensive operation.</span></span> <span data-ttu-id="a43eb-134">Lorsqu’un document est transformé par un mappage, BizTalk Server transmet le message à la classe .Net XSLCompileTransform, qui charge la feuille de style XSL.</span><span class="sxs-lookup"><span data-stu-id="a43eb-134">When a document is transformed by a map, BizTalk Server passes the message to the .Net XSLCompileTransform class, which loads the XSL style sheet.</span></span> <span data-ttu-id="a43eb-135">Une fois la méthode Load correctement exécutée, la méthode Transform peut être appelée simultanément à partir de plusieurs threads.</span><span class="sxs-lookup"><span data-stu-id="a43eb-135">After the Load method completes successfully, the Transform method can be called simultaneously from multiple threads.</span></span> <span data-ttu-id="a43eb-136">[Classe XslCompiledTransform](http://go.microsoft.com/fwlink/p/?LinkID=282683) fournit des informations sur la classe XSLCompiledTransform.</span><span class="sxs-lookup"><span data-stu-id="a43eb-136">[XslCompiledTransform Class](http://go.microsoft.com/fwlink/p/?LinkID=282683) provides more information on the XSLCompiledTransform class.</span></span>  
  
         [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="a43eb-137"> améliore considérablement la gestion de mémoire des documents volumineux en implémentant un seuil de taille de message configurable pour le chargement de documents en mémoire au cours de la transformation.</span><span class="sxs-lookup"><span data-stu-id="a43eb-137"> significantly improves memory management for large documents by implementing a configurable message size threshold for loading documents into memory during transforms.</span></span> <span data-ttu-id="a43eb-138">Les messages dont la taille est inférieure à ce seuil sont traités en mémoire alors que les messages dont la taille est supérieure au seuil sont mis dans la mémoire tampon du système de fichiers dans le but de réduire les besoins en mémoire.</span><span class="sxs-lookup"><span data-stu-id="a43eb-138">Any message with a size below this threshold is handled in memory; any message with a size above this threshold is buffered to the file system to reduce memory requirements.</span></span> <span data-ttu-id="a43eb-139">Le seuil de taille de message par défaut est de 1 Mo.</span><span class="sxs-lookup"><span data-stu-id="a43eb-139">The default message size threshold is 1 MB.</span></span>  
  
## <a name="guidelines-for-processing-large-messages"></a><span data-ttu-id="a43eb-140">Instructions pour le traitement des messages volumineux</span><span class="sxs-lookup"><span data-stu-id="a43eb-140">Guidelines for processing large messages</span></span>  
 <span data-ttu-id="a43eb-141">Pour améliorer les performances lors du traitement des messages volumineux dans BizTalk Server, tenez compte des points suivants :</span><span class="sxs-lookup"><span data-stu-id="a43eb-141">Follow these guidelines to improve performance when processing large messages in BizTalk Server:</span></span>  
  
1.  <span data-ttu-id="a43eb-142">Ajustez le seuil de taille des messages au-delà duquel les documents sont mis dans la mémoire tampon du système de fichiers lors du mappage.</span><span class="sxs-lookup"><span data-stu-id="a43eb-142">Adjust the message size threshold above which documents are buffered to the file system during mapping.</span></span> <span data-ttu-id="a43eb-143">Pour modifier le seuil de taille, créez une valeur DWORD nommée **TransformThreshold** à l’emplacement suivant dans le Registre de BizTalk Server :</span><span class="sxs-lookup"><span data-stu-id="a43eb-143">To modify the size threshold, create a DWORD value named **TransformThreshold** at the following location in the BizTalk Server registry:</span></span>  
  
    ```  
    HKLM\Software\Microsoft\BizTalk Server\3.0\Administration\TransformThreshold  
    ```  
  
     <span data-ttu-id="a43eb-144">Après avoir créé cette valeur, entrez une valeur décimale correspondant au nombre d'octets pour définir le nouveau seuil.</span><span class="sxs-lookup"><span data-stu-id="a43eb-144">After you have created this value, enter a decimal value with the number of bytes to set the new threshold to.</span></span> <span data-ttu-id="a43eb-145">Par exemple, entrez une valeur de  2097152 pour augmenter le seuil à 2 Mo (le seuil par défaut est de 1 Mo).</span><span class="sxs-lookup"><span data-stu-id="a43eb-145">For example, enter a decimal value of 2097152 to increase the message size threshold to 2 MB (from the default of 1 MB).</span></span> <span data-ttu-id="a43eb-146">Augmentez cette valeur sur des systèmes dotés d'un volume important de mémoire disponible afin d'améliorer le débit.</span><span class="sxs-lookup"><span data-stu-id="a43eb-146">Increase this value on systems with a large amount of available memory to improve throughput.</span></span> <span data-ttu-id="a43eb-147">La mise en mémoire des documents sur le disque permet d'économiser de la mémoire avec un impact sur le débit global.</span><span class="sxs-lookup"><span data-stu-id="a43eb-147">Buffering documents to disk conserves memory at a cost to overall throughput.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="a43eb-148">Par défaut, les documents qui sont mis en mémoire tampon pour le système de fichiers lors du mappage sont écrits dans le *%temp%* répertoire de l’ordinateur BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="a43eb-148">By default, documents that are buffered to the file system during mapping are written to the *%temp%* directory of the BizTalk Server computer.</span></span> <span data-ttu-id="a43eb-149">Modifiez le paramètre pour le *%temp%* variable d’environnement pour un disque non-système pour améliorer les performances lors de la mise en mémoire tampon de messages volumineux dans le système de fichiers lors du mappage.</span><span class="sxs-lookup"><span data-stu-id="a43eb-149">Change the setting for the *%temp%* environment variable to a non-system disk to improve performance when buffering large messages to the file system during mapping.</span></span>  
  
2.  <span data-ttu-id="a43eb-150">Limitez l'utilisation de mappages dans les orchestrations :</span><span class="sxs-lookup"><span data-stu-id="a43eb-150">Minimize the use of maps in orchestrations:</span></span>  
  
    -   <span data-ttu-id="a43eb-151">Si vous utilisez un mappage pour extraire ou pour définir les propriétés utilisées avec la logique d'entreprise dans une orchestration, privilégiez les champs distinctifs ou les propriétés promues.</span><span class="sxs-lookup"><span data-stu-id="a43eb-151">If you are using a map to extract or set properties used with business logic in an orchestration, use distinguished fields or promoted properties instead.</span></span> <span data-ttu-id="a43eb-152">Lors de l'extraction ou de la définition des valeurs au moyen d'un mappage, le document est chargé en mémoire.</span><span class="sxs-lookup"><span data-stu-id="a43eb-152">When extracting or setting values with a map the document is loaded into memory.</span></span> <span data-ttu-id="a43eb-153">Si des champs distinctifs ou des propriétés promues sont utilisées, le moteur d'orchestration accède au contexte du message et ne charge pas le document en mémoire.</span><span class="sxs-lookup"><span data-stu-id="a43eb-153">When using distinguished fields or promoted properties, the Orchestration engine accesses the message context and does not load the document into memory.</span></span>  
  
    -   <span data-ttu-id="a43eb-154">Si vous utilisez un mappage pour regrouper plusieurs champs en un seul, utilisez des champs distinctifs ou des propriétés promues avec une variable d'orchestration pour obtenir le jeu de résultats.</span><span class="sxs-lookup"><span data-stu-id="a43eb-154">If you are using a map to aggregate several fields into one field, use distinguished fields or promoted properties with an orchestration variable to accumulate the result set.</span></span>  
  
    -   <span data-ttu-id="a43eb-155">Ne configurez pas une orchestration comportant plusieurs entrées sur les formes Transformer.</span><span class="sxs-lookup"><span data-stu-id="a43eb-155">Do not configure an orchestration with multiple inputs to transform shapes.</span></span> <span data-ttu-id="a43eb-156">Une orchestration comportant plusieurs entrées sur les formes Transformer ne parvient pas correctement au système de fichiers pendant le mappage.</span><span class="sxs-lookup"><span data-stu-id="a43eb-156">An orchestration that contains multiple inputs to transform shapes will not stream to the file system while mapping.</span></span> <span data-ttu-id="a43eb-157">Cette limitation provoque le chargement en mémoire du document entier en cours de mappage si la taille du document dépasse la valeur de Registre TransformThreshold spécifiée.</span><span class="sxs-lookup"><span data-stu-id="a43eb-157">This limitation will cause the entire document that is being mapped to load into memory if the document size exceeds the specified TransformThreshold registry value.</span></span> <span data-ttu-id="a43eb-158">L'une des solutions possibles consiste à appliquer les transformations au niveau du port de réception de sorte que l'orchestration n'accepte jamais plus d'une entrée sur une forme Transformer.</span><span class="sxs-lookup"><span data-stu-id="a43eb-158">One possible workaround to this issue would be to apply transforms at the receive port level so that the orchestration never accepts more than a single input to transform shapes.</span></span>  
  
3.  <span data-ttu-id="a43eb-159">Ajuster la **taille des fragments de message volumineux** propriété exposée sur le **propriétés du groupe BizTalk** page de configuration :</span><span class="sxs-lookup"><span data-stu-id="a43eb-159">Adjust the **Large message fragment size** property exposed on the **BizTalk Group Properties** configuration page:</span></span>  
  
     <span data-ttu-id="a43eb-160">Si la taille d’un message reçu en mémoire dépasse le nombre d’octets spécifié pour **taille des fragments de message volumineux** ensuite le message est divisé en fragments de la taille spécifiée et les fragments sont écrits dans la MessageBox sous le contexte d’une transaction Microsoft Distributed Transaction Coordinator (MSDTC) comme suit :</span><span class="sxs-lookup"><span data-stu-id="a43eb-160">If the in-memory size of a received message exceeds the number of bytes specified for **Large message fragment size** then the message is split into fragments of the specified size and the fragments are written into the MessageBox under the context of a Microsoft Distributed Transaction Coordinator (MSDTC) transaction as follows:</span></span>  
  
    1.  <span data-ttu-id="a43eb-161">Si le message entrant est publié sous le contexte d'une transaction MSDTC existante, cette transaction est alors utilisée lors de l'écriture des fragments du message dans la base de données MessageBox.</span><span class="sxs-lookup"><span data-stu-id="a43eb-161">If the incoming message is being published under the context of an existing MSDTC transaction, then this transaction is used when writing the message fragments to the MessageBox.</span></span> <span data-ttu-id="a43eb-162">Par exemple, si le message entrant est publié par un adaptateur transactionnel configuré pour les transactions, la transaction existante sera utilisée lors de l'écriture des fragments du message dans la base de données MessageBox.</span><span class="sxs-lookup"><span data-stu-id="a43eb-162">For example if the incoming message is being published by a transactional adapter configured to require transactions then the existing transaction would be used when writing the message fragments to the MessageBox.</span></span>  
  
    2.  <span data-ttu-id="a43eb-163">Si le message entrant n'est pas publié sous le contexte d'une transaction MSDTC existante, une nouvelle transaction MSDTC est alors créée pour écrire les fragments du message.</span><span class="sxs-lookup"><span data-stu-id="a43eb-163">If the incoming message is not being published under the context of an existing MSDTC transaction, then a new MSDTC transaction is created to write the message fragments.</span></span>  
  
    -   <span data-ttu-id="a43eb-164">Augmentez la valeur de **taille des fragments de message volumineux** afin de réduire la fréquence avec laquelle les messages volumineux sont fragmentés et réduisent les effets de la création des transactions MSDTC associées.</span><span class="sxs-lookup"><span data-stu-id="a43eb-164">Increase the value for **Large message fragment size** to reduce the frequency with which large messages are fragmented and reduce the incidence of creating the associated MSDTC transactions.</span></span> <span data-ttu-id="a43eb-165">Veillez à augmenter la valeur de ce paramètre, car une utilisation excessive de transactions MSDTC est coûteuse d'un point de vue des performances.</span><span class="sxs-lookup"><span data-stu-id="a43eb-165">This should be done because excessive use of MSDTC transactions is expensive from a performance standpoint.</span></span> <span data-ttu-id="a43eb-166">Notez que l'augmentation de cette valeur peut également augmenter la quantité de mémoire disponible.</span><span class="sxs-lookup"><span data-stu-id="a43eb-166">Note that increasing this value may also increase the amount of available memory that is used.</span></span>  
  
    -   <span data-ttu-id="a43eb-167">Si l'écriture d'un message dans la base de données MessageBox prend plus longtemps que la durée de transaction MSDTC maximale autorisée de 60 minutes, la transaction expire, ce qui génère une erreur. La tentative d'écriture du message échoue et est annulée.</span><span class="sxs-lookup"><span data-stu-id="a43eb-167">If it takes longer than the maximum allowable MSDTC transaction timeout of 60 minutes to write a message to the MessageBox, then the transaction times out, an error results, and the attempt to write the message fails and is rolled back.</span></span> <span data-ttu-id="a43eb-168">Le **taille des fragments de message volumineux** la valeur doit être augmenté suffisamment pour éviter ce problème lors du traitement des messages très volumineux.</span><span class="sxs-lookup"><span data-stu-id="a43eb-168">The **Large message fragment size** value should be increased enough to avoid this problem when processing very large messages.</span></span> <span data-ttu-id="a43eb-169">En fonction de la mémoire disponible, vous pouvez augmenter cette valeur jusqu'à un maximum de 1 000 000 octets.</span><span class="sxs-lookup"><span data-stu-id="a43eb-169">Depending on available memory, this value should be increased up to a maximum value of 1000000 bytes.</span></span>  
  
    -   <span data-ttu-id="a43eb-170">Chaque fragment d'un message crée un ou plusieurs verrous de base de données SQL Server sur la base de données MessageBox.</span><span class="sxs-lookup"><span data-stu-id="a43eb-170">Each message fragment in a message creates one or more SQL Server database locks against the MessageBox database.</span></span> <span data-ttu-id="a43eb-171">Lorsque le nombre de verrous est supérieur à plusieurs milliers, SQL Server risque de générer des erreurs de type « nombre insuffisant de verrous ».</span><span class="sxs-lookup"><span data-stu-id="a43eb-171">When the number of locks exceeds several hundred thousand, it is possible that SQL Server will start generating “out of lock” errors.</span></span> <span data-ttu-id="a43eb-172">Si ce problème se produit, augmentez la **taille des fragments de message volumineux** afin de réduire le nombre de verrous de base de données SQL Server effectuée par rapport à la base de données MessageBox.</span><span class="sxs-lookup"><span data-stu-id="a43eb-172">If this problem occurs, increase the **Large message fragment size** to reduce the number of SQL Server database locks made against the MessageBox database.</span></span>  
  
4.  <span data-ttu-id="a43eb-173">Envisagez d'héberger votre base de données MessageBox sur une version 64 bits de SQL Server si vous rencontrez des erreurs de ce type.</span><span class="sxs-lookup"><span data-stu-id="a43eb-173">Consider housing your MessageBox database on a 64-bit version of SQL Server if you are experiencing "out of lock" errors.</span></span> <span data-ttu-id="a43eb-174">Le nombre de verrous disponibles est nettement supérieur sur cette version.</span><span class="sxs-lookup"><span data-stu-id="a43eb-174">The number of available locks is significantly higher on the 64-bit version of SQL Server.</span></span>  
  
5.  <span data-ttu-id="a43eb-175">Ajuster la **seuil de messages volumineux** propriété exposée sur le **propriétés du groupe BizTalk** page de configuration :</span><span class="sxs-lookup"><span data-stu-id="a43eb-175">Adjust the **Large message threshold** property exposed on the **BizTalk Group Properties** configuration page:</span></span>  
  
     <span data-ttu-id="a43eb-176">En tant que message lot est traité, si la taille en mémoire d’un lot de messages atteint le nombre d’octets spécifié pour **seuil de messages volumineux** puis la partie du lot qui a été traité est écrite dans la MessageBox avant le reste du lot est traité.</span><span class="sxs-lookup"><span data-stu-id="a43eb-176">As a message batch is processed, if the in-memory size of a message batch reaches the number of bytes specified for **Large message threshold** then the portion of the message batch that has been processed is written to the MessageBox before the remainder of the message batch is processed.</span></span> <span data-ttu-id="a43eb-177">Cette opération a lieu sous le contexte d'une transaction MSDTC de la manière suivante :</span><span class="sxs-lookup"><span data-stu-id="a43eb-177">This is done under the context of an MSDTC transaction as follows:</span></span>  
  
    1.  <span data-ttu-id="a43eb-178">Si le lot de messages est publié dans le contexte d'une transaction MSDTC existante, cette transaction est alors utilisée lors de l'écriture de partie traitée du lot dans la base de données MessageBox.</span><span class="sxs-lookup"><span data-stu-id="a43eb-178">If the message batch is being published under the context of an existing MSDTC transaction, then this transaction is used when writing the processed portion of the message batch to the MessageBox.</span></span> <span data-ttu-id="a43eb-179">Par exemple, si le lot de messages entrants est publié par un adaptateur transactionnel configuré pour les transactions, la transaction existante sera utilisée pour l'écriture de la partie traitée du lot de messages dans la base de données MessageBox.</span><span class="sxs-lookup"><span data-stu-id="a43eb-179">For example if the incoming message batch is being published by a transactional adapter configured to require transactions then the existing transaction would be used when writing the processed portion of the message batch to the MessageBox.</span></span>  
  
    2.  <span data-ttu-id="a43eb-180">Si le lot de messages n'est pas publié dans le contexte d'une transaction MSDTC existante, une nouvelle transaction MSDTC est alors créée pour écrire la partie traitée du lot dans la base de données MessageBox.</span><span class="sxs-lookup"><span data-stu-id="a43eb-180">If the message batch is not being published under the context of an existing MSDTC transaction, then a new MSDTC transaction must be created to write the portions of the message batch to the MessageBox.</span></span> <span data-ttu-id="a43eb-181">La transaction MSDTC permet de garantir que toutes les parties d'un lot de messages donné sont correctement écrites dans la base de données MessageBox.</span><span class="sxs-lookup"><span data-stu-id="a43eb-181">The MSDTC transaction is used to ensure that all of the portions of a given message batch are successfully written to the MessageBox database.</span></span>  
  
     <span data-ttu-id="a43eb-182">Le **seuil de messages volumineux** paramètre s’applique directement à des lots de messages, mais dans la mesure où un lot de messages peut être défini sur une valeur d’un, le **seuil de messages volumineux** paramètre peut également être indirectement s’applique aux messages individuels.</span><span class="sxs-lookup"><span data-stu-id="a43eb-182">The **Large message threshold** setting is directly applicable to message batches but since a message batch can be set to a value of one, the **Large message threshold** setting can also be indirectly applicable to individual messages.</span></span> <span data-ttu-id="a43eb-183">Par exemple lorsqu’un lot de messages d’un message dépasse la valeur spécifiée **seuil de messages volumineux** paramètre le **seuil de messages volumineux** ne s’applique uniquement au message unique dans le lot.</span><span class="sxs-lookup"><span data-stu-id="a43eb-183">For example when a message batch of one message exceeds the specified **Large message threshold** parameter then the **Large message threshold** in effect applies only to the single message in the batch.</span></span>  
  
    -   <span data-ttu-id="a43eb-184">Le **seuil de messages volumineux** paramètre doit être ajusté pour limiter la création de transactions MSDTC pour scinder des lots de messages dans la MessageBox.</span><span class="sxs-lookup"><span data-stu-id="a43eb-184">The **Large message threshold** parameter should be adjusted to mitigate the creation of MSDTC transactions used to apportion message batches to the MessageBox.</span></span> <span data-ttu-id="a43eb-185">Cela doit être effectuée, car l’utilisation excessive de transactions MSDTC est coûteuse d’un point de vue des performances.</span><span class="sxs-lookup"><span data-stu-id="a43eb-185">This should be done because the excessive use of MSDTC transactions is expensive from a performance standpoint.</span></span> <span data-ttu-id="a43eb-186">Utilisez le calcul suivant pour déterminer la valeur minimale pour le **seuil de messages volumineux** paramètre doit être superflues de transactions MSDTC :</span><span class="sxs-lookup"><span data-stu-id="a43eb-186">Use the following calculation to determine what the minimum value for the **Large message threshold** setting should be to avoid unnecessarily creating MSDTC transactions:</span></span>  
  
        ```  
        Batch Size * Average size (in bytes) of each message in the batch after being processed by the receive pipeline < Large message threshold  
        ```  
  
         <span data-ttu-id="a43eb-187">Tant que la taille totale en octets d’un lot de messages ne dépasse pas la valeur spécifiée pour **seuil de messages volumineux** puis il est inutile de BizTalk initier une transaction MSDTC pour scinder le lot de messages à MessageBox base de données.</span><span class="sxs-lookup"><span data-stu-id="a43eb-187">As long as the total size in bytes of a message batch does not exceed the specified value for **Large message threshold** then there is no need for BizTalk to initiate an MSDTC transaction to apportion the message batch to the MessageBox database.</span></span>