---
title: "Étape 7 (en local) : Création d’une Orchestration | Documents Microsoft"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 7c0b6d0e-cf00-4eee-9b89-28210bad46f4
caps.latest.revision: "2"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: b92a641252a76f4668cdf4c96c8df442c43d4719
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/20/2017
---
# <a name="step-7-on-premises-create-an-orchestration"></a><span data-ttu-id="891d3-102">Étape 7 (en local) : Création d’une Orchestration</span><span class="sxs-lookup"><span data-stu-id="891d3-102">Step 7 (On Premises): Create an Orchestration</span></span>
<span data-ttu-id="891d3-103">Selon le scénario d’entreprise, après [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] reçoit le message de commande client à partir de la file d’attente de Bus de Service, il doit vérifier si la quantité commandée dans le message est supérieure à 100.</span><span class="sxs-lookup"><span data-stu-id="891d3-103">According to the business scenario, after [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] receives the sales order message from the Service Bus Queue, it needs to check whether the quantity ordered in the message is greater than 100.</span></span> <span data-ttu-id="891d3-104">Si la quantité est supérieure à 100, le message est inséré dans le **SalesOrder** table.</span><span class="sxs-lookup"><span data-stu-id="891d3-104">If the quantity is greater than 100, the message is inserted into the **SalesOrder** table.</span></span> <span data-ttu-id="891d3-105">Sinon, le message est envoyé dans un emplacement de fichier partagé.</span><span class="sxs-lookup"><span data-stu-id="891d3-105">Otherwise, the message is sent to a shared file location.</span></span> <span data-ttu-id="891d3-106">Northwind parvient à mettre en œuvre cette logique métier en créant une orchestration.</span><span class="sxs-lookup"><span data-stu-id="891d3-106">Northwind achieves this business logic by creating an orchestration.</span></span> <span data-ttu-id="891d3-107">Cette rubrique fournit des instructions pas à pas pour la créer.</span><span class="sxs-lookup"><span data-stu-id="891d3-107">This topic provides step-by-step guidance on how to create the orchestration.</span></span>  
  
### <a name="to-add-an-orchestration-to-the-includebtsbiztalkservernoversionincludesbtsbiztalkservernoversion-mdmd-project"></a><span data-ttu-id="891d3-108">Pour ajouter une orchestration au projet [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]</span><span class="sxs-lookup"><span data-stu-id="891d3-108">To add an orchestration to the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] project</span></span>  
  
1.  <span data-ttu-id="891d3-109">Dans le [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] vous avez déjà créé, cliquez sur le projet, pointez sur **ajouter**, puis cliquez sur **un nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="891d3-109">In the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] you already created, right-click the project, point to **Add**, and then click **New Item**.</span></span>  
  
2.  <span data-ttu-id="891d3-110">Dans le **un nouvel élément** boîte de dialogue, sélectionnez **Orchestration BizTalk**, entrez le nom de mappage `OrderProcessing.odx`, puis cliquez sur **ajouter**.</span><span class="sxs-lookup"><span data-stu-id="891d3-110">In the **New Item** dialog box, select **BizTalk Orchestration**, enter the map name as `OrderProcessing.odx`, and then click **Add**.</span></span>  
  
## <a name="create-messages-for-the-orchestration"></a><span data-ttu-id="891d3-111">Création de messages pour l’orchestration</span><span class="sxs-lookup"><span data-stu-id="891d3-111">Create Messages for the Orchestration</span></span>  
 <span data-ttu-id="891d3-112">Le schéma que vous avez généré précédemment décrit les « types » requis pour les messages dans l’orchestration.</span><span class="sxs-lookup"><span data-stu-id="891d3-112">The schema that you generated earlier describes the “types” required for the messages in the orchestration.</span></span> <span data-ttu-id="891d3-113">Un message est généralement une variable, du type défini par le schéma correspondant.</span><span class="sxs-lookup"><span data-stu-id="891d3-113">A message is typically a variable, the type for which defined by the corresponding schema.</span></span> <span data-ttu-id="891d3-114">Vous devez à présent créer des messages pour l’orchestration, puis les lier aux schémas que vous avez générés précédemment.</span><span class="sxs-lookup"><span data-stu-id="891d3-114">You must now create messages for the orchestration and link them to schemas you generated earlier.</span></span> <span data-ttu-id="891d3-115">Vous devez créer les trois messages suivants :</span><span class="sxs-lookup"><span data-stu-id="891d3-115">You need to create following three messages:</span></span>  
  
|<span data-ttu-id="891d3-116">Nom du message</span><span class="sxs-lookup"><span data-stu-id="891d3-116">Message Name</span></span>|<span data-ttu-id="891d3-117">Correspond au schéma</span><span class="sxs-lookup"><span data-stu-id="891d3-117">Corresponds to schema</span></span>|  
|------------------|---------------------------|  
|<span data-ttu-id="891d3-118">Message1_SO_Inbound</span><span class="sxs-lookup"><span data-stu-id="891d3-118">Message1_SO_Inbound</span></span>|<span data-ttu-id="891d3-119">Ce message est une instance de la **ECommerceSalesOrder.xsd** schéma.</span><span class="sxs-lookup"><span data-stu-id="891d3-119">This message is an instance of the **ECommerceSalesOrder.xsd** schema.</span></span>|  
|<span data-ttu-id="891d3-120">Message2_SO_Inbound</span><span class="sxs-lookup"><span data-stu-id="891d3-120">Message2_SO_Inbound</span></span>|<span data-ttu-id="891d3-121">Ce message est une copie de la **Message1_SO_Inbound**.</span><span class="sxs-lookup"><span data-stu-id="891d3-121">This message is a copy of the **Message1_SO_Inbound**.</span></span> <span data-ttu-id="891d3-122">Il est recommandé de créer une copie du message, puis de modifier le nouveau message de manière à garder intact le message d’orgine.</span><span class="sxs-lookup"><span data-stu-id="891d3-122">As a best practice, you must create a copy of the message and then modify the new message, leaving the original message intact.</span></span> <span data-ttu-id="891d3-123">Pour plus d’informations, consultez [messages BizTalk Server](http://msdn.microsoft.com/library/aa560436).</span><span class="sxs-lookup"><span data-stu-id="891d3-123">For more information, see [The BizTalk Server Message](http://msdn.microsoft.com/library/aa560436).</span></span>|  
|<span data-ttu-id="891d3-124">Message1_SO_Outbound</span><span class="sxs-lookup"><span data-stu-id="891d3-124">Message1_SO_Outbound</span></span>|<span data-ttu-id="891d3-125">Ce message est une instance de la **TableOperations.dbo.SalesOrder (Insert)** schéma.</span><span class="sxs-lookup"><span data-stu-id="891d3-125">This message is an instance of the **TableOperations.dbo.SalesOrder (Insert)** schema.</span></span>|  
  
#### <a name="to-create-the-messages"></a><span data-ttu-id="891d3-126">Pour créer les messages</span><span class="sxs-lookup"><span data-stu-id="891d3-126">To create the messages</span></span>  
  
1.  <span data-ttu-id="891d3-127">Ouvrez le **Vue Orchestration** fenêtre du projet BizTalk, s’il n’est pas déjà ouvert.</span><span class="sxs-lookup"><span data-stu-id="891d3-127">Open the **Orchestration View** window of the BizTalk project, if it is not already open.</span></span> <span data-ttu-id="891d3-128">Pour ce faire, cliquez sur **vue**, pointez sur **autres fenêtres**, puis cliquez sur **Vue Orchestration**.</span><span class="sxs-lookup"><span data-stu-id="891d3-128">To do so, click **View**, point to **Other Windows**, and then click **Orchestration View**.</span></span>  
  
2.  <span data-ttu-id="891d3-129">Dans la vue Orchestration, cliquez sur **Messages**, puis cliquez sur **nouveau Message**.</span><span class="sxs-lookup"><span data-stu-id="891d3-129">In Orchestration View, right-click **Messages**, and then click **New Message**.</span></span>  
  
3.  <span data-ttu-id="891d3-130">Cliquez sur le message qui vient d’être créé, puis sélectionnez **fenêtre Propriétés**.</span><span class="sxs-lookup"><span data-stu-id="891d3-130">Right-click the newly created message, and then select **Properties Window**.</span></span>  
  
4.  <span data-ttu-id="891d3-131">Dans le **propriétés** volet pour le **Message_1**, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="891d3-131">In the **Properties** pane for the **Message_1**, do the following:</span></span>  
  
    |<span data-ttu-id="891d3-132">Nom de la propriété</span><span class="sxs-lookup"><span data-stu-id="891d3-132">Property name</span></span>|<span data-ttu-id="891d3-133">Action à effectuer</span><span class="sxs-lookup"><span data-stu-id="891d3-133">Perform action</span></span>|  
    |-------------------|--------------------|  
    |<span data-ttu-id="891d3-134">Identificateur</span><span class="sxs-lookup"><span data-stu-id="891d3-134">Identifier</span></span>|<span data-ttu-id="891d3-135">Entrez`Message1_SO_Inbound`</span><span class="sxs-lookup"><span data-stu-id="891d3-135">Enter `Message1_SO_Inbound`</span></span>|  
    |<span data-ttu-id="891d3-136">Type de message</span><span class="sxs-lookup"><span data-stu-id="891d3-136">Message Type</span></span>|<span data-ttu-id="891d3-137">Dans la liste déroulante, développez **schémas**, puis sélectionnez *OrderProcessingDemo.ECommerceSalesOrder*, où *OrderProcessingDemo* est le nom de votre BizTalk projet.</span><span class="sxs-lookup"><span data-stu-id="891d3-137">From the drop-down list, expand **Schemas**, and then select *OrderProcessingDemo.ECommerceSalesOrder*, where *OrderProcessingDemo* is the name of your BizTalk project.</span></span> <span data-ttu-id="891d3-138">*ECommerceSalesOrder* est le schéma pour le message de commande reçu à partir de la file d’attente du Bus de Service.</span><span class="sxs-lookup"><span data-stu-id="891d3-138">*ECommerceSalesOrder* is the schema for the sales order message received from the Service Bus Queue.</span></span>|  
  
5.  <span data-ttu-id="891d3-139">Répétez les étapes pour créer les messages avec les informations suivantes :</span><span class="sxs-lookup"><span data-stu-id="891d3-139">Repeat the steps to create the messages with following details:</span></span>  
  
    |<span data-ttu-id="891d3-140">Nom du message</span><span class="sxs-lookup"><span data-stu-id="891d3-140">Message name</span></span>||  
    |------------------|-|  
    |<span data-ttu-id="891d3-141">Message2_SO_Inbound</span><span class="sxs-lookup"><span data-stu-id="891d3-141">Message2_SO_Inbound</span></span>|<span data-ttu-id="891d3-142">-Définissez **identificateur** à`Message2_SO_Inbound`</span><span class="sxs-lookup"><span data-stu-id="891d3-142">-   Set **Identifier** to `Message2_SO_Inbound`</span></span><br /><span data-ttu-id="891d3-143">-Définissez **Type de Message** à *OrderProcessingDemo.ECommerceSalesOrder*</span><span class="sxs-lookup"><span data-stu-id="891d3-143">-   Set **Message Type** to *OrderProcessingDemo.ECommerceSalesOrder*</span></span>|  
    |<span data-ttu-id="891d3-144">Message1_SO_Outbound</span><span class="sxs-lookup"><span data-stu-id="891d3-144">Message1_SO_Outbound</span></span>|<span data-ttu-id="891d3-145">-Définissez **identificateur** à`Message1_SO_Outound`</span><span class="sxs-lookup"><span data-stu-id="891d3-145">-   Set **Identifier** to `Message1_SO_Outound`</span></span><br /><span data-ttu-id="891d3-146">-Définissez **Type de Message** à *OrderProcessingDemo.TableOperation_dbo_SalesOrder.Insert*</span><span class="sxs-lookup"><span data-stu-id="891d3-146">-   Set **Message Type** to *OrderProcessingDemo.TableOperation_dbo_SalesOrder.Insert*</span></span>|  
  
## <a name="add-shapes-to-the-orchestration"></a><span data-ttu-id="891d3-147">Ajout de formes à l’orchestration</span><span class="sxs-lookup"><span data-stu-id="891d3-147">Add Shapes to the Orchestration</span></span>  
 <span data-ttu-id="891d3-148">Les formes Orchestration définissent le flux d’une application [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="891d3-148">Orchestration shapes define the flow of a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] application.</span></span> <span data-ttu-id="891d3-149">Dans cette section, vous allez ajouter les formes requises à l’orchestration.</span><span class="sxs-lookup"><span data-stu-id="891d3-149">In this section, you add the required shapes to the orchestration.</span></span>  
  
#### <a name="to-add-shapes-to-the-orchestration"></a><span data-ttu-id="891d3-150">Pour ajouter des formes à l'orchestration</span><span class="sxs-lookup"><span data-stu-id="891d3-150">To add shapes to the orchestration</span></span>  
  
1.  <span data-ttu-id="891d3-151">Pour commencer, vous devez ajouter un **réception** forme.</span><span class="sxs-lookup"><span data-stu-id="891d3-151">To start with, you must add a **Receive** shape.</span></span> <span data-ttu-id="891d3-152">Cette forme reçoit le message de commande client entrant en provenance de la file d’attente Service Bus.</span><span class="sxs-lookup"><span data-stu-id="891d3-152">This shape receives the incoming sales order message from the Service Bus Queue.</span></span> <span data-ttu-id="891d3-153">Définissez les propriétés suivantes sur la forme Réception.</span><span class="sxs-lookup"><span data-stu-id="891d3-153">Set the following properties on the receive shape.</span></span>  
  
    1.  <span data-ttu-id="891d3-154">Définissez **activer** à **True**.</span><span class="sxs-lookup"><span data-stu-id="891d3-154">Set **Activate** to **True**.</span></span>  
  
    2.  <span data-ttu-id="891d3-155">Définissez **Message** à **Message1_SO_Inbound**.</span><span class="sxs-lookup"><span data-stu-id="891d3-155">Set **Message** to **Message1_SO_Inbound**.</span></span>  
  
    3.  <span data-ttu-id="891d3-156">Définissez **nom** à **ReceiveOrder**.</span><span class="sxs-lookup"><span data-stu-id="891d3-156">Set **Name** to **ReceiveOrder**.</span></span>  
  
2.  <span data-ttu-id="891d3-157">Comme indiqué précédemment, vous devez créer une copie du message de commande client d’origine reçu dans l’orchestration.</span><span class="sxs-lookup"><span data-stu-id="891d3-157">As mentioned earlier, you must create a copy of the original sales order message that is received into the orchestration.</span></span>  
  
    1.  <span data-ttu-id="891d3-158">Glisser-déposer un **construire un Message** sous la forme la **ReceiveOrder** forme.</span><span class="sxs-lookup"><span data-stu-id="891d3-158">Drag-and-drop a **Construct Message** shape under the **ReceiveOrder** shape.</span></span> <span data-ttu-id="891d3-159">Étant donné que vous utilisez cette forme pour construire un message de type Message2_SO_Inbound, définissez le **Messages construits** propriété **Message2_SO_Inbound**.</span><span class="sxs-lookup"><span data-stu-id="891d3-159">Because you use this shape to construct a message of type Message2_SO_Inbound, set the **Messages Constructed** property to **Message2_SO_Inbound**.</span></span>  
  
    2.  <span data-ttu-id="891d3-160">Ajouter un **assignation du Message** mettre en forme dans le **construire un Message** forme.</span><span class="sxs-lookup"><span data-stu-id="891d3-160">Add a **Message Assignment** shape within the **Construct Message** shape.</span></span> <span data-ttu-id="891d3-161">Double-cliquez sur la forme pour ouvrir l’Éditeur d’expression, puis ajoutez les informations suivantes :</span><span class="sxs-lookup"><span data-stu-id="891d3-161">Double-click the shape to open the Expression Editor, and add the following:</span></span>  
  
        ```  
        Message2_SO_Inbound = Message1_SO_Inbound; //copy the message  
        Message2_SO_Inbound(*) = Message1_SO_Inbound(*); //copy the context properties on the message  
        ```  
  
         <span data-ttu-id="891d3-162">Cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="891d3-162">Click **OK**.</span></span>  
  
3.  <span data-ttu-id="891d3-163">D’après le scénario d’entreprise, le message doit être envoyé vers différentes destinations en fonction de la quantité d’articles commandés.</span><span class="sxs-lookup"><span data-stu-id="891d3-163">According to the business scenario, the message must be sent to different destinations based on the quantity of ordered items.</span></span> <span data-ttu-id="891d3-164">Aussi, vous devez à présent extraire la valeur de quantité du message de commande client entrant.</span><span class="sxs-lookup"><span data-stu-id="891d3-164">So, you must now extract the quantity value from the incoming sales order message.</span></span>  
  
    1.  <span data-ttu-id="891d3-165">Le **quantité** élément dans le message entrant (ECommerceSalesOrder.xsd) contient la valeur de la quantité commandée.</span><span class="sxs-lookup"><span data-stu-id="891d3-165">The **Quantity** element in the inbound message (ECommerceSalesOrder.xsd) contains the value of the ordered quantity.</span></span> <span data-ttu-id="891d3-166">Vous devez promouvoir cette propriété de sorte que l’élément puisse être utilisé dans les expressions au sein de l’orchestration.</span><span class="sxs-lookup"><span data-stu-id="891d3-166">You must promote that property so that the element can be used within the expressions in the orchestration.</span></span> <span data-ttu-id="891d3-167">Pour promouvoir la propriété, ouvrez le **ECommerceSalesOrder.xsd** schéma, avec le bouton droit **quantité**, pointez sur **promouvoir**, puis cliquez sur **Promotions rapides** .</span><span class="sxs-lookup"><span data-stu-id="891d3-167">To promote the property, open the **ECommerceSalesOrder.xsd** schema, right-click **Quantity**, point to **Promote**, and then click **Quick Promotions**.</span></span>  
  
    2.  <span data-ttu-id="891d3-168">Créez une variable afin de stocker la valeur de quantité.</span><span class="sxs-lookup"><span data-stu-id="891d3-168">Create a variable to store the quantity value.</span></span> <span data-ttu-id="891d3-169">Pour créer une variable, à partir de la **Vue Orchestration**, avec le bouton droit **Variables**, puis cliquez sur **nouvelle Variable**.</span><span class="sxs-lookup"><span data-stu-id="891d3-169">To create a variable, from the **Orchestration View**, right-click **Variables**, and then click **New Variable**.</span></span> <span data-ttu-id="891d3-170">Définissez les propriétés suivantes de la variable :</span><span class="sxs-lookup"><span data-stu-id="891d3-170">Set the following properties for the variable:</span></span>  
  
        |<span data-ttu-id="891d3-171">Nom de la propriété</span><span class="sxs-lookup"><span data-stu-id="891d3-171">Property name</span></span>|<span data-ttu-id="891d3-172">Valeur</span><span class="sxs-lookup"><span data-stu-id="891d3-172">Value</span></span>|  
        |-------------------|-----------|  
        |<span data-ttu-id="891d3-173">Identificateur</span><span class="sxs-lookup"><span data-stu-id="891d3-173">Identifier</span></span>|<span data-ttu-id="891d3-174">Entrez`quantityOrdered`</span><span class="sxs-lookup"><span data-stu-id="891d3-174">Enter `quantityOrdered`</span></span>|  
        |<span data-ttu-id="891d3-175">Type</span><span class="sxs-lookup"><span data-stu-id="891d3-175">Type</span></span>|<span data-ttu-id="891d3-176">Sélectionnez **Int32**.</span><span class="sxs-lookup"><span data-stu-id="891d3-176">Select **Int32**.</span></span>|  
  
    3.  <span data-ttu-id="891d3-177">Vous devez à présent affecter la valeur de la **quantité** élément à la **quantityOrdered** variable.</span><span class="sxs-lookup"><span data-stu-id="891d3-177">You must now assign the value in the **Quantity** element to the **quantityOrdered** variable.</span></span> <span data-ttu-id="891d3-178">Glisser-déposer un **l’éditeur d’Expression** après le **construire un Message** forme.</span><span class="sxs-lookup"><span data-stu-id="891d3-178">Drag-and-drop an **Expression Editor** after the **Construct Message** shape.</span></span> <span data-ttu-id="891d3-179">Ouvrez l’Éditeur, puis entrez l’expression suivante :</span><span class="sxs-lookup"><span data-stu-id="891d3-179">Open the editor and enter the following expression:</span></span>  
  
        ```  
        quantityOrdered = Message2_SO_Inbound.Quantity;  
        ```  
  
         <span data-ttu-id="891d3-180">Cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="891d3-180">Click **OK**.</span></span>  
  
4.  <span data-ttu-id="891d3-181">Après avoir extrait la quantité commandée, vous devez maintenant créer un bloc de décision dans lequel vous disposez deux chemins d’accès différents que doit emprunter le flux de message.</span><span class="sxs-lookup"><span data-stu-id="891d3-181">After extracting the order quantity, you now need to create a decision block where you layout two separate paths the message flow takes.</span></span> <span data-ttu-id="891d3-182">Vous créez le bloc de décision dans une orchestration en ajoutant un **décider** forme.</span><span class="sxs-lookup"><span data-stu-id="891d3-182">You create the decision block in an orchestration by adding a **Decide** shape.</span></span>  
  
    1.  <span data-ttu-id="891d3-183">Faites glisser et déposez un **décider** forme après la **l’éditeur d’Expression** forme.</span><span class="sxs-lookup"><span data-stu-id="891d3-183">Drag and drop a **Decide** shape after the **Expression Editor** shape.</span></span>  
  
    2.  <span data-ttu-id="891d3-184">Sélectionnez le **Rule_1** forme et dans le **propriétés** fenêtre, spécifiez les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="891d3-184">Select the **Rule_1** shape and in the **Properties** window, specify the following:</span></span>  
  
        |<span data-ttu-id="891d3-185">Nom de la propriété</span><span class="sxs-lookup"><span data-stu-id="891d3-185">Property name</span></span>|<span data-ttu-id="891d3-186">Valeur</span><span class="sxs-lookup"><span data-stu-id="891d3-186">Value</span></span>|  
        |-------------------|-----------|  
        |<span data-ttu-id="891d3-187">Identificateur</span><span class="sxs-lookup"><span data-stu-id="891d3-187">Identifier</span></span>|<span data-ttu-id="891d3-188">Entrez `Yes`.</span><span class="sxs-lookup"><span data-stu-id="891d3-188">Enter `Yes`.</span></span> <span data-ttu-id="891d3-189">**Remarque :** l’autre itinéraire est nommée par défaut **Else**.</span><span class="sxs-lookup"><span data-stu-id="891d3-189">**Note:**  The other route is by default named **Else**.</span></span>|  
        |<span data-ttu-id="891d3-190">Expression</span><span class="sxs-lookup"><span data-stu-id="891d3-190">Expression</span></span>|<span data-ttu-id="891d3-191">Entrez `quantityOrdered > 100`.</span><span class="sxs-lookup"><span data-stu-id="891d3-191">Enter `quantityOrdered > 100`.</span></span>|  
  
         <span data-ttu-id="891d3-192">Vous avez maintenant deux itinéraires possibles.</span><span class="sxs-lookup"><span data-stu-id="891d3-192">You now have two routes available.</span></span> <span data-ttu-id="891d3-193">Si la valeur de la **quantityOrdered** variable est supérieure à 100, le message emprunte le **Oui** itinéraire.</span><span class="sxs-lookup"><span data-stu-id="891d3-193">If the value in the **quantityOrdered** variable is greater than 100, the message takes the **Yes** route.</span></span> <span data-ttu-id="891d3-194">Dans le cas contraire, il prend le **Else** itinéraire.</span><span class="sxs-lookup"><span data-stu-id="891d3-194">Otherwise, it takes the **Else** route.</span></span> <span data-ttu-id="891d3-195">Vous devez maintenant définir les actions à effectuer au sein de chaque itinéraire.</span><span class="sxs-lookup"><span data-stu-id="891d3-195">You must now define the actions to be performed within each route.</span></span>  
  
5.  <span data-ttu-id="891d3-196">D’après le scénario d’entreprise, si la quantité commandée est supérieure à 100, le message doit être inséré dans la table SalesOrder.</span><span class="sxs-lookup"><span data-stu-id="891d3-196">According to the business scenario, if the order quantity is greater than 100, the message must be inserted into the SalesOrder table.</span></span> <span data-ttu-id="891d3-197">Ainsi, dans le **Oui** itinéraire, vous devez transformer le schéma ECommerceSalesOrder.xsd en schéma TableOperations.SalesOrder.Insert.</span><span class="sxs-lookup"><span data-stu-id="891d3-197">So, in the **Yes** route, you must transform the ECommerceSalesOrder.xsd schema to the TableOperations.SalesOrder.Insert schema.</span></span> <span data-ttu-id="891d3-198">Vous avez créé le schéma d’insertion dans la rubrique [étape 5 (locaux) : générer le schéma d’insertion d’un Message dans la SalesOrder Table](../core/step-5-generate-the-schema-for-inserting-a-message-into-salesorder-table.md).</span><span class="sxs-lookup"><span data-stu-id="891d3-198">You created the Insert schema in the topic [Step 5 (On Premises): Generate the Schema for Inserting a Message inito SalesOrder Table](../core/step-5-generate-the-schema-for-inserting-a-message-into-salesorder-table.md).</span></span> <span data-ttu-id="891d3-199">Après avoir transformé le schéma, vous devez envoyer le message dans la table de base de données SQL Server.</span><span class="sxs-lookup"><span data-stu-id="891d3-199">After transforming the schema, you must send the message to the message out to the SQL Server database table.</span></span>  
  
    1.  <span data-ttu-id="891d3-200">Dans le **Oui** Router, faites glisser un **construire un Message** forme.</span><span class="sxs-lookup"><span data-stu-id="891d3-200">Within the **Yes** route, drag and drop a **Construct Message** shape.</span></span> <span data-ttu-id="891d3-201">Définir le **Messages construits** propriété de la forme à **Message1_SO_Outbound**.</span><span class="sxs-lookup"><span data-stu-id="891d3-201">Set the **Messages Constructed** property for the shape to **Message1_SO_Outbound**.</span></span>  
  
    2.  <span data-ttu-id="891d3-202">Dans le **construire un Message** forme ajouter un **transformer** forme.</span><span class="sxs-lookup"><span data-stu-id="891d3-202">Within the **Construct Message** shape add a **Transform** shape.</span></span> <span data-ttu-id="891d3-203">Double-cliquez sur la forme pour ouvrir la **transformer la Configuration** boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="891d3-203">Double-click the shape to open the **Transform Configuration** dialog box.</span></span> <span data-ttu-id="891d3-204">Procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="891d3-204">Do the following:</span></span>  
  
        1.  <span data-ttu-id="891d3-205">Sélectionnez le **mappage existant** option.</span><span class="sxs-lookup"><span data-stu-id="891d3-205">Select the **Existing Map** option.</span></span>  
  
        2.  <span data-ttu-id="891d3-206">À partir de la **nom de mappage complet** liste déroulante, sélectionnez **OrderProcessingDemo.SalesOrder_SQL**.</span><span class="sxs-lookup"><span data-stu-id="891d3-206">From the **Fully Qualified Map Name** drop-down, select **OrderProcessingDemo.SalesOrder_SQL**.</span></span>  
  
        3.  <span data-ttu-id="891d3-207">Pour **Source**, sélectionnez **Message2_SO_Inbound**.</span><span class="sxs-lookup"><span data-stu-id="891d3-207">For **Source**, select **Message2_SO_Inbound**.</span></span>  
  
        4.  <span data-ttu-id="891d3-208">Pour **Destination**, sélectionnez **Message1_SO_Outound**.</span><span class="sxs-lookup"><span data-stu-id="891d3-208">For **Destination**, select **Message1_SO_Outound**.</span></span>  
  
    3.  <span data-ttu-id="891d3-209">Après le **construire un Message** mettre en forme, faites glisser un **envoyer** mettre en forme et de définir la **Message** propriété de la forme à `Message1_SO_Outbound`.</span><span class="sxs-lookup"><span data-stu-id="891d3-209">After the **Construct Message** shape, drag and drop a **Send** shape and set the **Message** property for the shape to `Message1_SO_Outbound`.</span></span>  
  
6.  <span data-ttu-id="891d3-210">D’après le scénario d’entreprise, si la quantité commandée est inférieure à 100, le message doit être envoyé dans un emplacement de fichier partagé.</span><span class="sxs-lookup"><span data-stu-id="891d3-210">According to the business scenario, if the order quantity is less than 100, the message must be sent to a shared file location.</span></span> <span data-ttu-id="891d3-211">Ainsi, dans le **Else** itinéraire, vous devez ajouter une forme envoi.</span><span class="sxs-lookup"><span data-stu-id="891d3-211">So, in the **Else** route you must add a send shape.</span></span>  
  
    1.  <span data-ttu-id="891d3-212">Dans le **Else** Router, faites glisser un **envoyer** mettre en forme et de définir la **Message** propriété de la forme à `Message2_SO_Inbound`.</span><span class="sxs-lookup"><span data-stu-id="891d3-212">Within the **Else** route, drag and drop a **Send** shape, and set the **Message** property for the shape to `Message2_SO_Inbound`.</span></span>  
  
        > [!NOTE]
        >  <span data-ttu-id="891d3-213">Vous définissez la propriété Message sur Message2_SO_Inbound, car le même message reçu de la file d’attente Service Bus est envoyé dans l’emplacement de fichier, sans aucun traitement.</span><span class="sxs-lookup"><span data-stu-id="891d3-213">You set the Message to Message2_SO_Inbound because the same message that is received from the Service Bus Queue is sent to the file location, without any processing.</span></span> <span data-ttu-id="891d3-214">Message2_SO_Inbound représente le message reçu par la file d’attente Service Bus.</span><span class="sxs-lookup"><span data-stu-id="891d3-214">Message2_SO_Inbound represents the message that is received by the Service Bus Queue.</span></span>  
  
## <a name="add-ports-to-the-orchestration"></a><span data-ttu-id="891d3-215">ajout des ports à l'orchestration</span><span class="sxs-lookup"><span data-stu-id="891d3-215">Add Ports to the Orchestration</span></span>  
 <span data-ttu-id="891d3-216">Pour une orchestration, les ports représentent les intermédiaires d’entrée et de sortie d’un message.</span><span class="sxs-lookup"><span data-stu-id="891d3-216">Ports represent the input and output mediums of the message with respect to an orchestration.</span></span> <span data-ttu-id="891d3-217">Les messages sont consommés par une orchestration à l’aide d’un port de réception, puis sont renvoyés à l’aide d’un port d’envoi.</span><span class="sxs-lookup"><span data-stu-id="891d3-217">Messages are consumed by an orchestration using a receive port and are sent out using a send port.</span></span> <span data-ttu-id="891d3-218">Dans le scénario d’entreprise, un message est reçu d’un intermédiaire (une file d’attente Service Bus), puis renvoyé vers deux emplacements différents (une base de données SQL Server ou un emplacement de partage de fichiers) en fonction du traitement du message.</span><span class="sxs-lookup"><span data-stu-id="891d3-218">In the business scenario, a message is received from one medium (Service Bus Queue) and then sent out to two different locations (SQL Server database or a file share location) based on message processing.</span></span> <span data-ttu-id="891d3-219">Ainsi, vous devez créer un port de réception et deux ports d’envoi dans le cadre de l’orchestration.</span><span class="sxs-lookup"><span data-stu-id="891d3-219">So, you must create one receive port and two send ports as part of the orchestration.</span></span>  
  
#### <a name="to-add-ports"></a><span data-ttu-id="891d3-220">Pour ajouter des ports</span><span class="sxs-lookup"><span data-stu-id="891d3-220">To add ports</span></span>  
  
1.  <span data-ttu-id="891d3-221">Glisser- déposer un **Port** à mettre en forme le **Surface du Port** volet de la **le Concepteur d’Orchestration** pour lancer le **Assistant Configuration du Port**.</span><span class="sxs-lookup"><span data-stu-id="891d3-221">Drag and drop a **Port** shape to the **Port Surface** pane of the **Orchestration Designer** to launch the **Port Configuration Wizard**.</span></span> <span data-ttu-id="891d3-222">Sur le **Bienvenue** , cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="891d3-222">On the **Welcome** page, click **Next**.</span></span>  
  
2.  <span data-ttu-id="891d3-223">Dans le **propriétés de Port** page, nommez le port `ReceiveSO` puis cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="891d3-223">In the **Port Properties** page, name the port as `ReceiveSO` and then click **Next**.</span></span>  
  
3.  <span data-ttu-id="891d3-224">Dans le **sélectionner un Type de Port** , sélectionnez **créer un nouveau type de port** option, sélectionnez le **unidirectionnel** communication de modèle, laissez la valeur par défaut pour les restrictions d’accès, puis Cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="891d3-224">In the **Select a Port Type** page, select **Create a new port type** option, select the **One-Way** communication pattern, leave the default for access restrictions, and then click **Next**.</span></span>  
  
4.  <span data-ttu-id="891d3-225">Dans le **liaison de Port** page, pour la direction du port, sélectionnez **toujours recevoir les messages sur ce port**, laissez la liaison de port à la valeur par défaut, puis cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="891d3-225">In the **Port Binding** page, for the port direction, select **I’ll always be receiving messages on this port**, leave the port biding to the default value, and then click **Next**.</span></span>  
  
5.  <span data-ttu-id="891d3-226">Dans la dernière page, cliquez sur **Terminer**.</span><span class="sxs-lookup"><span data-stu-id="891d3-226">On the last page, click **Finish**.</span></span>  
  
6.  <span data-ttu-id="891d3-227">Répétez les étapes pour créer les deux ports d’envoi,</span><span class="sxs-lookup"><span data-stu-id="891d3-227">Repeat the steps to create the two send ports.</span></span> <span data-ttu-id="891d3-228">en spécifiant les valeurs suivantes.</span><span class="sxs-lookup"><span data-stu-id="891d3-228">Specify the following values while creating the ports.</span></span>  
  
    |<span data-ttu-id="891d3-229">Nom du port</span><span class="sxs-lookup"><span data-stu-id="891d3-229">Port Name</span></span>|<span data-ttu-id="891d3-230">Propriétés</span><span class="sxs-lookup"><span data-stu-id="891d3-230">Properties</span></span>|  
    |---------------|----------------|  
    |<span data-ttu-id="891d3-231">SendToSQL</span><span class="sxs-lookup"><span data-stu-id="891d3-231">SendToSQL</span></span>|<span data-ttu-id="891d3-232">-Définissez **nom** à **SendToSQL**</span><span class="sxs-lookup"><span data-stu-id="891d3-232">-   Set **Name** to **SendToSQL**</span></span><br /><span data-ttu-id="891d3-233">-Sélectionnez **créer un nouveau type de port**</span><span class="sxs-lookup"><span data-stu-id="891d3-233">-   Select **Create a new port type**</span></span><br /><span data-ttu-id="891d3-234">-Modèle de communication set à **unidirectionnel**</span><span class="sxs-lookup"><span data-stu-id="891d3-234">-   Set communication pattern to **One-way**</span></span><br /><span data-ttu-id="891d3-235">-La valeur direction du port **toujours envoyer les messages sur ce port**</span><span class="sxs-lookup"><span data-stu-id="891d3-235">-   Set port direction to **I’ll always be sending messages on this port**</span></span>|  
    |<span data-ttu-id="891d3-236">SendToFile</span><span class="sxs-lookup"><span data-stu-id="891d3-236">SendToFile</span></span>|<span data-ttu-id="891d3-237">-Définissez **nom** à **SendToFile**</span><span class="sxs-lookup"><span data-stu-id="891d3-237">-   Set **Name** to **SendToFile**</span></span><br /><span data-ttu-id="891d3-238">-Sélectionnez **créer un nouveau type de port**</span><span class="sxs-lookup"><span data-stu-id="891d3-238">-   Select **Create a new port type**</span></span><br /><span data-ttu-id="891d3-239">-Modèle de communication set à **unidirectionnel**</span><span class="sxs-lookup"><span data-stu-id="891d3-239">-   Set communication pattern to **One-way**</span></span><br /><span data-ttu-id="891d3-240">-La valeur direction du port **toujours envoyer les messages sur ce port**</span><span class="sxs-lookup"><span data-stu-id="891d3-240">-   Set port direction to **I’ll always be sending messages on this port**</span></span>|  
  
## <a name="connect-ports-and-message-shapes"></a><span data-ttu-id="891d3-241">Connexion des ports et des formes de message</span><span class="sxs-lookup"><span data-stu-id="891d3-241">Connect Ports and Message Shapes</span></span>  
 <span data-ttu-id="891d3-242">Pour terminer l’orchestration, vous devez à présent connecter les ports et les formes de message.</span><span class="sxs-lookup"><span data-stu-id="891d3-242">You must now connect the ports and the message shapes to complete the orchestration.</span></span> <span data-ttu-id="891d3-243">L’orchestration démarre lorsque le message est reçu par le **ReceiveOrder** forme et l’orchestration quitte lorsque le message est envoyé par les deux formes d’envoi.</span><span class="sxs-lookup"><span data-stu-id="891d3-243">The orchestration starts when the message is received by the **ReceiveOrder** shape and the orchestration exits when the message is sent out by the two Send shapes.</span></span> <span data-ttu-id="891d3-244">Vous devez utiliser ce critère pour connecter les ports et les formes de message.</span><span class="sxs-lookup"><span data-stu-id="891d3-244">You must use this criterion to connect the ports and the message shapes</span></span>  
  
#### <a name="to-connect-ports-with-message-shapes"></a><span data-ttu-id="891d3-245">Pour connecter les ports aux formes de message</span><span class="sxs-lookup"><span data-stu-id="891d3-245">To connect ports with message shapes</span></span>  
  
1.  <span data-ttu-id="891d3-246">Connecter le **ReceiveSO** port de réception pour le **ReceiveOrder** forme.</span><span class="sxs-lookup"><span data-stu-id="891d3-246">Connect the **ReceiveSO** receive port to the **ReceiveOrder** shape.</span></span>  
  
2.  <span data-ttu-id="891d3-247">Connectez la forme envoi sous la **Oui** router vers le **SendToSQL** port d’envoi.</span><span class="sxs-lookup"><span data-stu-id="891d3-247">Connect the Send shape under the **Yes** route to the **SendToSQL** send port.</span></span> <span data-ttu-id="891d3-248">Cela indique que si un message emprunte cet itinéraire (**quantityOrdered** > 100), il est envoyé à la **SalesOrder** table dans la base de données SQL Server.</span><span class="sxs-lookup"><span data-stu-id="891d3-248">This denotes that if a message enters this route (**quantityOrdered** > 100), it’ll be sent to the **SalesOrder** table in the SQL Server database.</span></span>  
  
3.  <span data-ttu-id="891d3-249">Connectez la forme envoi sous la **Else** router vers le **SendToFile** port d’envoi.</span><span class="sxs-lookup"><span data-stu-id="891d3-249">Connect the Send shape under the **Else** route to the **SendToFile** send port.</span></span> <span data-ttu-id="891d3-250">Cela indique que si un message emprunte cet itinéraire (**quantityOrdered** < = 100), il est envoyé vers un emplacement de fichier spécifié.</span><span class="sxs-lookup"><span data-stu-id="891d3-250">This denotes that if a message enters this route (**quantityOrdered** <= 100), it’ll be sent to a specified file location.</span></span>  
  
     <span data-ttu-id="891d3-251">L’orchestration doit ressembler à ceci :</span><span class="sxs-lookup"><span data-stu-id="891d3-251">The orchestration must resemble the following:</span></span>  
  
     <span data-ttu-id="891d3-252">![Orchestration](../core/media/bts2010r2-tut1-orch.jpg "BTS2010R2_Tut1_Orch")</span><span class="sxs-lookup"><span data-stu-id="891d3-252">![Orchestration](../core/media/bts2010r2-tut1-orch.jpg "BTS2010R2_Tut1_Orch")</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="891d3-253">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="891d3-253">See Also</span></span>  
 [<span data-ttu-id="891d3-254">Didacticiel 4 : Création d’une Application hybride à l’aide de BizTalk Server 2013</span><span class="sxs-lookup"><span data-stu-id="891d3-254">Tutorial 4: Creating a Hybrid Application Using BizTalk Server 2013</span></span>](../core/tutorial-4-creating-a-hybrid-application-using-biztalk-server-2013.md)