---
title: "Suivi des événements commerciaux asynchrone | Documents Microsoft"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- performance, BAM
- events, tracking [BAM]
- BAM, event tracking
- BAM, performance
ms.assetid: 6d51fadf-b329-4536-9618-d982d9c17882
caps.latest.revision: "7"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: f7191d9b0be94b4b089a91e78dd526867171c68a
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/20/2017
---
# <a name="asynchronous-business-event-tracking"></a><span data-ttu-id="5674d-102">Suivi asynchrone des événements commerciaux</span><span class="sxs-lookup"><span data-stu-id="5674d-102">Asynchronous Business Event Tracking</span></span>
<span data-ttu-id="5674d-103">Asynchrone (à l’aide de `BufferedEventStream`)-ce modèle offre des améliorations significatives des performances.</span><span class="sxs-lookup"><span data-stu-id="5674d-103">Asynchronous (using `BufferedEventStream`) - This model offers significant performance improvements.</span></span> <span data-ttu-id="5674d-104">Il utilise une interface API similaire à celle du modèle synchrone mais le constructeur est différent.</span><span class="sxs-lookup"><span data-stu-id="5674d-104">This uses a similar API to the synchronous model, using only a different constructor.</span></span> <span data-ttu-id="5674d-105">Au lieu d'envoyer les données vers la base de données d'importation principale, la classe BufferedEventStream conserve les données d'événements en mémoire sous forme binaire avant de les insérer sous forme d'enregistrement de table unique dans une base de données temporaire (MessageBox).</span><span class="sxs-lookup"><span data-stu-id="5674d-105">Instead of pushing the data into the primary import database, BufferedEventStream accumulates the event data in memory in binary form, and then inserts it as a single table record into an interim database (MessageBox).</span></span> <span data-ttu-id="5674d-106">Le service Bus d'événements lit les données placées dans la file d'attente de la base de données MessageBox par BizTalk, puis les importe dans la base de données d'importation principale.</span><span class="sxs-lookup"><span data-stu-id="5674d-106">The Event Bus service reads the data queued in the MessageBox database by BizTalk and imports it into the primary import database.</span></span>  
  
 <span data-ttu-id="5674d-107">Pour configurer l'analyse BAM de sorte qu'elle effectue des opérations asynchrones, le service Bus d'événements et l'application d'appel (ex. : hôte d'orchestration) doivent être exécutés sur des ordinateurs différents.</span><span class="sxs-lookup"><span data-stu-id="5674d-107">To configure BAM for asynchronous operation, the Event Bus Service and the calling application (e.g. Orchestration Host) should run on different computers.</span></span> <span data-ttu-id="5674d-108">Cela permet à l'application d'appel de se débarrasser des données d'événements immédiatement et de faire en sorte que ces données soient traitées par l'UC d'un autre ordinateur.</span><span class="sxs-lookup"><span data-stu-id="5674d-108">This allows the calling application to get rid of the event data immediately to be processed using the CPU on a different computer.</span></span>  
  
 <span data-ttu-id="5674d-109">D'autre part, cette topologie BAM est cohérente avec les transactions.</span><span class="sxs-lookup"><span data-stu-id="5674d-109">This BAM topology is also transaction-consistent.</span></span> <span data-ttu-id="5674d-110">En effet, vous n'obtiendrez pas de données BAM pour des transactions annulées ayant réintégré l'application d'appel car le service Bus d'événements lit uniquement les données validées provenant de la base de données MessageBox.</span><span class="sxs-lookup"><span data-stu-id="5674d-110">You will never get BAM data for transactions that rolled back in the calling application, because the Event Bus Service only reads the committed data from the MessageBox database.</span></span> <span data-ttu-id="5674d-111">Les données BAM obtenues pour des transactions validées s'affichent avec une latence faible pour l'interrogation et l'agrégation.</span><span class="sxs-lookup"><span data-stu-id="5674d-111">The BAM data for the transactions that were committed will show up for query and aggregation with small latency.</span></span>  
  
 <span data-ttu-id="5674d-112">Si des erreurs se produisent, le service Bus d'événements lance plusieurs tentatives en utilisant les délais d'attente, la logique de reprise sur sinistre, etc.</span><span class="sxs-lookup"><span data-stu-id="5674d-112">If errors occur, the Event Bus Service will retry a few times, use timeouts, crash recovery logic, and so on.</span></span> <span data-ttu-id="5674d-113">En revanche, si le format des données n'est pas valide, ces données sont envoyées vers des tables spéciales.</span><span class="sxs-lookup"><span data-stu-id="5674d-113">If however the data is in an invalid format, it ends up in special tables.</span></span> <span data-ttu-id="5674d-114">Un événement est reproduit dans le journal des événements afin d'indiquer ce cas de figure.</span><span class="sxs-lookup"><span data-stu-id="5674d-114">An event occurs in the event log to indicate this condition.</span></span> <span data-ttu-id="5674d-115">Cela constitue un point de défaillance supplémentaire qui rend difficile la gestion du système.</span><span class="sxs-lookup"><span data-stu-id="5674d-115">This additional failure point increases the difficulty of managing the system.</span></span>  
  
 <span data-ttu-id="5674d-116">La méthode asynchrone à partir du code est aussi simple d'utilisation qu'un remplacement de classe DirectEventStream par une classe BufferedEventStream. Il suffit de définir la chaîne de connexion pour la base de données MessageBox du constructeur au lieu de la définir pour l'importation principale BAM.</span><span class="sxs-lookup"><span data-stu-id="5674d-116">Using the asynchronous approach from code is usually as simple as replacing the DirectEventStream with BufferedEventStream, and passing the connection string to the Message Box in the constructor, instead of the one for BAM Primary Import.</span></span>  
  
 <span data-ttu-id="5674d-117">Dans votre code, tenez compte des éléments suivants relatifs au suivi asynchrone des événements commerciaux :</span><span class="sxs-lookup"><span data-stu-id="5674d-117">Use the following guidelines regarding asynchronous business event tracking in your code:</span></span>  
  
-   <span data-ttu-id="5674d-118">Utilisez systématiquement une ligne de continuation lorsque l'activité englobe plusieurs applications et que vous envoyez des données de manière asynchrone vers le composant BAM, même si vous propagez l'ID de l'activité à tous les composants.</span><span class="sxs-lookup"><span data-stu-id="5674d-118">Always use continuation when the Activity spans multiple applications and you send the data asynchronously to BAM, even if you propagate the ActivityID to all components.</span></span> <span data-ttu-id="5674d-119">Dans ce cas, utilisez un ID d'activité différent dans chaque application en ajoutant un préfixe sous la forme d'une chaîne unique (le nom de l'application, par exemple).</span><span class="sxs-lookup"><span data-stu-id="5674d-119">In this case, use a different ActivityID in each application by prefixing it with a unique string (e.g. Application Name).</span></span> <span data-ttu-id="5674d-120">Cette opération est nécessaire dans la mesure où les données des différentes applications sont susceptibles d'arriver au composant BAM dans un ordre aléatoire et que ce dernier doit gérer les événements sans tenir compte de l'ordre chronologique pour que les résultats de l'interrogation et de l'agrégation soient corrects.</span><span class="sxs-lookup"><span data-stu-id="5674d-120">This is necessary because the data from different applications might arrive to BAM in random order, and BAM has to manage the out-of-order events to ensure correct Query and Aggregation results.</span></span>  
  
-   <span data-ttu-id="5674d-121">Les méthodes d'analyse des événements habituelles (modèle d'événement faiblement couplé COM+, événements WMI) ne sont pas applicables à l'analyse BAM car les données d'événements sont indépendantes des transactions.</span><span class="sxs-lookup"><span data-stu-id="5674d-121">The usual methods of event monitoring (e.g. COM+ Loosely Coupled Events or WMI Events) are not applicable for BAM because the event data is independent of the transaction.</span></span> <span data-ttu-id="5674d-122">Par exemple, il peut vous sembler avoir reçu 10 bons de commande d'un total de 10 000 dollars quand il s'agit en fait d'un seul bon de commande entrant de 1 000 dollars dont la tentative d'enregistrement dans la base de données a échoué 10 fois.</span><span class="sxs-lookup"><span data-stu-id="5674d-122">For example, it may look like you received 10 purchase orders for a total of $10,000 while there was only one incoming purchase order for $1000, but the attempt to save it to the database failed 10 times.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5674d-123">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="5674d-123">See Also</span></span>  

 [<span data-ttu-id="5674d-124">Suivi des événements commerciaux synchrone</span><span class="sxs-lookup"><span data-stu-id="5674d-124">Synchronous Business Event Tracking</span></span>](../core/synchronous-business-event-tracking.md)