---
title: "Suivre les données à Application Insights ou concentrateurs d’événements | Documents Microsoft"
description: "Installer le feature pack pour permettre l’analytique des données suivies avec Azure Application Insights ou Azure Event Hubs dans BizTalk Server"
ms.custom: fp1, fp2
ms.date: 11/16/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: b3ff6cb9-44d0-46cd-9b4f-a346365afb7b
caps.latest.revision: "10"
author: tordgladnordahl
ms.author: mandia
manager: anneta
ms.openlocfilehash: 7a6fe0c50527f51b599bca5f51c7b8ed8fb7313e
ms.sourcegitcommit: f65e8ed2b8c18cded26b9d60868fb6a56bcc1205
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/21/2017
---
# <a name="send-biztalk-tracking-data-to-azure-application-insights-or-event-hubs"></a><span data-ttu-id="39357-103">Envoyer des données de suivi pour Azure Application Insights ou concentrateurs d’événements de BizTalk</span><span class="sxs-lookup"><span data-stu-id="39357-103">Send BizTalk tracking data to Azure Application Insights or Event Hubs</span></span>

<span data-ttu-id="39357-104">**En commençant par [!INCLUDE[bts2016_md](../includes/bts2016-md.md)] [!INCLUDE[featurepack1](../includes/featurepack1.md)]** , vous pouvez traiter et envoyer vos données de suivi à Azure Application Insights.</span><span class="sxs-lookup"><span data-stu-id="39357-104">**Starting with [!INCLUDE[bts2016_md](../includes/bts2016-md.md)] [!INCLUDE[featurepack1](../includes/featurepack1.md)]**, you can process and send your tracking data to Azure Application Insights.</span></span> 
          
<span data-ttu-id="39357-105">**En commençant par [!INCLUDE[bts2016_md](../includes/bts2016-md.md)] Feature Pack 2**:</span><span class="sxs-lookup"><span data-stu-id="39357-105">**Starting with [!INCLUDE[bts2016_md](../includes/bts2016-md.md)] Feature Pack 2**:</span></span>

* <span data-ttu-id="39357-106">Application Insights prend en charge les instances par défaut SQL et les instances nommées de SQL</span><span class="sxs-lookup"><span data-stu-id="39357-106">Application Insights supports SQL default instances, and SQL named instances</span></span>
* <span data-ttu-id="39357-107">Vous pouvez traiter et envoyer des données de suivi vers Azure Event Hubs</span><span class="sxs-lookup"><span data-stu-id="39357-107">You can process and send tracking data to Azure Event Hubs</span></span>

<span data-ttu-id="39357-108">Utilisez ces services Azure pour effectuer le suivi de vos instances à partir des orchestrations, ports d’envoi et ports de réception.</span><span class="sxs-lookup"><span data-stu-id="39357-108">Use these Azure services to track your instances from receive ports, send ports, and orchestrations.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="39357-109">Conditions préalables</span><span class="sxs-lookup"><span data-stu-id="39357-109">Prerequisites</span></span>
* <span data-ttu-id="39357-110">Créer une nouvelle instance de [Application Insights](https://docs.microsoft.com/azure/application-insights/app-insights-create-new-resource).</span><span class="sxs-lookup"><span data-stu-id="39357-110">Create a new instance of [Application Insights](https://docs.microsoft.com/azure/application-insights/app-insights-create-new-resource).</span></span> <span data-ttu-id="39357-111">BizTalk Server utilise le **clé d’Instrumentation** pour s’authentifier.</span><span class="sxs-lookup"><span data-stu-id="39357-111">BizTalk Server uses the **Instrumentation Key** to authenticate.</span></span>
* <span data-ttu-id="39357-112">Créer un [hub d’espace de noms et événements Azure Event Hubs](https://docs.microsoft.com/azure/event-hubs/event-hubs-create).</span><span class="sxs-lookup"><span data-stu-id="39357-112">Create an [Azure Event Hubs namespace and event hub](https://docs.microsoft.com/azure/event-hubs/event-hubs-create).</span></span> <span data-ttu-id="39357-113">BizTalk Server utilise le SAS (espace de noms de niveau) ou la stratégie au niveau du concentrateur d’événements pour l’authentification.</span><span class="sxs-lookup"><span data-stu-id="39357-113">BizTalk Server uses the SAS (namespace-level) or event hub-level policy to authenticate.</span></span>
* <span data-ttu-id="39357-114">Installer [Feature Pack 2](https://aka.ms/bts2016fp2) sur votre[!INCLUDE[btsBizTalkServerNoVersion_md](../includes/btsbiztalkservernoversion-md.md)]</span><span class="sxs-lookup"><span data-stu-id="39357-114">Install [Feature Pack 2](https://aka.ms/bts2016fp2) on your [!INCLUDE[btsBizTalkServerNoVersion_md](../includes/btsbiztalkservernoversion-md.md)]</span></span>

## <a name="enable-analytics-for-your-environment"></a><span data-ttu-id="39357-115">Activer analytique pour votre environnement</span><span class="sxs-lookup"><span data-stu-id="39357-115">Enable analytics for your environment</span></span>

1. <span data-ttu-id="39357-116">Ouvrir le **Administration de BizTalk Server** de la console, cliquez sur le **groupe BizTalk**, puis sélectionnez **paramètres**.</span><span class="sxs-lookup"><span data-stu-id="39357-116">Open the **BizTalk Server Administration** console, right-click the **BizTalk Group**, and select **Settings**.</span></span> 
2. <span data-ttu-id="39357-117">Vérifiez **activer au niveau du groupe analytique**.</span><span class="sxs-lookup"><span data-stu-id="39357-117">Check **Enable group-level analytics**.</span></span>
3. <span data-ttu-id="39357-118">Pour le **type cible**, sélectionnez **Application Insight** ou **concentrateur d’événements** dans la liste.</span><span class="sxs-lookup"><span data-stu-id="39357-118">For the **Target type**, select **Application Insight** or **Event Hub** from the list.</span></span>
    <span data-ttu-id="39357-119">![Activer analytique pour votre environnement](../core/media/environmentsettingapplicationinishgt.PNG)</span><span class="sxs-lookup"><span data-stu-id="39357-119">![Enable analytics for your environment](../core/media/environmentsettingapplicationinishgt.PNG)</span></span>

4. <span data-ttu-id="39357-120">Pour le **les paramètres de connexion**, sélectionnez le **...**  bouton, et **connexion** à votre compte Azure.</span><span class="sxs-lookup"><span data-stu-id="39357-120">For the **Connection parameters**, select the **...** button, and **Sign-in** to your Azure account.</span></span>  

    <span data-ttu-id="39357-121">**Pour Application Insights**</span><span class="sxs-lookup"><span data-stu-id="39357-121">**For Application Insights**</span></span>  
    <span data-ttu-id="39357-122">Sélectionnez votre **abonnement**, **groupe de ressources**et l’instance de votre Application Insights.</span><span class="sxs-lookup"><span data-stu-id="39357-122">Select your **Subscription**, **Resource Group**, and your Application Insights instance.</span></span>

    ![Activer analytique pour votre environnement](../core/media/analytics-group-application-insights.png)

    <span data-ttu-id="39357-124">**Pour le concentrateur d’événements**</span><span class="sxs-lookup"><span data-stu-id="39357-124">**For Event Hub**</span></span>  
    <span data-ttu-id="39357-125">Sélectionnez votre **abonnement**, **groupe de ressources**, espace de noms de concentrateur d’événements et concentrateur d’événements.</span><span class="sxs-lookup"><span data-stu-id="39357-125">Select your **Subscription**, **Resource Group**, Event Hub namespace, and event hub.</span></span> <span data-ttu-id="39357-126">Pour l’authentification, vous pouvez utiliser une signature d’accès (SAS) sur le niveau de l’espace de noms, ou la signature d’entité à l’événement au niveau du concentrateur.</span><span class="sxs-lookup"><span data-stu-id="39357-126">For authentication, you can use an access signature (SAS) at the namespace-level, or entity signature at the event hub-level.</span></span> <span data-ttu-id="39357-127">Vos clés disponibles sont remplis automatiquement avec les valeurs précédemment configurées dans [Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="39357-127">Your available keys are auto-populated with the values previously configured within [Azure](https://portal.azure.com).</span></span>

    ![Activer analytique pour votre environnement](../core/media/send-tracking-data-to-azure.png)

5. <span data-ttu-id="39357-129">Sélectionnez **OK** pour enregistrer vos modifications.</span><span class="sxs-lookup"><span data-stu-id="39357-129">Select **OK** to save your changes.</span></span> 

<span data-ttu-id="39357-130">Une fois activé, [!INCLUDE[btsBizTalkServerNoVersion_md](../includes/btsbiztalkservernoversion-md.md)] est prêt à transmettre des données à vos ressources Azure.</span><span class="sxs-lookup"><span data-stu-id="39357-130">Once enabled, [!INCLUDE[btsBizTalkServerNoVersion_md](../includes/btsbiztalkservernoversion-md.md)] is ready to transmit data to your Azure resource.</span></span> <span data-ttu-id="39357-131">Ensuite, activez l’analytique sur vos orchestrations et les ports.</span><span class="sxs-lookup"><span data-stu-id="39357-131">Next, enable analytics on your ports and orchestrations.</span></span> 

## <a name="enable-analytics-on-your-artifacts"></a><span data-ttu-id="39357-132">Activer l’analytique sur vos artefacts</span><span class="sxs-lookup"><span data-stu-id="39357-132">Enable analytics on your artifacts</span></span>

1. <span data-ttu-id="39357-133">Dans la console Administration de BizTalk Server, cliquez sur un **port de réception**, **port d’envoi** ou **orchestration**, puis sélectionnez **suivi**.</span><span class="sxs-lookup"><span data-stu-id="39357-133">In BizTalk Server Administration, right-click a **receive port**, **send port** or **orchestration**, and select **Tracking**.</span></span>
2. <span data-ttu-id="39357-134">Sous **Analytique**, vérifiez **activer l’Analytique**, semblable au suivant.</span><span class="sxs-lookup"><span data-stu-id="39357-134">Under **Analytics**, check **Enable Analytics**, similar to the following.</span></span> <span data-ttu-id="39357-135">Ce paramètre lance le suivi et la transmission de données à partir de l’artefact à vos ressources Azure.</span><span class="sxs-lookup"><span data-stu-id="39357-135">This setting starts tracking and transmitting data from the artifact to your Azure resource.</span></span>
    
    ![Données de suivi pour l’Orchestration](../core/media/orchestrationsettingsapplicationinsight.PNG)

3. <span data-ttu-id="39357-137">Sélectionnez **OK** pour enregistrer vos modifications.</span><span class="sxs-lookup"><span data-stu-id="39357-137">Select **OK** to save your changes.</span></span>
4. <span data-ttu-id="39357-138">Redémarrez l’Instance d’hôte de suivi et confirmer le que démarrage de l’Application BizTalk.</span><span class="sxs-lookup"><span data-stu-id="39357-138">Restart the tracking host Instance, and confirm the BizTalk Application is started.</span></span>

> [!TIP]
> <span data-ttu-id="39357-139">Se connecter à votre Analytique du serveur BizTalk avec les autres systèmes pour avoir une idée davantage de données de votre organisation.</span><span class="sxs-lookup"><span data-stu-id="39357-139">Connect your BizTalk Server Analytics with other systems to gain even more insight into your organizations data.</span></span>

## <a name="view-your-data"></a><span data-ttu-id="39357-140">Afficher vos données</span><span class="sxs-lookup"><span data-stu-id="39357-140">View your data</span></span>

#### <a name="use-application-insights"></a><span data-ttu-id="39357-141">Utilisez Application Insights</span><span class="sxs-lookup"><span data-stu-id="39357-141">Use Application Insights</span></span>
<span data-ttu-id="39357-142">Une fois que les données sont envoyées à Application Insights, vous pouvez utiliser les outils d’analytique dans Azure pour créer des requêtes avancées et analyser vos données.</span><span class="sxs-lookup"><span data-stu-id="39357-142">Once the data is sent to Application Insights, you can use the analytics tools within Azure to create advanced queries, and analyze your data.</span></span>

1. <span data-ttu-id="39357-143">Se connecter à la [portail Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="39357-143">Sign in to the [Azure Portal](https://portal.azure.com).</span></span>
2. <span data-ttu-id="39357-144">Ouvrez votre ressource Application Insights, puis sélectionnez **Metrics Explorer**.</span><span class="sxs-lookup"><span data-stu-id="39357-144">Open your Application Insights resource, and select **Metrics Explorer**.</span></span>
3. <span data-ttu-id="39357-145">Peuvent afficher des graphiques vides.</span><span class="sxs-lookup"><span data-stu-id="39357-145">Empty charts may display.</span></span> <span data-ttu-id="39357-146">Dans un graphique, sélectionnez **modifier**.</span><span class="sxs-lookup"><span data-stu-id="39357-146">In a chart, select **Edit**.</span></span> <span data-ttu-id="39357-147">Sous **métriques**, sélectionnez **personnalisé** pour afficher les propriétés de suivi disponibles.</span><span class="sxs-lookup"><span data-stu-id="39357-147">Under **Metrics**, select **Custom** to see the available tracked properties.</span></span> <span data-ttu-id="39357-148">Sélectionnez parmi les différentes options pour voir les modifications sur votre graphique :</span><span class="sxs-lookup"><span data-stu-id="39357-148">Select some of the different options to see the changes on your chart:</span></span> 

    ![Analytique Azure](../core/media/azure-stream-metrics-custom.png)

4. <span data-ttu-id="39357-150">Revenez à votre ressource Application Insights, puis sélectionnez **Analytique**.</span><span class="sxs-lookup"><span data-stu-id="39357-150">Go back to your Application Insights resource, and select **Analytics**.</span></span> <span data-ttu-id="39357-151">Dans **utilisation**, sélectionnez **exécuter**.</span><span class="sxs-lookup"><span data-stu-id="39357-151">In **Usage**, select **Run**.</span></span> <span data-ttu-id="39357-152">Un exemple de requête est exécutée, et les résultats sont affichés dans un graphique.</span><span class="sxs-lookup"><span data-stu-id="39357-152">A sample query is executed, and the results are displayed in a chart.</span></span>  

> [!TIP]
> <span data-ttu-id="39357-153">Azure Application Insights est un outil puissant.</span><span class="sxs-lookup"><span data-stu-id="39357-153">Azure Application Insights is a powerful tool.</span></span> <span data-ttu-id="39357-154">Il existe des ressources pour vous aider à écrire des requêtes dans Application Insights à [Analytique dans Application Insights](https://docs.microsoft.com/azure/application-insights/app-insights-analytics)et même de commencer à utiliser [Nouveautés d’Application Insights ?](https://docs.microsoft.com/en-us/azure/application-insights/app-insights-overview).</span><span class="sxs-lookup"><span data-stu-id="39357-154">There are resources to help you write queries in Application Insights at [Analytics in Application Insights](https://docs.microsoft.com/azure/application-insights/app-insights-analytics), and even to get started at [What is Application Insights?](https://docs.microsoft.com/en-us/azure/application-insights/app-insights-overview).</span></span>

#### <a name="use-event-hubs"></a><span data-ttu-id="39357-155">Utiliser des concentrateurs d’événements</span><span class="sxs-lookup"><span data-stu-id="39357-155">Use Event Hubs</span></span>
<span data-ttu-id="39357-156">Une fois que les données sont envoyées à des concentrateurs d’événements, il existe deux manières d’afficher les données.</span><span class="sxs-lookup"><span data-stu-id="39357-156">Once the data is sent to Event Hubs, there are a couple of ways to see the data.</span></span> <span data-ttu-id="39357-157">De nombreux utilisateurs de concentrateurs d’événements sont à l’aide de capturer des concentrateurs d’événements pour charger des données de diffusion en continu dans Azure.</span><span class="sxs-lookup"><span data-stu-id="39357-157">Many Event Hubs users are using Event Hubs Capture to load streaming data into Azure.</span></span> <span data-ttu-id="39357-158">Le but est pour vous concentrer sur le traitement des données, plutôt que sur la capture de données.</span><span class="sxs-lookup"><span data-stu-id="39357-158">The intent is for you to focus on data processing, rather than on data capture.</span></span> <span data-ttu-id="39357-159">[Capturer des concentrateurs d’événements](https://docs.microsoft.com/azure/event-hubs/event-hubs-capture-overview) explique comment il fonctionne et comment la configurer.</span><span class="sxs-lookup"><span data-stu-id="39357-159">[Event Hubs Capture](https://docs.microsoft.com/azure/event-hubs/event-hubs-capture-overview) explains how it works, and how to set it up.</span></span>

<span data-ttu-id="39357-160">Une autre option consiste à créer un port de réception et un emplacement de réception à l’aide de l’adaptateur de concentrateur d’événements.</span><span class="sxs-lookup"><span data-stu-id="39357-160">Another option is to create a receive port and receive location using the Event Hub Adapter.</span></span> <span data-ttu-id="39357-161">Ensuite, vous pouvez exporter les données dans un dossier.</span><span class="sxs-lookup"><span data-stu-id="39357-161">Then, you can output the data to a folder.</span></span> <span data-ttu-id="39357-162">Cette idée est préférable si vous souhaitez tester le scénario.</span><span class="sxs-lookup"><span data-stu-id="39357-162">This idea may be best if you want to test the scenario.</span></span> <span data-ttu-id="39357-163">[Adaptateur de concentrateurs d’événements](event-hubs-adapter.md) présente les étapes permettant de recevoir des messages dans BizTalk Server à partir de concentrateurs d’événements.</span><span class="sxs-lookup"><span data-stu-id="39357-163">[Event Hubs adapter](event-hubs-adapter.md) lists the steps to receive messages into BizTalk Server from Event Hubs.</span></span>

## <a name="where-the-data-is-stored"></a><span data-ttu-id="39357-164">Où les données sont stockées.</span><span class="sxs-lookup"><span data-stu-id="39357-164">Where the data is stored</span></span>

<span data-ttu-id="39357-165">Vos données de suivi doivent s’afficher assez rapidement (dans quelques minutes) au sein de vos ressources Azure.</span><span class="sxs-lookup"><span data-stu-id="39357-165">Your tracking data should display fairly quickly (within a few minutes) within your Azure resources.</span></span> <span data-ttu-id="39357-166">Si ce n’est pas le cas, il peut y être un problème avec l’hôte de suivi.</span><span class="sxs-lookup"><span data-stu-id="39357-166">If it doesn't, then there may be an issue with the tracking host.</span></span> <span data-ttu-id="39357-167">Dans SQL Server, les données Analytique sont stockées dans la base de données BizTalkMsgBoxDb, dans le TrackingData_2_*x* tables.</span><span class="sxs-lookup"><span data-stu-id="39357-167">In SQL Server, the Analytics data is stored in the BizTalkMsgBoxDb database, in the TrackingData_2_*x* tables.</span></span> <span data-ttu-id="39357-168">Dans SQL Server Management Studio, retourner les 1000 lignes du haut sur ces quatre tables.</span><span class="sxs-lookup"><span data-stu-id="39357-168">In SQL Server Management Studio, return the top 1000 rows on these four tables.</span></span> <span data-ttu-id="39357-169">Si les données, l’hôte de suivi ne bouge pas les données de la base de données BizTalkDTADb.</span><span class="sxs-lookup"><span data-stu-id="39357-169">If the data is there, then the tracking host is not moving the data to the BizTalkDTADb database.</span></span> 

<span data-ttu-id="39357-170">Certaines solutions possibles :</span><span class="sxs-lookup"><span data-stu-id="39357-170">Some possible resolutions:</span></span>

1. <span data-ttu-id="39357-171">Redémarrez l’hôte de suivi.</span><span class="sxs-lookup"><span data-stu-id="39357-171">Restart the tracking host.</span></span>
2. <span data-ttu-id="39357-172">Créer un hôte de suivi dédié.</span><span class="sxs-lookup"><span data-stu-id="39357-172">Create a dedicated tracking host.</span></span> <span data-ttu-id="39357-173">Lorsque BizTalk Server est installé, le suivi peut être activé sur le **1 d’Application de BizTalk Server** hôte.</span><span class="sxs-lookup"><span data-stu-id="39357-173">When BizTalk Server is installed, tracking may be enabled on the **BizTalk Server Application 1** host.</span></span> <span data-ttu-id="39357-174">En règle générale, cette application est également utilisée pour traiter les messages.</span><span class="sxs-lookup"><span data-stu-id="39357-174">Typically, this application is also used to process messages.</span></span> <span data-ttu-id="39357-175">Créer un hôte de suivi dédié en procédant comme suit :</span><span class="sxs-lookup"><span data-stu-id="39357-175">Create a dedicated tracking host using the following steps:</span></span> 

    1. <span data-ttu-id="39357-176">Dans la console Administration de BizTalk Server, ouvrez les propriétés de l’hôte BizTalk Server Application 1 et désélectionnez **autoriser suivi de l’hôte**.</span><span class="sxs-lookup"><span data-stu-id="39357-176">In BizTalk Server Administration, open the properties of the BizTalk Server Application 1 host, and uncheck **Allow Host Tracking**.</span></span> <span data-ttu-id="39357-177">Redémarrer cette instance d’hôte.</span><span class="sxs-lookup"><span data-stu-id="39357-177">Restart this host instance.</span></span>

    2. <span data-ttu-id="39357-178">Créer un hôte nommé **suivi**et vérifiez **autoriser suivi de l’hôte**.</span><span class="sxs-lookup"><span data-stu-id="39357-178">Create a new host named **Tracking**, and check **Allow Host Tracking**.</span></span> <span data-ttu-id="39357-179">Créer une instance d’hôte et le démarrer.</span><span class="sxs-lookup"><span data-stu-id="39357-179">Create a host instance, and start it.</span></span>

<span data-ttu-id="39357-180">À présent, interroger les tables BizTalkMsgBoxDb TrackingData_2_x à nouveau.</span><span class="sxs-lookup"><span data-stu-id="39357-180">Now, query the BizTalkMsgBoxDb TrackingData_2_x tables again.</span></span> <span data-ttu-id="39357-181">Si les tables sont vides, les données a été déplacées et il doivent commencer à afficher dans Application Insights.</span><span class="sxs-lookup"><span data-stu-id="39357-181">If the tables are empty, then the data was moved, and should start displaying in Application Insights.</span></span>
    
## <a name="see-also"></a><span data-ttu-id="39357-182">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="39357-182">See also</span></span>
 [<span data-ttu-id="39357-183">Installer et configurer le Pack de fonctionnalités</span><span class="sxs-lookup"><span data-stu-id="39357-183">Install & configure the Feature Pack</span></span>](../core/configure-the-feature-pack.md)