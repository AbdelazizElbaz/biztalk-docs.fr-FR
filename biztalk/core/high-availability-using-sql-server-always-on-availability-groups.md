---
title: "Haute disponibilité à l’aide de SQL Server groupes de disponibilité AlwaysOn | Documents Microsoft"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 4511a578-77d2-49ee-99bd-f0406ad625d0
caps.latest.revision: "10"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: db9b066b6d1f2334e14e4829d61ec6b84830c4c1
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/20/2017
---
# <a name="high-availability-using-sql-server-always-on-availability-groups"></a><span data-ttu-id="92c9b-102">Haute disponibilité à l’aide de SQL Server groupes de disponibilité AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="92c9b-102">High Availability using SQL Server Always On Availability Groups</span></span>
<span data-ttu-id="92c9b-103">Configurer la haute disponibilité à l’aide de groupes de disponibilité AlwaysOn de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="92c9b-103">Configure high availability using SQL Server AlwaysOn availability groups.</span></span>

> [!TIP] 
<span data-ttu-id="92c9b-104">[Configuration de BizTalk Server 2016 à l’aide de la disponibilité de groupes LAB](https://skastberg.wordpress.com/2017/02/22/setting-up-my-biztalk-server-2016-using-availability-groups-lab/) fournit un guide pas à pas écrit par un ingénieur Microsoft.</span><span class="sxs-lookup"><span data-stu-id="92c9b-104">[Setting up BizTalk Server 2016 using availability groups LAB](https://skastberg.wordpress.com/2017/02/22/setting-up-my-biztalk-server-2016-using-availability-groups-lab/) provides a step-by-step guide written by a Microsoft field engineer.</span></span> <span data-ttu-id="92c9b-105">Il est basé sur un environnement lab et comprend des observations.</span><span class="sxs-lookup"><span data-stu-id="92c9b-105">It is based on a lab environment, and includes some observations.</span></span> <span data-ttu-id="92c9b-106">Regarde.</span><span class="sxs-lookup"><span data-stu-id="92c9b-106">Check it out.</span></span>  

> [!IMPORTANT]
> * <span data-ttu-id="92c9b-107">Groupes de disponibilité AlwaysOn est disponible à partir de SQL Server 2016.</span><span class="sxs-lookup"><span data-stu-id="92c9b-107">Always On Availability Groups is available starting with SQL Server 2016.</span></span> <span data-ttu-id="92c9b-108">Si vous utilisez une version antérieure de SQL Server, cette rubrique ne s’applique pas à vous.</span><span class="sxs-lookup"><span data-stu-id="92c9b-108">If you are using a previous SQL Server version, this topic does not apply to you.</span></span> 
> * <span data-ttu-id="92c9b-109">BizTalk Server 2016 prend en charge le mode de validation synchrone ; mode de validation asynchrone n’est pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="92c9b-109">BizTalk Server 2016 supports synchronous-commit mode; asynchronous-commit mode is not supported.</span></span> <span data-ttu-id="92c9b-110">Récupération d’urgence, il est recommandé pour configurer la tâche de sauvegarde de BizTalk Server et utiliser des journaux de transaction.</span><span class="sxs-lookup"><span data-stu-id="92c9b-110">For disaster recovery, it is recommended to configure the Backup BizTalk Server job, and use log shipping.</span></span> <span data-ttu-id="92c9b-111">Consultez [sauvegarde et restauration de bases de données BizTalk Server](../core/backing-up-and-restoring-biztalk-server-databases.md) pour des détails spécifiques.</span><span class="sxs-lookup"><span data-stu-id="92c9b-111">See [Backing Up and Restoring BizTalk Server Databases](../core/backing-up-and-restoring-biztalk-server-databases.md) for specific details.</span></span>
> 
>    <span data-ttu-id="92c9b-112">[Modes de disponibilité](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/availability-modes-always-on-availability-groups) en détail les options de validation avec des groupes de disponibilité AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="92c9b-112">[Availability Modes](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/availability-modes-always-on-availability-groups) details the commit options with Always On Availability Groups.</span></span> 


## <a name="background-and-history"></a><span data-ttu-id="92c9b-113">Historique</span><span class="sxs-lookup"><span data-stu-id="92c9b-113">Background and history</span></span>

<span data-ttu-id="92c9b-114">BizTalk Server s’appuie fortement sur SQL Server pour la persistance des données.</span><span class="sxs-lookup"><span data-stu-id="92c9b-114">BizTalk Server relies heavily on SQL Server for data persistence.</span></span> <span data-ttu-id="92c9b-115">Autres composants et les hôtes BizTalk Server ont des rôles spécifiques lors de l’intégration d’applications d’entreprise hétérogènes, telles que la réception, le traitement ou routage des messages.</span><span class="sxs-lookup"><span data-stu-id="92c9b-115">Other components and hosts in BizTalk Server have specific roles when integrating disparate business applications, such as receiving, processing, or routing messages.</span></span> <span data-ttu-id="92c9b-116">L’ordinateur de base de données enregistre ces travaux et l’enregistre sur disque.</span><span class="sxs-lookup"><span data-stu-id="92c9b-116">The database computer captures this work, and persists it to disk.</span></span> 

<span data-ttu-id="92c9b-117">BizTalk Server utilise le Clustering de basculement SQL Server et l’envoi de journaux pour fournir une haute disponibilité, sauvegarde et restauration et récupération d’urgence pour ses bases de données locales.</span><span class="sxs-lookup"><span data-stu-id="92c9b-117">BizTalk uses SQL Server Failover Clustering and Log Shipping to provide high availability, backup and restore, and disaster recovery for its on-premises databases.</span></span> <span data-ttu-id="92c9b-118">Dans Azure IaaS (machines virtuelles), les versions précédentes de SQL Server ne gèrent pas les Instances de Cluster de basculement (aucune prise en charge MSDTC).</span><span class="sxs-lookup"><span data-stu-id="92c9b-118">In Azure IaaS (Azure virtual machines), previous versions of SQL Server do not support Failover Cluster Instances (no MSDTC support).</span></span> <span data-ttu-id="92c9b-119">Par conséquent, BizTalk n’a pas une solution de haute disponibilité lors de l’utilisation de machines virtuelles Azure.</span><span class="sxs-lookup"><span data-stu-id="92c9b-119">As a result, BizTalk did not have a HA solution when using Azure VMs.</span></span>

<span data-ttu-id="92c9b-120">À compter de SQL Server 2016, groupes de disponibilité AlwaysOn de SQL Server prend en charge MSDTC sur site et à l’aide de machines virtuelles Azure.</span><span class="sxs-lookup"><span data-stu-id="92c9b-120">Starting with SQL Server 2016, SQL Server AlwaysOn Availability Groups supports MSDTC for on-premises and using Azure VMs.</span></span> <span data-ttu-id="92c9b-121">Par conséquent, la fonctionnalité AlwaysOn de SQL Server 2016 est prise en charge pour BizTalk bases de données locale ou dans les scénarios Azure IaaS.</span><span class="sxs-lookup"><span data-stu-id="92c9b-121">As a result, the SQL Server 2016 AlwaysOn feature is supported for BizTalk databases on-premises or in Azure IaaS scenarios.</span></span> 

## <a name="sql-server-2016-alwayson-availability-groups"></a><span data-ttu-id="92c9b-122">Groupes de disponibilité AlwaysOn de SQL Server 2016</span><span class="sxs-lookup"><span data-stu-id="92c9b-122">SQL Server 2016 AlwaysOn Availability Groups</span></span> 
<span data-ttu-id="92c9b-123">Déploiement des groupes de disponibilité AlwaysOn requiert un cluster de Clustering de basculement Windows Server (WSFC).</span><span class="sxs-lookup"><span data-stu-id="92c9b-123">Deploying AlwaysOn Availability Groups requires a Windows Server Failover Clustering (WSFC) cluster.</span></span> <span data-ttu-id="92c9b-124">Chaque réplica de disponibilité d'un groupe de disponibilité donné doit résider sur un nœud différent du même cluster WSFC.</span><span class="sxs-lookup"><span data-stu-id="92c9b-124">Each availability replica of a given availability group must reside on a different node of the same WSFC cluster.</span></span> <span data-ttu-id="92c9b-125">Un groupe de ressources WSFC est créé pour chaque groupe de disponibilité que vous créez.</span><span class="sxs-lookup"><span data-stu-id="92c9b-125">A WSFC resource group is created for every availability group that you create.</span></span> <span data-ttu-id="92c9b-126">Le cluster WSFC surveille ce groupe de ressources pour évaluer l'intégrité du réplica principal.</span><span class="sxs-lookup"><span data-stu-id="92c9b-126">The WSFC cluster monitors this resource group to evaluate the health of the primary replica.</span></span>  

<span data-ttu-id="92c9b-127">L'illustration suivante montre un groupe de disponibilité qui contient un réplica principal et quatre réplicas secondaires.</span><span class="sxs-lookup"><span data-stu-id="92c9b-127">The following illustration shows an availability group that contains one primary replica and four secondary replicas.</span></span>  
 
 ![SQLAG_PrimaryReplica](../core/media/sqlag-primaryreplica.png)

<span data-ttu-id="92c9b-129">Les clients peuvent se connecter au réplica principal d’un groupe de disponibilité donné à l’aide d’un écouteur de groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="92c9b-129">Clients can connect to the primary replica of a given availability group using an availability group listener.</span></span> <span data-ttu-id="92c9b-130">Un écouteur fournit un ensemble de ressources qui sont attachés à un groupe de disponibilité donné pour diriger les connexions clientes au réplica de disponibilité approprié.</span><span class="sxs-lookup"><span data-stu-id="92c9b-130">An availability group listener provides a set of resources that are attached to a given availability group to direct client connections to the appropriate availability replica.</span></span> 

>[!IMPORTANT]
> <span data-ttu-id="92c9b-131">SQL Server 2016 prend en charge MSDTC avec groupes de disponibilité AlwaysOn (AG) sur Windows Server 2016 et Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="92c9b-131">SQL Server 2016 supports MSDTC with AlwaysOn Availability Groups (AG) on Windows Server 2016 and Windows Server 2012 R2.</span></span> <span data-ttu-id="92c9b-132">**Windows Server 2012 R2** requiert le [3090973](https://support.microsoft.com/kb/3090973) correctif Windows Installer.</span><span class="sxs-lookup"><span data-stu-id="92c9b-132">**Windows Server 2012 R2** requires  the [3090973](https://support.microsoft.com/kb/3090973) Windows hotfix  to be installed.</span></span> 
> <span data-ttu-id="92c9b-133">**Windows Server 2016** requiert que le [clé de Registre RemoteAccessEnabled](https://support.microsoft.com/kb/3182294) être activée.</span><span class="sxs-lookup"><span data-stu-id="92c9b-133">**Windows Server 2016** requires that the [RemoteAccessEnabled registry key](https://support.microsoft.com/kb/3182294) be enabled.</span></span>

<span data-ttu-id="92c9b-134">SQL Server ne prend pas en charge MSDTC avec le groupe de disponibilité AlwaysOn pour toutes les versions antérieures à 2016.</span><span class="sxs-lookup"><span data-stu-id="92c9b-134">SQL Server does not support MSDTC with AlwaysOn AG for any versions prior to 2016.</span></span>  

<span data-ttu-id="92c9b-135">MSDTC entre les bases de données sur la même instance de SQL Server n’est pas pris en charge avec les groupes de disponibilité AlwaysOn de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="92c9b-135">MSDTC between databases on same SQL Server instance is not supported with SQL Server AlwaysOn Availability Groups.</span></span> <span data-ttu-id="92c9b-136">Cela signifie qu’aucun deux bases de données BizTalk dans une transaction distribuée ne peuvent être hébergées sur la même instance SQL server.</span><span class="sxs-lookup"><span data-stu-id="92c9b-136">This means that no two BizTalk databases in a distributed transaction can be hosted on the same SQL server instance.</span></span> <span data-ttu-id="92c9b-137">Pour des raisons de cohérence transactionnelle, les bases de données BizTalk participant à une transaction distribuée doivent être hébergés sur différentes instances de SQL server.</span><span class="sxs-lookup"><span data-stu-id="92c9b-137">For transactional consistency, BizTalk databases participating in distributed transaction should be hosted on different SQL server instances.</span></span> <span data-ttu-id="92c9b-138">Notez que peu importe si les instances SQL sont sur le même ordinateur ou sur des ordinateurs différents.</span><span class="sxs-lookup"><span data-stu-id="92c9b-138">Note that it does not matter whether SQL instances are on the same computer, or different computers.</span></span>  


## <a name="providing-high-availability-for-biztalk-databases-using-alwayson-availability-groups"></a><span data-ttu-id="92c9b-139">Offrant une haute disponibilité pour les bases de données BizTalk à l’aide de groupes de disponibilité AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="92c9b-139">Providing high availability for BizTalk databases using AlwaysOn Availability Groups</span></span> 
<span data-ttu-id="92c9b-140">Dans la configuration de base de BizTalk Server, un minimum de 9 bases de données sont créés notamment BAM et les règles de bases de données.</span><span class="sxs-lookup"><span data-stu-id="92c9b-140">In the basic configuration of BizTalk Server, a minimum of 9 databases are created including Rules and BAM databases.</span></span> <span data-ttu-id="92c9b-141">En raison de la ressource MSDTC limitation avec des groupes de disponibilité mentionné précédemment, une configuration telle que les éléments suivants ne garantit pas la cohérence transactionnelle.</span><span class="sxs-lookup"><span data-stu-id="92c9b-141">Due to the MSDTC limitation with Availability Groups mentioned previously, a configuration such as following does not ensure transactional consistency.</span></span> 

![SQLAG_NoTrans](../core/media/sqlag-notrans.gif)
 
<span data-ttu-id="92c9b-143">Nous recommandons que les bases de données BizTalk Server sont regroupés dans les quatre instances de SQL Server suivantes :</span><span class="sxs-lookup"><span data-stu-id="92c9b-143">We recommend that the BizTalk Server databases are grouped into the following four SQL Server instances:</span></span>
 
| <span data-ttu-id="92c9b-144">Instance</span><span class="sxs-lookup"><span data-stu-id="92c9b-144">Instance</span></span> |<span data-ttu-id="92c9b-145">Rôle</span><span class="sxs-lookup"><span data-stu-id="92c9b-145">Role</span></span> |<span data-ttu-id="92c9b-146">Bases de données de ce groupe BizTalk</span><span class="sxs-lookup"><span data-stu-id="92c9b-146">BizTalk Databases in that group</span></span>  |
|--- | --- | ---|
|<span data-ttu-id="92c9b-147">1</span><span class="sxs-lookup"><span data-stu-id="92c9b-147">1</span></span> |<span data-ttu-id="92c9b-148">Authentification</span><span class="sxs-lookup"><span data-stu-id="92c9b-148">Authentication</span></span> |<span data-ttu-id="92c9b-149">SSODB</span><span class="sxs-lookup"><span data-stu-id="92c9b-149">SSODB</span></span>|
|<span data-ttu-id="92c9b-150">2</span><span class="sxs-lookup"><span data-stu-id="92c9b-150">2</span></span> |<span data-ttu-id="92c9b-151">Gestion</span><span class="sxs-lookup"><span data-stu-id="92c9b-151">Management</span></span> |<span data-ttu-id="92c9b-152">BizTalkMgmtDb</span><span class="sxs-lookup"><span data-stu-id="92c9b-152">BizTalkMgmtDb</span></span>| 
|<span data-ttu-id="92c9b-153">3</span><span class="sxs-lookup"><span data-stu-id="92c9b-153">3</span></span> |<span data-ttu-id="92c9b-154">Runtime</span><span class="sxs-lookup"><span data-stu-id="92c9b-154">Runtime</span></span> |<span data-ttu-id="92c9b-155">BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="92c9b-155">BizTalkMsgBoxDb</span></span><br/> <span data-ttu-id="92c9b-156">BizTalkRulesEngineDb</span><span class="sxs-lookup"><span data-stu-id="92c9b-156">BizTalkRulesEngineDb</span></span><br/> <span data-ttu-id="92c9b-157">BAMPrimaryImport</span><span class="sxs-lookup"><span data-stu-id="92c9b-157">BAMPrimaryImport</span></span><br/><span data-ttu-id="92c9b-158">BAMStarSchema</span><span class="sxs-lookup"><span data-stu-id="92c9b-158">BAMStarSchema</span></span> <br/><span data-ttu-id="92c9b-159">BAMAlertsApplication</span><span class="sxs-lookup"><span data-stu-id="92c9b-159">BAMAlertsApplication</span></span> |
|<span data-ttu-id="92c9b-160">4</span><span class="sxs-lookup"><span data-stu-id="92c9b-160">4</span></span> |<span data-ttu-id="92c9b-161">Suivi</span><span class="sxs-lookup"><span data-stu-id="92c9b-161">Tracking</span></span> |<span data-ttu-id="92c9b-162">BizTalkDTADb</span><span class="sxs-lookup"><span data-stu-id="92c9b-162">BizTalkDTADb</span></span>| 
 
<span data-ttu-id="92c9b-163">Dans un scénario de MessageBox à grande échelle (il s’agit d’une configuration avec plusieurs MessageBox), il existe plusieurs bases de données MessageBox, et chaque base de données MessageBox doit se trouver sur sa propre instance de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="92c9b-163">In a scaled-out MessageBox scenario (a configuration with more than one MessageBox), there is more than one MessageBox database, and each MessageBox database must be on its own SQL Server instance.</span></span> 

<span data-ttu-id="92c9b-164">BizTalk Server dépend également de SQL Server Analysis Services et SQL Server Integration Services pour l’analyse BAM et d’archivage.</span><span class="sxs-lookup"><span data-stu-id="92c9b-164">BizTalk Server also depends on SQL Server Analysis Services and SQL Server Integration Services for BAM Analysis and Archiving.</span></span> <span data-ttu-id="92c9b-165">SQL Server ne fournit pas une solution haute disponibilité pour les Services d’intégration ou d’Analysis Services dans Azure IaaS.</span><span class="sxs-lookup"><span data-stu-id="92c9b-165">SQL Server does not provide a high availability solution for Integration Services or Analysis Services in Azure IaaS.</span></span> <span data-ttu-id="92c9b-166">Il est donc recommandé d’utiliser une autre instance de SQL Server autonome pour les bases de données BAMArchive et BAMAnalysis Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="92c9b-166">It is therefore recommended to use another standalone SQL Server instance for the BAMArchive and BAMAnalysis Analysis Services databases.</span></span> <span data-ttu-id="92c9b-167">Pour les installations locales, Instance de Clustering de basculement de SQL peut être utilisée pour définir une configuration de haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="92c9b-167">For on-premises installations, SQL Failover Clustering Instance can be used for setting up a high availability configuration.</span></span> 

<span data-ttu-id="92c9b-168">Cette configuration est illustrée ci-dessous et recommandée pour les bases de données BizTalk dans les groupes de disponibilité :</span><span class="sxs-lookup"><span data-stu-id="92c9b-168">This configuration is illustrated below, and recommended for BizTalk Databases in Availability Groups:</span></span>  

![SQLAG_Recommended](../core/media/sqlag-recommended.png)
 
<span data-ttu-id="92c9b-170">En même temps que les bases de données SQL Server, configuration de BizTalk Server crée également des connexions de sécurité de SQL Server et les travaux de l’Agent SQL.</span><span class="sxs-lookup"><span data-stu-id="92c9b-170">Along with SQL Server databases, BizTalk Server configuration also creates SQL Server security logins and SQL Agent Jobs.</span></span> <span data-ttu-id="92c9b-171">Groupes de disponibilité AlwaysOn fournir uniquement la possibilité de gérer des bases de données à l’intérieur d’un groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="92c9b-171">AlwaysOn Availability Groups only provide the ability to manage databases inside an Availability Group.</span></span> <span data-ttu-id="92c9b-172">Connexions et les travaux de l’Agent SQL pour BizTalk doivent être créés et mis à jour/gérés manuellement sur tous les réplicas de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="92c9b-172">Logins and SQL Agent Jobs for BizTalk need to be created and updated/managed manually on all the availability replicas.</span></span>  

<span data-ttu-id="92c9b-173">La liste suivante des connexions de sécurité de SQL Server sont associés à BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="92c9b-173">The following list of SQL Server security logins are associated with BizTalk Server.</span></span> <span data-ttu-id="92c9b-174">Vous avez peut-être créées pour vos applications BizTalk Server de connexions supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="92c9b-174">You may have additional logins created for your BizTalk Server applications.</span></span> <span data-ttu-id="92c9b-175">Dans ce cas, vous devez les répliquer sur chaque instance de SQL Server qui héberge un réplica de bases de données BizTalk.</span><span class="sxs-lookup"><span data-stu-id="92c9b-175">If so, you need to replicate them on every instance of SQL Server hosting a replica of BizTalk databases.</span></span> 

1. <span data-ttu-id="92c9b-176">Utilisateurs d’applications BizTalk (un ou plusieurs correspondant à chaque hôte in-process)</span><span class="sxs-lookup"><span data-stu-id="92c9b-176">BizTalk Application Users (one or more corresponding to each in-proc Host)</span></span> 
2. <span data-ttu-id="92c9b-177">BizTalk utilisateurs d’hôtes isolés (un ou plusieurs correspondant à chaque hôte isolé)</span><span class="sxs-lookup"><span data-stu-id="92c9b-177">BizTalk Isolated Host Users (one or more corresponding to each Isolated Host)</span></span> 
3. <span data-ttu-id="92c9b-178">Administrateurs BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="92c9b-178">BizTalk Server Administrators</span></span> 
4. <span data-ttu-id="92c9b-179">Opérateurs interentreprises BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="92c9b-179">BizTalk Server B2B Operators</span></span> 
5. <span data-ttu-id="92c9b-180">Opérateurs BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="92c9b-180">BizTalk Server Operators</span></span> 
6. <span data-ttu-id="92c9b-181">Administrateurs SSO</span><span class="sxs-lookup"><span data-stu-id="92c9b-181">SSO Administrators</span></span> 
7. <span data-ttu-id="92c9b-182">Utilisateur d’alertes BAM</span><span class="sxs-lookup"><span data-stu-id="92c9b-182">BAM Alerts User</span></span> 
8. <span data-ttu-id="92c9b-183">Utilisateur de service Web de gestion de l'analyse BAM</span><span class="sxs-lookup"><span data-stu-id="92c9b-183">BAM Management Web Service User</span></span> 
9. <span data-ttu-id="92c9b-184">Compte de Service de mise à jour de moteur règle</span><span class="sxs-lookup"><span data-stu-id="92c9b-184">Rule Engine Update Service Account</span></span> 

<span data-ttu-id="92c9b-185">Si vous avez créé des hôtes supplémentaires ou que vous créerez ultérieurement des hôtes supplémentaires, il y aura des connexions SQL créées dans le cadre de ce processus.</span><span class="sxs-lookup"><span data-stu-id="92c9b-185">If you have created additional hosts or will create additional hosts later, there will be new SQL logins created as part of this process.</span></span> <span data-ttu-id="92c9b-186">Il se peut que vous devez vous assurer de créer ces connexions SQL manuellement sur les réplicas correspondants.</span><span class="sxs-lookup"><span data-stu-id="92c9b-186">You must make sure to create these SQL logins manually on the corresponding replicas.</span></span>

<span data-ttu-id="92c9b-187">Les travaux d'Agent SQL Server suivants sont associés à BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="92c9b-187">The following SQL Server Agent jobs are associated with BizTalk Server.</span></span> <span data-ttu-id="92c9b-188">Les travaux installés sur chaque serveur sont différentes selon les fonctionnalités qui sont installées et configurées.</span><span class="sxs-lookup"><span data-stu-id="92c9b-188">The jobs installed on each server are different depending on which features are installed and configured.</span></span> <span data-ttu-id="92c9b-189">La plupart de ces travaux sont créés lors de la configuration de BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="92c9b-189">Most of these jobs are created during BizTalk Server configuration.</span></span> <span data-ttu-id="92c9b-190">Plusieurs d'entre eux sont créés lors de la configuration de l'envoi de journaux.</span><span class="sxs-lookup"><span data-stu-id="92c9b-190">Several are created when configuring log shipping.</span></span> <span data-ttu-id="92c9b-191">Ces travaux doivent être répliqués sur chaque instance de réplica d’hébergement SQL Server de leur base de données BizTalk correspondant.</span><span class="sxs-lookup"><span data-stu-id="92c9b-191">These jobs need to be replicated on each instance of SQL Server hosting replica of their corresponding BizTalk database.</span></span> <span data-ttu-id="92c9b-192">Cela doit être effectué manuellement.</span><span class="sxs-lookup"><span data-stu-id="92c9b-192">This must be performed manually.</span></span> 

- <span data-ttu-id="92c9b-193">Travaux de BizTalkMgmtDb :</span><span class="sxs-lookup"><span data-stu-id="92c9b-193">BizTalkMgmtDb jobs:</span></span> 
    - <span data-ttu-id="92c9b-194">Backup BizTalk Server (BizTalkMgmtDb)</span><span class="sxs-lookup"><span data-stu-id="92c9b-194">Backup BizTalk Server (BizTalkMgmtDb)</span></span> 
    - <span data-ttu-id="92c9b-195">CleanupBTFExpiredEntriesJob_BizTalkMgmtDb</span><span class="sxs-lookup"><span data-stu-id="92c9b-195">CleanupBTFExpiredEntriesJob_BizTalkMgmtDb</span></span> 
    - <span data-ttu-id="92c9b-196">Monitor BizTalk Server (BizTalkMgmtDb)</span><span class="sxs-lookup"><span data-stu-id="92c9b-196">Monitor BizTalk Server (BizTalkMgmtDb)</span></span> 
- <span data-ttu-id="92c9b-197">Travaux de BizTalkMsgBoxDb :</span><span class="sxs-lookup"><span data-stu-id="92c9b-197">BizTalkMsgBoxDb jobs:</span></span> 
    - <span data-ttu-id="92c9b-198">MessageBox_DeadProcesses_Cleanup_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="92c9b-198">MessageBox_DeadProcesses_Cleanup_BizTalkMsgBoxDb</span></span> 
    - <span data-ttu-id="92c9b-199">MessageBox_Message_Cleanup_BizTalkMsgBoxDb MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb MessageBox_Parts_Cleanup_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="92c9b-199">MessageBox_Message_Cleanup_BizTalkMsgBoxDb MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb MessageBox_Parts_Cleanup_BizTalkMsgBoxDb</span></span> 
    - <span data-ttu-id="92c9b-200">MessageBox_UpdateStats_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="92c9b-200">MessageBox_UpdateStats_BizTalkMsgBoxDb</span></span> 
    - <span data-ttu-id="92c9b-201">Operations_OperateOnInstances_OnMaster_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="92c9b-201">Operations_OperateOnInstances_OnMaster_BizTalkMsgBoxDb</span></span> 
    - <span data-ttu-id="92c9b-202">PurgeSubscriptionsJob_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="92c9b-202">PurgeSubscriptionsJob_BizTalkMsgBoxDb</span></span> 
    - <span data-ttu-id="92c9b-203">TrackedMessages_Copy_BizTalkMsgBoxDb</span><span class="sxs-lookup"><span data-stu-id="92c9b-203">TrackedMessages_Copy_BizTalkMsgBoxDb</span></span> 
- <span data-ttu-id="92c9b-204">Travaux sur les boîtes de message supplémentaires</span><span class="sxs-lookup"><span data-stu-id="92c9b-204">Jobs on additional msgboxes</span></span>
- <span data-ttu-id="92c9b-205">Travail de BizTalkDTADb :</span><span class="sxs-lookup"><span data-stu-id="92c9b-205">BizTalkDTADb job:</span></span> 
    - <span data-ttu-id="92c9b-206">DTA Purge and Archive (BizTalkDTADb)</span><span class="sxs-lookup"><span data-stu-id="92c9b-206">DTA Purge and Archive (BizTalkDTADb)</span></span> 
- <span data-ttu-id="92c9b-207">Travail de BizTalkRulesEngineDb :</span><span class="sxs-lookup"><span data-stu-id="92c9b-207">BizTalkRulesEngineDb job:</span></span> 
    - <span data-ttu-id="92c9b-208">Rules_Database_Cleanup_BizTalkRuleEngineDb</span><span class="sxs-lookup"><span data-stu-id="92c9b-208">Rules_Database_Cleanup_BizTalkRuleEngineDb</span></span> 
- <span data-ttu-id="92c9b-209">Travail de BAMAlertsApplication :</span><span class="sxs-lookup"><span data-stu-id="92c9b-209">BAMAlertsApplication job:</span></span> 
    - <span data-ttu-id="92c9b-210">0 ou plus DelAlertHistJob</span><span class="sxs-lookup"><span data-stu-id="92c9b-210">0 or more DelAlertHistJob</span></span> 

<span data-ttu-id="92c9b-211">Contrairement aux Instances de Clustering de basculement SQL, dans les groupes de disponibilité tous les réplicas sont active, en cours d’exécution et disponible.</span><span class="sxs-lookup"><span data-stu-id="92c9b-211">Unlike SQL Failover Clustering Instances, in Availability Groups all replicas are active, running, and available.</span></span> <span data-ttu-id="92c9b-212">Lorsque les travaux de l’Agent SQL sont dupliqués sur chaque réplica pour le basculement, ils s’exécuter sur le réplica correspondant, indépendamment de si elle est actuellement dans le rôle principal ou secondaire.</span><span class="sxs-lookup"><span data-stu-id="92c9b-212">When SQL Agent jobs are duplicated on each replica for failover, they run against the corresponding replica, irrespective of whether it is currently in primary role or secondary role.</span></span> <span data-ttu-id="92c9b-213">Pour vous assurer que ces travaux sont exécutés uniquement sur le réplica principal actuel, toutes les étapes de chaque tâche doivent être placés dans un bloc IF, comme indiqué :</span><span class="sxs-lookup"><span data-stu-id="92c9b-213">To make sure these jobs are executed only on the current primary replica, every step in every job must be enclosed within an IF block, as shown:</span></span> 

    IF (sys.fn_hadr_is_primary_replica(‘dbname’) = 1)  
    BEGIN  
    …  
    END
  
<span data-ttu-id="92c9b-214">Remplacez `‘dbname’` avec le nom de base de données correspondant, par rapport à laquelle le travail est configuré pour s’exécuter.</span><span class="sxs-lookup"><span data-stu-id="92c9b-214">Replace `‘dbname’` with the corresponding database name against which the job is configured to run.</span></span> <span data-ttu-id="92c9b-215">L’exemple suivant illustre cette modification pour TrackedMessages_Copy_BizTalkMsgBoxDb sur BizTalkMsgBoxDb :</span><span class="sxs-lookup"><span data-stu-id="92c9b-215">The following example shows this change for TrackedMessages_Copy_BizTalkMsgBoxDb on BizTalkMsgBoxDb:</span></span> 
 
 ![SQLAG_AgentJob](../core/media/sqlag-agentjob.gif)

### <a name="configure-biztalk-server-when-availability-groups-are-already-set-up"></a><span data-ttu-id="92c9b-217">Configuration de BizTalk Server lorsque les groupes de disponibilité sont déjà configurées</span><span class="sxs-lookup"><span data-stu-id="92c9b-217">Configure BizTalk Server when Availability Groups are already set up</span></span>

1. <span data-ttu-id="92c9b-218">Vérifiez votre configuration requise du système d’exploitation :</span><span class="sxs-lookup"><span data-stu-id="92c9b-218">Check your OS requirements:</span></span> 
* <span data-ttu-id="92c9b-219">Sur tous les **Windows Server 2012 R2** les ordinateurs, installer le [3090973 MSDTC correctif](https://support.microsoft.com/kb/3090973) (ouvre un article de la base de connaissances)</span><span class="sxs-lookup"><span data-stu-id="92c9b-219">On all **Windows Server 2012 R2** computers, install the [3090973 MSDTC hotfix](https://support.microsoft.com/kb/3090973) (opens a KB article)</span></span>
* <span data-ttu-id="92c9b-220">Sur tous les **Windows Server 2016** ordinateurs, activez la [clé de Registre RemoteAccessEnabled](https://support.microsoft.com/kb/3182294) (ouvre un article de la base de connaissances)</span><span class="sxs-lookup"><span data-stu-id="92c9b-220">On all **Windows Server 2016** computers, enable the [RemoteAccessEnabled registry key](https://support.microsoft.com/kb/3182294) (opens a KB article)</span></span>
2. <span data-ttu-id="92c9b-221">Assurez-vous d’avoir au moins quatre instances SQL différentes qui hébergent les bases de données BizTalk différents.</span><span class="sxs-lookup"><span data-stu-id="92c9b-221">Make sure to have at least four different SQL instances which will host the various BizTalk databases.</span></span> <span data-ttu-id="92c9b-222">Les réplicas secondaires doivent également être configurés sur différentes instances SQL.</span><span class="sxs-lookup"><span data-stu-id="92c9b-222">The secondary replicas should also be set up on different SQL instances.</span></span> <span data-ttu-id="92c9b-223">Cela entraîne un minimum de 8 instances SQL (1 réplica principal et 1 secondaire pour chacune des instances de 4), ainsi qu’un minimum de 4 groupes de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="92c9b-223">This results in a minimum of 8 SQL instances (1 primary and 1 secondary replica for each of the 4 instances), and a minimum of 4 Availability Groups.</span></span> <span data-ttu-id="92c9b-224">Consultez l’illustration ci-dessus pour cette configuration de groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="92c9b-224">See the above illustration for this Availability Group configuration.</span></span> <span data-ttu-id="92c9b-225">Assurez-vous que les groupes de disponibilité sont créés avec le **par base de données prise en charge DTC** option car il ne peut pas être modifiée ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="92c9b-225">Make sure Availability Groups are created with the **Per Database DTC Support** option as this cannot be changed later.</span></span> 
3. <span data-ttu-id="92c9b-226">Lorsque configuration de BizTalk Server et en spécifiant le nom du serveur SQL, utilisez le nom de l’écouteur du groupe de disponibilité au lieu du nom d’ordinateur réel.</span><span class="sxs-lookup"><span data-stu-id="92c9b-226">When configuring BizTalk Server and specifying the SQL server name, use the Availability Group’s listener name instead of the actual machine name.</span></span> <span data-ttu-id="92c9b-227">Cela crée les bases de données BizTalk, les connexions et les travaux SQL Agent sur le réplica principal actuel.</span><span class="sxs-lookup"><span data-stu-id="92c9b-227">This creates the BizTalk databases, logins, and SQL Agent jobs on the current primary replica.</span></span> 
4. <span data-ttu-id="92c9b-228">Arrêter le traitement BizTalk (Instances de l’hôte, Service d’authentification unique, IIS, Service de mise à jour du moteur de règles, BAMAlerts Service et ainsi de suite) et arrêter les travaux de l’Agent SQL.</span><span class="sxs-lookup"><span data-stu-id="92c9b-228">Stop BizTalk processing (Host Instances, SSO Service, IIS, Rules Engine Update Service, BAMAlerts Service, and so on), and stop the SQL Agent Jobs.</span></span> 
5. <span data-ttu-id="92c9b-229">Ajoutez maintenant les bases de données BIzTalk aux groupes de disponibilité respectif.</span><span class="sxs-lookup"><span data-stu-id="92c9b-229">Now add BIzTalk databases to the respective Availability Groups.</span></span> 
6. <span data-ttu-id="92c9b-230">Placez le corps d’étapes de travail de l’Agent SQL dans `IF` bloc (mentionnée précédemment) pour vous assurer qu’ils s’exécuter uniquement si la cible est le réplica principal.</span><span class="sxs-lookup"><span data-stu-id="92c9b-230">Enclose body of SQL Agent job steps within `IF` block (mentioned previously) to make sure they run only if the target is the primary replica.</span></span> 
7. <span data-ttu-id="92c9b-231">Script des connexions et des travaux de l’Agent SQL pour les répliquer sur le réplica correspondant.</span><span class="sxs-lookup"><span data-stu-id="92c9b-231">Script Logins and SQL Agent Jobs to replicate them on corresponding replica.</span></span> 
8. <span data-ttu-id="92c9b-232">Réplication SQL DBMail compte et un profil pour les alertes BAM sur des instances SQL correspondants qui héberge le réplica secondaire.</span><span class="sxs-lookup"><span data-stu-id="92c9b-232">Replicate SQL DBMail Profile and Account for BAM Alerts on corresponding SQL instances hosting the secondary replica.</span></span> 
9. <span data-ttu-id="92c9b-233">Si vous ajoutez une base de données MessageBox supplémentaires ou déploiement d’une nouvelle activité/vue BAM version ultérieure, puis de nouveau les travaux de SQL Server sont créés pour les nouvelles bases de données de zone message ou de la base de données d’alertes BAM sur le réplica principal actuel.</span><span class="sxs-lookup"><span data-stu-id="92c9b-233">If you are adding an additional message box database or deploying a new BAM activity/view later, then new SQL jobs are created for new message box databases or BAM Alerts database on the current primary replica.</span></span> <span data-ttu-id="92c9b-234">Veillez à modifier sur le réplica principal et ensuite créer manuellement sur les réplicas secondaires correspondants.</span><span class="sxs-lookup"><span data-stu-id="92c9b-234">Make sure to edit it on primary replica, and then create them manually on the corresponding secondary replicas.</span></span> 

<span data-ttu-id="92c9b-235">Cette configuration peut également être effectuée à l’aide des Instances de SQL qui héberge le réplica principal.</span><span class="sxs-lookup"><span data-stu-id="92c9b-235">This configuration can also be done using the SQL Instances hosting the primary replica.</span></span> <span data-ttu-id="92c9b-236">Dans ce cas, après la configuration de BizTalk, exécutez le `UpdateDatabase.vbs` et `UpdateRegistry.vbs` des scripts sur les ordinateurs BizTalk après avoir effectué les étapes ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="92c9b-236">In this case, after the BizTalk configuration, run the `UpdateDatabase.vbs` and `UpdateRegistry.vbs` scripts on the BizTalk machines after the above steps.</span></span> <span data-ttu-id="92c9b-237">Ce sujet est abordé plus en détail dans la section suivante.</span><span class="sxs-lookup"><span data-stu-id="92c9b-237">This is discussed in more detail in the next section.</span></span>  
 
### <a name="move-biztalk-server-databases-of-an-existing-biztalk-system-to-availability-groups"></a><span data-ttu-id="92c9b-238">Déplacer des bases de données BizTalk Server d’un système BizTalk existant aux groupes de disponibilité</span><span class="sxs-lookup"><span data-stu-id="92c9b-238">Move BizTalk Server databases of an existing BizTalk system to Availability Groups</span></span>

1. <span data-ttu-id="92c9b-239">Vérifiez votre configuration requise du système d’exploitation :</span><span class="sxs-lookup"><span data-stu-id="92c9b-239">Check your OS requirements:</span></span> 
* <span data-ttu-id="92c9b-240">Sur tous les **Windows Server 2012 R2** les ordinateurs, installer le [3090973 MSDTC correctif](https://support.microsoft.com/kb/3090973) (ouvre un article de la base de connaissances)</span><span class="sxs-lookup"><span data-stu-id="92c9b-240">On all **Windows Server 2012 R2** computers, install the [3090973 MSDTC hotfix](https://support.microsoft.com/kb/3090973) (opens a KB article)</span></span>
* <span data-ttu-id="92c9b-241">Sur tous les **Windows Server 2016** ordinateurs, activez la [clé de Registre RemoteAccessEnabled](https://support.microsoft.com/kb/3182294) (ouvre un article de la base de connaissances)</span><span class="sxs-lookup"><span data-stu-id="92c9b-241">On all **Windows Server 2016** computers, enable the [RemoteAccessEnabled registry key](https://support.microsoft.com/kb/3182294) (opens a KB article)</span></span>
2. <span data-ttu-id="92c9b-242">Assurez-vous d’avoir au moins quatre instances SQL différentes qui hébergent les bases de données BizTalk différents.</span><span class="sxs-lookup"><span data-stu-id="92c9b-242">Make sure to have at least four different SQL instances which will host the various BizTalk databases.</span></span> <span data-ttu-id="92c9b-243">Les réplicas secondaires doivent également être configurés sur différentes instances SQL.</span><span class="sxs-lookup"><span data-stu-id="92c9b-243">The secondary replicas should also be set up on different SQL instances.</span></span> <span data-ttu-id="92c9b-244">Cela entraîne un minimum de 8 instances SQL (1 réplica principal et 1 secondaire pour chacune des instances de 4), ainsi qu’un minimum de 4 groupes de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="92c9b-244">This results in a minimum of 8 SQL instances (1 primary and 1 secondary replica for each of the 4 instances), and a minimum of 4 Availability Groups.</span></span> <span data-ttu-id="92c9b-245">Consultez l’illustration ci-dessus pour cette configuration de groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="92c9b-245">See the above illustration for this Availability Group configuration.</span></span> <span data-ttu-id="92c9b-246">Assurez-vous que les groupes de disponibilité sont créés avec **par base de données prise en charge DTC** option car il ne peut pas être modifiée ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="92c9b-246">Make sure Availability Groups are created with **Per Database DTC Support** option as this cannot be changed later.</span></span>  
3. <span data-ttu-id="92c9b-247">Arrêter le traitement de BizTalk et les travaux de l’Agent SQL.</span><span class="sxs-lookup"><span data-stu-id="92c9b-247">Stop BizTalk processing and SQL Agent Jobs.</span></span> 
4. <span data-ttu-id="92c9b-248">Effectuez une sauvegarde complète de toutes les bases de données BizTalk.</span><span class="sxs-lookup"><span data-stu-id="92c9b-248">Perform full backup of all BizTalk Databases.</span></span> 
5. <span data-ttu-id="92c9b-249">Restaurez les bases de données BizTalk sur les instances SQL actuellement dans le rôle principal du groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="92c9b-249">Restore BizTalk databases on the SQL instances currently in the primary role in the Availability Group.</span></span> 
6. <span data-ttu-id="92c9b-250">Script des connexions et l’Agent SQL travaux sur les Instances de SQL correspondantes actuellement dans le rôle principal du groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="92c9b-250">Script Logins and SQL Agent jobs on corresponding SQL Instances currently in the primary role in the Availability Group.</span></span>  
7. <span data-ttu-id="92c9b-251">Exécutez le `UpdateDatabase.vbs` et `UpdateRegistry.vbs` des scripts sur les ordinateurs BizTalk en procédant comme suit.</span><span class="sxs-lookup"><span data-stu-id="92c9b-251">Run the `UpdateDatabase.vbs` and `UpdateRegistry.vbs` scripts on the BizTalk machines using the following steps.</span></span> <span data-ttu-id="92c9b-252">Entrez l’écouteur du groupe de disponibilité en tant que le nouveau nom du serveur dans le fichier xml des informations de mise à jour d’entrée.</span><span class="sxs-lookup"><span data-stu-id="92c9b-252">Enter the Availability Group Listener as the new server name in the input update info xml.</span></span>  
    1. <span data-ttu-id="92c9b-253">Arrêtez tous les services BizTalk et SSO de l’entreprise sur le serveur BizTalk.</span><span class="sxs-lookup"><span data-stu-id="92c9b-253">Stop all BizTalk services and Enterprise SSO services on BizTalk Server.</span></span> <span data-ttu-id="92c9b-254">Arrêter le Service SQL Agent sur SQL Server.</span><span class="sxs-lookup"><span data-stu-id="92c9b-254">Stop SQL Agent Service on SQL Server.</span></span> 
    2. <span data-ttu-id="92c9b-255">Sur BizTalk Server, modifiez SampleUpdateInfo.xml dans le dossier suivant :</span><span class="sxs-lookup"><span data-stu-id="92c9b-255">On BizTalk Server, edit SampleUpdateInfo.xml in the following folder:</span></span> 
 
        <span data-ttu-id="92c9b-256">ordinateur 32 bits :`%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="92c9b-256">32-bit computer: `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span></span>
 
        <span data-ttu-id="92c9b-257">ordinateur 64 bits :`%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="92c9b-257">64-bit computer: `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span></span>
 
            1. Replace "SourceServer" with the source server name (old SQL Server hosting old databases).  
            2. Replace "DestinationServer" with the name of the destination server, which should be the availability group listener name.  
            3. If you have the BAMAnalysis, BAM databases or RuleEngineDB, uncomment the appropriate sections. 

    3. <span data-ttu-id="92c9b-258">Ouvrez une invite de commandes et accédez à :</span><span class="sxs-lookup"><span data-stu-id="92c9b-258">Open a command prompt, and go to:</span></span> 
 
        <span data-ttu-id="92c9b-259">ordinateur 32 bits :`%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="92c9b-259">32-bit computer: `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span></span> 
 
        <span data-ttu-id="92c9b-260">ordinateur 64 bits :`%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="92c9b-260">64-bit computer: `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span></span> 
 
        <span data-ttu-id="92c9b-261">À l’invite de commandes, exécutez :</span><span class="sxs-lookup"><span data-stu-id="92c9b-261">At the command prompt, run:</span></span>  
    `cscript UpdateDatabase.vbs SampleUpdateInfo.xml`  
 
        <span data-ttu-id="92c9b-262">Exécutez UpdateDatabase.vbs sur un seul serveur dans le groupe BizTalk.</span><span class="sxs-lookup"><span data-stu-id="92c9b-262">Run UpdateDatabase.vbs on only one server in the BizTalk group.</span></span> 

    4. <span data-ttu-id="92c9b-263">Copiez le fichier SampleUpdateInfo.xml modifié dans le dossier suivant sur chaque ordinateur BizTalk Server dans ce groupe BizTalk :</span><span class="sxs-lookup"><span data-stu-id="92c9b-263">Copy the edited SampleUpdateInfo.xml file to the following folder on every BizTalk Server computer in this BizTalk group:</span></span> 
 
        <span data-ttu-id="92c9b-264">ordinateur 32 bits :`%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="92c9b-264">32-bit computer: `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span></span> 
 
        <span data-ttu-id="92c9b-265">ordinateur 64 bits :`%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="92c9b-265">64-bit computer: `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span></span> 
 
    5. <span data-ttu-id="92c9b-266">Sur chaque ordinateur dans le groupe BizTalk Server, ouvrez une invite de commandes et accédez à :</span><span class="sxs-lookup"><span data-stu-id="92c9b-266">On each computer in the BizTalk Server group, open a command prompt, and go to:</span></span> 
 
        <span data-ttu-id="92c9b-267">ordinateur 32 bits :`%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="92c9b-267">32-bit computer: `%SystemRoot%\Program Files\Microsoft BizTalk Server 20xx\Schema\Restore`</span></span>
 
        <span data-ttu-id="92c9b-268">ordinateur 64 bits :`%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span><span class="sxs-lookup"><span data-stu-id="92c9b-268">64-bit computer: `%SystemRoot%\Program Files (x86)\Microsoft BizTalk Server 20xx\Bins32\Schema\Restore`</span></span> 
 
        <span data-ttu-id="92c9b-269">À l’invite de commandes, exécutez :</span><span class="sxs-lookup"><span data-stu-id="92c9b-269">At the command prompt, run:</span></span>  
    `cscript UpdateRegistry.vbs SampleUpdateInfo.xml` 
 
        <span data-ttu-id="92c9b-270">Exécutez UpdateRegistry.vbs sur chaque serveur dans le groupe BizTalk.</span><span class="sxs-lookup"><span data-stu-id="92c9b-270">Run UpdateRegistry.vbs on every server in the BizTalk group.</span></span> 
 
8. <span data-ttu-id="92c9b-271">Maintenant, déplacez les bases de données dans leurs groupes respectifs de la disponibilité.</span><span class="sxs-lookup"><span data-stu-id="92c9b-271">Now move the databases to their respective Availability Groups.</span></span> 
9. <span data-ttu-id="92c9b-272">Répliquer le profil de DBMail SQL et le compte pour les alertes BAM sur SQL d’instances qui héberge le réplica de la base de données BAMAlerts.</span><span class="sxs-lookup"><span data-stu-id="92c9b-272">Replicate the SQL DBMail Profile and Account for BAM Alerts on the SQL instances hosting the replica of the BAMAlerts database.</span></span> 
10. <span data-ttu-id="92c9b-273">Placez le corps d’étapes de travail de l’Agent SQL dans un bloc IF pour vous assurer qu’ils s’exécuter uniquement si la cible est le serveur principal.</span><span class="sxs-lookup"><span data-stu-id="92c9b-273">Enclose the body of SQL Agent job steps within an IF block to make sure they run only if the target is the primary.</span></span> 
11. <span data-ttu-id="92c9b-274">Script des connexions et des travaux de l’Agent SQL pour les répliquer sur le réplica correspondant.</span><span class="sxs-lookup"><span data-stu-id="92c9b-274">Script Logins and SQL Agent Jobs to replicate them on the corresponding replica.</span></span> <span data-ttu-id="92c9b-275">Le script UpdateDatabase met également à jour le nom du serveur dans les travaux de Operations_OperateOnInstances_OnMaster_BizTalkMsgBoxDb et TrackedMessages_Copy_BizTalkMsgBoxDb.</span><span class="sxs-lookup"><span data-stu-id="92c9b-275">The UpdateDatabase script also updates the server name in the Operations_OperateOnInstances_OnMaster_BizTalkMsgBoxDb and TrackedMessages_Copy_BizTalkMsgBoxDb jobs.</span></span> <span data-ttu-id="92c9b-276">Par conséquent, un script les travaux SQL Agent uniquement après l’exécution du script UpdateDatabase.</span><span class="sxs-lookup"><span data-stu-id="92c9b-276">So script the SQL Agent Jobs only after running the UpdateDatabase script.</span></span> 

## <a name="requirements"></a><span data-ttu-id="92c9b-277">Spécifications</span><span class="sxs-lookup"><span data-stu-id="92c9b-277">Requirements</span></span> 
* <span data-ttu-id="92c9b-278">BizTalk Server Enterprise 2016</span><span class="sxs-lookup"><span data-stu-id="92c9b-278">BizTalk Server 2016 Enterprise</span></span>
* <span data-ttu-id="92c9b-279">SQL Server 2016 Enterprise</span><span class="sxs-lookup"><span data-stu-id="92c9b-279">SQL Server 2016 Enterprise</span></span>
* <span data-ttu-id="92c9b-280">Windows Server 2012 R2</span><span class="sxs-lookup"><span data-stu-id="92c9b-280">Windows Server 2012 R2</span></span>
* <span data-ttu-id="92c9b-281">Windows Server 2016</span><span class="sxs-lookup"><span data-stu-id="92c9b-281">Windows Server 2016</span></span> 

### <a name="availability-group-listener-configured-with-non-default-port-1433"></a><span data-ttu-id="92c9b-282">Écouteur de groupe de disponibilité configuré sans valeur par défaut du port (1433)</span><span class="sxs-lookup"><span data-stu-id="92c9b-282">Availability Group Listener configured with non-default port (1433)</span></span> 
<span data-ttu-id="92c9b-283">Utiliser l’alias SQL sur les ordinateurs BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="92c9b-283">Use SQL alias on BizTalk Server machines.</span></span> 

### <a name="supporting-availability-group-multi-subnet-failovers"></a><span data-ttu-id="92c9b-284">Prise en charge de basculements de sous-réseaux multiples de groupe de disponibilité</span><span class="sxs-lookup"><span data-stu-id="92c9b-284">Supporting Availability Group Multi-Subnet Failovers</span></span> 
<span data-ttu-id="92c9b-285">BizTalk Server utilise OLE DB Microsoft pour les connexions de base de données, ce qui ne prend pas en charge la **MultiSubnetFailover** l’option de connexion.</span><span class="sxs-lookup"><span data-stu-id="92c9b-285">BizTalk Server uses Microsoft OLE DB for database connections, which does not support the **MultiSubnetFailover** connection option.</span></span> <span data-ttu-id="92c9b-286">BizTalk Server ne prend pas en charge la `MultiSubnetFailover (=TRUE)` option de connexion et cela peuvent entraîner des temps de récupération plus élevée pendant le basculement de sous-réseaux multiples.</span><span class="sxs-lookup"><span data-stu-id="92c9b-286">BizTalk Server does not support the `MultiSubnetFailover (=TRUE)` connection option, and this may cause higher recovery time during multi-subnet failover.</span></span> 

### <a name="read-only-routing"></a><span data-ttu-id="92c9b-287">Routage en lecture seule</span><span class="sxs-lookup"><span data-stu-id="92c9b-287">Read-Only Routing</span></span> 
<span data-ttu-id="92c9b-288">Routage en lecture seule fait référence à la capacité de SQL Server pour acheminer les connexions entrantes pour un écouteur de groupe de disponibilité vers un réplica secondaire est configuré pour autoriser des charges de travail en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="92c9b-288">Read-only routing refers to the ability of SQL Server to route incoming connections for an availability group listener to a secondary replica that is configured to allow read-only workloads.</span></span> 

<span data-ttu-id="92c9b-289">BizTalk n’utilise pas le routage en lecture seule pour une des connexions à ses bases de données.</span><span class="sxs-lookup"><span data-stu-id="92c9b-289">BizTalk does not use Read-Only Routing for any of the connections to its databases.</span></span> <span data-ttu-id="92c9b-290">Cela signifie que l’option « Secondaire accessible en lecture » sur les réplicas de disponibilité dans le groupe de disponibilité n’a pas de tout impact sur les connexions de base de données BizTalk.</span><span class="sxs-lookup"><span data-stu-id="92c9b-290">This means the “Readable Secondary” option on Availability Replicas in the availability group does not have any impact on BizTalk database connections.</span></span> 

### <a name="behavior-of-biztalk-server-host-instances-during-sql-server-failover"></a><span data-ttu-id="92c9b-291">Comportement des instances de l'hôte BizTalk Server pendant le basculement de SQL Server</span><span class="sxs-lookup"><span data-stu-id="92c9b-291">Behavior of BizTalk Server Host Instances during SQL Server Failover</span></span> 
<span data-ttu-id="92c9b-292">Si le groupe de disponibilité de SQL Server rencontre un basculement, les bases de données BizTalk Server sur le groupe de disponibilité sont temporairement indisponibles.</span><span class="sxs-lookup"><span data-stu-id="92c9b-292">If the SQL Server availability group experiences a failover, the BizTalk Server databases on the availability group are temporarily unavailable.</span></span> 

#### <a name="behavior-of-in-process-host-instances-during-sql-server-failover"></a><span data-ttu-id="92c9b-293">Comportement des instances de l'hôte In-process au cours d'un basculement SQL Server</span><span class="sxs-lookup"><span data-stu-id="92c9b-293">Behavior of In-Process Host Instances during SQL Server Failover</span></span> 
<span data-ttu-id="92c9b-294">Si les bases de données BizTalk Server ne sont pas disponibles, une instance in-process d’un hôte BizTalk Server est recyclée jusqu'à ce que la connexion à SQL Server est restaurée.</span><span class="sxs-lookup"><span data-stu-id="92c9b-294">If the BizTalk Server databases are unavailable, then an in-process instance of a BizTalk Server host is recycled until the connection to the SQL Server is restored.</span></span> <span data-ttu-id="92c9b-295">Une fois la connexion aux bases de données SQL Server est restaurée, le traitement des documents reprend normalement.</span><span class="sxs-lookup"><span data-stu-id="92c9b-295">Once the connection to the SQL Server databases is restored, document processing resumes normally.</span></span>
 
#### <a name="behavior-of-isolated-host-instances-during-sql-server-failover"></a><span data-ttu-id="92c9b-296">Comportement des instances de l'hôte isolé au cours d'un basculement de SQL Server</span><span class="sxs-lookup"><span data-stu-id="92c9b-296">Behavior of Isolated Host Instances During SQL Server Failover</span></span> 
<span data-ttu-id="92c9b-297">Si les bases de données BizTalk Server ne sont pas disponibles, puis s’arrête une instance isolée d’un hôte BizTalk Server, et une erreur semblable au suivant est générée dans le journal de l’Application BizTalk Server :</span><span class="sxs-lookup"><span data-stu-id="92c9b-297">If the BizTalk Server databases are unavailable, then an isolated instance of a BizTalk Server host pauses, and an error similar to the following is generated in the BizTalk Server Application log:</span></span> 

    All receive locations are being temporarily disabled because either the MessageBox or Configuration database is not available. When these databases become available, the receive locations will be automatically enabled.
 
<span data-ttu-id="92c9b-298">Une fois la connexion aux bases de données SQL Server est restaurée, un message d’information semblable au suivant est écrit dans le journal de l’Application BizTalk Server et le traitement des documents reprend normalement :</span><span class="sxs-lookup"><span data-stu-id="92c9b-298">Once the connection to the SQL Server databases is restored, an informational message similar to the following is written to the BizTalk Server Application log, and then document processing resumes normally:</span></span> 

    All receive locations are being enabled because both the MessageBox and Configuration databases are back online.

#### <a name="biztalk-server-log-shipping-for-disaster-recovery"></a><span data-ttu-id="92c9b-299">Journaux de BizTalk Server pour la récupération d’urgence</span><span class="sxs-lookup"><span data-stu-id="92c9b-299">BizTalk Server Log Shipping for Disaster Recovery</span></span> 
<span data-ttu-id="92c9b-300">BizTalk Server implémente des fonctionnalités en attente de base de données via l’utilisation de base de données de journaux de transaction.</span><span class="sxs-lookup"><span data-stu-id="92c9b-300">BizTalk Server implements database standby capabilities through the use of database log shipping.</span></span> <span data-ttu-id="92c9b-301">BizTalk Server d’envoi de journaux automatise la sauvegarde et la restauration de bases de données et leurs fichiers journaux des transactions, ce qui permet un serveur de secours reprendre le traitement de base de données dans le cas où la production de base de données de serveur échoue.</span><span class="sxs-lookup"><span data-stu-id="92c9b-301">BizTalk Server log shipping automates the backup and restore of databases and their transaction log files, allowing a standby server to resume database processing in the event that the production database server fails.</span></span> 

<span data-ttu-id="92c9b-302">**Bases de données secondaires dans le groupe de disponibilité ne sont pas des sauvegardes.**</span><span class="sxs-lookup"><span data-stu-id="92c9b-302">**Secondary databases in availability group are not backups.**</span></span> <span data-ttu-id="92c9b-303">Continuer à sauvegarder des bases de données BizTalk et leurs journaux des transactions à l’aide de tâches d’envoi de journaux de BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="92c9b-303">Continue to backup BizTalk databases and their transaction logs using BizTalk Server Log Shipping jobs.</span></span> <span data-ttu-id="92c9b-304">Envoi de journaux BizTalk implémentation garantit que les sauvegardes sont toujours effectuées sur le réplica principal actuel de chaque base de données.</span><span class="sxs-lookup"><span data-stu-id="92c9b-304">The way BizTalk Log Shipping is implemented ensures that backups are always performed against the current primary replica of every database.</span></span> <span data-ttu-id="92c9b-305">Le paramètre de préférence de sauvegarde sur le groupe de disponibilité n’est pas reconnue par les travaux de l’envoi de journaux de BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="92c9b-305">The backup preference setting on the availability group is not honored by the BizTalk Server Log Shipping jobs.</span></span> 

<span data-ttu-id="92c9b-306">Si vous ajoutez d’autres bases de données BizTalk à l’opération de sauvegarde de bases de données BizTalk, veillez à utiliser le nom de l’écouteur du groupe de disponibilité que le serveur de base de données pour eux lorsque vous configurez la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="92c9b-306">If you are adding other BizTalk databases to the BizTalk Databases Backup job, be sure to use the Availability Group Listener name as the database server for them when setting up the Backup.</span></span>  
 
## <a name="references"></a><span data-ttu-id="92c9b-307">Références</span><span class="sxs-lookup"><span data-stu-id="92c9b-307">References</span></span> 
 
* [<span data-ttu-id="92c9b-308">Offrant une haute disponibilité pour les bases de données BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="92c9b-308">Providing High Availability for BizTalk Server Databases</span></span>](../core/providing-high-availability-for-biztalk-server-databases.md)  
* [<span data-ttu-id="92c9b-309">Prise en charge du logiciel Microsoft server pour les machines virtuelles Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="92c9b-309">Microsoft server software support for Microsoft Azure virtual machines</span></span>](https://support.microsoft.com/kb/2721672)  
* [<span data-ttu-id="92c9b-310">Base de données SQL Server mise en miroir, le service VSS et AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="92c9b-310">SQL Server database mirroring, Volume Shadow Copy service and AlwaysOn</span></span>](../core/sql-server-database-mirroring-volume-shadow-copy-service-and-alwayson.md)  
* [<span data-ttu-id="92c9b-311">Vue d’ensemble des groupes de disponibilité AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="92c9b-311">Overview of AlwaysOn Availability Groups (SQL Server)</span></span>](https://msdn.microsoft.com/library/ff877884.aspx)  
* [<span data-ttu-id="92c9b-312">Prise en charge des Transactions de bases de données croisées pour la mise en miroir de base de données ou de groupes de disponibilité AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="92c9b-312">Cross-Database Transactions Support For Database Mirroring or AlwaysOn Availability Groups (SQL Server)</span></span>](https://msdn.microsoft.com/library/ms366279.aspx)  
* [<span data-ttu-id="92c9b-313">Reenlist ne peut pas être appelée lorsque SQL Server reçoit le résultat de la transaction à partir de MSDTC dans Windows Server 2012 R2</span><span class="sxs-lookup"><span data-stu-id="92c9b-313">Reenlist can't be called when SQL Server receives transaction outcome from MSDTC in Windows Server 2012 R2</span></span>](https://support.microsoft.com/kb/3090973)  
* [<span data-ttu-id="92c9b-314">Sauvegarde et restauration des bases de données BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="92c9b-314">Backing Up and Restoring BizTalk Server Databases</span></span>](../core/backing-up-and-restoring-biztalk-server-databases.md)  
* [<span data-ttu-id="92c9b-315">Comment déplacer les bases de données BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="92c9b-315">How to Move the BizTalk Server Databases</span></span>](../core/how-to-move-the-biztalk-server-databases.md)  
* [<span data-ttu-id="92c9b-316">Comment faire pour restaurer vos bases de données</span><span class="sxs-lookup"><span data-stu-id="92c9b-316">How to Restore Your Databases</span></span>](../core/how-to-restore-your-databases.md)   
* [<span data-ttu-id="92c9b-317">Délais d’attente de connexion dans le groupe de disponibilité de sous-réseaux multiples</span><span class="sxs-lookup"><span data-stu-id="92c9b-317">Connection Timeouts in Multi-subnet Availability Group</span></span>](https://blogs.msdn.microsoft.com/alwaysonpro/2014/06/03/connection-timeouts-in-multi-subnet-availability-group/)  
 
## <a name="known-limitations"></a><span data-ttu-id="92c9b-318">Limitations connues</span><span class="sxs-lookup"><span data-stu-id="92c9b-318">Known limitations</span></span> 

<span data-ttu-id="92c9b-319">Ces limitations sont destinés, groupe de disponibilité AlwaysOn SQL Server, BizTalk Server et de Machines virtuelles Azure.</span><span class="sxs-lookup"><span data-stu-id="92c9b-319">These limitations are for BizTalk Server, SQL Server AlwaysOn Availability Group, and Azure Virtual Machines.</span></span> <span data-ttu-id="92c9b-320">Ces limitations peuvent ou ne peuvent pas obtenir traitées dans les futures.</span><span class="sxs-lookup"><span data-stu-id="92c9b-320">These limitations may or may not get addressed in future.</span></span> 

* <span data-ttu-id="92c9b-321">Connexions, les travaux de l’Agent SQL, le profil de messagerie de base de données SQL et les comptes ne sont pas gérés au sein de groupes de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="92c9b-321">Logins, SQL Agent Jobs, the SQL DB Mail profile, and accounts are not managed within Availability Groups.</span></span> <span data-ttu-id="92c9b-322">Cela nécessite une modification manuelle de tâches pour vous assurer qu’ils s’exécuter sur le réplica principal.</span><span class="sxs-lookup"><span data-stu-id="92c9b-322">This requires manual modification in Jobs to make sure they run against the primary replica.</span></span> 
* <span data-ttu-id="92c9b-323">SQL Server Analysis Services et SQL Server Integration Services ne participent pas les groupes de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="92c9b-323">SQL Server Analysis Services and SQL Server Integration Services do not participate in Availability Groups.</span></span> <span data-ttu-id="92c9b-324">Sans cette prise en charge de SQL Server, il n’existe aucune solution de haute disponibilité pour ces Machines virtuelles Azure.</span><span class="sxs-lookup"><span data-stu-id="92c9b-324">Without this support from SQL Server, there is no HA solution for these in Azure Virtual Machines.</span></span> <span data-ttu-id="92c9b-325">Fonctionnalités d’analyse BAM de BizTalk Server dépendent de ces services.</span><span class="sxs-lookup"><span data-stu-id="92c9b-325">BizTalk Server’s BAM capabilities are dependent on these services.</span></span> 
* <span data-ttu-id="92c9b-326">Groupes de disponibilité ne prend pas en charge MSDTC entre les bases de données sur la même instance SQL.</span><span class="sxs-lookup"><span data-stu-id="92c9b-326">Availability Groups does not support MSDTC between databases on the same SQL instance.</span></span> <span data-ttu-id="92c9b-327">Par conséquent, une instance SQL 8 minimale requises pour configurer BizTalk.</span><span class="sxs-lookup"><span data-stu-id="92c9b-327">Therefore, a minimum 8 SQL instances are required to configure BizTalk.</span></span> 
* <span data-ttu-id="92c9b-328">Pour résoudre le MSDTC limitations avec groupes de disponibilité, les bases de données BizTalk peuvent être configurées à l’aide d’un minimum de deux serveurs hébergeant chaque quatre instances SQL.</span><span class="sxs-lookup"><span data-stu-id="92c9b-328">To address MSDTC limitations with Availability Groups, BizTalk databases can be configured using a minimum of two servers hosting four SQL instances each.</span></span> <span data-ttu-id="92c9b-329">Toutefois, dans des Machines virtuelles Azure, équilibrage de charge interne ne prend pas en charge plusieurs adresses IP.</span><span class="sxs-lookup"><span data-stu-id="92c9b-329">However, in Azure Virtual Machines, ILB does not support multiple IP addresses.</span></span> <span data-ttu-id="92c9b-330">Cela nous oblige à créer chaque instance de SQL sur un serveur distinct.</span><span class="sxs-lookup"><span data-stu-id="92c9b-330">This forces us to create each instance of SQL on a separate server.</span></span> 
* <span data-ttu-id="92c9b-331">BizTalk Server ne peut pas utiliser le routage en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="92c9b-331">BizTalk Server cannot use Read-Only Routing.</span></span> 
* <span data-ttu-id="92c9b-332">BizTalk Server ne définit pas le `MultiSubnetFailover` propriété de connexion.</span><span class="sxs-lookup"><span data-stu-id="92c9b-332">BizTalk Server does not set the `MultiSubnetFailover` connection property.</span></span> 
* <span data-ttu-id="92c9b-333">Les travaux de sauvegarde de BizTalk à l’aide de l’envoi de journaux sera toujours cibler le réplica principal, quelles que soient les préférences de sauvegarde définie sur le groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="92c9b-333">BizTalk Backup Jobs using Log Shipping will always target the primary replica irrespective of the backup preference set on the Availability Group.</span></span> 
 