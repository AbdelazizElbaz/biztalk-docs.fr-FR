---
title: Les Transactions atomiques | Documents Microsoft
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- atomic transactions
- scopes, examples
- transactions, orchestrations
- orchestrations, transactions
- transactions, isolation levels
- transactions, ACID concept
- transactions, examples
- transactions, atomic
- scopes, transactions
- scopes
ms.assetid: 5030e1fd-943f-42bc-9296-4f315bd5f733
caps.latest.revision: "12"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: bc07f379c1f7aa1c846b2c20c19cbfb3393e8174
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/20/2017
---
# <a name="atomic-transactions"></a><span data-ttu-id="5746f-102">Transactions atomiques</span><span class="sxs-lookup"><span data-stu-id="5746f-102">Atomic Transactions</span></span>
<span data-ttu-id="5746f-103">Vous pouvez concevoir les orchestrations BizTalk de sorte qu'elles exécutent des tâches discrètes, selon le concept 'ACID' classique d'une transaction.</span><span class="sxs-lookup"><span data-stu-id="5746f-103">BizTalk orchestrations can be designed to run discrete pieces of work, following the classic 'ACID' concept of a transaction.</span></span> <span data-ttu-id="5746f-104">Ces unités de travail discrètes ou atomiques, quand elles sont exécutées, permettent de faire passer le processus d'entreprise d'un état cohérent à un autre état, nouveau, cohérent et durable, qui se trouve isolé des autres unités de travail.</span><span class="sxs-lookup"><span data-stu-id="5746f-104">These discrete or atomic units of work, when performed, move the business process from one consistent state to a new, consistent and durable state that is isolated from other units of work.</span></span> <span data-ttu-id="5746f-105">Cela est généralement effectué à l’aide de la **étendue** construction qui encapsule les unités de travail avec la sémantique transactionnelle.</span><span class="sxs-lookup"><span data-stu-id="5746f-105">This is typically done by using the **Scope** construct that encapsulates the units of work with the transactional semantics.</span></span> <span data-ttu-id="5746f-106">Vous pouvez également définir l'orchestration complète en tant que transaction atomique sans utiliser d'étendues.</span><span class="sxs-lookup"><span data-stu-id="5746f-106">The entire orchestration can also be defined as an atomic transaction without the use of scopes.</span></span> <span data-ttu-id="5746f-107">Les étendues ne peuvent toutefois être transactionnelles que si l'orchestration elle-même est de type transaction atomique ou à long terme.</span><span class="sxs-lookup"><span data-stu-id="5746f-107">The scopes, however, cannot be marked as transactional unless the orchestration itself is marked as a long running or atomic transaction type.</span></span> <span data-ttu-id="5746f-108">Les transactions atomiques garantissent que les mises à jour partielles sont automatiquement annulées en cas d'échec lors de la mise à jour transactionnelle et que les effets de la transaction sont effacés (à l'exception des effets des appels .NET effectués dans la transaction).</span><span class="sxs-lookup"><span data-stu-id="5746f-108">Atomic transactions guarantee that any partial updates are rolled back automatically in the event of a failure during the transactional update, and that the effects of the transaction are erased (except for the effects of any .NET calls that are made in the transaction).</span></span> <span data-ttu-id="5746f-109">Les transactions atomiques des orchestrations BizTalk sont similaires aux transactions DTC (distributed transaction coordinator) dans le sens où elles sont généralement de courte durée et où elles possèdent les quatre attributs « ACID » (atomicité, cohérence, isolation et durabilité) :</span><span class="sxs-lookup"><span data-stu-id="5746f-109">Atomic transactions in BizTalk orchestrations are similar to distributed transaction coordinator (DTC) transactions in that they are generally short-lived and have the four "ACID" attributes (atomicity, consistency, isolation, and durability):</span></span>  
  
-   <span data-ttu-id="5746f-110">**Atomicité**</span><span class="sxs-lookup"><span data-stu-id="5746f-110">**Atomicity**</span></span>  
  
     <span data-ttu-id="5746f-111">Une transaction représente une unité de travail atomique.</span><span class="sxs-lookup"><span data-stu-id="5746f-111">A transaction represents an atomic unit of work.</span></span> <span data-ttu-id="5746f-112">Toutes les modifications d'une transaction sont appliquées, ou aucune d'entre elles.</span><span class="sxs-lookup"><span data-stu-id="5746f-112">Either all modifications within a transaction are performed, or none of the modifications are performed.</span></span>  
  
-   <span data-ttu-id="5746f-113">**Cohérence**</span><span class="sxs-lookup"><span data-stu-id="5746f-113">**Consistency**</span></span>  
  
     <span data-ttu-id="5746f-114">La validation d'une transaction ne doit pas altérer l'intégrité des données d'un système.</span><span class="sxs-lookup"><span data-stu-id="5746f-114">When committed, a transaction must preserve the integrity of the data within the system.</span></span> <span data-ttu-id="5746f-115">Si des modifications sont apportées par une transaction dans une base de données jugée cohérente en interne avant le début de la transaction, il faut que la base de données conserve sa cohérence une fois la transaction validée.</span><span class="sxs-lookup"><span data-stu-id="5746f-115">If a transaction performs a data modification on a database that was internally consistent before the transaction started, the database must still be internally consistent when the transaction is committed.</span></span> <span data-ttu-id="5746f-116">C'est essentiellement au développeur d'applications qu'il revient de garantir cette propriété.</span><span class="sxs-lookup"><span data-stu-id="5746f-116">Ensuring this property is largely the responsibility of the application developer.</span></span>  
  
-   <span data-ttu-id="5746f-117">**Isolement**</span><span class="sxs-lookup"><span data-stu-id="5746f-117">**Isolation**</span></span>  
  
     <span data-ttu-id="5746f-118">Les modifications apportées par des transactions simultanées doivent être isolées des modifications effectuées par d'autres transaction simultanées.</span><span class="sxs-lookup"><span data-stu-id="5746f-118">Modifications made by concurrent transactions must be isolated from the modifications made by other concurrent transactions.</span></span> <span data-ttu-id="5746f-119">Les transactions isolées s'exécutant simultanément procèdent à des modifications qui préservent la cohérence interne de la base de données de la même façon que si elles étaient exécutées en série.</span><span class="sxs-lookup"><span data-stu-id="5746f-119">Isolated transactions that run concurrently perform modifications that preserve internal database consistency exactly as they would if the transactions were run serially.</span></span>  
  
-   <span data-ttu-id="5746f-120">**Durabilité**</span><span class="sxs-lookup"><span data-stu-id="5746f-120">**Durability**</span></span>  
  
     <span data-ttu-id="5746f-121">Après la validation d'une transaction, toutes les modifications demeurent définitivement en place par défaut dans le système.</span><span class="sxs-lookup"><span data-stu-id="5746f-121">After a transaction is committed, all modifications are permanently in place in the system by default.</span></span> <span data-ttu-id="5746f-122">Les modifications sont conservées même en cas de défaillance du système.</span><span class="sxs-lookup"><span data-stu-id="5746f-122">The modifications persist even if a system failure occurs.</span></span>  
  
 <span data-ttu-id="5746f-123">Les niveaux d'isolation suivants sont pris en charge par les transactions atomiques utilisées dans les orchestrations BizTalk :</span><span class="sxs-lookup"><span data-stu-id="5746f-123">The following isolation levels are supported by the atomic transactions used in BizTalk Orchestrations:</span></span>  
  
-   <span data-ttu-id="5746f-124">**Lecture validée**</span><span class="sxs-lookup"><span data-stu-id="5746f-124">**Read Committed**</span></span>  
  
     <span data-ttu-id="5746f-125">Les verrous partagés sont conservés pendant la lecture des données afin d'éviter tout défaut de lecture, mais les données peuvent être modifiées avant la fin de la transaction, entraînant ainsi des données fantômes ou des lectures qui ne peuvent pas être répétées.</span><span class="sxs-lookup"><span data-stu-id="5746f-125">Shared locks are held while the data is being read to avoid dirty reads, but the data can be changed before the end of the transaction, resulting in non-repeatable reads or phantom data.</span></span>  
  
-   <span data-ttu-id="5746f-126">**Lecture renouvelable**</span><span class="sxs-lookup"><span data-stu-id="5746f-126">**Repeatable Read**</span></span>  
  
     <span data-ttu-id="5746f-127">Des verrous sont placés sur toutes les données utilisées dans une requête afin d'empêcher d'autres utilisateurs de mettre à jour les données.</span><span class="sxs-lookup"><span data-stu-id="5746f-127">Locks are placed on all data that is used in a query, preventing other users from updating the data.</span></span> <span data-ttu-id="5746f-128">Cette opération permet d'empêcher les lectures non renouvelées, mais les lignes fantômes sont toujours possibles.</span><span class="sxs-lookup"><span data-stu-id="5746f-128">This prevents non-repeatable reads, but phantom rows are still possible.</span></span>  
  
-   <span data-ttu-id="5746f-129">**Sérialisable**</span><span class="sxs-lookup"><span data-stu-id="5746f-129">**Serializable**</span></span>  
  
     <span data-ttu-id="5746f-130">Un verrou de plage est placé afin d'empêcher les autres utilisateurs de mettre à jour ou d'insérer des lignes dans la base de données avant la fin de la transaction.</span><span class="sxs-lookup"><span data-stu-id="5746f-130">A range lock is placed preventing other users from updating or inserting rows into the database until the transaction is complete.</span></span>  
  
 <span data-ttu-id="5746f-131">BizTalk Server veille à ce que les modifications d'état apportées au sein d'une transaction atomique, telles que les modifications de variables, de messages et d'objets, ne soient visibles hors de l'étendue de la transaction atomique qu'après la validation de la transaction.</span><span class="sxs-lookup"><span data-stu-id="5746f-131">BizTalk Server ensures that state changes within an atomic transaction—such as modifications to variables, messages, and objects—are visible outside the scope of the atomic transaction only upon commitment of the transaction.</span></span> <span data-ttu-id="5746f-132">Les modifications d'état intermédiaires sont isolées des autres parties d'une orchestration.</span><span class="sxs-lookup"><span data-stu-id="5746f-132">The intermediate state changes are isolated from other parts of an orchestration.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="5746f-133">Si une transaction atomique contient une **réception** mettre en forme un **envoyer** forme, ou un **démarrer Orchestration** forme, les actions correspondantes n’auront lieu jusqu'à ce que le transaction a été validée.</span><span class="sxs-lookup"><span data-stu-id="5746f-133">If an atomic transaction contains a **Receive** shape, a **Send** shape, or a **Start Orchestration** shape, the corresponding actions will not take place until the transaction has committed.</span></span>  
  
 <span data-ttu-id="5746f-134">Si des propriétés ACID complètes sont exigées pour les données, par exemple, si les données doivent être isolées des autres transactions, vous devez uniquement faire appel aux transactions atomiques.</span><span class="sxs-lookup"><span data-stu-id="5746f-134">If you require full ACID properties on the data—for example, when the data must be isolated from other transactions—you must use atomic transactions exclusively.</span></span>  
  
 <span data-ttu-id="5746f-135">Lors de l'échec d'une transaction atomique, tous les états sont réinitialisés comme si l'instance d'orchestration n'avait jamais été dans l'étendue.</span><span class="sxs-lookup"><span data-stu-id="5746f-135">When an atomic transaction fails, all states are reset as if the orchestration instance never entered the scope.</span></span> <span data-ttu-id="5746f-136">La règle BizTalk sur les transactions atomiques veut que toutes les variables (et pas seulement les variables locales à l'étendue) participent à la transaction.</span><span class="sxs-lookup"><span data-stu-id="5746f-136">The rule BizTalk has for atomic transactions is that all variables (not just local to the scope) participate in the transaction.</span></span> <span data-ttu-id="5746f-137">Toutes les variables non sérialisables et les messages utilisés dans une transaction atomique doivent être déclarés locaux à l'étendue, faute de quoi, le compilateur génère une erreur de type « la variable….n'est pas marquée comme sérialisable ».</span><span class="sxs-lookup"><span data-stu-id="5746f-137">All non-serializable variables and messages used in an atomic transaction should be declared local to the scope; otherwise, the compiler will give the "variable….is not marked as serializable" error.</span></span> <span data-ttu-id="5746f-138">Toutes les étendues atomiques sont supposées être « synchronisées » et le compilateur d'orchestration génère un avertissement en cas d'utilisation redondante si le mot clé synchronisé est vraiment employé pour les étendues atomiques.</span><span class="sxs-lookup"><span data-stu-id="5746f-138">All atomic scopes are assumed to be "synchronized" and the orchestration compiler will provide a warning for redundant usage, if indeed the synchronized keyword is used for atomic scopes.</span></span> <span data-ttu-id="5746f-139">Le domaine de synchronisation des données partagées s'étend du début de l'étendue jusqu'à l'achèvement complet de cette dernière (persistance de l'état, à la fin de l'étendue, incluse) ou jusqu'à la fin du gestionnaire d'exceptions (en cas d'erreurs).</span><span class="sxs-lookup"><span data-stu-id="5746f-139">The synchronization for the shared data extends from the beginning of the scope until the successful completion of the scope (including the state persistence at the end of the scope) or to the completion of the exception handler (in case of errors).</span></span> <span data-ttu-id="5746f-140">Il ne s'étend pas jusqu'au gestionnaire de compensation.</span><span class="sxs-lookup"><span data-stu-id="5746f-140">The synchronization domain does not extend to the compensation handler.</span></span>  
  
 <span data-ttu-id="5746f-141">Il est possible d'associer les transactions atomiques à des délais d'expiration, de sorte que l'orchestration arrête la transaction et suspend l'instance.</span><span class="sxs-lookup"><span data-stu-id="5746f-141">Atomic transactions can be associated with timeout values at which point the orchestration will stop the transaction and the instance will be suspended.</span></span> <span data-ttu-id="5746f-142">Si une transaction atomique contient une forme Réception, Envoi ou Démarrer orchestration, les actions correspondantes n'auront lieu qu'après la validation de la transaction.</span><span class="sxs-lookup"><span data-stu-id="5746f-142">If an atomic transaction contains a Receive shape, a Send shape, or a Start Orchestration shape, the corresponding actions will not take place until the transaction has committed.</span></span>  
  
 <span data-ttu-id="5746f-143">Une transaction atomique effectue une nouvelle tentative lorsque l’utilisateur lève délibérément une **RetryTransactionException** ou si un **PersistenceException** est déclenché au moment de la transaction atomique tente de valider.</span><span class="sxs-lookup"><span data-stu-id="5746f-143">An atomic transaction retries when the user deliberately throws a **RetryTransactionException** or if a **PersistenceException** is raised at the time that the atomic transaction tries to commit.</span></span> <span data-ttu-id="5746f-144">Ce dernier cas peut se produire lorsque la transaction atomique fait partie d'une transaction DTC distribuée et qu'un des autres participants met fin à la transaction, par exemple.</span><span class="sxs-lookup"><span data-stu-id="5746f-144">The latter could happen if for instance, the atomic transaction was part of a distributed DTC transaction and some other participant in that transaction stopped the transaction.</span></span> <span data-ttu-id="5746f-145">De même, s’il existe des problèmes de connectivité de base de données en temps lorsque la transaction a été la tentative de validation, il serait également un **PersistenceException** déclenché.</span><span class="sxs-lookup"><span data-stu-id="5746f-145">Likewise, if there were database connectivity problems at the time when the transaction was trying to commit, there would also be a **PersistenceException** raised.</span></span> <span data-ttu-id="5746f-146">Si cela se produit pour une étendue atomique a **réessayer = True**, puis il réessaiera jusqu'à 21 tentatives suivantes.</span><span class="sxs-lookup"><span data-stu-id="5746f-146">If this happens for an atomic scope that has **Retry=True**, then it will retry up to 21 times.</span></span> <span data-ttu-id="5746f-147">L'intervalle entre chaque nouvelle tentative est, par défaut, de deux secondes, mais vous pouvez changer cette valeur.</span><span class="sxs-lookup"><span data-stu-id="5746f-147">The delay between each retry is two seconds by default (but that is modifiable).</span></span> <span data-ttu-id="5746f-148">Après que 21 tentatives sont atteint, si la transaction est toujours Impossible de valider, l’instance de l’ensemble de l’orchestration est suspendue.</span><span class="sxs-lookup"><span data-stu-id="5746f-148">After 21 retries are exhausted, if the transaction is still unable to commit, the whole orchestration instance is suspended.</span></span> <span data-ttu-id="5746f-149">Vous pouvez la reprendre manuellement, auquel cas le cycle complet redémarre avec un compteur réinitialisé au début de l'étendue atomique problématique.</span><span class="sxs-lookup"><span data-stu-id="5746f-149">It can be manually resumed and it will start over again, with a fresh counter, from the beginning of the offending atomic scope.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="5746f-150">Uniquement les **RetryTransactionException** et **PersistenceException** peut entraîner une étendue atomique réessayer.</span><span class="sxs-lookup"><span data-stu-id="5746f-150">Only the **RetryTransactionException** and **PersistenceException** can cause an atomic scope to retry.</span></span> <span data-ttu-id="5746f-151">Toute autre exception levée dans une étendue atomique ne peut pas entraîner de nouvelles tentatives, même si le **réessayer** est définie sur **True**.</span><span class="sxs-lookup"><span data-stu-id="5746f-151">Any other exception raised in an atomic scope cannot cause it to retry, even if the **Retry** property is set to **True**.</span></span> <span data-ttu-id="5746f-152">Le délai par défaut de deux secondes entre chaque tentative consécutive peut être substitué à l’aide d’une propriété publique sur **RetryTransactionException** (si c’est l’exception qui est utilisée à l’origine des nouvelles tentatives).</span><span class="sxs-lookup"><span data-stu-id="5746f-152">The two-second default delay between each two consecutive retries can be overridden by using a public property on **RetryTransactionException** (if that is the exception that is being used to cause the retries).</span></span>  
  
 <span data-ttu-id="5746f-153">Les étendues atomiques des restrictions autres transactions qui ne peut pas imbriquer d’autres transactions ou inclure **Catch - Exception** blocs.</span><span class="sxs-lookup"><span data-stu-id="5746f-153">The atomic scopes have restrictions on nesting other transactions that cannot nest other transactions or include **Catch - Exception** blocks.</span></span>  
  
## <a name="dtc-transactions"></a><span data-ttu-id="5746f-154">Transactions DTC</span><span class="sxs-lookup"><span data-stu-id="5746f-154">DTC transactions</span></span>  
 <span data-ttu-id="5746f-155">Les transactions atomiques ont beau se comporter comme des transactions DTC, elles n'en sont pas par défaut.</span><span class="sxs-lookup"><span data-stu-id="5746f-155">While atomic transactions behave like DTC transactions, they are not explicitly DTC transactions by default.</span></span> <span data-ttu-id="5746f-156">Vous pouvez les rendre DTC de manière explicite, à condition que les objets utilisés dans les transactions soient des objets COM+ dérivés de System.EnterpriseServices.ServicedComponents, et que les niveaux d'isolation des composants de transaction soient compatibles.</span><span class="sxs-lookup"><span data-stu-id="5746f-156">You can explicitly make them DTC transactions, provided that any objects being used in the transaction are COM+ objects derived from System.EnterpriseServices.ServicedComponents, and that isolation levels agree between transaction components.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="5746f-157">Une transaction atomique ne peut pas contenir d'autres transactions en son sein, de même qu'elle ne peut contenir de gestionnaires d'exception.</span><span class="sxs-lookup"><span data-stu-id="5746f-157">An atomic transaction cannot contain any other transactions within it, nor can it contain exception handlers.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="5746f-158">Une transaction atomique ne peut pas contenir d'actions d'envoi et de réception correspondantes, à savoir une paire requête-réponse ou des actions d'envoi et de réception se servant du même ensemble de corrélations.</span><span class="sxs-lookup"><span data-stu-id="5746f-158">An atomic transaction cannot contain matching send and receive actions—that is, a request-response pair or a send and receive that use the same correlation set.</span></span>  
  
## <a name="non-serializable-objects"></a><span data-ttu-id="5746f-159">Objets non sérialisables</span><span class="sxs-lookup"><span data-stu-id="5746f-159">Non-serializable objects</span></span>  
 <span data-ttu-id="5746f-160">Pour utiliser un objet non sérialisable dans une orchestration, il vous faut le faire au sein d'une transaction atomique.</span><span class="sxs-lookup"><span data-stu-id="5746f-160">If you want to use a non-serializable object within an orchestration, you must use it only within an atomic transaction.</span></span> <span data-ttu-id="5746f-161">Toute utilisation d'objet non sérialisable hors d'une transaction atomique risque d'entraîner la perte de données chaque fois que l'orchestration est conservée par le moteur.</span><span class="sxs-lookup"><span data-stu-id="5746f-161">Any use of such an object outside of an atomic transaction risks data loss whenever the orchestration is persisted by the engine.</span></span>  
  
> [!CAUTION]
>  <span data-ttu-id="5746f-162">Chaque étendue atomique représente un point de persistance. En d'autres termes, l'état de l'orchestration est enregistré dans la base de données au niveau de chaque point de persistance.</span><span class="sxs-lookup"><span data-stu-id="5746f-162">Each Atomic scope represents a persistence point and what that means is the state of the orchestration is saved to the database at each persistence point.</span></span> <span data-ttu-id="5746f-163">Une utilisation fréquente de l'étendue atomique augmente la latence dans l'orchestration.</span><span class="sxs-lookup"><span data-stu-id="5746f-163">Extensive use of Atomic scope will increase the latency in the orchestration.</span></span> <span data-ttu-id="5746f-164">Au lieu d'avoir recours à l'étendue atomique pour la création d'objets non sérialisables, utilisez la méthode Static qui ne requiert aucune étendue atomique, supprimant ainsi la nécessité des points de persistance.</span><span class="sxs-lookup"><span data-stu-id="5746f-164">Instead of using Atomic scope for the purpose of creating non-serializable objects, you can use Static method calls which they don not require Atomic scopes, thus eliminating the need for the persistence points.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5746f-165">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="5746f-165">See Also</span></span>  
 <span data-ttu-id="5746f-166">[Scénarios à l’aide de Transactions atomiques](../core/scenarios-using-atomic-transactions.md) </span><span class="sxs-lookup"><span data-stu-id="5746f-166">[Scenarios Using Atomic Transactions](../core/scenarios-using-atomic-transactions.md) </span></span>  
 [<span data-ttu-id="5746f-167">Transactions à long terme</span><span class="sxs-lookup"><span data-stu-id="5746f-167">Long-Running Transactions</span></span>](../core/long-running-transactions.md)