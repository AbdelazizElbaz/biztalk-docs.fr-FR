---
title: Conseils pour la conception de votre adaptateur | Documents Microsoft
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 0bb60988-4e48-4654-9cf4-512dd7c97239
caps.latest.revision: "9"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 93c59efc2ae811827cd0cb1cf4763485b675f4ea
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/20/2017
---
# <a name="tips-for-designing-your-adapter"></a><span data-ttu-id="a3f53-102">Conseils pour la conception de votre adaptateur</span><span class="sxs-lookup"><span data-stu-id="a3f53-102">Tips for Designing Your Adapter</span></span>
<span data-ttu-id="a3f53-103">Cette section présente des astuces et des conseils compilés par les développeurs des adaptateurs durant leur conception.</span><span class="sxs-lookup"><span data-stu-id="a3f53-103">This section contains hints and tips that adapter developers have learned while designing adapters.</span></span>  
  
## <a name="handler-properties-should-be-strings-if-used-as-default-configurations"></a><span data-ttu-id="a3f53-104">Les propriétés du gestionnaire doivent être des chaînes si elles sont utilisées comme configurations par défaut</span><span class="sxs-lookup"><span data-stu-id="a3f53-104">Handler Properties Should Be Strings if Used as Default Configurations</span></span>  
 <span data-ttu-id="a3f53-105">Il peut sembler intéressant d’utiliser les propriétés sur la feuille de propriétés du gestionnaire générée XSD comme valeurs par défaut pour leurs **emplacement** propriétés, car si la valeur n’est pas définie **emplacement** le runtime automatiquement utilise la valeur définie dans le gestionnaire.</span><span class="sxs-lookup"><span data-stu-id="a3f53-105">It seems attractive to use the properties on the XSD-generated handler property sheet as defaults for their **Location** properties because if the value is not set in **Location** the runtime automatically uses the value set in the handler.</span></span> <span data-ttu-id="a3f53-106">Mais cela entraîne plusieurs problèmes.</span><span class="sxs-lookup"><span data-stu-id="a3f53-106">But there are several issues that make this less useful.</span></span>  
  
 <span data-ttu-id="a3f53-107">D'abord, cela ne permet pas de savoir si la valeur présentée au moteur d'exécution doit être remplacée ou pas.</span><span class="sxs-lookup"><span data-stu-id="a3f53-107">The problem comes with not knowing whether the value presented to the runtime is to be overridden or not.</span></span> <span data-ttu-id="a3f53-108">Pour le savoir, il faut définir une certaine notion NULL pour les valeurs et effectuer un test par rapport à cette valeur.</span><span class="sxs-lookup"><span data-stu-id="a3f53-108">The typical way of doing this is to have some notion of NULL defined for values and then run a test against that value.</span></span> <span data-ttu-id="a3f53-109">Le problème avec les feuilles de propriétés XSD de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] est que seules les chaînes acceptent la valeur NULL.</span><span class="sxs-lookup"><span data-stu-id="a3f53-109">The problem when using the XSD-based property sheets in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] is that NULL is only supported for strings.</span></span> <span data-ttu-id="a3f53-110">Même si vous voulez que votre adaptateur utilise des paramètres par défaut par l'intermédiaire de ce test NULL et si vous êtes prêt à restreindre l'adaptateur aux types de chaînes, celui-ci reste exposé à une interface utilisateur assez curieuse.</span><span class="sxs-lookup"><span data-stu-id="a3f53-110">Even if you want your adapter to have default settings through the use of this NULL test and are willing to restrict the adapter to string types, it is still exposed to a very odd piece of user interface.</span></span>  
  
 <span data-ttu-id="a3f53-111">Les feuilles de propriétés XSD prennent uniquement en charge le paramètre d’une propriété sur NULL en double-cliquant sur la propriété, alors un **Annuler ?** menu contextuel s’affiche et la propriété peut être définie avec la valeur NULL.</span><span class="sxs-lookup"><span data-stu-id="a3f53-111">The XSD-generated property sheets only support the setting of a property back to NULL by right-clicking the property, at which point a **nullify?** context menu appears and the property can be set to NULL.</span></span> <span data-ttu-id="a3f53-112">Aucun retour visuel ne vous permet de savoir si une propriété est NULL.</span><span class="sxs-lookup"><span data-stu-id="a3f53-112">There is no visual feedback as to whether a property is NULL.</span></span>  
  
## <a name="considerations-for-implementing-schema-generation-wizards"></a><span data-ttu-id="a3f53-113">Éléments à prendre en compte lors de l'implémentation de l'Assistant Génération de schémas</span><span class="sxs-lookup"><span data-stu-id="a3f53-113">Considerations for Implementing Schema Generation Wizards</span></span>  
 <span data-ttu-id="a3f53-114">Les programmeurs aiment utiliser dans leurs codes des modèles d'objets fortement typés.</span><span class="sxs-lookup"><span data-stu-id="a3f53-114">Programmers like to code against strongly typed object models.</span></span> <span data-ttu-id="a3f53-115">La manipulation du XML dans le code peut sembler maladroit et risqué au premier abord.</span><span class="sxs-lookup"><span data-stu-id="a3f53-115">Manipulating XML in code can at first seem awkward and prone to error.</span></span> <span data-ttu-id="a3f53-116">Mais quelques astuces et une utilisation réfléchie de l'aide offerte par .NET Framework peuvent grandement simplifier les choses.</span><span class="sxs-lookup"><span data-stu-id="a3f53-116">But some tricks and smart use of the support offered by the .NET Framework can dramatically simplify matters.</span></span>  
  
#### <a name="do-not-create-xml-documents-with-string-concatenation"></a><span data-ttu-id="a3f53-117">Ne créez pas des documents XML avec concaténation de chaînes</span><span class="sxs-lookup"><span data-stu-id="a3f53-117">Do not create XML documents with string concatenation</span></span>  
 <span data-ttu-id="a3f53-118">L'une des pires erreurs relatives à l'utilisation du XML est d'essayer de le générer à partir de la concaténation des chaînes et d'imprimer des instructions dans la mémoire.</span><span class="sxs-lookup"><span data-stu-id="a3f53-118">One of the worst mistakes to make with XML is to try and generate it from string concatenation and print statements in memory.</span></span> <span data-ttu-id="a3f53-119">Cela consomme énormément de temps processeur et de mémoire.</span><span class="sxs-lookup"><span data-stu-id="a3f53-119">This consumes large amounts of CPU time and memory.</span></span> <span data-ttu-id="a3f53-120">Même pour un extrait XML insignifiant, il est plus simple d'utiliser un outil comme XmlWriter ou un objet Document Object Model (DOM).</span><span class="sxs-lookup"><span data-stu-id="a3f53-120">Even for the most trivial XML snippet, it is easier to use a tool like XmlWriter or the Document Object Model (DOM).</span></span> <span data-ttu-id="a3f53-121">Si vous utilisez XmlWriter, ne choisissez pas la fonction d'écriture brute, car l'enregistreur ne conserve pas l'état du document.</span><span class="sxs-lookup"><span data-stu-id="a3f53-121">If you are using XmlWriter, do not use the raw write capability, because the writer loses the state of the document.</span></span>  
  
 <span data-ttu-id="a3f53-122">Au moment de l'exécution, XmlWriter est préférable au XML DOM car des problèmes de forte consommation de la mémoire sont connus avec le DOM.</span><span class="sxs-lookup"><span data-stu-id="a3f53-122">At run time, XmlWriter is preferred over the XML DOM because of high memory consumption issues associated with the DOM.</span></span> <span data-ttu-id="a3f53-123">Cependant, au stade de la configuration ou de la conception, ces problèmes ne se posent pas.</span><span class="sxs-lookup"><span data-stu-id="a3f53-123">However, at configuration or design time this will most likely not be an issue.</span></span> <span data-ttu-id="a3f53-124">Le DOM facilite l'utilisation des requêtes XPATH, ce qui peut représenter un outil supplémentaire utile.</span><span class="sxs-lookup"><span data-stu-id="a3f53-124">Using the DOM facilitates the use of XPATH queries, which can be a useful additional tool.</span></span>  
  
#### <a name="consider-defining-the-skeleton-of-your-xml-document-as-a-resource"></a><span data-ttu-id="a3f53-125">Pensez à définir le squelette de votre document XML en tant que ressource</span><span class="sxs-lookup"><span data-stu-id="a3f53-125">Consider defining the skeleton of your XML document as a resource</span></span>  
 <span data-ttu-id="a3f53-126">Si vous générez un gros document XML à partir d'un outil de conception et que ce document généré suit toujours la même structure de base, pensez à faire du squelette du fichier XML une ressource du projet, pour pouvoir le modifier plus facilement si besoin. </span><span class="sxs-lookup"><span data-stu-id="a3f53-126">If you are generating a large XML document from a design tool and that generated document always follows the same basic structure, consider placing the whole skeletal XML file as a resource in the project to allow making changes when you need to edit it.</span></span>  
  
 <span data-ttu-id="a3f53-127">Chargez le code dans un DOM puis étoffez votre document en utilisant XPATH pour choisir le nœud à ajouter.</span><span class="sxs-lookup"><span data-stu-id="a3f53-127">Load the code into a DOM and then add the necessary flesh to the bones of the document by using XPATH to pick out the node you want to add it to.</span></span> <span data-ttu-id="a3f53-128">Dans ce cas, vous créez un fichier Web Services Description Language (WSDL).</span><span class="sxs-lookup"><span data-stu-id="a3f53-128">In this case, you are creating a Web Services Description Language (WSDL) file.</span></span> <span data-ttu-id="a3f53-129">L'Assistant stocke le fichier WSDL squelette dans une ressource et ajoute les pièces enfants XSD (XML Schema Definition).</span><span class="sxs-lookup"><span data-stu-id="a3f53-129">The wizard stores the skeletal WSDL file in a resource and adds the generated XML Schema Definition (XSD) child parts.</span></span> <span data-ttu-id="a3f53-130">Il utilise selectNode avec un XPath pour trouver le bon parent.</span><span class="sxs-lookup"><span data-stu-id="a3f53-130">It uses selectNode with an xpath to find the right parent.</span></span> <span data-ttu-id="a3f53-131">Il s'agit du code de l'interface utilisateur : la performance n'est donc pas en question et l'implémentation qui en résulte est propre, robuste et durable.</span><span class="sxs-lookup"><span data-stu-id="a3f53-131">This is user interface code, so performance is not an issue, and the resulting implementation is clean, robust, and maintainable.</span></span>  
  
## <a name="consider-placing-processing-steps-in-the-biztalk-pipeline"></a><span data-ttu-id="a3f53-132">Pensez à placer le processus de traitement dans le pipeline BizTalk</span><span class="sxs-lookup"><span data-stu-id="a3f53-132">Consider Placing Processing Steps in the BizTalk Pipeline</span></span>  
 <span data-ttu-id="a3f53-133">En général, les adaptateurs construits chez Microsoft ne gèrent pas le traitement des messages en fonction du format et l'envoient dans le pipeline BizTalk.</span><span class="sxs-lookup"><span data-stu-id="a3f53-133">In general the adapters built at Microsoft move message format-based processing out of the adapter and into the BizTalk pipeline.</span></span> <span data-ttu-id="a3f53-134">Les adaptateurs pour les sources de données structurées mais non-XML en sont un bon exemple.</span><span class="sxs-lookup"><span data-stu-id="a3f53-134">A good example is an adapter to a structured but non-XML data source.</span></span>  
  
 <span data-ttu-id="a3f53-135">Dans ce cas, l'adaptateur ne fait que recevoir les données et le pipeline BizTalk les analyse et les convertit en équivalent XML.</span><span class="sxs-lookup"><span data-stu-id="a3f53-135">In this case, the adapter only gets the data and the BizTalk pipeline is used to parse it and convert it into an XML equivalent.</span></span> <span data-ttu-id="a3f53-136">Le composant pipeline devient ainsi une pièce réutilisable de l'architecture.</span><span class="sxs-lookup"><span data-stu-id="a3f53-136">The benefit is that the pipeline component itself becomes a reusable piece of the architecture.</span></span>  
  
## <a name="make-adapter-behavior-configurable"></a><span data-ttu-id="a3f53-137">Faites en sorte que le comportement de l'adaptateur soit configurable</span><span class="sxs-lookup"><span data-stu-id="a3f53-137">Make Adapter Behavior Configurable</span></span>  
 <span data-ttu-id="a3f53-138">Parmi les leçons tirées du programme bêta d'adaptateurs MQSeries, retenez que tous les clients ne se satisfont pas du même comportement.</span><span class="sxs-lookup"><span data-stu-id="a3f53-138">One of the lessons learned from the MQSeries adapter beta program was that not all customers were happy with the same behavior.</span></span> <span data-ttu-id="a3f53-139">Cela est particulièrement vrai pour la gestion des erreurs et le classement.</span><span class="sxs-lookup"><span data-stu-id="a3f53-139">This was especially true when it came to handling errors and ordering.</span></span> <span data-ttu-id="a3f53-140">La solution est de faire en sorte que le comportement de l'adaptateur soit configurable.</span><span class="sxs-lookup"><span data-stu-id="a3f53-140">The solution was to make the behavior configurable.</span></span> <span data-ttu-id="a3f53-141">Vous pouvez stipuler que l'adaptateur prenne en charge le classement, que les échecs soient déplacés dans la file d'attente des messages interrompus ou qu'ils forcent l'adaptateur à interrompre le traitement et à se désactiver.</span><span class="sxs-lookup"><span data-stu-id="a3f53-141">You can specify whether the adapter is to support ordering, whether failures are moved to the Suspended queue, or whether they cause the adapter to stop processing and disable itself.</span></span> <span data-ttu-id="a3f53-142">Rendre de tels comportements configurables peut simplifier de manière significative la vie de vos clients, lorsqu'ils ont besoin d'écrire des orchestrations ou des scripts complexes externes à [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] afin d'arriver au même résultat.</span><span class="sxs-lookup"><span data-stu-id="a3f53-142">Making such behaviors configurable can significantly simplify customers' lives when they would need to write complex orchestrations or scripts external to [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] to achieve the same result.</span></span>  
  
## <a name="support-correlation-with-message-queues"></a><span data-ttu-id="a3f53-143">Permettez la corrélation avec les files d'attente de messages</span><span class="sxs-lookup"><span data-stu-id="a3f53-143">Support Correlation with Message Queues</span></span>  
 <span data-ttu-id="a3f53-144">De nombreuses plateformes de messagerie acceptent l'adjonction d'un ID de corrélation dans l'en-tête des messages afin de pouvoir prendre en charge un scénario requête-réponse au niveau de l'application.</span><span class="sxs-lookup"><span data-stu-id="a3f53-144">Many messaging platforms support the notion of a correlation ID in the message header to support an application-level request-response scenario.</span></span> <span data-ttu-id="a3f53-145">Exemples : MQSeries, MSMQ et SQL Service Broker.</span><span class="sxs-lookup"><span data-stu-id="a3f53-145">Examples include MQSeries, MSMQ, and SQL Service Broker.</span></span> <span data-ttu-id="a3f53-146">Il peut sembler intéressant de mapper le modèle requête-réponse du système de messagerie externe sur un adaptateur envoi-réponse dans [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="a3f53-146">It would seem attractive to map the request-response pattern of the external messaging system to a send-response adapter in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="a3f53-147">Cependant, cela n'a pas de sens, vu l'endroit où s'effectuent les transactions.</span><span class="sxs-lookup"><span data-stu-id="a3f53-147">However this does not make sense because of where the transactions live.</span></span> <span data-ttu-id="a3f53-148">En fait, un envoi vers le système de messagerie externe nécessite une validation transactionnelle avant que l'autre extrémité de la file d'attente ne voit les données.</span><span class="sxs-lookup"><span data-stu-id="a3f53-148">Specifically, a send to the external messaging system requires a transactional commit before the other end of the queue sees the data.</span></span> <span data-ttu-id="a3f53-149">La réception doit également être une transaction distincte.</span><span class="sxs-lookup"><span data-stu-id="a3f53-149">The receive must also be a separate transaction.</span></span>  
  
 <span data-ttu-id="a3f53-150">La solution dans [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] est la suivante :</span><span class="sxs-lookup"><span data-stu-id="a3f53-150">The solution in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] is to:</span></span>  
  
-   <span data-ttu-id="a3f53-151">utiliser des ensembles de corrélations dans l'orchestration ;</span><span class="sxs-lookup"><span data-stu-id="a3f53-151">Use correlation sets in orchestration</span></span>  
  
-   <span data-ttu-id="a3f53-152">Configurer deux ports distincts : un pour l’envoi et un pour la réception</span><span class="sxs-lookup"><span data-stu-id="a3f53-152">Configure two separate ports: one for the send and one for the receive</span></span>  
  
 <span data-ttu-id="a3f53-153">Dans les cas simples, l'orchestration spécifie l'ID de corrélation associé au message par l'adaptateur.</span><span class="sxs-lookup"><span data-stu-id="a3f53-153">In a simple case the orchestration specifies the correlation ID that is associated with the message by the adapter.</span></span> <span data-ttu-id="a3f53-154">Il est transmis à l'adaptateur en tant que propriété de contexte du message.</span><span class="sxs-lookup"><span data-stu-id="a3f53-154">This is passed to the adapter as a context property on the message.</span></span> <span data-ttu-id="a3f53-155">Dans les cas plus complexes, le scénario demande au système de messagerie externe allouer le code.</span><span class="sxs-lookup"><span data-stu-id="a3f53-155">In a more complex case, the scenario calls for the external messaging system to allocate the ID.</span></span> <span data-ttu-id="a3f53-156">Dans ce cas elle peut être passée à partir du port d’envoi à l’orchestration avec un message de réponse.</span><span class="sxs-lookup"><span data-stu-id="a3f53-156">In this case it can be passed back from the send port to the orchestration with a response message.</span></span> <span data-ttu-id="a3f53-157">Ce message de réponse sert uniquement à transmettre l'ID et ne représente pas le vrai message de réponse.</span><span class="sxs-lookup"><span data-stu-id="a3f53-157">This response message is just to pass back the ID and is not the true message response.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a3f53-158">Il existe une condition d'engorgement dans le moteur d'orchestration, de sorte que la vraie réponse au message peut l'emporter sur la réponse d'ID depuis l'envoi.</span><span class="sxs-lookup"><span data-stu-id="a3f53-158">There is a race condition in the orchestration engine such that the true response to the message could win against the ID response from the send.</span></span> <span data-ttu-id="a3f53-159">Cette condition d'engorgement doit être gérée dans l'orchestration elle-même.</span><span class="sxs-lookup"><span data-stu-id="a3f53-159">This race condition must be handled in the orchestration itself.</span></span>