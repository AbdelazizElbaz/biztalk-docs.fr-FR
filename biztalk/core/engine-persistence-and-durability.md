---
title: "Moteur de persistance et durabilité | Documents Microsoft"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 9bd209e9-75d2-422f-b3b2-377986f41f2f
caps.latest.revision: "7"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 13f9f3f1a02ddfe84a963704476e867783f31042
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/20/2017
---
# <a name="engine-persistence-and-durability"></a><span data-ttu-id="ccd9a-102">Persistance et durabilité du moteur</span><span class="sxs-lookup"><span data-stu-id="ccd9a-102">Engine Persistence and Durability</span></span>
<span data-ttu-id="ccd9a-103">Cette section explique comment BizTalk Server intègre de manière fiable des processus d'entreprise faiblement couplés en stockant l'état de ces processus sur un disque via SQL Server.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-103">This section explains how BizTalk Server reliably integrates loosely coupled business processes by persisting process state to disk via SQL Server.</span></span> <span data-ttu-id="ccd9a-104">En assurant la persistance de l'état des processus aux moments opportuns et en exploitant les transactions, le système garantit qu'aucun état de processus n'est perdu, même en cas de panne matérielle ou logicielle.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-104">By persisting state at appropriate times, leveraging transactions, the system guarantees that no process state is lost even in the event of a hardware or software outage.</span></span> <span data-ttu-id="ccd9a-105">C'est ce que l'on appelle la durabilité du système.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-105">This is referred to as system durability.</span></span>  
  
## <a name="loosely-coupled-business-process-management"></a><span data-ttu-id="ccd9a-106">Gestion des processus d'entreprise faiblement couplés</span><span class="sxs-lookup"><span data-stu-id="ccd9a-106">Loosely Coupled Business Process Management</span></span>  
 <span data-ttu-id="ccd9a-107">Intégrer des systèmes existants pour exécuter un seul processus d'entreprise logique nécessite de gérer l'état du processus en dehors de ces systèmes.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-107">Integrating existing systems to perform a single logical business process requires management of process state outside of the existing systems.</span></span> <span data-ttu-id="ccd9a-108">Quelle que soit la durée de vie du processus, l'état de ce processus doit être géré de façon indépendante pour éviter l'explosion des chemins de communication personnalisés que génère un couplage étroit des systèmes.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-108">Whether the business process is long running or short lived, process state must be maintained independently in order to avoid the explosion of custom communications paths that result from tightly coupling systems together.</span></span>  
  
 <span data-ttu-id="ccd9a-109">De toute évidence, l'état d'un processus d'entreprise en cours d'exécution doit être fiable si le processus remplit une mission stratégique.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-109">Clearly, the state of a running business process instance must be reliable if the business process is mission critical.</span></span> <span data-ttu-id="ccd9a-110">Afin de garantir la fiabilité et la durabilité des processus d'entreprise, BizTalk se sert des transactions SQL Server pour stocker sur disque l'état de ces processus et les données, dans la base de données MessageBox.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-110">To assure that business processes are reliable and durable, BizTalk leverages SQL Server transactions to persist process state and business data to disk in a database known as the MessageBox database.</span></span> <span data-ttu-id="ccd9a-111">Pour plus d’informations sur la base de données MessageBox, consultez [la base de données MessageBox](../core/the-messagebox-database.md).</span><span class="sxs-lookup"><span data-stu-id="ccd9a-111">For more information about the MessageBox database, see [The MessageBox Database](../core/the-messagebox-database.md).</span></span>  
  
 <span data-ttu-id="ccd9a-112">Tous les messages et toutes les instances des processus d'entreprise sauf les plus anecdotiques (les instances d'orchestration, par exemple) de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] sont transférés vers la base de données MessageBox, une fois au moins pendant le traitement.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-112">Every message and all but the most trivial business process instances (for example, orchestration instances) in [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] are persisted in the MessageBox database at least once during processing.</span></span>  
  
## <a name="persistence-and-sustainability"></a><span data-ttu-id="ccd9a-113">Persistance et viabilité</span><span class="sxs-lookup"><span data-stu-id="ccd9a-113">Persistence and Sustainability</span></span>  
 <span data-ttu-id="ccd9a-114">Le fait que BizTalk Server conserve tous les messages et la plupart des orchestrations a un effet direct sur la durabilité tel qu’indiqué à [Nouveautés des performances durables ?](../core/what-is-sustainable-performance.md)</span><span class="sxs-lookup"><span data-stu-id="ccd9a-114">The fact that BizTalk Server persists all messages and most orchestrations has a direct affect on sustainability as noted in [What Is Sustainable Performance?](../core/what-is-sustainable-performance.md)</span></span> <span data-ttu-id="ccd9a-115">Réception de messages dans la base de données MessageBox, ils sont acheminés aux abonnés en attente (par exemple, orchestrations et envoi des ports) et en file d’attente en ou publiées dans des tables SQL messagebox attendre pour que les abonnés les récupèrent et de les traiter.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-115">As messages arrive in the MessageBox database, they are routed to waiting subscribers (for example, orchestrations and send ports) and en-queued, or published, into messagebox SQL tables to wait for subscribers to pick them up and process them.</span></span> <span data-ttu-id="ccd9a-116">Certains des messages entrants activent de nouvelles instances d'abonnés.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-116">Some of the arriving messages activate new subscriber instances.</span></span> <span data-ttu-id="ccd9a-117">D'autres sont acheminés, par corrélation, vers une instance en attente d'un abonné qui s'exécute déjà, telle une orchestration corrélée.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-117">Other messages arrive and are routed, via correlation, to a waiting instance of an already running subscriber such as a correlated orchestration.</span></span>  
  
 <span data-ttu-id="ccd9a-118">Pour que les orchestrations corrélées continuent le traitement, les messages corrélés entrants doivent rester non bloqués.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-118">In order for correlated orchestrations to continue processing, arriving correlated messages must remain un-blocked.</span></span> <span data-ttu-id="ccd9a-119">BizTalk s'efforce donc de continuer à recevoir les messages (tant ceux qui activent des instances d'abonnés que les messages corrélés), même si la charge système est importante, de sorte que les abonnés en attente de messages corrélés puissent terminer leurs tâches et faire de la place pour l'exécution de processus supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-119">To facilitate this, BizTalk does its best to make sure messages (both activating and correlated) continue to be received, even under high load, so that subscribers waiting for correlated messages can finish and make room for more processes to run.</span></span> <span data-ttu-id="ccd9a-120">Cela signifie que les messages peuvent être reçus plus vite qu'il n'est possible de les traiter et de les supprimer de la base de données MessageBox, où ceux qui ne sont pas encore traités s'accumulent.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-120">This means it is possible to receive messages faster than they can be processed and removed from the MessageBox database, thus building up a message backlog.</span></span> <span data-ttu-id="ccd9a-121">BizTalk étant une technologie de stockage et de transfert, il est naturel qu'elle fournisse ce type de mise en mémoire tampon ; toutefois, cela peut engendrer des problèmes si le taux de réception est systématiquement plus élevé que le taux de traitement, auquel cas le nombre de messages non traités devient considérable.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-121">Being a store-and-forward technology, it is natural for BizTalk to provide this type of buffering, however, it can result in problems if the receive rate is consistently faster than the process rate indefinitely, resulting in a large backlog.</span></span>  
  
 <span data-ttu-id="ccd9a-122">Le contenu de chaque message reçu ou créé dans BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="ccd9a-122">Every message that is received by, or created within, BizTalk Server is immutable.</span></span> <span data-ttu-id="ccd9a-123">ne peut plus être modifié.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-123">That is, once it has been received or created, its content cannot be changed.</span></span> <span data-ttu-id="ccd9a-124">En outre, les messages reçus peuvent avoir plusieurs abonnés.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-124">In addition, received messages may have multiple subscribers.</span></span> <span data-ttu-id="ccd9a-125">Chaque abonné à un message particulier référence la même copie unique du message.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-125">Each subscriber of a particular message references the same, single copy of that message.</span></span> <span data-ttu-id="ccd9a-126">Si cette approche minimise l'espace de stockage requis, un compteur de référence doit être associé à chaque message et une maintenance doit être effectuée régulièrement pour supprimer les messages dont le compteur de référence indique la valeur 0.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-126">While this approach minimizes storage, a ref-count must be kept for each message and maintenance must be performed periodically to get rid of those messages that have a ref count of 0.</span></span>  
  
 <span data-ttu-id="ccd9a-127">Si un certain cumul de messages non traités est autorisé dans la base de données MessageBox, les processus de maintenance de cette base (implémentés sous la forme d'un ensemble de travaux SQL) prendront du retard et si aucune possibilité de rattraper ce retard n'est prévue, cela posera des problèmes à terme comme un manque d'espace disque.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-127">If a large enough backlog is allowed to build up in the MessageBox database, the maintenance processes for the database (implemented as a set of SQL Jobs for each MessageBox database) will fall behind and, if not given an opportunity to catch up, will eventually cause issues such as running out of disk space.</span></span> <span data-ttu-id="ccd9a-128">Pour éviter cela, BizTalk Server propose un mécanisme de limitation qui réduit le taux de réception des messages quand, dans la base de données MessageBox, le nombre de messages non traités atteint un certain niveau (configurable par l'utilisateur).</span><span class="sxs-lookup"><span data-stu-id="ccd9a-128">To avoid this situation, BizTalk Server provides a throttling mechanism that slows down the message receive rate when the MessageBox database backlog gets to some user-configurable level.</span></span> <span data-ttu-id="ccd9a-129">Pour plus d’informations sur la limitation, consultez [optimisation des ressources d’utilisation via la limitation des hôtes](../core/optimizing-resource-usage-through-host-throttling.md).</span><span class="sxs-lookup"><span data-stu-id="ccd9a-129">For more information about throttling, see [Optimizing Resource Usage Through Host Throttling](../core/optimizing-resource-usage-through-host-throttling.md).</span></span>  
  
 <span data-ttu-id="ccd9a-130">Étant donné la diversité des activités et des processus qui contribuent à la viabilité, la principale mesure pour garantir la viabilité dans la durée est d'interdire l'accumulation indéfinie des messages non traités.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-130">Given all of the activities and processes that contribute to sustainability, the primary measure of sustainability over time is that a backlog is not allowed to grow indefinitely.</span></span> <span data-ttu-id="ccd9a-131">En d'autres termes, dans la durée, il faut parvenir à un équilibre entre les niveaux de débit de pointe minimal et maximal afin que la base de données MessageBox puisse conserver un volume moyen de messages non traités constant et gérable.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-131">In other words, over time, there must be a balance between the high and low peak throughput levels so that the MessageBox database is able to maintain a constant and manageable average backlog.</span></span> <span data-ttu-id="ccd9a-132">Le principal indicateur du nombre de messages non traités est la profondeur de la table de mise en file d'attente, exprimée par un compteur de performance de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] nommé BizTalk:MessageBox:Compteurs généraux:Taille mise en file d'attente.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-132">The primary measure of backlog is the depth of the spool table, which is exposed as a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] performance counter called BizTalk:Message Box:General Counters:Spool Size.</span></span> <span data-ttu-id="ccd9a-133">Pour plus d’informations sur ce compteur de performance, consultez [les compteurs de Performance de boîte de Message](../core/message-box-performance-counters.md).</span><span class="sxs-lookup"><span data-stu-id="ccd9a-133">For more information about this performance counter, see [Message Box Performance Counters](../core/message-box-performance-counters.md).</span></span>  
  
 <span data-ttu-id="ccd9a-134">Pour plus d’informations sur l’utilisation de la taille de la mise en attente et d’autres compteurs pour déterminer le débit maximal, un système peut admettre, consultez [mesure moteur débit maximal](../core/measuring-maximum-sustainable-engine-throughput.md).</span><span class="sxs-lookup"><span data-stu-id="ccd9a-134">For more information on how to use the spool size and other counters to determine the maximum throughput a system can sustain, see [Measuring Maximum Sustainable Engine Throughput](../core/measuring-maximum-sustainable-engine-throughput.md).</span></span>  
  
## <a name="recommendations"></a><span data-ttu-id="ccd9a-135">Recommandations</span><span class="sxs-lookup"><span data-stu-id="ccd9a-135">Recommendations</span></span>  
 [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="ccd9a-136"> conserve tous les messages et la plupart des orchestrations et peut, en l'absence de contrôle, accumuler des messages non traités, ce qui à terme peut créer des problèmes comme un manque d'espace disque.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-136"> persists all messages and most orchestrations and can, left un-checked, develop a backlog of messages that can result in issues such as running out of disk space.</span></span> <span data-ttu-id="ccd9a-137">Le principal indicateur du retard est la profondeur de la table du spouleur messagebox, qui est exposée comme un compteur de performances : taille de compteurs : Spool : général de la MessageBox.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-137">The primary measure of backlog is the depth of the messagebox spool table, which is exposed as a performance counter called: BizTalk:Message Box:General Counters:Spool Size.</span></span>  
  
 <span data-ttu-id="ccd9a-138">Pour que le débit reste admissible, la taille de mise en file d'attente doit se maintenir à une valeur moyenne stable.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-138">When thinking about sustainable throughput, the spool size must sustain a stable average over time.</span></span> <span data-ttu-id="ccd9a-139">En effet, cette taille ne peut pas augmenter indéfiniment sans contrôle.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-139">That is, the spool cannot continue to grow un-checked indefinitely.</span></span> <span data-ttu-id="ccd9a-140">Dans [mesure moteur débit maximal](../core/measuring-maximum-sustainable-engine-throughput.md), ce comportement est décrit plus en détail et une méthode permettant de déterminer le débit maximal, un système peut admettre est fournie, qui tire parti de la taille de la mise en attente et les performances des autres indicateurs.</span><span class="sxs-lookup"><span data-stu-id="ccd9a-140">In [Measuring Maximum Sustainable Engine Throughput](../core/measuring-maximum-sustainable-engine-throughput.md), this behavior is discussed in more detail and a method of determining the maximum throughput a system can sustain is provided which leverages the spool size and other performance indicators.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ccd9a-141">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="ccd9a-141">See Also</span></span>  
 <span data-ttu-id="ccd9a-142">[Mesurer le débit de moteur maximal acceptable](../core/measuring-maximum-sustainable-engine-throughput.md) </span><span class="sxs-lookup"><span data-stu-id="ccd9a-142">[Measuring Maximum Sustainable Engine Throughput](../core/measuring-maximum-sustainable-engine-throughput.md) </span></span>  
 <span data-ttu-id="ccd9a-143">[Nouveautés des performances durables ?](../core/what-is-sustainable-performance.md) </span><span class="sxs-lookup"><span data-stu-id="ccd9a-143">[What Is Sustainable Performance?](../core/what-is-sustainable-performance.md) </span></span>  
 <span data-ttu-id="ccd9a-144">[Trucs et astuces](../core/performance-tips-and-tricks.md) </span><span class="sxs-lookup"><span data-stu-id="ccd9a-144">[Performance Tips and Tricks](../core/performance-tips-and-tricks.md) </span></span>  
 [<span data-ttu-id="ccd9a-145">Compteurs de Performance de boîte de message</span><span class="sxs-lookup"><span data-stu-id="ccd9a-145">Message Box Performance Counters</span></span>](../core/message-box-performance-counters.md)