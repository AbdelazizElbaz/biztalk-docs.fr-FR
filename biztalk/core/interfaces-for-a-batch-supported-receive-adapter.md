---
title: "Interfaces pour un lot pris en charge par l’adaptateur de réception | Documents Microsoft"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: fa6ee780-189c-41e3-9ab0-6b869e791c0a
caps.latest.revision: "12"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: b2de4d27ec65620adbb5428491c5ab1a53300fd7
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/20/2017
---
# <a name="interfaces-for-a-batch-supported-receive-adapter"></a><span data-ttu-id="21afc-102">Interfaces pour un adaptateur de réception pris en charge par lot</span><span class="sxs-lookup"><span data-stu-id="21afc-102">Interfaces for a Batch-Supported Receive Adapter</span></span>
<span data-ttu-id="21afc-103">Un adaptateur de réception envoie toujours les messages par lots.</span><span class="sxs-lookup"><span data-stu-id="21afc-103">A receive adapter always submits messages in a batch.</span></span> <span data-ttu-id="21afc-104">Un lot est une unité d'opérations de base de données que vous pouvez utilisez pour les actions autres que l'envoi.</span><span class="sxs-lookup"><span data-stu-id="21afc-104">A batch is a unit of database operations that you can use for actions other than submission.</span></span> <span data-ttu-id="21afc-105">Par exemple, un adaptateur de réception peut envoyer un ensemble de messages, en suspendre un autre et en supprimer un troisième dans le même lot.</span><span class="sxs-lookup"><span data-stu-id="21afc-105">For example, a receive adapter can submit one set of messages, suspend a different set of messages, and delete another set of messages in the same batch.</span></span> <span data-ttu-id="21afc-106">Le regroupement de ces opérations distinctes au sein d'un même lot est vivement recommandé car il permet d'optimiser les performances en minimisant le nombre d'allers-retours obligatoires vers une base de données.</span><span class="sxs-lookup"><span data-stu-id="21afc-106">Grouping these separate operations in the same batch optimizes performance by minimizing the number of database round trips required and is strongly encouraged.</span></span>  
  
 <span data-ttu-id="21afc-107">Les adaptateurs de réception in-process et isolés doivent implémenter les interfaces suivantes pour envoyer des lots de messages au serveur :</span><span class="sxs-lookup"><span data-stu-id="21afc-107">In-process and isolated receive adapters need to implement the following interfaces to submit batches of messages into the server:</span></span>  
  
-   <span data-ttu-id="21afc-108">**IBTTransport**</span><span class="sxs-lookup"><span data-stu-id="21afc-108">**IBTTransport**</span></span>  
  
-   <span data-ttu-id="21afc-109">**IBTTransportControl** (adaptateurs in-process uniquement)</span><span class="sxs-lookup"><span data-stu-id="21afc-109">**IBTTransportControl** (in-process adapters only)</span></span>  
  
-   <span data-ttu-id="21afc-110">**IBTTransportConfig**</span><span class="sxs-lookup"><span data-stu-id="21afc-110">**IBTTransportConfig**</span></span>  
  
-   <span data-ttu-id="21afc-111">**IBaseComponent**</span><span class="sxs-lookup"><span data-stu-id="21afc-111">**IBaseComponent**</span></span>  
  
-   <span data-ttu-id="21afc-112">**IPersistPropertyBag**</span><span class="sxs-lookup"><span data-stu-id="21afc-112">**IPersistPropertyBag**</span></span>  
  
-   <span data-ttu-id="21afc-113">**IBTBatchCallBack**</span><span class="sxs-lookup"><span data-stu-id="21afc-113">**IBTBatchCallBack**</span></span>  
  
 <span data-ttu-id="21afc-114">Les étapes suivantes décrivent la séquence d'actions effectuée par un adaptateur de réception afin d'envoyer les messages au serveur.</span><span class="sxs-lookup"><span data-stu-id="21afc-114">The following steps describe the sequence of actions that a receive adapter performs to submit messages into the server.</span></span>  
  
1.  <span data-ttu-id="21afc-115">Un adaptateur de réception Obtient le lot du proxy de transport en appelant le **GetBatch** méthode de la **IBTTransportProxy** interface.</span><span class="sxs-lookup"><span data-stu-id="21afc-115">A receive adapter obtains the batch from the transport proxy by calling the **GetBatch** method of the **IBTTransportProxy** interface.</span></span> <span data-ttu-id="21afc-116">Dans son appel à **GetBatch** l’adaptateur transmet un pointeur vers son **IBTBatchCallback** implémentation de l’interface.</span><span class="sxs-lookup"><span data-stu-id="21afc-116">In its call to **GetBatch** the adapter passes in a pointer to its **IBTBatchCallback** interface implementation.</span></span>  
  
2.  <span data-ttu-id="21afc-117">Un adaptateur ajoute les messages un à la fois dans le lot en appelant le **SubmitMessage** méthode de la **IBTTransportBatch** interface.</span><span class="sxs-lookup"><span data-stu-id="21afc-117">An adapter adds the messages one at a time into the batch by calling the **SubmitMessage** method of the **IBTTransportBatch** interface.</span></span> <span data-ttu-id="21afc-118">S’il s’agit d’une opération bidirectionnelle, telles que la messagerie avec sollicitation-réponse, le **SubmitResponseMessage** méthode de cette même interface est appelée pour envoyer le message de réponse.</span><span class="sxs-lookup"><span data-stu-id="21afc-118">If this is a two-way operation such as solicit-response messaging, the **SubmitResponseMessage** method of this same interface is called to submit the response message.</span></span>  
  
3.  <span data-ttu-id="21afc-119">Lorsque tous les messages ont été ajoutés au lot, l’adaptateur appelle la **fait** méthode de la **IBTTransportBatch** interface soumettre le lot au proxy de transport.</span><span class="sxs-lookup"><span data-stu-id="21afc-119">When all the messages have been added to the batch, the adapter calls the **Done** method of the **IBTTransportBatch** interface to submit the batch to the transport proxy.</span></span> <span data-ttu-id="21afc-120">Étant donné que recevoir des adaptateurs sont asynchrones par nature, l’adaptateur peut immédiatement obtenir un nouveau lot et commencer à envoyer d’autres messages après avoir appelé **fait**.</span><span class="sxs-lookup"><span data-stu-id="21afc-120">Because receive adapters are asynchronous in nature, the adapter can immediately obtain a new batch and start submitting other messages after it calls **Done**.</span></span>  
  
4.  <span data-ttu-id="21afc-121">Une fois que le lot a été traité, le moteur de messagerie appelle l’adaptateur **BatchComplete** méthode de rappel à l’aide du proxy de transport pour effectuer l’appel réel.</span><span class="sxs-lookup"><span data-stu-id="21afc-121">After the batch has been processed, the Messaging Engine invokes the adapter's **BatchComplete** callback method using the transport proxy to make the actual call.</span></span> <span data-ttu-id="21afc-122">Un tableau de **BTBatchOperationStatus** objets contenant l’état de l’envoi est transmis à l’adaptateur.</span><span class="sxs-lookup"><span data-stu-id="21afc-122">An array of **BTBatchOperationStatus** objects containing the status of the submission is passed to the adapter.</span></span> <span data-ttu-id="21afc-123">Chaque objet correspond à un type d'opération et contient l'état général de l'opération ainsi que l'état de chaque message pour lequel l'opération a été effectuée.</span><span class="sxs-lookup"><span data-stu-id="21afc-123">Each object corresponds to an operation type and contains the overall status of the operation as well as the status for each message for which the operation was performed.</span></span> <span data-ttu-id="21afc-124">La séquence suivante décrit les actions qu'un adaptateur doit effectuer pour analyser l'état d'un traitement par lot.</span><span class="sxs-lookup"><span data-stu-id="21afc-124">The following sequence describes the actions the adapter needs to perform to analyze the status of batch processing:</span></span>  
  
    1.  <span data-ttu-id="21afc-125">Vérification de l’état général du lot valeur HRESULT est passé en tant que paramètre à la **BatchComplete** (méthode).</span><span class="sxs-lookup"><span data-stu-id="21afc-125">Check the overall batch status HRESULT value passed as a parameter to the **BatchComplete** method.</span></span> <span data-ttu-id="21afc-126">En cas d'échec, cela signifie qu'au moins une des opérations du lot a échoué.</span><span class="sxs-lookup"><span data-stu-id="21afc-126">If it is a failure, it means that at least one of the operations in the batch was unsuccessful.</span></span> <span data-ttu-id="21afc-127">Par conséquent, l'envoi du lot en tant qu'entité unique a échoué.</span><span class="sxs-lookup"><span data-stu-id="21afc-127">Therefore the submission of the entire batch as one entity failed.</span></span> <span data-ttu-id="21afc-128">L'adaptateur doit alors tenter d'identifier le(s) message(s) responsable(s) et renvoyer en tant que lot uniquement les messages qui ne sont pas à l'origine de l'échec.</span><span class="sxs-lookup"><span data-stu-id="21afc-128">The adapter should then try to discover the offending message(s) and resubmit as a batch only the ones that did not initially cause a failure.</span></span>  
  
         <span data-ttu-id="21afc-129">Si l'état général du lot est une réussite, cela signifie que tous les messages transmis au proxy de transport ont été conservés sur le disque.</span><span class="sxs-lookup"><span data-stu-id="21afc-129">If the overall batch status succeeded, it means that all the messages that were given to the transport proxy were persisted to disk.</span></span> <span data-ttu-id="21afc-130">Toutefois, cela ne veut pas dire que le pipeline a traité tous les messages avec succès.</span><span class="sxs-lookup"><span data-stu-id="21afc-130">However, it does not mean that the pipeline successfully processed all the messages.</span></span> <span data-ttu-id="21afc-131">Il est possible que les messages ayant échoué dans le pipeline soient suspendus.</span><span class="sxs-lookup"><span data-stu-id="21afc-131">It is possible that messages that failed in the pipeline were suspended.</span></span> <span data-ttu-id="21afc-132">Pour les messages qui échouent dans le pipeline, l'état général du lot est une réussite car les données ont été écrites sur le disque.</span><span class="sxs-lookup"><span data-stu-id="21afc-132">For messages that fail in the pipeline, the overall batch status returned is successful because the data was written to disk.</span></span>  
  
    2.  <span data-ttu-id="21afc-133">Vérifiez l'état de chaque type d'opération dans le paramètre `operationStatus`.</span><span class="sxs-lookup"><span data-stu-id="21afc-133">Check the status for each operation type in the `operationStatus` parameter.</span></span> <span data-ttu-id="21afc-134">Si l’état est **S_OK**, l’envoi pour cette opération a réussi et que vous n’avez pas besoin de vérifier l’état de tous les autres.</span><span class="sxs-lookup"><span data-stu-id="21afc-134">If the status is **S_OK**, the submission for this operation succeeded and you do not need to check the status any further.</span></span> <span data-ttu-id="21afc-135">Si l’état est défini sur **BTS_S_EPM_MESSAGE_SUSPENDED** certains messages ont été interrompues.</span><span class="sxs-lookup"><span data-stu-id="21afc-135">If the status is set to **BTS_S_EPM_MESSAGE_SUSPENDED** some of the messages were suspended.</span></span> <span data-ttu-id="21afc-136">**BTS_S_EPM_SECURITY_CHECK_FAILED** signifie que certains messages d’échec de l’authentification dans une authentification requise port de réception.</span><span class="sxs-lookup"><span data-stu-id="21afc-136">**BTS_S_EPM_SECURITY_CHECK_FAILED** signifies that some messages failed authentication in an authentication-required receive port.</span></span> <span data-ttu-id="21afc-137">Si **E_FAIL** est retourné, ou tout paramètre HRESULT avec une valeur qui est inférieur à zéro, l’envoi du message pour cette opération a échoué.</span><span class="sxs-lookup"><span data-stu-id="21afc-137">If **E_FAIL** is returned, or any HRESULT with a value that is less than zero, the message submission for this operation failed.</span></span>  
  
    3.  <span data-ttu-id="21afc-138">Vérifiez l'état de chaque message pour le type d'opération.</span><span class="sxs-lookup"><span data-stu-id="21afc-138">Check the status of individual messages for the operation type.</span></span> <span data-ttu-id="21afc-139">Pour le type d’opération de soumission, l’état de chaque message est défini sur **S_OK** si l’envoi a réussi.</span><span class="sxs-lookup"><span data-stu-id="21afc-139">For the submit operation type, the status of each message is set to **S_OK** if the submission succeeded.</span></span> <span data-ttu-id="21afc-140">**BTS_S_EPM_MESSAGE_SUSPENDED** est retournée si le message a été interrompu.</span><span class="sxs-lookup"><span data-stu-id="21afc-140">**BTS_S_EPM_MESSAGE_SUSPENDED** is returned if the message was suspended.</span></span> <span data-ttu-id="21afc-141">**BTS_S_EPM_SECURITY_CHECK_FAILED** est retournée si le message d’échec de l’authentification sur un port de réception qui requiert une authentification.</span><span class="sxs-lookup"><span data-stu-id="21afc-141">**BTS_S_EPM_SECURITY_CHECK_FAILED** is returned if the message failed authentication on a receive port that requires authentication.</span></span> <span data-ttu-id="21afc-142">**E_BTS_NO_SUBSCRIPTION** revient si il y avait pas d’abonnés pour le message publié.</span><span class="sxs-lookup"><span data-stu-id="21afc-142">**E_BTS_NO_SUBSCRIPTION** comes back if there were no subscribers for the published message.</span></span> <span data-ttu-id="21afc-143">Si **E_FAIL** est retourné, ou tout paramètre HRESULT avec une valeur qui est inférieur à zéro, l’envoi du message a échoué.</span><span class="sxs-lookup"><span data-stu-id="21afc-143">If **E_FAIL** is returned, or any HRESULT with a value that is less than zero, the message submission failed.</span></span>  
  
    4.  <span data-ttu-id="21afc-144">En fonction de votre adaptateur, vous voudrez suspendre les messages qui retournent **E_FAIL** ou tout paramètre HRESULT d’échec.</span><span class="sxs-lookup"><span data-stu-id="21afc-144">Depending on your adapter, you may want to suspend messages that return **E_FAIL** or any failing HRESULT.</span></span>  
  
5.  <span data-ttu-id="21afc-145">Le **BatchComplete** méthode doit retourner **S_OK** ou **E_FAIL** pour indiquer le résultat de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="21afc-145">The **BatchComplete** method needs to return either **S_OK** or **E_FAIL** to indicate the result of execution.</span></span> <span data-ttu-id="21afc-146">Si le **BatchComplete** méthode retourne **E_FAIL** ou tout paramètre HRESULT négatif, le proxy de transport consigne une erreur.</span><span class="sxs-lookup"><span data-stu-id="21afc-146">If the **BatchComplete** method returns **E_FAIL** or any negative HRESULT, the transport proxy logs an error.</span></span>  
  
 <span data-ttu-id="21afc-147">L'illustration suivante indique les interactions d'objets impliquées dans la création d'un adaptateur de réception pris en charge par lot.</span><span class="sxs-lookup"><span data-stu-id="21afc-147">The following figure shows the object interactions involved in creating a batch-supported receive adapter.</span></span>  
  
 ![](../core/media/ebiz-sdk-devadapter1.gif "ebiz_sdk_devadapter1")  
<span data-ttu-id="21afc-148">Workflow d'un adaptateur de réception envoyant un lot de messages</span><span class="sxs-lookup"><span data-stu-id="21afc-148">Workflow for a receive adapter submitting a batch of messages</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="21afc-149">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="21afc-149">See Also</span></span>  
 <span data-ttu-id="21afc-150">[Variables d’adaptateur](../core/adapter-variables.md) </span><span class="sxs-lookup"><span data-stu-id="21afc-150">[Adapter Variables](../core/adapter-variables.md) </span></span>  
 <span data-ttu-id="21afc-151">[Développement d’un adaptateur de réception](../core/developing-a-receive-adapter.md) </span><span class="sxs-lookup"><span data-stu-id="21afc-151">[Developing a Receive Adapter](../core/developing-a-receive-adapter.md) </span></span>  
 <span data-ttu-id="21afc-152">[Instanciation et initialisation un adaptateur de réception](../core/instantiating-and-initializing-a-receive-adapter.md) </span><span class="sxs-lookup"><span data-stu-id="21afc-152">[Instantiating and Initializing a Receive Adapter](../core/instantiating-and-initializing-a-receive-adapter.md) </span></span>  
 <span data-ttu-id="21afc-153">[Adaptateur de réception des interfaces pour In-Process](../core/interfaces-for-an-in-process-receive-adapter.md) </span><span class="sxs-lookup"><span data-stu-id="21afc-153">[Interfaces for an In-Process Receive Adapter](../core/interfaces-for-an-in-process-receive-adapter.md) </span></span>  
 <span data-ttu-id="21afc-154">[Adaptateur de réception des interfaces pour un hôte isolé](../core/interfaces-for-an-isolated-receive-adapter.md) </span><span class="sxs-lookup"><span data-stu-id="21afc-154">[Interfaces for an Isolated Receive Adapter](../core/interfaces-for-an-isolated-receive-adapter.md) </span></span>  
 <span data-ttu-id="21afc-155">[Adaptateur de réception des interfaces pour un transactionnel pris en charge par lot](../core/interfaces-for-a-transactional-batch-supported-receive-adapter.md) </span><span class="sxs-lookup"><span data-stu-id="21afc-155">[Interfaces for a Transactional Batch-Supported Receive Adapter](../core/interfaces-for-a-transactional-batch-supported-receive-adapter.md) </span></span>  
 [<span data-ttu-id="21afc-156">Adaptateur de réception des interfaces pour une demande-réponse synchrone</span><span class="sxs-lookup"><span data-stu-id="21afc-156">Interfaces for a Synchronous Request-Response Receive Adapter</span></span>](../core/interfaces-for-a-synchronous-request-response-receive-adapter.md)