---
title: "Le traitement d’un Message AS2 entrant | Documents Microsoft"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 998ff334-71e2-4686-b2b7-44940a0ebed1
caps.latest.revision: "32"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: b221ea3697180c27e347250570b0e96105a50f08
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/20/2017
---
# <a name="processing-an-incoming-as2-message"></a><span data-ttu-id="f077b-102">Traitement d'un message AS2 entrant</span><span class="sxs-lookup"><span data-stu-id="f077b-102">Processing an Incoming AS2 Message</span></span>
<span data-ttu-id="f077b-103">Les pipelines de réception AS2 traitent un message entrant sur AS2.</span><span class="sxs-lookup"><span data-stu-id="f077b-103">The AS2 receive pipelines process an incoming message over AS2.</span></span> <span data-ttu-id="f077b-104">Le pipeline de réception AS2EdiReceive traite un message EDI à l'aide du Désassembleur EDI.</span><span class="sxs-lookup"><span data-stu-id="f077b-104">The AS2EdiReceive receive pipeline processes an EDI-encoded message, using the EDI Disassembler.</span></span> <span data-ttu-id="f077b-105">Le pipeline de réception AS2Receive traite un message non EDI à l'aide du Désassembleur AS2.</span><span class="sxs-lookup"><span data-stu-id="f077b-105">The AS2Receive receive pipeline processes a non-EDI-encoded message, using the AS2 Disassembler.</span></span> <span data-ttu-id="f077b-106">Les deux pipelines traitent la charge du message AS2 et génèrent un MDN de façons différentes ; toutefois, les deux pipelines de réception utilisent le décodeur AS2 pour traiter le message AS2.</span><span class="sxs-lookup"><span data-stu-id="f077b-106">The two pipelines process the payload of the AS2 message and generate an MDN differently; however, both receive pipelines use the AS2 Decoder to process the AS2 message.</span></span>  
  
 <span data-ttu-id="f077b-107">Lorsque le pipeline AS2EdiReceivePipeline traite un message AS2 avec une charge EDI, il termine le traitement AS2 du message reçu avant d'effectuer le traitement EDI.</span><span class="sxs-lookup"><span data-stu-id="f077b-107">When the AS2EdiReceivePipeline processes an AS2 message with an EDI payload, it completes the AS2 processing of the received message before performing the EDI processing.</span></span> <span data-ttu-id="f077b-108">Lorsque le pipeline génère un accusé de réception EDI pour la charge EDI d'un message AS2, il doit renvoyer l'accusé de réception EDI de manière asynchrone, car la connexion est fermée par la réponse AS2.</span><span class="sxs-lookup"><span data-stu-id="f077b-108">When the pipeline generates an EDI acknowledgment for the EDI payload of an AS2 message, it must return the EDI acknowledgment asynchronously, because the connection is closed by the AS2 response.</span></span>  
  
## <a name="the-receive-port"></a><span data-ttu-id="f077b-109">Le Port de réception</span><span class="sxs-lookup"><span data-stu-id="f077b-109">The Receive Port</span></span>  
 <span data-ttu-id="f077b-110">Un port de réception HTTP permet de recevoir un message AS2 avec une charge EDI ou non-EDI.</span><span class="sxs-lookup"><span data-stu-id="f077b-110">An HTTP receive port is used to receive an AS2 message with an EDI or non-EDI payload.</span></span> <span data-ttu-id="f077b-111">Si un MDN doit être renvoyé de manière synchrone, le port de réception doit être un port de réception de requête-réponse bidirectionnel.</span><span class="sxs-lookup"><span data-stu-id="f077b-111">If an MDN must be returned synchronously, then the receive port must be a request-response port.</span></span>  
  
 <span data-ttu-id="f077b-112">Un MDN peut être renvoyé de façon synchrone ou asynchrone.</span><span class="sxs-lookup"><span data-stu-id="f077b-112">An MDN can be returned synchronously or asynchronously.</span></span> <span data-ttu-id="f077b-113">Cela est déterminé par l’en-tête Disposition-notification-to du message AS2, à moins que le **utiliser les paramètres de l’accord pour validation et MDN au lieu de l’en-tête de message** propriété est sélectionnée dans l’onglet d’accord AS2 unidirectionnel de la  **Propriétés de l’accord** boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="f077b-113">This is determined by the Disposition-notification-to header of the AS2 message, unless the **Use agreement settings for validation and MDN instead of message header** property is selected in the one-way AS2 agreement tab of the **Agreement Properties** dialog box.</span></span> <span data-ttu-id="f077b-114">Si la propriété est sélectionnée, la façon dont le MDN est retourné est déterminée par le **exiger le MDN asynchrone** propriété dans le **paramètres MDN de l’expéditeur** page de l’onglet d’accord AS2 unidirectionnel de la  **Propriétés de l’accord** boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="f077b-114">If the property is selected, the way the MDN is returned is determined by the **Request asynchronous MDN** property in the **Sender MDN Settings** page of the one-way AS2 agreement tab of the **Agreement Properties** dialog box.</span></span> <span data-ttu-id="f077b-115">Pour plus d’informations, consultez [les Messages AS2](../core/as2-messages.md) et [Messages MDN](../core/mdn-messages.md).</span><span class="sxs-lookup"><span data-stu-id="f077b-115">For more information, see [AS2 Messages](../core/as2-messages.md) and [MDN Messages](../core/mdn-messages.md).</span></span>  
  
 <span data-ttu-id="f077b-116">Si le MDN est renvoyé de manière synchrone, il l'est via le port d'envoi de l'emplacement de réception bidirectionnel.</span><span class="sxs-lookup"><span data-stu-id="f077b-116">If the MDN will be returned synchronously, the MDN is returned over the send port of the two-way receive location.</span></span> <span data-ttu-id="f077b-117">Ce MDN sert de réponse HTTP, par exemple, un 200OK indique que le message a été reçu.</span><span class="sxs-lookup"><span data-stu-id="f077b-117">This MDN serves as the HTTP response, for example, a 200OK indicating successful reception of the message.</span></span>  
  
 <span data-ttu-id="f077b-118">Si le MDN est renvoyé en mode asynchrone, un port d'envoi distinct doit être utilisé.</span><span class="sxs-lookup"><span data-stu-id="f077b-118">If the MDN will be returned asynchronously, the MDN must be returned over a separate send port.</span></span> <span data-ttu-id="f077b-119">Si un port d'envoi dynamique est utilisé, le MDN sera envoyé à l'adresse contenue dans l'en-tête Disposition-notification-to.</span><span class="sxs-lookup"><span data-stu-id="f077b-119">If a dynamic send port is used, the MDN will be sent to the address contained in Disposition-notification-to header.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f077b-120">Le port de réception bidirectionnel utilisé pour recevoir les messages AS2 ne doit pas servir à recevoir les messages MDN.</span><span class="sxs-lookup"><span data-stu-id="f077b-120">The two-way receive port used to receive AS2 messages should not be used to receive MDN messages.</span></span> <span data-ttu-id="f077b-121">Ceux-ci doivent être reçus sur un port de réception unidirectionnel statique.</span><span class="sxs-lookup"><span data-stu-id="f077b-121">MDN messages should be received on a static one-way receive port.</span></span> <span data-ttu-id="f077b-122">L'utilisation d'un port de réception de requête/réponse pour un MDN renvoyé de façon asynchrone doit empêcher le renvoi d'un message 200OK en réponse à un MDN entrant, qui provoquerait des tentatives de transmission du MDN inutiles.</span><span class="sxs-lookup"><span data-stu-id="f077b-122">Using a request/response receive port for an MDN returned asynchronously would prevent a 200OK message from being returned in response to the incoming MDN, thereby causing unnecessary retries of the MDN transmission.</span></span>  
  
## <a name="how-the-as2-receive-pipelines-work"></a><span data-ttu-id="f077b-123">Fonctionnement des pipelines de réception AS2</span><span class="sxs-lookup"><span data-stu-id="f077b-123">How the AS2 Receive Pipelines Work</span></span>  
 <span data-ttu-id="f077b-124">Les pipelines de réception AS2 effectuent le traitement suivant pour le message AS2 entrant :</span><span class="sxs-lookup"><span data-stu-id="f077b-124">The steps that the AS2 receive pipelines performs in processing an incoming AS2 message are as follows:</span></span>  
  
-   <span data-ttu-id="f077b-125">Détermine le tiers expéditeur en faisant correspondre AS2-à partir de la valeur de l’en-tête AS2 du message avec la valeur pour AS2-à partir de la liste dans le **identificateurs** page de l’onglet d’accord AS2 unidirectionnel de la **Propriétésdel’accord** boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="f077b-125">Determines the sending party by matching the AS2-From value in the AS2 header of the message with the value for AS2-From list in the **Identifiers** page of the one-way AS2 agreement tab of the **Agreement Properties** dialog box.</span></span> <span data-ttu-id="f077b-126">En cas d'échec, il tente de déterminer le tiers expéditeur en faisant correspondre la propriété de contexte AS2-From définie pour le message entrant avec le nom du tiers.</span><span class="sxs-lookup"><span data-stu-id="f077b-126">If that fails, attempts to determine the sending party by matching the AS2-From context property that is set for the incoming message with the name of a party.</span></span> <span data-ttu-id="f077b-127">Si une correspondance est trouvée et le **utiliser les paramètres de l’accord pour validation et MDN au lieu de l’en-tête de message** propriété est sélectionnée dans l’onglet d’accord AS2 unidirectionnel de la **propriétés de l’accord** boîte de dialogue, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] utilisera les propriétés AS2 associées avec l’accord du tiers pour le traitement du message AS2.</span><span class="sxs-lookup"><span data-stu-id="f077b-127">If a match is found, and the **Use agreement settings for validation and MDN instead of message header** property is selected in the one-way AS2 agreement tab of the **Agreement Properties** dialog box, [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] will use the AS2 properties associated with the agreement for the party for processing the AS2 message.</span></span> <span data-ttu-id="f077b-128">Si la propriété n'est pas sélectionnée, le pipeline de réception utilise les balises d'en-tête AS2 dans le message entrant.</span><span class="sxs-lookup"><span data-stu-id="f077b-128">If the property is not selected, the receive pipeline will use the AS2 header tags in the incoming message.</span></span> <span data-ttu-id="f077b-129">Si aucun accord n'est trouvé, le pipeline abandonne le traitement, suspend le message et génère une exception.</span><span class="sxs-lookup"><span data-stu-id="f077b-129">If the agreement is not found, the pipeline aborts processing, suspends the message, and raises an exception.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="f077b-130">Le **utiliser les paramètres de l’accord pour validation et MDN au lieu de l’en-tête de message** propriété vous permet de valider qu’un message entrant a des propriétés de signature, le chiffrement et compression (si ces propriétés sont spécifiées dans le accord dans le **Validation** onglet de l’accord unidirectionnel) et dans le cas contraire, pour suspendre le message et publie une erreur.</span><span class="sxs-lookup"><span data-stu-id="f077b-130">The **Use agreement settings for validation and MDN instead of message header** property allows you to validate that an incoming message has signing, encryption, and compression properties (if those properties are specified in the agreement in the **Validation** tab of the one-way agreement), and if not, to suspend the message and post an error.</span></span> <span data-ttu-id="f077b-131">Vous devez procéder à ces modifications en accord avec le tiers expéditeur.</span><span class="sxs-lookup"><span data-stu-id="f077b-131">These changes must be negotiated with the agreement for the sending party.</span></span> <span data-ttu-id="f077b-132">Pour plus d’informations, consultez [configuration des propriétés AS2](../core/configuring-as2-properties.md).</span><span class="sxs-lookup"><span data-stu-id="f077b-132">For more information see [Configuring AS2 Properties](../core/configuring-as2-properties.md).</span></span>  
  
-   <span data-ttu-id="f077b-133">Si l'accord du tiers expéditeur est déterminé, mais qu'une erreur se produit lorsque le pipeline de réception tente de traiter le message AS2, le pipeline définit la propriété de contexte MessageDestination du message AS2 sur SuspendQueue.</span><span class="sxs-lookup"><span data-stu-id="f077b-133">If the agreement for the sending party is determined, but an error arises when the receive pipeline attempts to process the AS2 message, the pipeline will set the context property MessageDestination on the AS2 message to SuspendQueue.</span></span> <span data-ttu-id="f077b-134">Le pipeline de réception suspend le message dans la MessageBox.</span><span class="sxs-lookup"><span data-stu-id="f077b-134">The receive pipeline will then suspend the message in the MessageBox.</span></span> <span data-ttu-id="f077b-135">Le pipeline de réception définit aussi la propriété de contexte de `EdiIntAS.IsAS2FailedMessage` sur True.</span><span class="sxs-lookup"><span data-stu-id="f077b-135">The receive pipeline will also set the `EdiIntAS.IsAS2FailedMessage` context property to True.</span></span> <span data-ttu-id="f077b-136">Si un MDN est activé en définissant **exiger le MDN** dans les **paramètres MDN de l’expéditeur** page de l’onglet d’accord AS2 unidirectionnel de la **propriétés de l’accord** sera de boîte de dialogue, le pipeline Renvoie le MDN approprié à l’expéditeur.</span><span class="sxs-lookup"><span data-stu-id="f077b-136">If an MDN is enabled by setting **Request MDN** in the **Sender MDN Settings** page of the one-way AS2 agreement tab of the **Agreement Properties** dialog box, the pipeline will then return the appropriate MDN to the sender.</span></span> <span data-ttu-id="f077b-137">Le pipeline tente toujours de renvoyer un MDN s'il est exigé.</span><span class="sxs-lookup"><span data-stu-id="f077b-137">The pipeline will always attempt to return an MDN if it is requested.</span></span>  
  
-   <span data-ttu-id="f077b-138">Détermine si le message est un doublon, si le **vérifier les messages en double** option est sélectionnée dans le **Validation** page de l’onglet d’accord AS2 unidirectionnel de la **accord Propriétés** boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="f077b-138">Determines if the message is a duplicate, if the **Check for duplicate messages within** option is selected in the **Validation** page of the one-way AS2 agreement tab of the **Agreement Properties** dialog box.</span></span> <span data-ttu-id="f077b-139">Les messages en double sont détectés en faisant correspondre les valeurs AS2-From, AS2-To et Message-ID du message entrant avec les valeurs des messages précédemment reçus.</span><span class="sxs-lookup"><span data-stu-id="f077b-139">Duplicate message detection is accomplished by matching the AS2-From, AS2-To, and Message-ID values on the inbound message to values on messages previously received.</span></span> <span data-ttu-id="f077b-140">Si toutes les valeurs correspondent, le pipeline de réception définit la valeur de la propriété de contexte `EdiIntAs.IsAS2MessageDuplicate` sur true.</span><span class="sxs-lookup"><span data-stu-id="f077b-140">If all three values match, the receive pipeline will set the value of the `EdiIntAs.IsAS2MessageDuplicate` context property to true.</span></span> <span data-ttu-id="f077b-141">Si le **suspendre les messages en double** est également sélectionnée sur la **Validation** page, le message sera interrompu et une erreur consignée.</span><span class="sxs-lookup"><span data-stu-id="f077b-141">If the **Suspend duplicate messages** option is also selected on the **Validation** page, the message will be suspended and an error logged.</span></span>  
  
-   <span data-ttu-id="f077b-142">Récupère le nom de fichier, le cas échéant, de chaque pièce jointe et le promeut vers les propriétés de contexte.</span><span class="sxs-lookup"><span data-stu-id="f077b-142">Retrieves the file name, if any, of each attachment and promotes this to the context properties.</span></span>  
  
-   <span data-ttu-id="f077b-143">Effectue une copie du message (au format câble) et la stocke dans la base de données de réception de non répudiation, si activé dans les propriétés de l'accord unidirectionnel AS2.</span><span class="sxs-lookup"><span data-stu-id="f077b-143">Makes a copy of the message (in wire format), and stores the copy in the non-repudiation receipt database, if enabled in the one-way AS2 agreement properties.</span></span>  
  
-   <span data-ttu-id="f077b-144">Exécute le traitement MIME, notamment la vérification de la signature et le déchiffrement du message (en fonction des balises d'en-tête).</span><span class="sxs-lookup"><span data-stu-id="f077b-144">Performs MIME processing, including verifying the signature and decrypting the message (based upon the header tags).</span></span>  
  
-   <span data-ttu-id="f077b-145">Décompresse le message reçu, s'il était compressé.</span><span class="sxs-lookup"><span data-stu-id="f077b-145">Decompresses the received message, if it was compressed.</span></span>  
  
-   <span data-ttu-id="f077b-146">Génère une réponse HTTP, ajoutée au MDN en mode de réception synchrone de type requête-réponse, ou envoyé en tant que réponse autonome en mode asynchrone.</span><span class="sxs-lookup"><span data-stu-id="f077b-146">Generates an HTTP response, appended to the MDN in synchronous request-response mode, or sent as a standalone response in asynchronous mode.</span></span>  
  
-   <span data-ttu-id="f077b-147">Génère une réponse MDN, si elle est exigée.</span><span class="sxs-lookup"><span data-stu-id="f077b-147">Generates an MDN response, if requested.</span></span> <span data-ttu-id="f077b-148">Le pipeline génère un MDN en fonction des propriétés de l’accord, si le **utiliser les paramètres de l’accord pour validation et MDN au lieu de l’en-tête de message** propriété est définie, ou à partir des propriétés de contexte, si cette propriété n’est pas définie.</span><span class="sxs-lookup"><span data-stu-id="f077b-148">The pipeline will generate an MDN based upon agreement properties, if the **Use agreement settings for validation and MDN instead of message header** property is set, or from context properties, if that property is not set.</span></span> <span data-ttu-id="f077b-149">Si les paramètres de configuration et les en-têtes du message entrant ne sont pas cohérents, le pipeline génère un MDN négatif.</span><span class="sxs-lookup"><span data-stu-id="f077b-149">If the configuration settings and the headers in the incoming message are inconsistent, the pipeline will generate a negative MDN.</span></span>  
  
-   <span data-ttu-id="f077b-150">Le Désassembleur EDI du pipeline de réception AS2EdiReceive génère un accusé de réception EDI, si le message est EDI et qu'un accusé de réception a été activé.</span><span class="sxs-lookup"><span data-stu-id="f077b-150">The EDI Disassembler in the AS2EdiReceive receive pipeline generates an EDI acknowledgment, if the message was EDI-encoded and an acknowledgment was enabled.</span></span> <span data-ttu-id="f077b-151">Le pipeline achemine l'accusé de réception EDI vers la base de données MessageBox, à partir de laquelle un port d'envoi dynamique l'enverra de manière asynchrone.</span><span class="sxs-lookup"><span data-stu-id="f077b-151">The pipeline will route the EDI acknowledgment to the MessageBox, from which a dynamic send port will pick it up and send it out asynchronously.</span></span> <span data-ttu-id="f077b-152">Les accusés de réception EDI sont toujours envoyés de façon asynchrone via le transport AS2, parce qu'un MDN ou une réponse HTTP est envoyée de façon synchrone.</span><span class="sxs-lookup"><span data-stu-id="f077b-152">EDI acknowledgments are always sent out asynchronously over AS2 transport, because either an MDN or an HTTP response is sent out synchronously.</span></span>  
  
-   <span data-ttu-id="f077b-153">Effectue une copie du message MDN et la stocke dans la base de données de réception de non répudiation, si activé dans les propriétés de l'accord unidirectionnel AS2.</span><span class="sxs-lookup"><span data-stu-id="f077b-153">Makes a copy of the MDN, and stores it in the non-repudiation receipt database, if enabled in the one-way AS2 agreement properties.</span></span>  
  
-   <span data-ttu-id="f077b-154">Effectue une copie du message décodé et la stocke dans la base de données de réception de non répudiation, si activé dans les propriétés de l'accord unidirectionnel AS2.</span><span class="sxs-lookup"><span data-stu-id="f077b-154">Makes a copy of the decoded message, and stores the copy in the non-repudiation receipt database, if enabled in the one-way AS2 agreement properties.</span></span>  
  
 <span data-ttu-id="f077b-155">En cas d'erreur AS2, le message reçu ne subira plus aucun traitement.</span><span class="sxs-lookup"><span data-stu-id="f077b-155">If an AS2 error occurs, no further processing will occur on the received message.</span></span> <span data-ttu-id="f077b-156">Toutefois, le pipeline de réception génèrera une réponse MDN.</span><span class="sxs-lookup"><span data-stu-id="f077b-156">However, the receive pipeline will still generate an MDN response.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f077b-157">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="f077b-157">See Also</span></span>  
 <span data-ttu-id="f077b-158">[Réception des Messages AS2 par BizTalk Server](../core/how-biztalk-server-receives-as2-messages.md) </span><span class="sxs-lookup"><span data-stu-id="f077b-158">[How BizTalk Server Receives AS2 Messages](../core/how-biztalk-server-receives-as2-messages.md) </span></span>  
 <span data-ttu-id="f077b-159">[Messages AS2](../core/as2-messages.md) </span><span class="sxs-lookup"><span data-stu-id="f077b-159">[AS2 Messages](../core/as2-messages.md) </span></span>  
 [<span data-ttu-id="f077b-160">Messages MDN</span><span class="sxs-lookup"><span data-stu-id="f077b-160">MDN Messages</span></span>](../core/mdn-messages.md)