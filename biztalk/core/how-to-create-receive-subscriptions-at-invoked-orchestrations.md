---
title: "Comment créer des Orchestrations appelées abonnements de réception | Documents Microsoft"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 3423309a-cb5a-40a5-9582-6ee3ac82b538
caps.latest.revision: "9"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: c419101aa16c23f5fd8a644c0fe33f269d06d6ba
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/20/2017
---
# <a name="how-to-create-receive-subscriptions-at-invoked-orchestrations"></a><span data-ttu-id="03a71-102">Création d'abonnements de réception pour les orchestrations appelées</span><span class="sxs-lookup"><span data-stu-id="03a71-102">How to Create Receive Subscriptions at Invoked Orchestrations</span></span>
<span data-ttu-id="03a71-103">Bien que vous pouvez transmettre des messages en tant que paramètres via la **démarrer Orchestration** forme lorsque vous démarrez une orchestration, dans certains scénarios que vous pouvez envoyer des messages à partir de l’orchestration de l’appelant à l’orchestration appelée après le appel.</span><span class="sxs-lookup"><span data-stu-id="03a71-103">Although you can pass messages as parameters through the **Start Orchestration** shape when you start an orchestration, in some scenarios you may want to send messages from the caller orchestration to the invoked orchestration after the invocation.</span></span> <span data-ttu-id="03a71-104">C'est par exemple le cas si vous ne savez pas, au moment de l'appel, quels messages transmettre, ou si d'autres orchestrations ont besoin d'envoyer des messages de manière dynamique à l'orchestration appelée.</span><span class="sxs-lookup"><span data-stu-id="03a71-104">For example, you may not know what messages you want to pass at the time of invocation, or other orchestrations may need to send messages to the invoked orchestration dynamically.</span></span>  
  
 <span data-ttu-id="03a71-105">Pour envoyer un message à une orchestration appelée, il faut transmettre une corrélation qui permettra à l'orchestration appelée de créer l'abonnement par le biais duquel recevoir le message.</span><span class="sxs-lookup"><span data-stu-id="03a71-105">The way to send a message to an invoked orchestration is to pass in a correlation so that the invoked orchestration can create the subscription that the correlation helps define and then receive the message by using that subscription.</span></span> <span data-ttu-id="03a71-106">Toutefois, se contenter de transmettre la corrélation ne suffit pas.</span><span class="sxs-lookup"><span data-stu-id="03a71-106">However, you cannot simply pass in a correlation and expect the invoked orchestration to create the subscription based on the correlation and receive a message on the subscription.</span></span> <span data-ttu-id="03a71-107">Si vous procédez de cette manière, les messages que vous avez envoyés de l'orchestration de l'appelant à l'orchestration appelée généreront l'erreur « Impossible d'acheminer le message publié, car aucun abonné n'a été trouvé ».</span><span class="sxs-lookup"><span data-stu-id="03a71-107">If you use that approach, the messages you send from the caller orchestration to the invoked orchestration will result in the error, "The published message could not be routed because no subscribers were found."</span></span> <span data-ttu-id="03a71-108">Il s’agit en raison de la manière suivante :</span><span class="sxs-lookup"><span data-stu-id="03a71-108">This is because of the following:</span></span>  
  
-   <span data-ttu-id="03a71-109">L'orchestration appelée présente une condition d'engorgement.</span><span class="sxs-lookup"><span data-stu-id="03a71-109">There is a race condition in the invoked orchestration.</span></span>  
  
-   <span data-ttu-id="03a71-110">Il n'existe aucun point de validation qui puisse permettre à l'orchestration appelée d'envoyer l'abonnement à la base de données MessageBox pour le routage et recevoir les messages.</span><span class="sxs-lookup"><span data-stu-id="03a71-110">There is no commit point for the invoked orchestration to send the subscription to the MessageBox database for routing so that it can receive the messages.</span></span>  
  
 <span data-ttu-id="03a71-111">Vous pouvez résoudre ce problème de la manière suivante :</span><span class="sxs-lookup"><span data-stu-id="03a71-111">A way to resolve this problem is to perform the following steps:</span></span>  
  
1.  <span data-ttu-id="03a71-112">Dans l'orchestration de l'appelant, vous disposez d'une réception avec activation pour recevoir le message.</span><span class="sxs-lookup"><span data-stu-id="03a71-112">In the caller orchestration, you have an activate receive to receive the message.</span></span> <span data-ttu-id="03a71-113">Une fois que vous recevez le message dans l’orchestration de l’appelant, initialisez l’ensemble de corrélations, puis passez l’ensemble de corrélations et une réception auto-corrélation à liaison directe via la **démarrer Orchestration** forme.</span><span class="sxs-lookup"><span data-stu-id="03a71-113">After you receive the message in the caller orchestration, initialize the correlation set, and then pass the correlation set and a self-correlating receive direct-bound port through the **Start Orchestration** shape.</span></span> <span data-ttu-id="03a71-114">Le port ainsi transmis devient un port d'envoi dans l'orchestration appelée, grâce auquel le message pourra être renvoyé pour permettre la synchronisation avec l'orchestration de l'appelant.</span><span class="sxs-lookup"><span data-stu-id="03a71-114">The port that you pass in becomes a send port in the invoked orchestration, and you will use it to send the message back to synchronize with the caller orchestration.</span></span>  
  
2.  <span data-ttu-id="03a71-115">Dans l'orchestration appelée, renvoyez un message à l'orchestration de l'appelant par le biais du port d'auto-corrélation.</span><span class="sxs-lookup"><span data-stu-id="03a71-115">In the invoked orchestration, send a message back to the caller orchestration through the self-correlating port.</span></span> <span data-ttu-id="03a71-116">Cette opération effectue une synchronisation avec l'orchestration de l'appelant, laquelle permet d'éviter les risques d'engorgement et permet de fournir un point de validation lors de la création de l'abonnement de réception dans la base de données MessageBox pour le routage dans l'orchestration appelée.</span><span class="sxs-lookup"><span data-stu-id="03a71-116">This synchronizes with the caller orchestration to prevent race conditions and to provide a commit point while creating the receive subscription to the MessageBox for routing in the invoked orchestration.</span></span>  
  
3.  <span data-ttu-id="03a71-117">L'orchestration de l'appelant reçoit le message via le port d'auto-corrélation et se synchronise avec l'orchestration appelée.</span><span class="sxs-lookup"><span data-stu-id="03a71-117">The caller orchestration receives the message through the self-correlating port and synchronizes with the invoked orchestration.</span></span> <span data-ttu-id="03a71-118">Notez que les réceptions du port d'auto-corrélation ne requièrent pas de suivis.</span><span class="sxs-lookup"><span data-stu-id="03a71-118">Note that self-correlating port receives do not need correlation followers.</span></span> <span data-ttu-id="03a71-119">Vous pouvez désormais envoyer en toute sécurité des messages entre l'orchestration de l'appelant et l'orchestration appelée, et cette dernière recevra les messages basés sur la corrélation.</span><span class="sxs-lookup"><span data-stu-id="03a71-119">You can now safely send messages from the caller orchestration to the invoked orchestration, and the invoked orchestration will receive the messages based upon the correlation.</span></span>  
  
 <span data-ttu-id="03a71-120">Bien que la méthode précitée soit efficace, il existe une meilleure méthode. Elle consiste à transmettre le message qui initialise la corrélation sur laquelle se baser.</span><span class="sxs-lookup"><span data-stu-id="03a71-120">Although the preceding approach can achieve the goal, a better approach is to pass in the message that initializes the correlation on which you want to receive upon.</span></span> <span data-ttu-id="03a71-121">Lors de la synchronisation des orchestrations de l'appelant et appelée via un port d'auto-corrélation, il est recommandé de toujours transmettre le message permettant d'initialiser les corrélations.</span><span class="sxs-lookup"><span data-stu-id="03a71-121">When you are synchronizing a caller orchestration with an invoked orchestration through a self-correlating port, we recommend that you always pass in the message that you need for initializing the correlations.</span></span> <span data-ttu-id="03a71-122">La procédure suivante constitue la méthode la plus fiable et la plus performante :</span><span class="sxs-lookup"><span data-stu-id="03a71-122">The following steps provide the most reliable and highest-performance approach:</span></span>  
  
1.  <span data-ttu-id="03a71-123">Dans l'orchestration de l'appelant, vous disposez d'une réception avec activation pour recevoir le message.</span><span class="sxs-lookup"><span data-stu-id="03a71-123">In the caller orchestration, you have an activate receive to receive the message.</span></span> <span data-ttu-id="03a71-124">Après avoir reçu le message, transmettez un message et une réception auto-corrélation à liaison directe via la **démarrer Orchestration** forme.</span><span class="sxs-lookup"><span data-stu-id="03a71-124">After you receive the message, pass a message and a self-correlating receive direct-bound port through the **Start Orchestration** shape.</span></span> <span data-ttu-id="03a71-125">Le message transmis servira à initialiser la corrélation dans l'orchestration appelée.</span><span class="sxs-lookup"><span data-stu-id="03a71-125">The message you pass in will be used to initialize the correlation in the invoked orchestration.</span></span> <span data-ttu-id="03a71-126">Le port ainsi transmis devient un port d'envoi dans l'orchestration appelée, grâce auquel le message pourra être renvoyé pour permettre la synchronisation avec l'orchestration de l'appelant.</span><span class="sxs-lookup"><span data-stu-id="03a71-126">The port that you pass in becomes a send port in the invoked orchestration, and you will use it to send the message back to synchronize with the caller orchestration.</span></span>  
  
2.  <span data-ttu-id="03a71-127">Dans l'orchestration appelée, initialisez la corrélation et renvoyez un message à l'orchestration de l'appelant.</span><span class="sxs-lookup"><span data-stu-id="03a71-127">In the invoked orchestration, initialize the correlation and send a message back to the caller orchestration.</span></span> <span data-ttu-id="03a71-128">Cette opération effectue une synchronisation avec l'orchestration de l'appelant, laquelle permet d'éviter les risques d'engorgement et permet de fournir un point de validation lors de la création de l'abonnement de réception dans la base de données MessageBox pour le routage dans l'orchestration appelée.</span><span class="sxs-lookup"><span data-stu-id="03a71-128">This synchronizes with the caller orchestration to prevent race conditions and to provide a commit point while creating the receive subscription to the MessageBox for routing in the invoked orchestration.</span></span>  
  
3.  <span data-ttu-id="03a71-129">L'orchestration de l'appelant reçoit le message via le port d'auto-corrélation et se synchronise avec l'orchestration appelée.</span><span class="sxs-lookup"><span data-stu-id="03a71-129">The caller orchestration receives the message through the self-correlating port and synchronizes with the invoked orchestration.</span></span> <span data-ttu-id="03a71-130">Notez que le port d’autocorrélation reçoit n’avez pas besoin de suivis.</span><span class="sxs-lookup"><span data-stu-id="03a71-130">Note that the self-correlating port receives do not need correlation followers.</span></span> <span data-ttu-id="03a71-131">Vous pouvez désormais envoyer en toute sécurité des messages entre l'orchestration de l'appelant et l'orchestration appelée, et cette dernière recevra les messages basés sur la corrélation.</span><span class="sxs-lookup"><span data-stu-id="03a71-131">You can now safely send messages from the caller orchestration to the invoked orchestration, and the invoked orchestration will receive the messages based upon the correlation.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="03a71-132">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="03a71-132">See Also</span></span>  
 <span data-ttu-id="03a71-133">[À l’aide de corrélations dans les Orchestrations](../core/using-correlations-in-orchestrations.md) </span><span class="sxs-lookup"><span data-stu-id="03a71-133">[Using Correlations in Orchestrations](../core/using-correlations-in-orchestrations.md) </span></span>  
 [<span data-ttu-id="03a71-134">Ports de liaison de l’utilisation directe d’autocorrélation</span><span class="sxs-lookup"><span data-stu-id="03a71-134">How to Use Self-Correlating Direct Bound Ports</span></span>](../core/how-to-use-self-correlating-direct-bound-ports.md)