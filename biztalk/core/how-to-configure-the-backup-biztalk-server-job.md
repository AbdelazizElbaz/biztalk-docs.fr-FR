---
title: Configurer le travail de sauvegarde de BizTalk Server | Documents Microsoft
description: 
ms.custom: 
ms.date: 11/22/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 026622c9-fcb4-4db0-af48-1379feb30372
caps.latest.revision: "42"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 452884062cb9c4cdabbfd4890f590e5f0202b417
ms.sourcegitcommit: 5abd0ed3f9e4858ffaaec5481bfa8878595e95f7
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/28/2017
---
# <a name="configure-the-backup-biztalk-server-job"></a><span data-ttu-id="75944-102">Configurer le travail de sauvegarde de BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="75944-102">Configure the Backup BizTalk Server Job</span></span>
<span data-ttu-id="75944-103">Une fois que vous installez et configurez BizTalk Server, configurez la sauvegarde [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] tâche pour sauvegarder vos données.</span><span class="sxs-lookup"><span data-stu-id="75944-103">After you install and configure BizTalk Server, configure the Backup [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] job to back up your data.</span></span> 

<span data-ttu-id="75944-104">**En commençant par [!INCLUDE[bts2016_md](../includes/bts2016-md.md)] Feature Pack 2**, vous pouvez sauvegarder vos bases de données et des fichiers journaux à un compte de stockage d’objets blob Azure.</span><span class="sxs-lookup"><span data-stu-id="75944-104">**Starting with [!INCLUDE[bts2016_md](../includes/bts2016-md.md)] Feature Pack 2**, you can backup your databases and log files to an Azure blob storage account.</span></span> 


## <a name="overview"></a><span data-ttu-id="75944-105">Vue d'ensemble</span><span class="sxs-lookup"><span data-stu-id="75944-105">Overview</span></span>
<span data-ttu-id="75944-106">Le **sauvegarde de BizTalk Server (BizTalkMgmtDb)** le travail inclut les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="75944-106">The **Backup BizTalk Server (BizTalkMgmtDb)** job includes the following steps:</span></span>

-   <span data-ttu-id="75944-107">Étape 1 – **Option de Compression Set**: activer ou désactiver la compression lors de la sauvegarde</span><span class="sxs-lookup"><span data-stu-id="75944-107">Step 1 – **Set Compression Option**: Enable or disable compression during backup</span></span>

-   <span data-ttu-id="75944-108">Étape 2 : **BackupFull**: exécutions de base de données des sauvegardes complètes de bases de données BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="75944-108">Step 2 – **BackupFull**: Runs full database backups of the BizTalk Server databases</span></span>

-   <span data-ttu-id="75944-109">Étape 3 : **MarkAndBackUpLog**: sauvegarde les journaux de base de données BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="75944-109">Step 3 – **MarkAndBackUpLog**: Backs up the BizTalk Server database logs</span></span>

-   <span data-ttu-id="75944-110">Étape 4 : **effacer l’historique de sauvegarde**: choisissez la durée de conservation de l’historique de sauvegarde</span><span class="sxs-lookup"><span data-stu-id="75944-110">Step 4 – **Clear Backup History**: Choose how long the backup history is kept</span></span>

<span data-ttu-id="75944-111">Pour configurer cette tâche, vous devez :</span><span class="sxs-lookup"><span data-stu-id="75944-111">To configure this job, you'll need to:</span></span>  
  
-   <span data-ttu-id="75944-112">Identifier les serveurs SQL principal et de destination et autres options de sauvegarde</span><span class="sxs-lookup"><span data-stu-id="75944-112">Identify the primary and destination SQL Servers and other backup options</span></span>
  
-   <span data-ttu-id="75944-113">Choisissez un compte d’utilisateur Windows pour sauvegarder vos bases de données, créez une connexion SQL Server pour ce compte</span><span class="sxs-lookup"><span data-stu-id="75944-113">Choose a Windows user account to back up your databases, and create a SQL Server login for this account</span></span>
  
-   <span data-ttu-id="75944-114">mapper les connexions SQL Server au rôle de base de données BTS_BACKUP_USERS dans les bases de données BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="75944-114">Map SQL Server logins to the BTS_BACKUP_USERS database role in the BizTalk Server databases</span></span>
  
-   <span data-ttu-id="75944-115">Assurez-vous que le service MSDTC est actif sur tous les nœuds.</span><span class="sxs-lookup"><span data-stu-id="75944-115">Ensure MSDTC service is active on all nodes.</span></span> <span data-ttu-id="75944-116">Sinon, ajout d’un serveur lié entre le nœud source et le nœud de destination échoue.</span><span class="sxs-lookup"><span data-stu-id="75944-116">Otherwise, adding a linked server between the source node and the destination node fails.</span></span>
  
## <a name="before-you-begin"></a><span data-ttu-id="75944-117">Avant de commencer</span><span class="sxs-lookup"><span data-stu-id="75944-117">Before you begin</span></span>  
  
-   <span data-ttu-id="75944-118">Certaines opérations de sauvegarde et de configuration nécessitent l’appartenance au rôle sysadmin SQL Server.</span><span class="sxs-lookup"><span data-stu-id="75944-118">Certain configuration and backup operations require membership in the sysadmin SQL Server role.</span></span> <span data-ttu-id="75944-119">Pour sauvegarder votre [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] signer des bases de données, dans le serveur principal avec un compte qui est membre du rôle de serveur sysadmin SQL Server.</span><span class="sxs-lookup"><span data-stu-id="75944-119">To back up your [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases, sign in the primary server with an account that is a member of the SQL Server sysadmin Server role.</span></span> [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="75944-120">configuration ajoute le rôle de base de données BTS_BACKUP_USERS.</span><span class="sxs-lookup"><span data-stu-id="75944-120"> configuration adds the BTS_BACKUP_USERS database role.</span></span> <span data-ttu-id="75944-121">Le compte d’utilisateur utilisé pour sauvegarder vos bases de données ne nécessite pas d’autorisations de l’administrateur système (rôle de SQL Server sysadmin) sur tous les serveurs SQL qui peuvent être impliqués dans une sauvegarde, à l’exception du serveur principal.</span><span class="sxs-lookup"><span data-stu-id="75944-121">The user account you use to back up your databases does not require System Administrator (sysadmin SQL Server role) permissions on all the SQL Servers that may be involved in a backup, except for the primary server.</span></span>  
  
-   <span data-ttu-id="75944-122">Décidez à laquelle l’authentification dans le compte que vous utilisez pour exécuter votre [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] les sauvegardes de base de données.</span><span class="sxs-lookup"><span data-stu-id="75944-122">Decide which sign in account you use to run your [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] database backups.</span></span> <span data-ttu-id="75944-123">Vous pouvez utiliser un compte local, et vous pouvez utiliser plusieurs comptes.</span><span class="sxs-lookup"><span data-stu-id="75944-123">You can use a local account, and you can use more than one account.</span></span> <span data-ttu-id="75944-124">Mais il est généralement plus simple et plus sûr de créer un compte utilisateur de domaine Windows dédié spécialement dans ce but.</span><span class="sxs-lookup"><span data-stu-id="75944-124">But it is generally simpler and more secure to create one dedicated Windows domain user account specifically for this purpose.</span></span> <span data-ttu-id="75944-125">Vous devez configurer un compte de connexion SQL Server pour cet utilisateur. Celui-ci doit être mappé à une connexion SQL Server pour tous les serveurs SQL participant au processus de sauvegarde, en tant que serveur principal (source) ou secondaire (destination).</span><span class="sxs-lookup"><span data-stu-id="75944-125">You must configure a SQL Server logon account for this user, and the user must be mapped to a SQL Server login for all of the SQL Servers that participate in the backup process, either as primary (source) or secondary (destination) servers.</span></span> <span data-ttu-id="75944-126">Affecter l’utilisateur au rôle de base de données BizTalk BTS_BACKUP_USERS pour chacune de la [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] bases de données vous sauvegardez.</span><span class="sxs-lookup"><span data-stu-id="75944-126">Assign this user to the BizTalk BTS_BACKUP_USERS database role for each of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases you back up.</span></span>  
  
-   <span data-ttu-id="75944-127">Le travail de sauvegarde de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] ne supprime pas les fichiers de sauvegarde obsolètes. Vous devez donc gérer ceux-ci manuellement afin de conserver de l'espace libre sur le disque.</span><span class="sxs-lookup"><span data-stu-id="75944-127">The Backup [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] job does not delete outdated backup files, so you need to manually manage those backup files to conserve disk space.</span></span> <span data-ttu-id="75944-128">Une fois que vous avez créé une sauvegarde complète de vos bases de données, vous devez déplacer les fichiers de sauvegarde obsolètes vers un périphérique de stockage d'archives pour libérer de l'espace sur le disque principal.</span><span class="sxs-lookup"><span data-stu-id="75944-128">After you have created a new full backup of your databases, you should move the outdated backup files onto an archival storage device to reclaim space on the primary disk.</span></span> <span data-ttu-id="75944-129">Consultez le [packages SSIS](http://www.biztalkbill.com/2015/05/26/ssis-packages-to-help-management-biztalk-server-environments/) pour gérer ces fichiers.</span><span class="sxs-lookup"><span data-stu-id="75944-129">See the [SSIS packages](http://www.biztalkbill.com/2015/05/26/ssis-packages-to-help-management-biztalk-server-environments/) to manage these files.</span></span>  
  
-   [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]<span data-ttu-id="75944-130">n’écrit pas les données de suivi directement à la base de données des suivis BizTalk ; au lieu de cela, il met en cache les données dans la base de données MessageBox et puis les déplace vers la base de données des suivis BizTalk.</span><span class="sxs-lookup"><span data-stu-id="75944-130"> does not write tracking data directly to the BizTalk Tracking database; rather it caches the data in the MessageBox database, and then moves it to the BizTalk Tracking database.</span></span> <span data-ttu-id="75944-131">Si des données MessageBox sont perdues, certaines données de suivi peuvent l'être également.</span><span class="sxs-lookup"><span data-stu-id="75944-131">If MessageBox data loss occurs, some tracking data may also be lost.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="75944-132">Conditions préalables</span><span class="sxs-lookup"><span data-stu-id="75944-132">Prerequisites</span></span>  
* <span data-ttu-id="75944-133">Connectez-vous à SQL Server à l’aide d’un compte qui est membre du rôle sysadmin SQL Server.</span><span class="sxs-lookup"><span data-stu-id="75944-133">Sign in to SQL Server using an account that is a member of the sysadmin SQL Server role.</span></span>  
  
* <span data-ttu-id="75944-134">Configurez l'exécution du service SQL Server Agent sous un compte de domaine (recommandé, même si des comptes locaux peuvent être utilisés), avec une connexion d'utilisateur mappée sur chaque instance de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="75944-134">Configure the SQL Server Agent service to run under a domain account (recommended, although local accounts can be used), with a mapped user login on each instance of SQL Server.</span></span>  

* <span data-ttu-id="75944-135">Pour utiliser un compte de stockage d’objets blob Azure, vous devez un [compte de stockage à usage général](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account#create-a-storage-account), un conteneur au sein de votre compte de stockage d’objets blob, une [signature d’accès partagé](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url#SAS) (SAS) et un [informations d’identification SQL à l’aide de la SAP](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url#credential).</span><span class="sxs-lookup"><span data-stu-id="75944-135">To use an Azure blob storage account, you need a [general purpose storage account](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account#create-a-storage-account), a container within your blob storage account, a [shared access signature](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url#SAS) (SAS), and a [SQL credential using the SAS](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url#credential).</span></span> <span data-ttu-id="75944-136">Une fois créé, avoir votre point de terminaison URL du service blob prêt, qui ressemble à https://*yourstorageaccount*.blob.core.windows.net/*containername*.</span><span class="sxs-lookup"><span data-stu-id="75944-136">Once created, have your blob service endpoint URL ready, which is something like https://*yourstorageaccount*.blob.core.windows.net/*containername*.</span></span> 

    > [!TIP]
    > <span data-ttu-id="75944-137">Si vous n’avez existant d’objets blob de stockage Azure configuré avec une SAP, puis le [script PowerShell de SAS](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url#SAS) peut créer et le conteneur.</span><span class="sxs-lookup"><span data-stu-id="75944-137">If you don't have an existing blob storage account configured with a SAS, then the [SAS PowerShell script](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url#SAS) can create it, and the container.</span></span> <span data-ttu-id="75944-138">[SQL Server Backup to URL](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url) fournit une vue d’ensemble et les étapes spécifiques.</span><span class="sxs-lookup"><span data-stu-id="75944-138">[SQL Server Backup to URL](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url) provides an overview, and the specific steps.</span></span>
  
## <a name="configure-the-job"></a><span data-ttu-id="75944-139">Configurer la tâche</span><span class="sxs-lookup"><span data-stu-id="75944-139">Configure the job</span></span>  
  
1.  <span data-ttu-id="75944-140">Sur le serveur SQL qui héberge la base de données de gestion BizTalk, ouvrez **SQL Server Management Studio**et vous connecter à votre [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="75944-140">On the SQL Server that hosts the BizTalk Management database, open **SQL Server Management Studio**, and connect to your [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)].</span></span>  
  
2.  <span data-ttu-id="75944-141">Développez **Agent SQL Server**, puis **Travaux**.</span><span class="sxs-lookup"><span data-stu-id="75944-141">Expand **SQL Server Agent**, and expand **Jobs**.</span></span>  
  
3.  <span data-ttu-id="75944-142">Cliquez avec le bouton droit sur **Sauvegarde de BizTalk Server (BizTalkMgmtDb)** et sélectionnez **Propriétés**.</span><span class="sxs-lookup"><span data-stu-id="75944-142">Right-click **Backup BizTalk Server (BizTalkMgmtDb)** and select **Properties**.</span></span> <span data-ttu-id="75944-143">Dans les propriétés du travail, sélectionnez **Étapes**.</span><span class="sxs-lookup"><span data-stu-id="75944-143">In the job properties, select **Steps**.</span></span>  
  
4.  <span data-ttu-id="75944-144">Sélectionnez le **définir l’Option de Compression** pas à pas, puis sélectionnez **modifier**:</span><span class="sxs-lookup"><span data-stu-id="75944-144">Select the **Set Compression Option** step, and select **Edit**:</span></span>  

    <span data-ttu-id="75944-145">Cette étape appelle les `sp_SetBackupCompression` procédure stockée dans la base de gestion BizTalk (BizTalkMgmtDb) pour définir la valeur sur le `adm_BackupSettings` table.</span><span class="sxs-lookup"><span data-stu-id="75944-145">This step calls the `sp_SetBackupCompression` stored procedure in the BizTalk management database (BizTalkMgmtDb) to set the value on the `adm_BackupSettings` table.</span></span> <span data-ttu-id="75944-146">La procédure stockée possède un seul paramètre :  **@bCompression** .</span><span class="sxs-lookup"><span data-stu-id="75944-146">The stored procedure has one parameter: **@bCompression**.</span></span> <span data-ttu-id="75944-147">Par défaut, il est défini **0** (compression de la sauvegarde est désactivée).</span><span class="sxs-lookup"><span data-stu-id="75944-147">By default, it is set to **0** (backup compression is off).</span></span> <span data-ttu-id="75944-148">Pour appliquer la compression, remplacez la valeur par **1**:</span><span class="sxs-lookup"><span data-stu-id="75944-148">To apply compression, change the value to **1**:</span></span>  
  
    ```  
    exec [dbo].[sp_SetBackupCompression] @bCompression = 1 /*0 - Do not use Compression, 1 - Use Compression */  
    ```  
  
     <span data-ttu-id="75944-149">Sélectionnez **OK**.</span><span class="sxs-lookup"><span data-stu-id="75944-149">Select **OK**.</span></span>  
  
5.  <span data-ttu-id="75944-150">Sélectionnez le **BackupFull** pas à pas, puis sélectionnez **modifier**.</span><span class="sxs-lookup"><span data-stu-id="75944-150">Select the **BackupFull** step, and select **Edit**.</span></span> <span data-ttu-id="75944-151">Dans le **commande** zone, mettre à jour les valeurs de paramètre :</span><span class="sxs-lookup"><span data-stu-id="75944-151">In the **Command** box, update the parameter values:</span></span>  
  
    1. <span data-ttu-id="75944-152">**Fréquence**: la valeur par défaut est **d** (quotidienne) ; ce qui est le paramètre recommandé.</span><span class="sxs-lookup"><span data-stu-id="75944-152">**Frequency**: The default is **d** (daily); which is the recommended setting.</span></span> <span data-ttu-id="75944-153">Les valeurs **h** (horaire), **w** (hebdomadaire), **m** (mensuelle) et **y** (annuelle) sont également disponibles.</span><span class="sxs-lookup"><span data-stu-id="75944-153">Other values include **h** (hourly), **w** (weekly), **m** (monthly), or **y** (yearly).</span></span>  
  
    2. <span data-ttu-id="75944-154">**Name**: la valeur par défaut est **BTS**.</span><span class="sxs-lookup"><span data-stu-id="75944-154">**Name**: The default is **BTS**.</span></span> <span data-ttu-id="75944-155">Cette valeur est utilisée dans le nom du fichier de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="75944-155">The name is used as part of the backup file name.</span></span>  
  
    3. <span data-ttu-id="75944-156">**Emplacement des fichiers de sauvegarde**: remplacez '*\<chemin d’accès de destination\>*» avec le chemin d’accès complet (le chemin d’accès doit inclure les guillemets simples) à l’ordinateur et le dossier où vous souhaitez sauvegarder le [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]bases de données, ou l’URL du point de terminaison de service blob à un compte de stockage d’objets blob Azure.</span><span class="sxs-lookup"><span data-stu-id="75944-156">**Location of backup files**: Replace '*\<destination path\>*' with the full path (the path must include the single quotes) to the computer and folder where you want to back up the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] databases, or the blob service endpoint URL to an Azure blob storage account.</span></span>  

        > [!IMPORTANT]
        > - <span data-ttu-id="75944-157">Si vous entrez un chemin d’accès local, vous devez copier manuellement tous les fichiers dans le même dossier sur le système de destination chaque fois que la sauvegarde [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] travail crée de nouveaux fichiers.</span><span class="sxs-lookup"><span data-stu-id="75944-157">If you enter a local path, then you have to manually copy all the files to the same folder on the destination system whenever the Backup [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] job creates new files.</span></span>  
        >   
        >      <span data-ttu-id="75944-158">Pour utiliser un chemin d’accès à distance, entrez un partage UNC tel que \\ \\  *\<nom_serveur\>*\\*\<SharedDrive\>*  \\, où  *\<nom_serveur\>*  est le nom du serveur où vous voulez les fichiers, et  *\<SharedDrive\>* est le nom du lecteur partagé ou du dossier.</span><span class="sxs-lookup"><span data-stu-id="75944-158">To use a remote path, enter a UNC share such as \\\\*\<ServerName\>*\\*\<SharedDrive\>*\\, where *\<ServerName\>* is the name of the server where you want the files, and *\<SharedDrive\>* is name of the shared drive or folder.</span></span>  
        >   
        >      <span data-ttu-id="75944-159">La sauvegarde de données sur un réseau peut faire l’objet d’éventuels problèmes réseau.</span><span class="sxs-lookup"><span data-stu-id="75944-159">Backing up data over a network is subject to any network issues.</span></span> <span data-ttu-id="75944-160">Si vous utilisez un emplacement distant, vérifiez que la sauvegarde a réussi lorsque le travail de sauvegarde de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] termine.</span><span class="sxs-lookup"><span data-stu-id="75944-160">When using a remote location, verify the backup succeeded when the Backup [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] job finishes.</span></span>  
        > - <span data-ttu-id="75944-161">Pour éviter de perdre des données, configurez un disque distinct pour la sauvegarde et le stockage des données des bases de données et des journaux.</span><span class="sxs-lookup"><span data-stu-id="75944-161">To avoid potential data loss, configure the backup disk to be a different disk than the database data and log disks.</span></span> <span data-ttu-id="75944-162">Cette étape est nécessaire afin que vous puissiez accéder aux sauvegardes en cas de défaillance du disque de stockage des données ou des journaux.</span><span class="sxs-lookup"><span data-stu-id="75944-162">This is necessary so you can access the backups if the data or log disk fails.</span></span>  
        > - <span data-ttu-id="75944-163">Lorsque la sauvegarde sur un compte d’objets blob Azure, entrez le **point de terminaison de service Blob** URL et le nom du conteneur, qui sont répertoriées dans les propriétés du service blob dans le [portail Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="75944-163">When backing up to an Azure blob account, enter the **Blob service endpoint** URL and the container name, which are listed in your blob service properties in the [Azure portal](https://portal.azure.com).</span></span>

    4. <span data-ttu-id="75944-164">Ce paramètre est facultatif.</span><span class="sxs-lookup"><span data-stu-id="75944-164">Optional.</span></span> <span data-ttu-id="75944-165">**Force une sauvegarde complète après des échecs de sauvegarde partielles** (@ForceFullBackupAfterPartialSetFailure) : la valeur par défaut est **0**.</span><span class="sxs-lookup"><span data-stu-id="75944-165">**Force full backup after partial backup failures** (@ForceFullBackupAfterPartialSetFailure): The default is **0**.</span></span> <span data-ttu-id="75944-166">Si une sauvegarde du journal échoue, aucune sauvegarde complète ne sont exécutées jusqu'à ce que le prochain intervalle de fréquence de sauvegarde complète.</span><span class="sxs-lookup"><span data-stu-id="75944-166">If a log backup fails, no full backups are ran until the next full backup frequency interval is reached.</span></span> <span data-ttu-id="75944-167">Remplacez par **1** si vous souhaitez une sauvegarde complète est exécutée chaque fois qu’un échec de sauvegarde de journal se produit.</span><span class="sxs-lookup"><span data-stu-id="75944-167">Replace with **1** if you want a full backup ran whenever a log backup failure occurs.</span></span>
    
    5. <span data-ttu-id="75944-168">Ce paramètre est facultatif.</span><span class="sxs-lookup"><span data-stu-id="75944-168">Optional.</span></span> <span data-ttu-id="75944-169">**Heure de l’heure locale pour le processus de sauvegarde à exécuter** (@BackupHour) : la valeur par défaut est **NULL**.</span><span class="sxs-lookup"><span data-stu-id="75944-169">**Local time hour for the backup process to run** (@BackupHour): The default is **NULL**.</span></span> <span data-ttu-id="75944-170">La tâche de sauvegarde n’est pas associée avec le fuseau horaire de le [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] ordinateur et s’exécute à minuit UTC (0000) de temps.</span><span class="sxs-lookup"><span data-stu-id="75944-170">The backup job is not associated with the time zone of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] computer, and runs at midnight UTC time (0000).</span></span> <span data-ttu-id="75944-171">Si vous souhaitez sauvegarde à une heure spécifique dans le fuseau horaire de le [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] ordinateur, entrez une valeur entière comprise entre 0 (minuit) et 23 (11 PM) en tant que l’heure de l’heure locale.</span><span class="sxs-lookup"><span data-stu-id="75944-171">If you want to backup at a specific hour in the time zone of the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] computer, enter an integer value from 0 (midnight) to 23 (11 PM) as the local time hour.</span></span> 

    6. <span data-ttu-id="75944-172">Ce paramètre est facultatif.</span><span class="sxs-lookup"><span data-stu-id="75944-172">Optional.</span></span> <span data-ttu-id="75944-173">**Utiliser l’heure locale** (@UseLocalTime) : indique la procédure pour utiliser l’heure locale.</span><span class="sxs-lookup"><span data-stu-id="75944-173">**Use local time** (@UseLocalTime): Tells the procedure to use local time.</span></span> <span data-ttu-id="75944-174">La valeur par défaut est **0**et utilise actuel UTC heure – GETUTCDATE() – 2007-05-04 01:34:11.933.</span><span class="sxs-lookup"><span data-stu-id="75944-174">The default value is **0**, and uses current UTC time – GETUTCDATE() – 2007-05-04 01:34:11.933.</span></span> <span data-ttu-id="75944-175">Si la valeur **1**, puis il utilise l’heure locale – GETDATE() – 2007-05-03 18:34:11.933</span><span class="sxs-lookup"><span data-stu-id="75944-175">If set to **1**, then it uses local time – GETDATE() – 2007-05-03 18:34:11.933</span></span>
  
    <span data-ttu-id="75944-176">Dans l’exemple suivant, les sauvegardes quotidiennes sont créées à 14 h 00 et stockées sur le lecteur m:\ :</span><span class="sxs-lookup"><span data-stu-id="75944-176">In the following example, daily backups are created at 2am, and stored in the m:\ drive:</span></span>  
  
    ```  
    exec [dbo].[sp_BackupAllFull_Schedule]   
    'd' /* Frequency */,   
    'BTS' /* Name */,   
    'm:\BizTalkBackups' /* location of backup files */,   
    '0' /* 0 (default) or 1 ForceFullBackupAfterPartialSetFailure */,   
    '2' /* local time hour for the backup process to run */  
    ```  

    <span data-ttu-id="75944-177">Dans l’exemple suivant, les sauvegardes hebdomadaires sont créés à minuit heure UTC et stockées dans votre compte Azure blob :</span><span class="sxs-lookup"><span data-stu-id="75944-177">In the following example, weekly backups are created at midnight UTC time, and stored in your Azure blob account:</span></span> 

    ```  
    exec [dbo].[sp_BackupAllFull_Schedule]   
    'w' /* Frequency */,   
    'BTS' /* Name */,   
    'http://yourstorageaccount.blob.core.windows.net/yourcontainer/' /* location of backup files */,   
    '1' /* 0 (default) or 1 ForceFullBackupAfterPartialSetFailure */
    ```  

     <span data-ttu-id="75944-178">Sélectionnez **OK**.</span><span class="sxs-lookup"><span data-stu-id="75944-178">Select **OK**.</span></span>  
  
6.  <span data-ttu-id="75944-179">Sélectionnez le **MarkAndBackupLog** pas à pas, puis sélectionnez **modifier**.</span><span class="sxs-lookup"><span data-stu-id="75944-179">Select the **MarkAndBackupLog** step, and select **Edit**.</span></span> <span data-ttu-id="75944-180">Dans le **commande** zone, mettre à jour les valeurs de paramètre :</span><span class="sxs-lookup"><span data-stu-id="75944-180">In the **Command** box, update the parameter values:</span></span>  
  
    1.  <span data-ttu-id="75944-181">**@MarkName**: Cela fait partie de la convention d’affectation de noms pour les fichiers de sauvegarde : \<nom du serveur\>\_\<nom de la base de données\>**\_journal\_**  \< Nom de la marque de journal \> \_ \<Timestamp\></span><span class="sxs-lookup"><span data-stu-id="75944-181">**@MarkName**: This is part of the naming convention for backup files: \<Server Name\>\_\<Database Name\>**\_Log\_**\< Log Mark Name \>\_\<Timestamp\></span></span>  
    
    2.  <span data-ttu-id="75944-182">**@BackupPath**: Chemin de destination complet (y compris les guillemets simples) à l’ordinateur et le dossier où stocker le [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] journaux, ou le compte de stockage d’objets blob Azure et le conteneur de base de données.</span><span class="sxs-lookup"><span data-stu-id="75944-182">**@BackupPath**: Full destination path (including single quotes) to the computer and folder to store the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] database logs, or the Azure blob storage account and container.</span></span> <span data-ttu-id="75944-183">Le  *\<chemin d’accès de destination\>*  peut également être local ou un chemin d’accès UNC vers un autre serveur.</span><span class="sxs-lookup"><span data-stu-id="75944-183">The *\<destination path\>* can also be local or a UNC path to another server.</span></span>  
  
     <span data-ttu-id="75944-184">L'étape MarkAndBackupLog marque les journaux pour la sauvegarde, puis les sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="75944-184">The MarkAndBackupLog step marks the logs for backup, and then backs them up.</span></span>  
  
    > [!IMPORTANT]
    >  <span data-ttu-id="75944-185">Pour éviter **perdre des données** et **amélioration des performances**, le  *\<chemin d’accès de destination\>*  doit être défini sur un autre ordinateur, ou un disque dur, différente de celle utilisée pour stocker les journaux de base de données d’origine.</span><span class="sxs-lookup"><span data-stu-id="75944-185">To avoid **potential data loss** and for **performance improvement**, the *\<destination path\>* should be set to a different computer, or hard drive, different from what is used to store the original database logs.</span></span>  
  
     <span data-ttu-id="75944-186">Sélectionnez **OK**.</span><span class="sxs-lookup"><span data-stu-id="75944-186">Select **OK**.</span></span>  
  
7.  <span data-ttu-id="75944-187">Sélectionnez le **effacer l’historique de sauvegarde** pas à pas, puis sélectionnez **modifier**.</span><span class="sxs-lookup"><span data-stu-id="75944-187">Select the **Clear Backup History** step, and select **Edit**.</span></span> <span data-ttu-id="75944-188">Dans le **commande** zone, mettre à jour les valeurs de paramètre :</span><span class="sxs-lookup"><span data-stu-id="75944-188">In the **Command** box, update the parameter values:</span></span>  
  
    1.  <span data-ttu-id="75944-189">**@DaysToKeep**: Valeur par défaut est **14 jours**.</span><span class="sxs-lookup"><span data-stu-id="75944-189">**@DaysToKeep**: Default value is **14 days**.</span></span> <span data-ttu-id="75944-190">Détermine la durée pendant laquelle l’historique de sauvegarde est conservée le `Adm_BackupHistory` table.</span><span class="sxs-lookup"><span data-stu-id="75944-190">Determines how long the backup history is kept in the `Adm_BackupHistory` table.</span></span> <span data-ttu-id="75944-191">Effacer régulièrement de l’historique de sauvegarde vous permet d’assurer le `Adm_BackupHistory` table à une taille appropriée.</span><span class="sxs-lookup"><span data-stu-id="75944-191">Periodically clearing the backup history helps maintain the `Adm_BackupHistory` table to an appropriate size.</span></span> 
    
    2.  <span data-ttu-id="75944-192">Ce paramètre est facultatif.</span><span class="sxs-lookup"><span data-stu-id="75944-192">Optional.</span></span> <span data-ttu-id="75944-193">**@UseLocalTime**: Indique la procédure pour utiliser l’heure locale.</span><span class="sxs-lookup"><span data-stu-id="75944-193">**@UseLocalTime**: Tells the procedure to use local time.</span></span> <span data-ttu-id="75944-194">La valeur par défaut est 0 :</span><span class="sxs-lookup"><span data-stu-id="75944-194">The default value is 0.</span></span> <span data-ttu-id="75944-195">Il utilise actuel UTC heure – GETUTCDATE() – 2007-05-04 01:34:11.933.</span><span class="sxs-lookup"><span data-stu-id="75944-195">It uses current UTC time – GETUTCDATE() – 2007-05-04 01:34:11.933.</span></span> <span data-ttu-id="75944-196">Si la valeur 1, puis il utilise l’heure locale – GETDATE() – 2007-05-03 18:34:11.933</span><span class="sxs-lookup"><span data-stu-id="75944-196">If set to 1, then it uses local time – GETDATE() – 2007-05-03 18:34:11.933</span></span>
  
    ```  
    exec [dbo].[sp_DeleteBackupHistory] @DaysToKeep=14, @UseLocalTime =1 
    ```  
  
    > [!NOTE]
    >  <span data-ttu-id="75944-197">Cette étape **pas** supprimer les fichiers de sauvegarde à partir du chemin de destination.</span><span class="sxs-lookup"><span data-stu-id="75944-197">This step **does not** delete backup files from the destination path.</span></span>  
    
     <span data-ttu-id="75944-198">Sélectionnez **OK** et fermez toutes les fenêtres de propriétés.</span><span class="sxs-lookup"><span data-stu-id="75944-198">Select **OK** and close all property windows.</span></span>  
  
8.  <span data-ttu-id="75944-199">Ce paramètre est facultatif.</span><span class="sxs-lookup"><span data-stu-id="75944-199">Optional.</span></span> <span data-ttu-id="75944-200">Modifiez la planification de la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="75944-200">Change the backup schedule.</span></span> <span data-ttu-id="75944-201">Consultez [comment planifier le travail de sauvegarde de BizTalk Server](../core/how-to-schedule-the-backup-biztalk-server-job.md).</span><span class="sxs-lookup"><span data-stu-id="75944-201">See [How to Schedule the Backup BizTalk Server Job](../core/how-to-schedule-the-backup-biztalk-server-job.md).</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="75944-202">Le travail de sauvegarde de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] est exécuté la première fois que vous le configurez.</span><span class="sxs-lookup"><span data-stu-id="75944-202">The Backup [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] job runs the first time you configure it.</span></span> <span data-ttu-id="75944-203">Par défaut, lors des exécutions suivantes, la sauvegarde [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] tâche réalise une sauvegarde complète une fois par jour et effectue des sauvegardes de journal toutes les 15 minutes.</span><span class="sxs-lookup"><span data-stu-id="75944-203">By default, on subsequent runs, the Backup [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] job completes a full backup once a day, and completes log backups every 15 minutes.</span></span>  
  
9. <span data-ttu-id="75944-204">Avec le bouton droit le **sauvegarde de BizTalk Server** de la tâche, puis sélectionnez **activer**.</span><span class="sxs-lookup"><span data-stu-id="75944-204">Right-click the **Backup BizTalk Server** job, and select **Enable**.</span></span> <span data-ttu-id="75944-205">L'état doit passer à **Réussite**.</span><span class="sxs-lookup"><span data-stu-id="75944-205">The status should change to **Success**.</span></span>  

## <a name="execute-backupsetupallprocssql-and-logshippingdestinationlogicsql"></a><span data-ttu-id="75944-206">Exécutez Backup_Setup_All_Procs.sql et LogShipping_Destination_Logic.sql</span><span class="sxs-lookup"><span data-stu-id="75944-206">Execute Backup_Setup_All_Procs.sql and LogShipping_Destination_Logic.sql</span></span>

<span data-ttu-id="75944-207">**[!INCLUDE[bts2016_md](../includes/bts2016-md.md)]Feature Pack 2 (FP2)** utilisé les scripts Backup_Setup_All_Procs.sql et LogShipping_Destination_Logic.sql `\Program Files (x86)\Microsoft BizTalk Server *your version*\Schema`.</span><span class="sxs-lookup"><span data-stu-id="75944-207">**[!INCLUDE[bts2016_md](../includes/bts2016-md.md)] Feature Pack 2 (FP2)** used the Backup_Setup_All_Procs.sql and LogShipping_Destination_Logic.sql scripts in `\Program Files (x86)\Microsoft BizTalk Server *your version*\Schema`.</span></span> 

<span data-ttu-id="75944-208">Si votre travail de sauvegarde de BizTalk Server est déjà configuré et que vous souhaitez basculer à l’aide d’Azure d’objets blob (au lieu d’un disque), puis également les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="75944-208">If your Backup BizTalk Server job is already configured, and you want to switch to using Azure blob (instead of a disk), then also do the following:</span></span> 

1. <span data-ttu-id="75944-209">Sur le serveur SQL Server, exécutez le `Backup_Setup_All_Procs.sql` script sur toutes les bases de données personnalisées qui sont sauvegardés par le travail de sauvegarde de BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="75944-209">On the SQL Server, execute the `Backup_Setup_All_Procs.sql` script against all custom databases that are being backed up by the Backup BizTalk Server job.</span></span> <span data-ttu-id="75944-210">Par défaut, FP2 met automatiquement à jour les bases de données BizTalk ; Il ne met pas à jour toutes les bases de données personnalisées (ces bases de données dans le `adm_OtherBackupDatabases` table dans BizTalkMgmtDb).</span><span class="sxs-lookup"><span data-stu-id="75944-210">By default, FP2 automatically updates BizTalk databases; it does not update any custom databases (those databases in the `adm_OtherBackupDatabases` table in BizTalkMgmtDb).</span></span>

    <span data-ttu-id="75944-211">[Dans les bases de données personnalisées](how-to-back-up-custom-databases.md) fournit plus de détails sur les bases de données personnalisées.</span><span class="sxs-lookup"><span data-stu-id="75944-211">[Back Up Custom Databases](how-to-back-up-custom-databases.md) provides more details on custom databases.</span></span> 

2. <span data-ttu-id="75944-212">**Si vous utilisez [journaux](log-shipping.md)**, exécutez le script LogShipping_Destination_Logic.sql sur le système de destination SQL Server.</span><span class="sxs-lookup"><span data-stu-id="75944-212">**If you use [log shipping](log-shipping.md)**, execute the LogShipping_Destination_Logic.sql script on the destination system within SQL Server.</span></span> <span data-ttu-id="75944-213">Si vous n’utilisez pas des journaux, puis exécuter ce script.</span><span class="sxs-lookup"><span data-stu-id="75944-213">If you don't use log shipping, then do not execute this script.</span></span>

    <span data-ttu-id="75944-214">[Configurer le système de Destination pour l’envoi de journaux](how-to-configure-the-destination-system-for-log-shipping.md) fournit plus de détails sur le système de destination.</span><span class="sxs-lookup"><span data-stu-id="75944-214">[Configure the Destination System for Log Shipping](how-to-configure-the-destination-system-for-log-shipping.md) provides more details on the destination system.</span></span>

## <a name="spforcefullbackup-stored-procedure"></a><span data-ttu-id="75944-215">Procédure stockée sp_ForceFullBackup</span><span class="sxs-lookup"><span data-stu-id="75944-215">sp_ForceFullBackup stored procedure</span></span>  
  
<span data-ttu-id="75944-216">Le **sp_ForceFullBackup** procédure stockée dans le **BizTalkMgmtDb** base de données peut servir à exécuter ad hoc sauvegarde complète des fichiers journaux et de données.</span><span class="sxs-lookup"><span data-stu-id="75944-216">The **sp_ForceFullBackup** stored procedure in the **BizTalkMgmtDb** database can be used to run an ad-hoc full backup of the data and log files.</span></span> <span data-ttu-id="75944-217">La procédure stockée met à jour la table adm_ForceFullBackup avec la valeur 1.</span><span class="sxs-lookup"><span data-stu-id="75944-217">The stored procedure updates the adm_ForceFullBackup table with a value 1.</span></span> <span data-ttu-id="75944-218">Lors de la prochaine exécution du travail de sauvegarde de [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], un jeu de sauvegarde de base de données complète est créé.</span><span class="sxs-lookup"><span data-stu-id="75944-218">The next time the Backup [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] job is ran, a full database backup set is created.</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="75944-219">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="75944-219">Next Steps</span></span>  
 <span data-ttu-id="75944-220">[Configurer le système de Destination pour l’envoi de journaux](../core/how-to-configure-the-destination-system-for-log-shipping.md) </span><span class="sxs-lookup"><span data-stu-id="75944-220">[Configure the Destination System for Log Shipping](../core/how-to-configure-the-destination-system-for-log-shipping.md) </span></span>  
 [<span data-ttu-id="75944-221">Planifier le travail de sauvegarde de BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="75944-221">Schedule the Backup BizTalk Server Job</span></span>](../core/how-to-schedule-the-backup-biztalk-server-job.md)  
 [<span data-ttu-id="75944-222">Comptes de stockage Azure</span><span class="sxs-lookup"><span data-stu-id="75944-222">Azure storage accounts</span></span>](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account)  
 [<span data-ttu-id="75944-223">Sauvegarde SQL Server vers une URL</span><span class="sxs-lookup"><span data-stu-id="75944-223">SQL Server Backup to URL</span></span>](https://docs.microsoft.com/sql/relational-databases/backup-restore/sql-server-backup-to-url)
