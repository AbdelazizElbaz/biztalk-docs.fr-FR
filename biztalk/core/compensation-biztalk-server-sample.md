---
title: Compensation (exemple BizTalk Server) | Documents Microsoft
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- orchestrations, examples
- examples, orchestrations
- compensations, examples
- examples, compensations
- compensations, orchestrations
ms.assetid: 9d10c7be-6a4c-44cc-bf29-78ecdf147bd1
caps.latest.revision: "32"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: e7d3e2e917f9ac0cc09117f3de83bbcc6166af1c
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/20/2017
---
# <a name="compensation-biztalk-server-sample"></a><span data-ttu-id="a3c91-102">Compensation (exemple BizTalk Server)</span><span class="sxs-lookup"><span data-stu-id="a3c91-102">Compensation (BizTalk Server Sample)</span></span>
<span data-ttu-id="a3c91-103">L’exemple Compensation illustre l’utilisation de la **compenser** forme dans une orchestration.</span><span class="sxs-lookup"><span data-stu-id="a3c91-103">The Compensation sample demonstrates how to use the **Compensate** shape in an orchestration.</span></span>  
  
## <a name="what-this-sample-does"></a><span data-ttu-id="a3c91-104">Fonctions de l'exemple</span><span class="sxs-lookup"><span data-stu-id="a3c91-104">What This Sample Does</span></span>  
 <span data-ttu-id="a3c91-105">Cet exemple montre comment compenser la transaction déjà validée dans l'orchestration en procédant comme suit :</span><span class="sxs-lookup"><span data-stu-id="a3c91-105">This sample demonstrates how to compensate the transaction that has already been committed in the orchestration using the following sequence of steps:</span></span>  
  
1.  <span data-ttu-id="a3c91-106">Entrez les données client dans le formulaire InfoPath et envoyez-les à une orchestration exposée comme service Web.</span><span class="sxs-lookup"><span data-stu-id="a3c91-106">Enter the customer data in the InfoPath form and submit the data to an orchestration that has been exposed as a Web service.</span></span>  
  
2.  <span data-ttu-id="a3c91-107">L'orchestration effectue deux actions parallèles.</span><span class="sxs-lookup"><span data-stu-id="a3c91-107">The orchestration has two parallel actions.</span></span> <span data-ttu-id="a3c91-108">L'une d'elle renvoie un accusé de réception au formulaire InfoPath, tandis que l'autre met à jour les bases de données Northwind et BTSCompensationSampleMailingList.</span><span class="sxs-lookup"><span data-stu-id="a3c91-108">One returns an acknowledgment to the InfoPath form and the other updates the Northwind and BTSCompensationSampleMailingList databases.</span></span>  
  
3.  <span data-ttu-id="a3c91-109">Dans la seconde action, l’orchestration mappe le message entrant à un format de message des applications client relation management (CRM) et met à jour la **clients** table dans la base de données Northwind.</span><span class="sxs-lookup"><span data-stu-id="a3c91-109">In the second action, the orchestration maps the incoming message to a customer relationship management (CRM) application message format and then updates the **Customers** table in the Northwind database.</span></span> <span data-ttu-id="a3c91-110">La table Mailing List dans la base de données BTSCompensationSampleMailingList est ensuite mise à jour.</span><span class="sxs-lookup"><span data-stu-id="a3c91-110">After this, the Mailing List table in the BTSCompensationSampleMailingList database is updated.</span></span>  
  
4.  <span data-ttu-id="a3c91-111">Si une des actions échoue, les modifications apportées à la base de données Northwind sont compensées via l'appel d'un assembly externe pour réécrire les données client d'origine dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="a3c91-111">If either update fails, the changes made to the Northwind database are compensated by calling an external assembly to write the original customer data back to the database.</span></span>  
  
## <a name="how-this-sample-is-designed-and-why"></a><span data-ttu-id="a3c91-112">Cet exemple est conçu et pourquoi</span><span class="sxs-lookup"><span data-stu-id="a3c91-112">How This Sample is Designed and Why</span></span>  
 <span data-ttu-id="a3c91-113">A **étendue** forme est principalement utilisé pour l’exécution transactionnelle et la gestion des exceptions, notamment la compensation.</span><span class="sxs-lookup"><span data-stu-id="a3c91-113">A **Scope** shape is primarily used for transactional execution and exception handling, including compensation.</span></span> <span data-ttu-id="a3c91-114">Une étendue est constituée de deux blocs.</span><span class="sxs-lookup"><span data-stu-id="a3c91-114">A scope consists of two blocks.</span></span> <span data-ttu-id="a3c91-115">Le premier est le bloc de contexte et le second peut être un ou plusieurs blocs de gestion des exceptions ou de compensation</span><span class="sxs-lookup"><span data-stu-id="a3c91-115">The first block is the context block and the second block can be one or more exception-handling or compensation blocks.</span></span> <span data-ttu-id="a3c91-116">(équivalent à l'instruction try-catch dans le langage de programmation .NET).</span><span class="sxs-lookup"><span data-stu-id="a3c91-116">This is similar to the try-catch statement in the .NET programming language.</span></span> <span data-ttu-id="a3c91-117">L'orchestration UpdateContact.odx inclut deux actions parallèles.</span><span class="sxs-lookup"><span data-stu-id="a3c91-117">In the UpdateContact.odx orchestration, there are two parallel actions.</span></span> <span data-ttu-id="a3c91-118">La branche de droite, le bloc try est la **étendue** forme nommée Updated Backend Systems, qui a une transaction à Long terme de type et un identificateur de transaction Upd_Backend.</span><span class="sxs-lookup"><span data-stu-id="a3c91-118">At the right-side branch, the try block is the **Scope** shape named Updated Backend Systems, which has a Long-Running transaction type and an Upd_Backend transaction identifier.</span></span> <span data-ttu-id="a3c91-119">Plus bas dans le flux, un bloc catch intercepte l'exception générale et initie la compensation.</span><span class="sxs-lookup"><span data-stu-id="a3c91-119">Further down in the flow, there is a catch block that catches the general exception and initiates the compensation.</span></span>  
  
 <span data-ttu-id="a3c91-120">Pour plus d’informations sur la **étendue** mettre en forme, consultez [étendues](../core/scopes.md).</span><span class="sxs-lookup"><span data-stu-id="a3c91-120">For more information about the **Scope** shape, see [Scopes](../core/scopes.md).</span></span> <span data-ttu-id="a3c91-121">Consultez également [comment configurer la forme étendue](../core/how-to-configure-the-scope-shape.md).</span><span class="sxs-lookup"><span data-stu-id="a3c91-121">Also see [How to Configure the Scope Shape](../core/how-to-configure-the-scope-shape.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a3c91-122">L’orchestration doit être une transaction à long terme pour vous permettre de définir le type de transaction sur atomique ou à Long terme.</span><span class="sxs-lookup"><span data-stu-id="a3c91-122">The orchestration must itself be a long-running transaction for you to set the transaction type to Atomic or Long-Running.</span></span>  
  
 <span data-ttu-id="a3c91-123">Dans le bloc try, il existe deux étendues nommées **mise à jour CRM** et **mise à jour de publipostage**.</span><span class="sxs-lookup"><span data-stu-id="a3c91-123">In the try block, there are two scopes named **Update CRM** and **Update Mailing**.</span></span> <span data-ttu-id="a3c91-124">Toutes deux sont des transactions atomiques.</span><span class="sxs-lookup"><span data-stu-id="a3c91-124">Both of these scopes are atomic transactions.</span></span> <span data-ttu-id="a3c91-125">L'étendue Update CRM inclut un bloc try et un bloc compensation.</span><span class="sxs-lookup"><span data-stu-id="a3c91-125">In the Update CRM scope, there is a try block and a compensation block.</span></span> <span data-ttu-id="a3c91-126">Le bloc try met à jour la base de données Northwind via un appel de méthode auprès d'un assembly externe.</span><span class="sxs-lookup"><span data-stu-id="a3c91-126">The try block updates the Northwind database through a method call to an external assembly.</span></span> <span data-ttu-id="a3c91-127">Le bloc compensation est l'emplacement dans lequel l'action de compensation intervient.</span><span class="sxs-lookup"><span data-stu-id="a3c91-127">The compensation block is where the compensation action takes place.</span></span> <span data-ttu-id="a3c91-128">Lorsqu'une exception survient dans l'étendue Update Backend Systems, le code dans la forme Undo CRM Expression met à jour l'enregistrement à son état d'origine.</span><span class="sxs-lookup"><span data-stu-id="a3c91-128">When an exception happens in the Update Backend Systems scope, the code in Undo CRM Expression Shape updates the record back to its original state.</span></span> <span data-ttu-id="a3c91-129">Cela est déclenché par le **compenser** forme dans le bloc intercepter l’Exception.</span><span class="sxs-lookup"><span data-stu-id="a3c91-129">This is triggered by the **Compensate** shape in the Catch Exception block.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a3c91-130">Les transactions atomiques garantissent que les mises à jour partielles sont automatiquement annulées en cas d'échec lors de la mise à jour transactionnelle et que les effets de la transaction sont effacés (à l'exception des effets des appels .NET effectués dans la transaction).</span><span class="sxs-lookup"><span data-stu-id="a3c91-130">Atomic transactions guarantee that any partial updates are rolled back automatically in the event of a failure during the transactional update, and that the effects of the transaction are erased (except for the effects of any .NET calls that are made in the transaction).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a3c91-131">Une transaction à long terme est considérée comme validée une fois que sa dernière instruction a été exécutée.</span><span class="sxs-lookup"><span data-stu-id="a3c91-131">A long-running transaction is considered committed when the last statement in it has completed.</span></span> <span data-ttu-id="a3c91-132">Il n’existe aucune restauration automatique de l’état en cas d’abandon de la transaction.</span><span class="sxs-lookup"><span data-stu-id="a3c91-132">There is no automatic rollback of state in case of a transaction abort.</span></span> <span data-ttu-id="a3c91-133">Vous pouvez obtenir cette restauration par programme grâce aux gestionnaires d'exception et de compensation illustrés dans cet exemple.</span><span class="sxs-lookup"><span data-stu-id="a3c91-133">You can achieve this programmatically through the exception and compensation handlers demonstrated in this sample.</span></span>  
  
 <span data-ttu-id="a3c91-134">Dans le bloc catch, il en existe un **délai** forme définie sur dix secondes.</span><span class="sxs-lookup"><span data-stu-id="a3c91-134">In the catch block, there is one **Delay** shape set for ten seconds.</span></span> <span data-ttu-id="a3c91-135">Celle-ci retarde l'action de compensation.</span><span class="sxs-lookup"><span data-stu-id="a3c91-135">This delays the compensation action.</span></span> <span data-ttu-id="a3c91-136">Il existe également un **compenser** forme qui lance l’action de compensation dans la transaction Upd_Backend.</span><span class="sxs-lookup"><span data-stu-id="a3c91-136">There is also a **Compensate** shape that initiates the compensation action in the Upd_Backend transaction.</span></span>  
  
 <span data-ttu-id="a3c91-137">Les événements suivants se produisent une fois que l'orchestration a reçu le message d'entrée :</span><span class="sxs-lookup"><span data-stu-id="a3c91-137">The following happens after the orchestration receives the input message:</span></span>  
  
1.  <span data-ttu-id="a3c91-138">L'assembly UpdateCrm met à jour une ligne dans la base de données Northwind.</span><span class="sxs-lookup"><span data-stu-id="a3c91-138">The UpdateCrm assembly updates a row in the Northwind database.</span></span>  
  
2.  <span data-ttu-id="a3c91-139">L'assembly UpdateMailingList met à jour un enregistrement correspondant dans la base de données BTSCompensationSampleMailingList.</span><span class="sxs-lookup"><span data-stu-id="a3c91-139">The UpdateMailingList assembly updates a matching record in the BTSCompensationSampleMailingList database.</span></span>  
  
3.  <span data-ttu-id="a3c91-140">En cas d'erreur lors de la mise à jour de la base de données Northwind, une exception est générée et l'orchestration quitte le processus.</span><span class="sxs-lookup"><span data-stu-id="a3c91-140">In the event of a failure while updating the Northwind database, an exception is raised and the orchestration exits the process.</span></span>  
  
4.  <span data-ttu-id="a3c91-141">En cas d'erreur lors de la mise à jour de la base de données BTSCompensationSampleMailingList, une exception est générée et la réécriture des données client d'origine dans la base de données Northwind intervient après un délai de dix secondes.</span><span class="sxs-lookup"><span data-stu-id="a3c91-141">In the event of a failure while updating the BTSCompensationSampleMailingList database, an exception is raised and a ten-second delay takes place before rewriting the original customer data back to the Northwind database.</span></span>  
  
## <a name="where-to-find-this-sample"></a><span data-ttu-id="a3c91-142">Accès à l'exemple</span><span class="sxs-lookup"><span data-stu-id="a3c91-142">Where to Find This Sample</span></span>  
 <span data-ttu-id="a3c91-143">\<*Exemples de chemin d’accès*> \Orchestrations\Compensation\\</span><span class="sxs-lookup"><span data-stu-id="a3c91-143">\<*Samples Path*>\Orchestrations\Compensation\\</span></span>  
  
 <span data-ttu-id="a3c91-144">Le tableau suivant présente les fichiers de cet exemple et décrit leur fonction.</span><span class="sxs-lookup"><span data-stu-id="a3c91-144">The following table shows the files in this sample and describes their purpose.</span></span>  
  
|<span data-ttu-id="a3c91-145">Fichier(s)</span><span class="sxs-lookup"><span data-stu-id="a3c91-145">File(s)</span></span>|<span data-ttu-id="a3c91-146"> Description</span><span class="sxs-lookup"><span data-stu-id="a3c91-146">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="a3c91-147">Cleanup.bat</span><span class="sxs-lookup"><span data-stu-id="a3c91-147">Cleanup.bat</span></span>|<span data-ttu-id="a3c91-148">Fichier de commandes utilisé pour désinstaller l'exemple.</span><span class="sxs-lookup"><span data-stu-id="a3c91-148">Batch file used to uninstall the sample.</span></span>|  
|<span data-ttu-id="a3c91-149">CompensationOrchestration.btproj</span><span class="sxs-lookup"><span data-stu-id="a3c91-149">CompensationOrchestration.btproj</span></span>|<span data-ttu-id="a3c91-150">Projet d'orchestration.</span><span class="sxs-lookup"><span data-stu-id="a3c91-150">Orchestration project.</span></span>|  
|<span data-ttu-id="a3c91-151">CompensationSample.sln</span><span class="sxs-lookup"><span data-stu-id="a3c91-151">CompensationSample.sln</span></span>|<span data-ttu-id="a3c91-152">Exemple de solution.</span><span class="sxs-lookup"><span data-stu-id="a3c91-152">Sample solution.</span></span>|  
|<span data-ttu-id="a3c91-153">CompensationSampleBinding.xml</span><span class="sxs-lookup"><span data-stu-id="a3c91-153">CompensationSampleBinding.xml</span></span>|<span data-ttu-id="a3c91-154">Données de liaison pour l'orchestration (utilisées lors de l'installation).</span><span class="sxs-lookup"><span data-stu-id="a3c91-154">Binding data for the orchestration (used during installation).</span></span>|  
|<span data-ttu-id="a3c91-155">ContactInfo.xsd</span><span class="sxs-lookup"><span data-stu-id="a3c91-155">ContactInfo.xsd</span></span>|<span data-ttu-id="a3c91-156">Schéma de message des coordonnées.</span><span class="sxs-lookup"><span data-stu-id="a3c91-156">Contact information message schema.</span></span>|  
|<span data-ttu-id="a3c91-157">ContactInfo.xsx</span><span class="sxs-lookup"><span data-stu-id="a3c91-157">ContactInfo.xsx</span></span>|<span data-ttu-id="a3c91-158">Fichier de disposition du concepteur d'orchestration.</span><span class="sxs-lookup"><span data-stu-id="a3c91-158">Orchestration Designer layout file.</span></span>|  
|<span data-ttu-id="a3c91-159">CreateSQLDataStore.sql</span><span class="sxs-lookup"><span data-stu-id="a3c91-159">CreateSQLDataStore.sql</span></span>|<span data-ttu-id="a3c91-160">Script SQL qui permet de créer et renseigner l'exemple de base de données.</span><span class="sxs-lookup"><span data-stu-id="a3c91-160">SQL script to create and populate the sample database.</span></span>|  
|<span data-ttu-id="a3c91-161">CrmSchema.xsd</span><span class="sxs-lookup"><span data-stu-id="a3c91-161">CrmSchema.xsd</span></span>|<span data-ttu-id="a3c91-162">Schéma de message de la mise à jour CRM.</span><span class="sxs-lookup"><span data-stu-id="a3c91-162">CRM update message schema.</span></span>|  
|<span data-ttu-id="a3c91-163">MailingListSchema.xsd</span><span class="sxs-lookup"><span data-stu-id="a3c91-163">MailingListSchema.xsd</span></span>|<span data-ttu-id="a3c91-164">Schéma de message de la mise à jour de la liste de distribution.</span><span class="sxs-lookup"><span data-stu-id="a3c91-164">Mailing list message update schema.</span></span>|  
|<span data-ttu-id="a3c91-165">RemoveVirDir.vbs</span><span class="sxs-lookup"><span data-stu-id="a3c91-165">RemoveVirDir.vbs</span></span>|<span data-ttu-id="a3c91-166">Script Microsoft Visual Basic Scripting Edition (VBScript) qui permet de supprimer les répertoires virtuels et physiques du service Web (utilisés lors de la désinstallation).</span><span class="sxs-lookup"><span data-stu-id="a3c91-166">Microsoft Visual Basic Scripting Edition (VBScript) script to remove Web service virtual and physical directories (used during uninstallation).</span></span>|  
|<span data-ttu-id="a3c91-167">Request2Crm.btm</span><span class="sxs-lookup"><span data-stu-id="a3c91-167">Request2Crm.btm</span></span>|<span data-ttu-id="a3c91-168">Mappage de message qui permet de convertir la demande (coordonnées) en message de mise à jour CRM.</span><span class="sxs-lookup"><span data-stu-id="a3c91-168">Message map to translate from request (contact info) to CRM update message.</span></span>|  
|<span data-ttu-id="a3c91-169">Request2MailingList.btm</span><span class="sxs-lookup"><span data-stu-id="a3c91-169">Request2MailingList.btm</span></span>|<span data-ttu-id="a3c91-170">Mappage de message qui permet de convertir la demande (coordonnées) en message de liste de distribution.</span><span class="sxs-lookup"><span data-stu-id="a3c91-170">Message map to translate from request (contact info) to mailing list message.</span></span>|  
|<span data-ttu-id="a3c91-171">Setup.bat</span><span class="sxs-lookup"><span data-stu-id="a3c91-171">Setup.bat</span></span>|<span data-ttu-id="a3c91-172">Fichier de commandes qui permet d'installer l'exemple.</span><span class="sxs-lookup"><span data-stu-id="a3c91-172">Batch file to install this sample.</span></span>|  
|<span data-ttu-id="a3c91-173">UpdateContact.odx</span><span class="sxs-lookup"><span data-stu-id="a3c91-173">UpdateContact.odx</span></span>|<span data-ttu-id="a3c91-174">Fichier d'orchestration.</span><span class="sxs-lookup"><span data-stu-id="a3c91-174">Orchestration file.</span></span>|  
|<span data-ttu-id="a3c91-175">UpdateRequest2UpdateResponse.btm</span><span class="sxs-lookup"><span data-stu-id="a3c91-175">UpdateRequest2UpdateResponse.btm</span></span>|<span data-ttu-id="a3c91-176">Mappage de message qui permet de convertir la demande (coordonnées) en message de réponse.</span><span class="sxs-lookup"><span data-stu-id="a3c91-176">Message map to translate from request (contact info) to a response message.</span></span>|  
|<span data-ttu-id="a3c91-177">UpdateResponse.xsd</span><span class="sxs-lookup"><span data-stu-id="a3c91-177">UpdateResponse.xsd</span></span>|<span data-ttu-id="a3c91-178">Schéma de message de réponse.</span><span class="sxs-lookup"><span data-stu-id="a3c91-178">Response message schema.</span></span>|  
|<span data-ttu-id="a3c91-179">InfoPath\Contact Info Update.xsn</span><span class="sxs-lookup"><span data-stu-id="a3c91-179">InfoPath\Contact Info Update.xsn</span></span>|<span data-ttu-id="a3c91-180">Fichier Microsoft InfoPath utilisé pour envoyer les formulaires au service Web d'orchestration.</span><span class="sxs-lookup"><span data-stu-id="a3c91-180">Microsoft InfoPath file used to submit forms to the orchestration Web service.</span></span>|  
|<span data-ttu-id="a3c91-181">UpdateCrm\AssemblyInfo.cs</span><span class="sxs-lookup"><span data-stu-id="a3c91-181">UpdateCrm\AssemblyInfo.cs</span></span>|<span data-ttu-id="a3c91-182">Fichier de source d'informations de l'assembly UpdateCrm.</span><span class="sxs-lookup"><span data-stu-id="a3c91-182">Assembly information source file for the UpdateCrm assembly.</span></span> <span data-ttu-id="a3c91-183">(L'assembly UpdateCrm met à jour la base de données Northwind.)</span><span class="sxs-lookup"><span data-stu-id="a3c91-183">(The UpdateCrm assembly updates the Northwind database.)</span></span>|  
|<span data-ttu-id="a3c91-184">UpdateCrm\UpdateCrm.cs</span><span class="sxs-lookup"><span data-stu-id="a3c91-184">UpdateCrm\UpdateCrm.cs</span></span>|<span data-ttu-id="a3c91-185">Code source principal de l'assembly UpdateCrm.</span><span class="sxs-lookup"><span data-stu-id="a3c91-185">Main source code for the UpdateCrm assembly.</span></span>|  
|<span data-ttu-id="a3c91-186">UpdateCrm\UpdateCRM.csproj</span><span class="sxs-lookup"><span data-stu-id="a3c91-186">UpdateCrm\UpdateCRM.csproj</span></span>|<span data-ttu-id="a3c91-187">Fichier de projet UpdateCrm.</span><span class="sxs-lookup"><span data-stu-id="a3c91-187">UpdateCrm project file.</span></span>|  
|<span data-ttu-id="a3c91-188">UpdateMailingList\AssemblyInfo.cs</span><span class="sxs-lookup"><span data-stu-id="a3c91-188">UpdateMailingList\AssemblyInfo.cs</span></span>|<span data-ttu-id="a3c91-189">Fichier de source d'informations de l'assembly UpdateMailingList.</span><span class="sxs-lookup"><span data-stu-id="a3c91-189">Assembly information source file for the UpdateMailingList assembly.</span></span> <span data-ttu-id="a3c91-190">(L'assembly UpdateMailingList met à jour l'exemple de base de données.)</span><span class="sxs-lookup"><span data-stu-id="a3c91-190">(The UpdateMailingList assembly updates the sample database.)</span></span>|  
|<span data-ttu-id="a3c91-191">UpdateMailingList\UpdateMailingList.cs</span><span class="sxs-lookup"><span data-stu-id="a3c91-191">UpdateMailingList\UpdateMailingList.cs</span></span>|<span data-ttu-id="a3c91-192">Code source principal de l'assembly UpdateMailingList.</span><span class="sxs-lookup"><span data-stu-id="a3c91-192">Main source code for the UpdateMailingList assembly.</span></span>|  
|<span data-ttu-id="a3c91-193">UpdateMailingList\UpdateMailingList.csproj</span><span class="sxs-lookup"><span data-stu-id="a3c91-193">UpdateMailingList\UpdateMailingList.csproj</span></span>|<span data-ttu-id="a3c91-194">Fichier de projet UpdateMailingList.</span><span class="sxs-lookup"><span data-stu-id="a3c91-194">UpdateMailingList project file.</span></span>|  
  
## <a name="building-and-initializing-this-sample"></a><span data-ttu-id="a3c91-195">Création et initialisation de cet exemple</span><span class="sxs-lookup"><span data-stu-id="a3c91-195">Building and Initializing This Sample</span></span>  
  
#### <a name="to-build-and-initialize-the-compensation-sample"></a><span data-ttu-id="a3c91-196">Pour créer et initialiser l'exemple Compensation</span><span class="sxs-lookup"><span data-stu-id="a3c91-196">To build and initialize the Compensation sample</span></span>  
  
1.  <span data-ttu-id="a3c91-197">Dans une fenêtre de commande [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)], accédez au dossier suivant :</span><span class="sxs-lookup"><span data-stu-id="a3c91-197">In a [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)] command window, navigate to the following folder:</span></span>  
  
     <span data-ttu-id="a3c91-198">\<*Exemples de chemin d’accès*> \Orchestrations\Compensation\\</span><span class="sxs-lookup"><span data-stu-id="a3c91-198">\<*Samples Path*>\Orchestrations\Compensation\\</span></span>  
  
2.  <span data-ttu-id="a3c91-199">Exécutez le fichier Setup.bat, qui effectue les actions suivantes :</span><span class="sxs-lookup"><span data-stu-id="a3c91-199">Run Setup.bat, which performs the following actions:</span></span>  
  
    -   <span data-ttu-id="a3c91-200">création et déploiement de l'exemple d'assembly.</span><span class="sxs-lookup"><span data-stu-id="a3c91-200">Build and deploy the sample assembly.</span></span>  
  
    -   <span data-ttu-id="a3c91-201">Lors du lancement de l'Assistant Publication de services Web BizTalk, procédez manuellement comme suit :</span><span class="sxs-lookup"><span data-stu-id="a3c91-201">When the BizTalk Web Services Publishing Wizard launches, do the following manually:</span></span>  
  
    1.  <span data-ttu-id="a3c91-202">Sur le **Bienvenue dans l’Assistant de publication des Services Web BizTalk** , cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="a3c91-202">On the **Welcome to the BizTalk Web Services Publishing Wizard** page, click **Next**.</span></span>  
  
    2.  <span data-ttu-id="a3c91-203">Sur le **créer un Service Web** page, sélectionnez **l’orchestration BizTalk de publier en tant que services web**, puis cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="a3c91-203">On the **Create Web Service** page, select **Publish BizTalk orchestration as web services**, and then click **Next**.</span></span>  
  
    3.  <span data-ttu-id="a3c91-204">Sur le **BizTalk Assembly** page, recherchez et sélectionnez \< *exemples de chemin*> \Orchestrations\Compensation\bin\Release\CompensationOrchestration.dll, puis cliquez sur  **Suivant**.</span><span class="sxs-lookup"><span data-stu-id="a3c91-204">On the **BizTalk Assembly** page, browse and select \<*Samples Path*>\Orchestrations\Compensation\bin\Release\CompensationOrchestration.dll, and then click **Next**.</span></span>  
  
    4.  <span data-ttu-id="a3c91-205">Sur le **Orchestrations et Ports** , cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="a3c91-205">On the **Orchestrations and Ports** page, click **Next**.</span></span>  
  
    5.  <span data-ttu-id="a3c91-206">Sur le **propriétés du Service Web** page **espace de noms cible du service web**, type **http://Microsoft.BizTalk.Samples.Compensation/**, puis cliquez sur **Suivant**.</span><span class="sxs-lookup"><span data-stu-id="a3c91-206">On the **Web Service Properties** page, in **Target namespace of web service**, type **http://Microsoft.BizTalk.Samples.Compensation/**, and then click **Next**.</span></span>  
  
    6.  <span data-ttu-id="a3c91-207">Sur le **projet de Service Web** page **emplacement**, type **http://localhost/CompensationOrchestrationWebServiceProxy**.</span><span class="sxs-lookup"><span data-stu-id="a3c91-207">On the **Web Service Project** page, in **Location**, type **http://localhost/CompensationOrchestrationWebServiceProxy**.</span></span>  
  
    7.  <span data-ttu-id="a3c91-208">Sélectionnez le **autorise l’accès anonyme au service web** case à cocher.</span><span class="sxs-lookup"><span data-stu-id="a3c91-208">Select the **Allow anonymous access to web service** check box.</span></span>  
  
    8.  <span data-ttu-id="a3c91-209">Sélectionnez le **emplacement de réception BizTalk de créer dans l’application suivante** case à cocher.</span><span class="sxs-lookup"><span data-stu-id="a3c91-209">Select the **Create BizTalk receive location in the following application** check box.</span></span>  
  
    9. <span data-ttu-id="a3c91-210">Dans le **emplacement de réception BizTalk de créer dans l’application suivante** menu déroulant, sélectionnez **BizTalk Application 1** dans la liste déroulante, puis cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="a3c91-210">In the **Create BizTalk receive location in the following application** drop-down menu, select **BizTalk Application 1** from the drop-down list, and then click **Next**.</span></span>  
  
    10. <span data-ttu-id="a3c91-211">Sur le **résumé du projet de Service Web** , cliquez sur **créer**.</span><span class="sxs-lookup"><span data-stu-id="a3c91-211">On the **Web Service Project Summary** page, click **Create**.</span></span>  
  
    11. <span data-ttu-id="a3c91-212">Sur le **fin de l’Assistant de publication des Services Web BizTalk** , cliquez sur **Terminer**.</span><span class="sxs-lookup"><span data-stu-id="a3c91-212">On the **Completing the BizTalk Web Services Publishing Wizard** page, click **Finish**.</span></span>  
  
3.  <span data-ttu-id="a3c91-213">Le programme d'installation crée et lie les ports, crée la base de données principale pour l'exemple et ajoute les assemblys C# au GAC (Global Assembly Cache).</span><span class="sxs-lookup"><span data-stu-id="a3c91-213">Setup creates and binds ports, creates the back-end database for the sample, and adds C# assemblies to the global assembly cache.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="a3c91-214">Vous devez confirmer que [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] n'a pas signalé d'erreur pendant le processus de création et d'initialisation, avant d'essayer de faire fonctionner cet exemple.</span><span class="sxs-lookup"><span data-stu-id="a3c91-214">You should confirm that [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] did not report any errors during the build and initialization process before attempting to run this sample.</span></span>  
  
## <a name="running-this-sample"></a><span data-ttu-id="a3c91-215">Cet exemple en cours d’exécution</span><span class="sxs-lookup"><span data-stu-id="a3c91-215">Running This Sample</span></span>  
 <span data-ttu-id="a3c91-216">Une fois l'exemple créé et initialisé, tenez compte des points suivants avant de l'exécuter :</span><span class="sxs-lookup"><span data-stu-id="a3c91-216">After you build and initialize this sample, consider the following before you run it:</span></span>  
  
-   <span data-ttu-id="a3c91-217">Si vous exécutez cet exemple sous [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)] ou [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)], vous devez créer un pool d'applications IIS et définir son identité sur un compte membre du groupe Windows Utilisateurs d'applications BizTalk.</span><span class="sxs-lookup"><span data-stu-id="a3c91-217">If you are running this sample on [!INCLUDE[btsWinSvr2k8](../includes/btswinsvr2k8-md.md)] or [!INCLUDE[btsWinSvr2k8R2](../includes/btswinsvr2k8r2-md.md)], you must create an IIS application pool and set its identity to an account that is a member of the BizTalk Application Users Windows group.</span></span> <span data-ttu-id="a3c91-218">Vous devez également mettre à jour le répertoire virtuel du service Web d'orchestration afin qu'il soit exécuté dans ce pool d'applications.</span><span class="sxs-lookup"><span data-stu-id="a3c91-218">You also need to update the orchestration Web service virtual directory to run within this application pool.</span></span>  
  
-   <span data-ttu-id="a3c91-219">Ajoutez le compte ASPNET au groupe Utilisateurs d'hôtes BizTalk isolés.</span><span class="sxs-lookup"><span data-stu-id="a3c91-219">Add the ASPNET account to the BizTalk Isolated Host Users group.</span></span>  
  
-   <span data-ttu-id="a3c91-220">Accorder l’autorisation de db_owner du groupe utilisateurs de l’Application BizTalk à le **BTSCompensationSampleMailingList** et **Northwind** bases de données.</span><span class="sxs-lookup"><span data-stu-id="a3c91-220">Give the BizTalk Application Users group db_owner permission to the **BTSCompensationSampleMailingList** and **Northwind** databases.</span></span>  
  
-   <span data-ttu-id="a3c91-221">Si [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] n’est pas installé dans l’emplacement par défaut (lecteur : \Program Files\Microsoft BizTalk Server \<version >\\), vous devez publier le formulaire Contact Info Update.xsn avant de l’utiliser.</span><span class="sxs-lookup"><span data-stu-id="a3c91-221">If [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] is not installed in the default location (drive:\Program Files\Microsoft BizTalk Server \<version>\\), you must publish the Contact Info Update.xsn form before using it.</span></span> <span data-ttu-id="a3c91-222">Pour ce faire, procédez comme suit.</span><span class="sxs-lookup"><span data-stu-id="a3c91-222">To do so, do the following.</span></span>  
  
    #### <a name="to-publish-the-infopath-form"></a><span data-ttu-id="a3c91-223">Pour publier le formulaire InfoPath</span><span class="sxs-lookup"><span data-stu-id="a3c91-223">To publish the InfoPath form</span></span>  
  
    1.  <span data-ttu-id="a3c91-224">Dans Internet Explorer, sur le **outils** menu, cliquez sur **Options Internet**.</span><span class="sxs-lookup"><span data-stu-id="a3c91-224">In Internet Explorer, on the **Tools** menu, click **Internet Options**.</span></span>  
  
    2.  <span data-ttu-id="a3c91-225">Sur le **sécurité** , cliquez sur **Internet**, puis cliquez sur **niveau personnalisé**.</span><span class="sxs-lookup"><span data-stu-id="a3c91-225">On the **Security** tab, click **Internet**, and then click **Custom Level**.</span></span>  
  
    3.  <span data-ttu-id="a3c91-226">Dans le **divers** section, vérifiez que le **accéder aux sources de données sur plusieurs domaines** paramètre est activé, puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="a3c91-226">In the **Miscellaneous** section, ensure that the **Access data sources across domains** setting is enabled, and then click **OK**.</span></span> <span data-ttu-id="a3c91-227">Ce paramètre est requis pour le code de script de la solution d'interface utilisateur InfoPath à exécuter.</span><span class="sxs-lookup"><span data-stu-id="a3c91-227">This setting is required for the InfoPath user interface solution scripting code to run.</span></span>  
  
    4.  <span data-ttu-id="a3c91-228">Dans l’Explorateur Windows, accédez à \< *exemples de chemin*> \Orchestrations\Compensation\InfoPath, avec le bouton droit **Contact Info Update.xsn** puis cliquez sur **conception**.</span><span class="sxs-lookup"><span data-stu-id="a3c91-228">In Windows Explorer, navigate to \<*Samples Path*>\Orchestrations\Compensation\InfoPath, right-click **Contact Info Update.xsn** and then click **Design**.</span></span>  
  
    5.  <span data-ttu-id="a3c91-229">La solution de mise à jour des coordonnées InfoPath (Contact Info Update) est ouverte en mode Création.</span><span class="sxs-lookup"><span data-stu-id="a3c91-229">The InfoPath Contact Info Update solution opens in design mode.</span></span>  
  
    6.  <span data-ttu-id="a3c91-230">Dans l’application de la mise à jour des informations de Contact InfoPath, sur le **fichier** menu, cliquez sur **publier**.</span><span class="sxs-lookup"><span data-stu-id="a3c91-230">In the InfoPath Contact Info Update application, on the **File** menu, click **Publish**.</span></span>  
  
    7.  <span data-ttu-id="a3c91-231">L'Assistant Publication s'affiche.</span><span class="sxs-lookup"><span data-stu-id="a3c91-231">The Publish Wizard appears.</span></span>  
  
    8.  <span data-ttu-id="a3c91-232">Sélectionnez **dans un dossier partagé sur cet ordinateur ou sur un réseau** et publier la solution dans le chemin d’accès \< *exemples de chemin*> \Orchestrations\Compensation\InfoPath\Contact Info Update.xsn.</span><span class="sxs-lookup"><span data-stu-id="a3c91-232">Select **To a shared folder on this computer or on a network** and publish the solution to the path \<*Samples Path*>\Orchestrations\Compensation\InfoPath\Contact Info Update.xsn.</span></span>  
  
    9. <span data-ttu-id="a3c91-233">Fermez InfoPath en mode Création.</span><span class="sxs-lookup"><span data-stu-id="a3c91-233">Close the design mode InfoPath.</span></span>  
  
-   <span data-ttu-id="a3c91-234">Vous êtes prêt à exécuter cet exemple.</span><span class="sxs-lookup"><span data-stu-id="a3c91-234">You are ready to run this sample.</span></span>  
  
    #### <a name="to-run-the-compensation-sample"></a><span data-ttu-id="a3c91-235">Pour exécuter l'exemple Compensation</span><span class="sxs-lookup"><span data-stu-id="a3c91-235">To run the Compensation sample</span></span>  
  
    1.  <span data-ttu-id="a3c91-236">Double-cliquez sur **Contact Info Update.xsn** pour l’ouvrir dans InfoPath.</span><span class="sxs-lookup"><span data-stu-id="a3c91-236">Double-click **Contact Info Update.xsn** to open it in InfoPath.</span></span>  
  
    2.  <span data-ttu-id="a3c91-237">Renseignez le formulaire pour un compte existant dans les deux bases de données.</span><span class="sxs-lookup"><span data-stu-id="a3c91-237">Fill out the form for an account that exists in both databases.</span></span> <span data-ttu-id="a3c91-238">Par exemple, utilisez l'ID de compte « ALFKI » de la table Customers dans la base de données Northwind.</span><span class="sxs-lookup"><span data-stu-id="a3c91-238">For example, use an existing account ID "ALFKI" from the Northwind Customers table.</span></span>  
  
    3.  <span data-ttu-id="a3c91-239">Sur le **fichier** menu, sélectionnez **Submit**, puis cliquez sur **Submit**.</span><span class="sxs-lookup"><span data-stu-id="a3c91-239">On the **File** menu, select **Submit**, and click **Submit**.</span></span>  
  
    4.  <span data-ttu-id="a3c91-240">Le document de réponse doit apparaître dans le \< *exemples de chemin*> \Orchestrations\Compensation\Out dossier et Northwind et les bases de données BTSCompensationSampleMailingList doivent être mis à jour avec le nouveau données du formulaire InfoPath.</span><span class="sxs-lookup"><span data-stu-id="a3c91-240">The response document should appear in the \<*Samples Path*>\Orchestrations\Compensation\Out folder, and both the Northwind and the BTSCompensationSampleMailingList databases should be updated with the new data from the InfoPath form.</span></span>  
  
        > [!NOTE]
        >  <span data-ttu-id="a3c91-241">Vous pouvez détacher la base de données BTSCompensationSampleMailingList ou la mettre hors connexion pour tester l'action de compensation effectuée par l'orchestration.</span><span class="sxs-lookup"><span data-stu-id="a3c91-241">You can detach the BTSCompensationSampleMailingList database or take it offline to test the compensation action that the orchestration performs.</span></span> <span data-ttu-id="a3c91-242">Notez que l'enregistrement est d'abord mis à jour dans la base de données Northwind.</span><span class="sxs-lookup"><span data-stu-id="a3c91-242">Observe that the record is updated in the Northwind database first.</span></span> <span data-ttu-id="a3c91-243">Lorsque l'orchestration tente de mettre à jour la base de données BTSCompensationSampleMailingList par la suite, la mise à jour échoue car cette base de données est détachée.</span><span class="sxs-lookup"><span data-stu-id="a3c91-243">Then, when the orchestration tries to update the BTSCompensationSampleMailingList database, because that database is detached, the update fails.</span></span> <span data-ttu-id="a3c91-244">Une exception est donc générée et l'exécution de l'action de compensation en vue de la réécriture des données client d'origine dans la base de données Northwind intervient après un délai de dix secondes.</span><span class="sxs-lookup"><span data-stu-id="a3c91-244">Therefore, an exception is raised and there is a ten-second delay before the compensation action takes place to write the original customer data back to the Northwind database.</span></span>  
  
        > [!NOTE]
        >  <span data-ttu-id="a3c91-245">Vous risquez d'obtenir une erreur « Échec de la connexion pour l'utilisateur 'IIS APPPOOL\DefaultAppPool ».</span><span class="sxs-lookup"><span data-stu-id="a3c91-245">You may get a "Login failed for user 'IIS APPPOOL\DefaultAppPool' error.</span></span> <span data-ttu-id="a3c91-246">Cela est peut-être dû à un échec de la validation de l'accès au serveur basé sur les jetons.</span><span class="sxs-lookup"><span data-stu-id="a3c91-246">It might be because of the token-based server access validation failure.</span></span> <span data-ttu-id="a3c91-247">Pour corriger cette erreur, créez un pool d'applications et utilisez le compte d'administrateur dans ce pool.</span><span class="sxs-lookup"><span data-stu-id="a3c91-247">To resolve this error, create a new application pool and use the administrator account in it.</span></span>  
  
## <a name="uninstalling-this-sample"></a><span data-ttu-id="a3c91-248">Désinstallation de l'exemple</span><span class="sxs-lookup"><span data-stu-id="a3c91-248">Uninstalling This Sample</span></span>  
  
#### <a name="to-uninstall-the-compensation-sample"></a><span data-ttu-id="a3c91-249">Pour désinstaller l'exemple Compensation</span><span class="sxs-lookup"><span data-stu-id="a3c91-249">To uninstall the Compensation sample</span></span>  
  
1.  <span data-ttu-id="a3c91-250">Dans une fenêtre de commande [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)], accédez au dossier suivant :</span><span class="sxs-lookup"><span data-stu-id="a3c91-250">In a [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)] command window, navigate to the following folder:</span></span>  
  
     <span data-ttu-id="a3c91-251">\<*Exemples de chemin d’accès*> \Orchestrations\Compensation\\</span><span class="sxs-lookup"><span data-stu-id="a3c91-251">\<*Samples Path*>\Orchestrations\Compensation\\</span></span>  
  
2.  <span data-ttu-id="a3c91-252">Exécutez Cleanup.bat.</span><span class="sxs-lookup"><span data-stu-id="a3c91-252">Run Cleanup.bat.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a3c91-253">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="a3c91-253">See Also</span></span>  
 [<span data-ttu-id="a3c91-254">Orchestrations (dossier d’exemples BizTalk Server)</span><span class="sxs-lookup"><span data-stu-id="a3c91-254">Orchestrations (BizTalk Server Samples Folder)</span></span>](../core/orchestrations-biztalk-server-samples-folder.md)