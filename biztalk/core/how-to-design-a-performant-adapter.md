---
title: Comment concevoir un adaptateur Performant | Documents Microsoft
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: b5a1f338-fd7c-41c8-a181-8da8b293c4cc
caps.latest.revision: "15"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: e7958968809dc224a3446ac81f3f89d08f6128a0
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/20/2017
---
# <a name="how-to-design-a-performant-adapter"></a><span data-ttu-id="79611-102">Conception d'un adaptateur performant</span><span class="sxs-lookup"><span data-stu-id="79611-102">How to Design a Performant Adapter</span></span>
<span data-ttu-id="79611-103">Pour obtenir des performances optimales, l'ensemble des adaptateurs doivent reconnaître les lots en ce qui concerne l'envoi des lots de messages, leur transmission, et généralement l'exécution d'opérations sur les messages des lots.</span><span class="sxs-lookup"><span data-stu-id="79611-103">For performance purposes all adapters should be batch-aware with regard to submitting batches of messages, transmitting batches, and generally performing operations on messages in batches.</span></span> <span data-ttu-id="79611-104">Les adaptateurs doivent essayer d'exposer des attributs de performance configurables (par exemple, la taille des lots ou le nombre d'octets d'un lot) à partir de l'interface utilisateur de conception de l'adaptateur.</span><span class="sxs-lookup"><span data-stu-id="79611-104">Adapters should try to expose configurable performance-related attributes, such as the size of batches or the number of bytes in a batch, that are configurable from the adapter's design-time user interface.</span></span>  
  
 <span data-ttu-id="79611-105">Comme indiqué précédemment, les adaptateurs d'envoi doivent toujours effectuer des envois non bloquants afin d'éviter de dégrader les performances de l'hôte d'envoi.</span><span class="sxs-lookup"><span data-stu-id="79611-105">As mentioned earlier, send adapters should always perform non-blocking sends to avoid degrading the performance of the send host.</span></span> <span data-ttu-id="79611-106">Le blocage des API du moteur de messagerie est déconseillé.</span><span class="sxs-lookup"><span data-stu-id="79611-106">Further blocking of Messaging Engine APIs is not recommended.</span></span>  
  
 <span data-ttu-id="79611-107">L'écriture et la lecture à partir du contexte de message affecte les performances d'exécution.</span><span class="sxs-lookup"><span data-stu-id="79611-107">Writing to and reading from the message context affects run-time performance.</span></span> <span data-ttu-id="79611-108">En général, les adaptateurs doivent éviter de lire, écrire et promouvoir un nombre excessif de propriétés de contexte de message.</span><span class="sxs-lookup"><span data-stu-id="79611-108">In general, adapters should avoid reading, writing, and promoting excessive numbers of message-context properties.</span></span> <span data-ttu-id="79611-109">La promotion des propriétés affecte également les performances en raison de l'évaluation de l'abonnement qui se produit sur chaque propriété promue au moment de l'exécution.</span><span class="sxs-lookup"><span data-stu-id="79611-109">Promoting properties creates an additional performance drain because of the subscription evaluation that occurs on each promoted property at run time.</span></span> <span data-ttu-id="79611-110">Toutefois, il faut que le nombre de propriétés concernées soit très élevé pour que cela affecte les performances de manière significative.</span><span class="sxs-lookup"><span data-stu-id="79611-110">However, an adapter would need to promote a huge number of properties to noticeably impact performance.</span></span> <span data-ttu-id="79611-111">Il est donc conseillé de promouvoir uniquement les propriétés qui doivent impérativement l'être.</span><span class="sxs-lookup"><span data-stu-id="79611-111">Still it is a good practice to promote only those properties that are required to be promoted.</span></span>  
  
## <a name="throttle-send-and-receive"></a><span data-ttu-id="79611-112">Limiter l'envoi et la réception</span><span class="sxs-lookup"><span data-stu-id="79611-112">Throttle Send and Receive</span></span>  
 <span data-ttu-id="79611-113">Lorsque la charge sur le moteur BizTalk dépasse le seuil configuré, le moteur limite les adaptateurs et les orchestrations afin de garantir des performances optimales.</span><span class="sxs-lookup"><span data-stu-id="79611-113">When the load on the BizTalk engine exceeds the configured threshold, the engine throttles adapters and orchestrations to ensure optimum performance.</span></span> <span data-ttu-id="79611-114">Du côté réception, lorsque la charge de travail sur le moteur dépasse un seuil donné, l’appel de l’adaptateur à **IBTTransportBatch.Done** est bloquée jusqu'à ce que la charge a pas suffisamment diminué.</span><span class="sxs-lookup"><span data-stu-id="79611-114">On the receive side, when the workload on the engine exceeds a given threshold, the adapter's call to **IBTTransportBatch.Done** is blocked until the load has decreased sufficiently.</span></span> <span data-ttu-id="79611-115">Cela oblige l'adaptateur à n'envoyer de nouvelles tâches dans le moteur que lorsque celui-ci est disponible.</span><span class="sxs-lookup"><span data-stu-id="79611-115">This forces the adapter to submit new work into the engine only when the engine is available.</span></span> <span data-ttu-id="79611-116">Au niveau de l'envoi, lorsque le moteur limite l'envoi de messages sortants par les adaptateurs, il ne remet pas de nouveau message à transmettre tant que la charge n'a pas diminué.</span><span class="sxs-lookup"><span data-stu-id="79611-116">On the send side, when the engine is throttling adapters sending outbound messages, the engine does not deliver new messages to be transmitted until its load is reduced.</span></span>  
  
 <span data-ttu-id="79611-117">Pour ces raisons, l'adaptateur ne doit pas être concerné par la limitation sauf si cela s'avère nécessaire, par exemple, pour limiter le nombre de connexions au système principal.</span><span class="sxs-lookup"><span data-stu-id="79611-117">For these reasons, the adapter does not need to be concerned with throttling unless it is required, for example, to limit the number of connections to a back-end system.</span></span> <span data-ttu-id="79611-118">Ces types de scénario ne sont pas pris en charge par le moteur ou l'infrastructure d'adaptateurs.</span><span class="sxs-lookup"><span data-stu-id="79611-118">For these types of scenarios, neither the engine nor the Adapter Framework provides any support.</span></span>  
  
 <span data-ttu-id="79611-119">Vous pouvez gérer la limitation du nombre de messages envoyés à partir d'un adaptateur d'envoi personnalisé de plusieurs manières, selon que vous contrôlez ou non le code source de celui-ci.</span><span class="sxs-lookup"><span data-stu-id="79611-119">You can handle throttling the number of messages sent from a custom send adapter in several ways depending on whether you control the source code for the adapter.</span></span>  
  
### <a name="send-side-throttling-improves-performance"></a><span data-ttu-id="79611-120">La limitation au niveau envoi améliore les performances</span><span class="sxs-lookup"><span data-stu-id="79611-120">Send-Side Throttling Improves Performance</span></span>  
 <span data-ttu-id="79611-121">Si vous contrôlez le code source de l'adaptateur, vous pouvez, à partir des heuristiques, déterminer le nombre maximal de messages dans la file d'attente à envoyer à tout moment.</span><span class="sxs-lookup"><span data-stu-id="79611-121">If you control the source code for the adapter, you can determine from heuristics the maximum number of messages that you want to have in the queue to send at any time.</span></span> <span data-ttu-id="79611-122">Lorsque le moteur de messagerie appelle la `TransmitMessage` méthode et passe l’adaptateur d’envoi un nouveau message, que vous pouvez choisir de bloquer le thread ou une vérification pour voir si le nombre de messages dans la file d’attente est supérieur à la valeur maximale que vous avez précédemment.</span><span class="sxs-lookup"><span data-stu-id="79611-122">When the Messaging Engine calls the `TransmitMessage` method and passes the send adapter a new message, you can choose to either block the thread or check to see if the number of messages in the queue is larger than the maximum value you determined previously.</span></span> <span data-ttu-id="79611-123">Si le nombre maximal de messages a été dépassé, vous pouvez utiliser la `Resubmit` méthode pour renvoyer le message au moteur de messagerie.</span><span class="sxs-lookup"><span data-stu-id="79611-123">If the maximum number of messages has been exceeded, you can use the `Resubmit` method to resubmit the message to the Messaging Engine.</span></span> <span data-ttu-id="79611-124">Notez que si l'adaptateur est synchrone, le message est déjà bloqué.</span><span class="sxs-lookup"><span data-stu-id="79611-124">Note that if the adapter is synchronous, the message would already be blocked.</span></span>  
  
 <span data-ttu-id="79611-125">Si vous ne contrôlez pas le code source pour l’adaptateur, vous pouvez modifier le nombre de messages en file d’attente en modifiant le **Highwatermark** valeur dans la table Adm_serviceclass de la base de données de gestion BizTalk.</span><span class="sxs-lookup"><span data-stu-id="79611-125">If you do not control the source code for the adapter, you can change the number of queued messages by changing the **Highwatermark** value in the Adm_serviceclass table in the BizTalk Management database.</span></span> <span data-ttu-id="79611-126">La valeur maximale pour le **Highwatermark** propriété est 200.</span><span class="sxs-lookup"><span data-stu-id="79611-126">The maximum value for the **Highwatermark** property is 200.</span></span> <span data-ttu-id="79611-127">Vous pouvez également modifier la valeur de la **limite inférieure** propriété à une valeur inférieure.</span><span class="sxs-lookup"><span data-stu-id="79611-127">You can also change the value for the **Lowwatermark** property to a smaller value.</span></span>  
  
 <span data-ttu-id="79611-128">N’oubliez pas que la valeur de la **Highwatermark** propriété pour les comptes d’adaptateurs asynchrones pour le nombre de messages que le moteur de messagerie a donné à l’adaptateur.</span><span class="sxs-lookup"><span data-stu-id="79611-128">Remember that the value of the **Highwatermark** property for asynchronous adapters accounts for the number of messages that the Messaging Engine has given to the adapter.</span></span> <span data-ttu-id="79611-129">Le moteur de messagerie les transmet à l’adaptateur via la `TransmitMessage` (méthode), ces messages peuvent être en attente de leur transmission, par exemple, si l’adaptateur n’a pas effectué un appel correspondant à la `DeleteMessage`, `Resubmit`, `MoveToNextTransport` , ou [Microsoft.BizTalk.TransportProxy.Interop.BatchOperationType.MoveToSuspendQ](http://msdn.microsoft.com/library/microsoft.biztalk.transportproxy.interop.batchoperationtype.aspx) méthodes.</span><span class="sxs-lookup"><span data-stu-id="79611-129">The Messaging Engine passes them to the adapter through the `TransmitMessage` method, These messages can be still outstanding in their transmission—for example, if the adapter has not made a corresponding call to the `DeleteMessage`, `Resubmit`, `MoveToNextTransport`, or [Microsoft.BizTalk.TransportProxy.Interop.BatchOperationType.MoveToSuspendQ](http://msdn.microsoft.com/library/microsoft.biztalk.transportproxy.interop.batchoperationtype.aspx) methods.</span></span> <span data-ttu-id="79611-130">Pour les adaptateurs synchrones, le **Highwatermark** propriété uniquement des comptes pour le nombre de messages, le moteur de messagerie a passé à l’adaptateur à l’aide du **TransmitMessage** (méthode), car cet appel traite de façon synchrone, bloquer le thread appelant de moteur de messagerie.</span><span class="sxs-lookup"><span data-stu-id="79611-130">For synchronous adapters, the **Highwatermark** property only accounts for the number of messages the Messaging Engine has passed to the adapter by using the **TransmitMessage** method because this call processes synchronously, blocking the calling Messaging Engine thread.</span></span>  
  
 <span data-ttu-id="79611-131">Si vous écrivez un adaptateur d'envoi pour un protocole lent par nature (tels que HTTP, FTP ou SOAP bidirectionnel), prenez en compte les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="79611-131">If you are writing a send adapter for a protocol that is inherently slow in nature (such as HTTP, FTP, or two-way SOAP), consider the following:</span></span>  
  
-   <span data-ttu-id="79611-132">Un adaptateur de ce type peut recevoir des messages pour transmission provenant du moteur de messagerie BizTalk plus rapidement qu'il ne peut les transmettre.</span><span class="sxs-lookup"><span data-stu-id="79611-132">Such an adapter might receive messages for transmission from the BizTalk Messaging Engine faster than it can transmit them.</span></span> <span data-ttu-id="79611-133">Cet écart génère des problèmes à plusieurs niveaux.</span><span class="sxs-lookup"><span data-stu-id="79611-133">This discrepancy causes problems at various levels.</span></span> <span data-ttu-id="79611-134">Les messages en cours de transmission restent en mémoire et utilisent de la mémoire virtuelle, ce qui ralentit l'ensemble du système.</span><span class="sxs-lookup"><span data-stu-id="79611-134">The messages under transmission remain in memory and take up the virtual memory, slowing down the entire system.</span></span>  
  
-   <span data-ttu-id="79611-135">L'adaptateur peut utiliser des ressources spécifiques au protocole.</span><span class="sxs-lookup"><span data-stu-id="79611-135">The adapter might take up protocol-specific resources.</span></span> <span data-ttu-id="79611-136">Par exemple, il peut ouvrir un trop grand nombre de connexions simultanées au serveur, ce qui peut perturber le serveur distant.</span><span class="sxs-lookup"><span data-stu-id="79611-136">For example, it might open too many concurrent connections to the server, which could disrupt the remote server.</span></span>  
  
-   <span data-ttu-id="79611-137">L'adaptateur peut affecter d'autres adaptateurs.</span><span class="sxs-lookup"><span data-stu-id="79611-137">The adapter might affect other adapters.</span></span> <span data-ttu-id="79611-138">Par exemple, si un nombre trop élevé de messages se trouvent dans la file d'attente d'un adaptateur spécifique, le moteur de messagerie arrête l'émission des requêtes vers d'autres adaptateurs d'envoi de ce processus.</span><span class="sxs-lookup"><span data-stu-id="79611-138">For example, if too many messages queue up for a particular adapter, the Messaging Engine stops issuing requests to other send adapters in that process.</span></span>  
  
 <span data-ttu-id="79611-139">L'une des solutions consiste à placer les adaptateurs lents et rapides dans des hôtes BizTalk distincts et à contrôler le nombre de messages à l'aide des paramètres « High Watermark » et « Low Watermark ».</span><span class="sxs-lookup"><span data-stu-id="79611-139">A solution is to put the slow and fast adapters in separate BizTalk Hosts and control the number of messages by using the "High Watermark" and "Low Watermark" settings.</span></span>  
  
### <a name="receive-side-throttling-improves-performance"></a><span data-ttu-id="79611-140">La limitation au niveau réception améliore les performances</span><span class="sxs-lookup"><span data-stu-id="79611-140">Receive-Side Throttling Improves Performance</span></span>  
 <span data-ttu-id="79611-141">Il existe de nombreux cas dans lesquels un adaptateur de réception reçoit des messages plus rapidement que le débit auquel le reste du système peut les traiter.</span><span class="sxs-lookup"><span data-stu-id="79611-141">There are numerous situations in which a receive adapter receives messages faster than the rate at which the rest of the system can process the messages.</span></span> <span data-ttu-id="79611-142">Dans ce cas, les messages sont mis en file d'attente dans la base de données MessageBox.</span><span class="sxs-lookup"><span data-stu-id="79611-142">When such a situation occurs, the MessageBox database becomes backlogged.</span></span> <span data-ttu-id="79611-143">Lorsque cela se produit, les performances de l'ensemble du système se dégradent de manière significative.</span><span class="sxs-lookup"><span data-stu-id="79611-143">When this happens, the performance of the whole system drops dramatically.</span></span>  
  
 <span data-ttu-id="79611-144">Si cela se produit avec votre adaptateur, vous pouvez utiliser l'une des techniques suivantes pour réduire la vitesse de l'adaptateur de réception :</span><span class="sxs-lookup"><span data-stu-id="79611-144">If this is happening with your adapter, you can use one of the following techniques to reduce the speed of the receive adapter:</span></span>  
  
-   <span data-ttu-id="79611-145">Réduire la taille de la réserve de threads du moteur de messagerie.</span><span class="sxs-lookup"><span data-stu-id="79611-145">Reduce the Messaging Engine thread pool size.</span></span> <span data-ttu-id="79611-146">Vous pouvez contrôler le nombre de threads que le moteur de messagerie utilise pour publier les messages dans la base de données MessageBox.</span><span class="sxs-lookup"><span data-stu-id="79611-146">You can control the number of threads that the Messaging Engine uses to publish messages into the MessageBox.</span></span> <span data-ttu-id="79611-147">En réduisant le nombre de threads, vous réduisez la vitesse à la quelle l'adaptateur de réception reçoit les messages dans la base de données MessageBox.</span><span class="sxs-lookup"><span data-stu-id="79611-147">By reducing the number of threads, you reduce the rate at which the receive adapter receives messages into the MessageBox.</span></span> <span data-ttu-id="79611-148">Vous devez effectuer ce paramétrage uniquement pour l'hôte correspondant au gestionnaire de réception de l'adaptateur.</span><span class="sxs-lookup"><span data-stu-id="79611-148">This setting only needs to be done for the host corresponding to the receive handler for the adapter.</span></span> <span data-ttu-id="79611-149">Vous ne devez pas le faire pour celui correspondant au gestionnaire d'envoi de l'adaptateur, excepté si vous souhaitez ralentir également l'adaptateur d'envoi.</span><span class="sxs-lookup"><span data-stu-id="79611-149">You should not set this for the host corresponding to the send handler for the adapter, unless you want to slow down the send adapter as well.</span></span>  
  
-   <span data-ttu-id="79611-150">Réduire la taille de lot de l'adaptateur.</span><span class="sxs-lookup"><span data-stu-id="79611-150">Reduce the adapter batch size.</span></span> <span data-ttu-id="79611-151">La plupart des adaptateurs de réception rapides publient les messages dans la base de données MessageBox par lots.</span><span class="sxs-lookup"><span data-stu-id="79611-151">Most fast receive adapters publish messages to the MessageBox in batches.</span></span> <span data-ttu-id="79611-152">La taille de ces lots est généralement configurable dans la page de propriétés de l'emplacement de réception.</span><span class="sxs-lookup"><span data-stu-id="79611-152">The size of these batches is usually configurable in the receive location property page.</span></span> <span data-ttu-id="79611-153">La réduction de la taille de lot vous permet de diminuer le débit global des messages entrant dans le système.</span><span class="sxs-lookup"><span data-stu-id="79611-153">By decreasing the batch size you can decrease the overall throughput of messages coming into the system.</span></span>  
  
-   <span data-ttu-id="79611-154">Modifier d'autres paramètres spécifiques à l'adaptateur.</span><span class="sxs-lookup"><span data-stu-id="79611-154">Change other adapter-specific settings.</span></span> <span data-ttu-id="79611-155">Une fois les deux premières étapes terminées, vous pouvez essayer d'ajuster d'autres paramètres afin de réduire encore davantage le débit.</span><span class="sxs-lookup"><span data-stu-id="79611-155">After you complete the two previous steps, you can try adjusting other adapter parameters to further decrease throughput.</span></span> <span data-ttu-id="79611-156">Certains adaptateurs exposent des paramètres internes permettant de réduire le débit.</span><span class="sxs-lookup"><span data-stu-id="79611-156">Some adapters expose internal parameters that can be used to decrease throughput.</span></span> <span data-ttu-id="79611-157">Par exemple, l'adaptateur MQSeries est doté du paramètre « Livraison chronologique des messages ».</span><span class="sxs-lookup"><span data-stu-id="79611-157">For example, the MQSeries adapter has a setting for “Ordered Delivery.”</span></span> <span data-ttu-id="79611-158">La livraison chronologique indique que l'adaptateur publiera un lot de messages, attendra qu'il se termine, puis publiera le lot suivant.</span><span class="sxs-lookup"><span data-stu-id="79611-158">Ordered Delivery specifies that the adapter will publish a batch of messages, wait for it to complete, and then publish the next batch.</span></span> <span data-ttu-id="79611-159">En activant ce paramètre, vous supprimez essentiellement tout parallélisme provenant de l'adaptateur de réception.</span><span class="sxs-lookup"><span data-stu-id="79611-159">By enabling this setting, you essentially remove all parallelism from the receive adapter.</span></span> <span data-ttu-id="79611-160">Inversement, la désactivation de ces paramètres permet d'augmenter la vitesse de réception d'un adaptateur de réception.</span><span class="sxs-lookup"><span data-stu-id="79611-160">Conversely, tuning the parameters in the opposite way can be used to increase the receiving rate of a receive adapter.</span></span>  
  
 <span data-ttu-id="79611-161">Un adaptateur peut envoyer autant de lots que nécessaire au proxy de transport.</span><span class="sxs-lookup"><span data-stu-id="79611-161">An adapter can submit as many batches as required to the transport proxy.</span></span> <span data-ttu-id="79611-162">Lorsque le système est trop fortement sollicitée, un appel à la **fait** méthode de la **IBTTransportBatch** interface bloque le message jusqu'à ce que les ressources nécessaires sont publiées dans le système.</span><span class="sxs-lookup"><span data-stu-id="79611-162">When the system is heavily stressed, a call to the **Done** method of the **IBTTransportBatch** interface will block the message until the required resources are released to the system.</span></span>  
  
## <a name="plan-for-asynchronous-receive-and-send"></a><span data-ttu-id="79611-163">Planifier l'envoi et la réception asynchrones</span><span class="sxs-lookup"><span data-stu-id="79611-163">Plan for Asynchronous Receive and Send</span></span>  
 <span data-ttu-id="79611-164">Les API de messagerie de BizTalk Server prennent en charge la programmation asynchrone.</span><span class="sxs-lookup"><span data-stu-id="79611-164">The BizTalk Server messaging APIs have rich support for asynchronous programming.</span></span> <span data-ttu-id="79611-165">Si vous souhaitez écrire un adaptateur évolutif, prévoyez d'utiliser dès le début un modèle asynchrone car celui-ci fournit un meilleur accès concurrentiel.</span><span class="sxs-lookup"><span data-stu-id="79611-165">If you want to write a scalable adapter, plan on using the asynchronous model from the start because the asynchronous model provides better concurrency.</span></span>  
  
 <span data-ttu-id="79611-166">Du côté réception, lorsqu’un adaptateur envoie un lot de messages au moteur de messagerie BizTalk (en appelant **IBTTransportBatch::Done**), le moteur de messagerie des files d’attente en utilisant sa réserve de threads et retourne immédiatement.</span><span class="sxs-lookup"><span data-stu-id="79611-166">On the receive side, when an adapter submits a batch of messages to the BizTalk Messaging Engine (by calling **IBTTransportBatch::Done**), the Messaging Engine queues up the work using its internal thread pool and returns immediately.</span></span> <span data-ttu-id="79611-167">Le moteur traite les messages sur un autre thread, ce qui permet à l'adaptateur de lire davantage de messages à partir de sa source et de les envoyer sans avoir à attendre que le traitement des messages précédents soit terminé.</span><span class="sxs-lookup"><span data-stu-id="79611-167">The engine processes the messages on a separate thread, leaving the adapter free to read more messages from its source and submit them without waiting for the previous message processing to complete.</span></span>  
  
 <span data-ttu-id="79611-168">Au niveau envoi, votre adaptateur peut être asynchrone ou synchrone.</span><span class="sxs-lookup"><span data-stu-id="79611-168">On the send side, your adapter can be either asynchronous or synchronous.</span></span> <span data-ttu-id="79611-169">Toutefois, si votre protocole prend en charge des opérations asynchrones, vous devez utiliser cette prise en charge pour écrire un adaptateur évolutif.</span><span class="sxs-lookup"><span data-stu-id="79611-169">However, if your protocol supports asynchronous operations, you should use this support to write a scalable adapter.</span></span> <span data-ttu-id="79611-170">Par exemple, les adaptateurs d'envoi File et HTTP sont totalement asynchrones et effectuent très peu d'opérations de blocage/asynchrones.</span><span class="sxs-lookup"><span data-stu-id="79611-170">For example, File and HTTP send adapters are fully asynchronous and they perform very few blocking/synchronous operations.</span></span>  
  
 <span data-ttu-id="79611-171">Les opération asynchrones garantissent que le moteur de messagerie et votre adaptateur continueront à traiter leurs opérations respectives en parallèle et ne s'attendront pas l'un l'autre pour le traitement normal des messages.</span><span class="sxs-lookup"><span data-stu-id="79611-171">Asynchronous operations ensure that both the Messaging Engine and your adapter will continue to do their respective work in parallel and not wait on each other for normal message processing.</span></span>  
  
## <a name="use-batching-to-improve-performance"></a><span data-ttu-id="79611-172">Utiliser le traitement par lot pour améliorer les performances</span><span class="sxs-lookup"><span data-stu-id="79611-172">Use Batching to Improve Performance</span></span>  
 <span data-ttu-id="79611-173">Le traitement par lot est le meilleur point de départ pour l'écriture d'un adaptateur évolutif.</span><span class="sxs-lookup"><span data-stu-id="79611-173">Batching is the best starting point for writing a scalable adapter.</span></span> <span data-ttu-id="79611-174">Cela se vérifie à la fois pour les adaptateurs au niveau réception et au niveau envoi.</span><span class="sxs-lookup"><span data-stu-id="79611-174">This is true for both send-side and receive-side adapters.</span></span> <span data-ttu-id="79611-175">Chaque lot est soumis à une transaction de base de données dans BizTalk Server, même si votre adaptateur n'est pas transactionnel.</span><span class="sxs-lookup"><span data-stu-id="79611-175">Every batch goes through a database transaction within BizTalk Server even if your adapter is nontransactional.</span></span> <span data-ttu-id="79611-176">Un délai fixe étant associé à chaque transaction, vous devez faire en sorte de limiter le nombre de transactions en les combinant dans un lot unique.</span><span class="sxs-lookup"><span data-stu-id="79611-176">Because there is a fixed delay associated with each transaction, you should try to minimize the number of transactions by combining more than one operation into a single batch.</span></span>  
  
## <a name="do-not-starve-the-net-thread-pool"></a><span data-ttu-id="79611-177">Ne pas épuiser la réserve de threads .NET</span><span class="sxs-lookup"><span data-stu-id="79611-177">Do Not Starve the .NET Thread Pool</span></span>  
 <span data-ttu-id="79611-178">L'écriture d'adaptateurs BizTalk est une procédure d'écriture du code d'exécution .NET ; l'écriture du code d'exécution .NET est invariablement une procédure de programmation asynchrone.</span><span class="sxs-lookup"><span data-stu-id="79611-178">Writing BizTalk adapters is an exercise in writing .NET runtime code; writing .NET runtime code is invariably an exercise in asynchronous programming.</span></span>  
  
 <span data-ttu-id="79611-179">L'épuisement de la réserve de threads .NET est risqué pour l'ensemble de la programmation asynchrone dans .NET, et il est particulièrement important pour le programmeur d'adaptateur BizTalk de l'éviter.</span><span class="sxs-lookup"><span data-stu-id="79611-179">Starving the .NET thread pool is a risk to all asynchronous programming in .NET, and it is particularly important for the BizTalk adapter programmer to avoid.</span></span>  
  
 <span data-ttu-id="79611-180">La réserve de threads .NET est une ressource limitée mais largement partagée.</span><span class="sxs-lookup"><span data-stu-id="79611-180">The .NET thread pool is a limited but widely shared resource.</span></span> <span data-ttu-id="79611-181">Il est très facile d'écrire du code qui utilise l'un des threads de la réserve et le conserve pendant une longue période, bloquant ainsi l'exécution des autres opérations.</span><span class="sxs-lookup"><span data-stu-id="79611-181">It is easy to write code that uses one of the .NET thread pool threads and holds onto it for long time, blocking other work items from being executed.</span></span>  
  
 <span data-ttu-id="79611-182">Chaque fois que vous utilisez **BeginInvoke** ou utiliser un minuteur, vous utilisez un thread de pool de threads .NET.</span><span class="sxs-lookup"><span data-stu-id="79611-182">Whenever you use **BeginInvoke** or use a timer, you are using a .NET thread pool thread.</span></span> <span data-ttu-id="79611-183">Si vous avez plusieurs éléments de travail à faire (par exemple copier des messages de MQSeries dans BizTalk Server), vous devez exécuter un élément de travail (un lot de messages dans BizTalk Server), puis les remettre dans le pool de threads s’il existe plus de travail à effectuer.</span><span class="sxs-lookup"><span data-stu-id="79611-183">If you have multiple pieces of work to do (for example copying messages out of MQSeries into BizTalk Server), you should execute one work item (one batch of messages into BizTalk Server) and then requeue in the thread pool if there is more work to do.</span></span> <span data-ttu-id="79611-184">Ne placez jamais un `while` boucle sur le thread.</span><span class="sxs-lookup"><span data-stu-id="79611-184">Never sit in a `while` loop on the thread.</span></span>  
  
 <span data-ttu-id="79611-185">Concrètement, cela signifie en remplaçant `while` boucles avec des appels répétés à **BeginInvoke**.</span><span class="sxs-lookup"><span data-stu-id="79611-185">In concrete terms this means replacing `while` loops with repeated calls to **BeginInvoke**.</span></span> <span data-ttu-id="79611-186">Cette simple modification permet d'améliorer considérablement la réactivité et l'évolutivité de l'ensemble de l'implémentation.</span><span class="sxs-lookup"><span data-stu-id="79611-186">This simple change can dramatically improve the responsiveness and scale-out ability for the whole implementation.</span></span>  
  
## <a name="choose-the-right-measurement-when-limiting-batch-size"></a><span data-ttu-id="79611-187">Choisir la mesure appropriée lors de la limitation de la taille de lot</span><span class="sxs-lookup"><span data-stu-id="79611-187">Choose the Right Measurement When Limiting Batch Size</span></span>  
 <span data-ttu-id="79611-188">Si vous envoyez des messages à BizTalk Server par lots, ne limitez pas la taille de lot en fonction du nombre de messages uniquement.</span><span class="sxs-lookup"><span data-stu-id="79611-188">If you are submitting messages to BizTalk Server in batches, do not limit the batch size based only on the message count.</span></span> <span data-ttu-id="79611-189">Considérez ce qui arrive lorsqu’un adaptateur a été configuré pour traiter par lot basé uniquement sur le nombre de messages : si la taille de lot est deux et que l’adaptateur obtient quatre messages de taille de 4 Ko, 8 Ko, 1 Mo et 5 Mo respectivement, le premier lot sera de 12 Ko de taille , et le deuxième lot sera de 6 Mo.</span><span class="sxs-lookup"><span data-stu-id="79611-189">Consider what happens when an adapter has been configured to batch based only on message count: If the batch size is two and the adapter gets four messages of size 4 KB, 8 KB, 1 MB, and 5MB respectively, the first batch will be of size 12 KB, and the second batch will be of size 6 MB.</span></span>  
  
 <span data-ttu-id="79611-190">Le moteur de messagerie BizTalk traitant tous les messages d'un lot unique de manière séquentielle, le deuxième lot dans cet exemple sera traité beaucoup plus lentement que le premier.</span><span class="sxs-lookup"><span data-stu-id="79611-190">Because the BizTalk Messaging Engine processes all messages in a single batch sequentially, the second batch in this example will be processed much more slowly than the first batch.</span></span> <span data-ttu-id="79611-191">Cela réduit considérablement le débit.</span><span class="sxs-lookup"><span data-stu-id="79611-191">This is effectively reducing throughput.</span></span> <span data-ttu-id="79611-192">L'une des méthodes préconisées pour résoudre ce problème consiste à limiter la taille de lot à la fois en fonction du nombre de messages et du nombre total d'octets dans le lot (c'est-à-dire, la taille de lot en octets).</span><span class="sxs-lookup"><span data-stu-id="79611-192">A better way to handle this problem is to batch based on both message count and total bytes in the batch (that is, batch size in bytes).</span></span> <span data-ttu-id="79611-193">Il n'existe pas de nombre magique pour le nombre total d'octets.</span><span class="sxs-lookup"><span data-stu-id="79611-193">There is no magic number for total bytes.</span></span> <span data-ttu-id="79611-194">Cependant, dans un scénario de traitement normal, si la taille de lot dépasse 1 Mo, l'accès concurrentiel et le débit seront faibles.</span><span class="sxs-lookup"><span data-stu-id="79611-194">However, in a normal processing scenario, if the batch size exceeds 1 MB, you will start seeing poor concurrency and throughput.</span></span>  
  
 <span data-ttu-id="79611-195">Généralement, les adaptateurs sont indépendants des messages et ne connaissent pas la taille des message de l'environnement de production.</span><span class="sxs-lookup"><span data-stu-id="79611-195">Generally adapters are message agnostic and they do not know the size of the messages in the production environment.</span></span> <span data-ttu-id="79611-196">La taille des messages entrants est susceptible de varier de manière significative.</span><span class="sxs-lookup"><span data-stu-id="79611-196">The sizes of the incoming messages are likely to vary significantly.</span></span> <span data-ttu-id="79611-197">Par conséquent, limitez toujours la taille de lot en fonction du nombre de messages et du nombre total d'octets.</span><span class="sxs-lookup"><span data-stu-id="79611-197">Because of this, always use message count and total bytes to build the batch.</span></span>