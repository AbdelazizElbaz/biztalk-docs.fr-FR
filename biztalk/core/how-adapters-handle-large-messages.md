---
title: "Comment gérer les Messages volumineux adaptateurs | Documents Microsoft"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: c48671fd-b6cf-4507-92b4-35a4cd135714
caps.latest.revision: "15"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: fccfd1e988dc1395f14d6eb92a980ede184d0e0f
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/20/2017
---
# <a name="how-adapters-handle-large-messages"></a><span data-ttu-id="5f78f-102">Comment les adaptateurs de traiter les Messages volumineux</span><span class="sxs-lookup"><span data-stu-id="5f78f-102">How Adapters Handle Large Messages</span></span>
<span data-ttu-id="5f78f-103">Le moteur de messagerie BizTalk peut traiter des messages très volumineux et n'impose aucune restriction quant à la taille maximale d'un message.</span><span class="sxs-lookup"><span data-stu-id="5f78f-103">The BizTalk Messaging Engine can process very large messages and imposes no restriction on the maximum size of a message.</span></span> <span data-ttu-id="5f78f-104">Vous devez cependant envisager de limiter la taille des messages pour garantir des performances et une gestion des ressources optimales.</span><span class="sxs-lookup"><span data-stu-id="5f78f-104">However, you should consider limits to message size to maintain optimum performance and resource management.</span></span> <span data-ttu-id="5f78f-105">Plus la taille des messages est importante, plus le nombre de messages traités par seconde diminue.</span><span class="sxs-lookup"><span data-stu-id="5f78f-105">As message size increases the number of messages processed per second decreases.</span></span> <span data-ttu-id="5f78f-106">Prenez en compte la taille moyenne des messages, le type de message et le nombre de messages traités par [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] lors de la conception de votre scénario et de la planification de la capacité.</span><span class="sxs-lookup"><span data-stu-id="5f78f-106">Consider the average message size, message type, and number of messages being processed by [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] when designing your scenario and planning for capacity.</span></span>  
  
## <a name="stream-based-processing"></a><span data-ttu-id="5f78f-107">Traitement basé sur un flux de données</span><span class="sxs-lookup"><span data-stu-id="5f78f-107">Stream-Based Processing</span></span>  
 <span data-ttu-id="5f78f-108">Il est important de tenir compte du traitement des messages volumineux lors du développement des adaptateurs.</span><span class="sxs-lookup"><span data-stu-id="5f78f-108">It is important to keep large message handling in mind when developing adapters.</span></span> <span data-ttu-id="5f78f-109">Il est fortement déconseillé de charger l'intégralité du flux de données dans la mémoire indépendamment de sa taille, car ceci risque de causer l'arrêt du processus BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="5f78f-109">Loading the entire data stream into memory regardless of its size is strongly discouraged because this could potentially stop the BizTalk Server process.</span></span> <span data-ttu-id="5f78f-110">Selon la taille et le nombre des messages traités par le moteur à un instant donné, un problème de mémoire virtuelle insuffisante peut se produire.</span><span class="sxs-lookup"><span data-stu-id="5f78f-110">Depending on the size and number of messages that the engine is processing at any given time, low virtual memory could become a problem.</span></span> <span data-ttu-id="5f78f-111">Les messages doivent plutôt être traités en flux continu comme indiqué ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="5f78f-111">Instead, messages should be processed in a streaming fashion as follows:</span></span>  
  
-   <span data-ttu-id="5f78f-112">**Messages entrants.**</span><span class="sxs-lookup"><span data-stu-id="5f78f-112">**Inbound messages.**</span></span> <span data-ttu-id="5f78f-113">pour les messages entrants, le flux réseau est lié au message BizTalk par l'adaptateur de réception, l'« extraction » du flux étant assurée par le moteur de messagerie BizTalk.</span><span class="sxs-lookup"><span data-stu-id="5f78f-113">For inbound messages the network stream is attached to the BizTalk message by the receive adapter leaving the "pulling" of the stream to the BizTalk Messaging Engine.</span></span>  
  
-   <span data-ttu-id="5f78f-114">**Messages sortants.**</span><span class="sxs-lookup"><span data-stu-id="5f78f-114">**Outbound messages.**</span></span> <span data-ttu-id="5f78f-115">pour les messages sortants, l'adaptateur assure l'extraction du flux.</span><span class="sxs-lookup"><span data-stu-id="5f78f-115">For outbound messages the adapter is responsible for pulling the stream.</span></span> <span data-ttu-id="5f78f-116">Le flux est effectivement extrait de la base de données MessageBox et passe par le pipeline d'envoi.</span><span class="sxs-lookup"><span data-stu-id="5f78f-116">This effectively pulls the stream from the MessageBox database and though the send pipeline.</span></span> <span data-ttu-id="5f78f-117">L'adaptateur doit transférer les données sur le réseau en un flux continu.</span><span class="sxs-lookup"><span data-stu-id="5f78f-117">The adapter should send the data over the wire in a streaming fashion.</span></span>  
  
 <span data-ttu-id="5f78f-118">L'illustration suivante représente le traitement basé sur le flux sur le côté réception du moteur de messagerie.</span><span class="sxs-lookup"><span data-stu-id="5f78f-118">The following figure shows stream-based processing on the receive side of the Messaging Engine.</span></span>  
  
 ![](../core/media/streambasedprocessing.gif "Streambasedprocessing")  
  
 <span data-ttu-id="5f78f-119">Lorsqu'un adaptateur envoie un message au moteur, il doit lier son flux de données au message BizTalk.</span><span class="sxs-lookup"><span data-stu-id="5f78f-119">When an adapter submits a message to the engine it should attach its data stream to the BizTalk message.</span></span> <span data-ttu-id="5f78f-120">Pour certains adaptateurs, cela peut signifier l'implémentation d'un flux réseau.</span><span class="sxs-lookup"><span data-stu-id="5f78f-120">For some adapters this may mean implementing a network stream.</span></span> <span data-ttu-id="5f78f-121">Lorsque le message est envoyé, le moteur exécute le pipeline de réception.</span><span class="sxs-lookup"><span data-stu-id="5f78f-121">When the message is submitted, the engine executes the receive pipeline.</span></span> <span data-ttu-id="5f78f-122">Lors de l'exécution du pipeline, les composants de pipeline qui veulent modifier les données clonent le message, en raccordant le flux provenant du nouveau message au flux du message précédent.</span><span class="sxs-lookup"><span data-stu-id="5f78f-122">During pipeline execution, the pipeline components that want to change the data clone the message, wiring up the stream from the new message to the stream on the previous message.</span></span> <span data-ttu-id="5f78f-123">Une fois le pipeline exécuté, le moteur de messagerie extrait un message du pipeline et exécute une boucle en lisant le flux de ce message.</span><span class="sxs-lookup"><span data-stu-id="5f78f-123">After the pipeline has been executed, the Messaging Engine takes a message out of the pipeline and executes a loop reading the stream on that message.</span></span> <span data-ttu-id="5f78f-124">Cette lecture du flux appelle une lecture sur le flux précédent, qui à son tour appelle une lecture sur le flux précédent, et ainsi de suite jusqu'au flux réseau.</span><span class="sxs-lookup"><span data-stu-id="5f78f-124">This reading of the stream invokes a read on the previous stream, which in turn invokes a read on the previous stream, and so on back to the network stream.</span></span> <span data-ttu-id="5f78f-125">Le moteur purge régulièrement les données transmises à la base de données MessageBox pour garantir une gestion linéaire de la mémoire (« flat memory model »).</span><span class="sxs-lookup"><span data-stu-id="5f78f-125">The engine periodically flushes the data to the MessageBox to maintain a flat memory model.</span></span>  
  
 <span data-ttu-id="5f78f-126">**Conseil de dépannage :** côté envoi, l’adaptateur est responsable de la lecture du flux.</span><span class="sxs-lookup"><span data-stu-id="5f78f-126">**Troubleshooting Tip:** On the send side, the adapter is responsible for reading the stream.</span></span> <span data-ttu-id="5f78f-127">Si l'adaptateur d'envoi veut lire des propriétés de contexte de message qui sont promues ou écrites dans le pipeline d'envoi, ces propriétés risquent de ne pas être écrites tant que l'intégralité du flux n'a pas été lue.</span><span class="sxs-lookup"><span data-stu-id="5f78f-127">If the send adapter wants to read any message context properties that are promoted or written in the send pipeline, these properties may not be written until the entire stream is read.</span></span> <span data-ttu-id="5f78f-128">C'est seulement une fois que le flux a été intégralement lu que l'adaptateur peut avoir l'assurance que tous les composants de pipeline ont été exécutés.</span><span class="sxs-lookup"><span data-stu-id="5f78f-128">Only when the stream has been completely read can the adapter be sure that all of the pipeline components have finished executing.</span></span>  
  
## <a name="locating-a-specific-byte-in-the-stream"></a><span data-ttu-id="5f78f-129">Recherche d'un octet spécifique dans le flux</span><span class="sxs-lookup"><span data-stu-id="5f78f-129">Locating a Specific Byte in the Stream</span></span>  
 <span data-ttu-id="5f78f-130">Dans certains cas, un adaptateur peut avoir besoin de rechercher le flux en remontant jusqu'à son début pour traiter des messages dont la transmission a échoué et qui doivent être suspendus.</span><span class="sxs-lookup"><span data-stu-id="5f78f-130">There are scenarios in which an adapter may need to locate the stream back to the beginning to handle failed messages that need to be suspended.</span></span> <span data-ttu-id="5f78f-131">Il peut s'agir, par exemple, d'un adaptateur HTTP qui reçoit des données en utilisant un codage mémorisé en boc pour envoyer le message de réponse dans une paire sollicitation-réponse.</span><span class="sxs-lookup"><span data-stu-id="5f78f-131">An example of this is an HTTP adapter that is receiving data using chunked encoding to submit the response message in a solicit-response pair.</span></span>  
  
 <span data-ttu-id="5f78f-132">Toutefois, dans un grand nombre de cas, vous risquez de ne pas pouvoir réaliser le suivi du flux de données.</span><span class="sxs-lookup"><span data-stu-id="5f78f-132">However, in many scenarios you may not be able to trace the data stream.</span></span> <span data-ttu-id="5f78f-133">Par exemple, considérons un adaptateur HTTP qui reçoit les données avec un codage mémorisé en bloc.</span><span class="sxs-lookup"><span data-stu-id="5f78f-133">For example, consider an HTTP adapter receiving data using chunked encoding.</span></span> <span data-ttu-id="5f78f-134">Pour que le flux de données soit conçu de manière à vous permettre de trouver les messages en échec, l'adaptateur devrait mettre les données en cache à mesure qu'il les lit, dans la mémoire ou sur disque.</span><span class="sxs-lookup"><span data-stu-id="5f78f-134">For the data stream to be designed so you can find the messages that failed, the adapter would need to cache the data as it is read, either in memory or onto disk.</span></span> <span data-ttu-id="5f78f-135">Cette méthode ne semble évidemment pas optimale et requiert des ressources supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="5f78f-135">Clearly this is not optimal and requires additional resources.</span></span> <span data-ttu-id="5f78f-136">De plus, un grand nombre de composants de pipeline standard fonctionnent selon un mode de transmission continue vers l'avant uniquement.</span><span class="sxs-lookup"><span data-stu-id="5f78f-136">Further, many of the out-of-the-box pipeline components operate in a forward-only streaming fashion.</span></span> <span data-ttu-id="5f78f-137">Pour ces scénarios, l’adaptateur BaseAdapter du Kit de développement logiciel utilise une classe helper appelée **VirtualStream**.</span><span class="sxs-lookup"><span data-stu-id="5f78f-137">For these scenarios the BaseAdapter in the SDK uses a helper class called **VirtualStream**.</span></span> <span data-ttu-id="5f78f-138">Le fichier contenant cette fonctionnalité se nomme VirtualStream.cs.</span><span class="sxs-lookup"><span data-stu-id="5f78f-138">The file that contains this functionality is named VirtualStream.cs.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="5f78f-139">Le fichier VirtualStream.cs est situé à deux emplacements sous Pipelines SDK Samples : SDK\Samples\Pipelines\ArbitraryXPathPropertyHandler et SDK\Samples\Pipelines\SchemaResolverComponent\SchemaResolverFlatFileDasm.</span><span class="sxs-lookup"><span data-stu-id="5f78f-139">The VirtualStream.cs file is located in two locations under the Pipelines SDK Samples—SDK\Samples\Pipelines\ArbitraryXPathPropertyHandler and SDK\Samples\Pipelines\SchemaResolverComponent\SchemaResolverFlatFileDasm.</span></span>  
  
 <span data-ttu-id="5f78f-140">Le principe du flux virtuel est que les données du flux sont mises en cache dans un flux de mémoire jusqu'à ce qu'elles atteignent un seuil déterminé au-delà duquel les données en excédent sont transférées vers un emplacement sécurisé sur le disque.</span><span class="sxs-lookup"><span data-stu-id="5f78f-140">The idea behind a virtual stream is that the data in the stream is cached in a memory stream until it reaches a threshold, over which the data is overflowed to a secure location on disk.</span></span> <span data-ttu-id="5f78f-141">Après la fermeture du flux, le fichier disque est automatiquement supprimé.</span><span class="sxs-lookup"><span data-stu-id="5f78f-141">After the stream is closed the disk file is automatically deleted.</span></span> <span data-ttu-id="5f78f-142">Les flux vers l'avant uniquement peuvent être conçus de cette manière.</span><span class="sxs-lookup"><span data-stu-id="5f78f-142">Forward-only streams can be designed in this way.</span></span>