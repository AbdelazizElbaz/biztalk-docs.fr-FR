---
title: "Étape 3 a : recevoir une Notification d’opportunité de Salesforce dans BizTalk Server | Documents Microsoft"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: be9de6e3-6bd9-4275-b2fb-0a756c51aabf
caps.latest.revision: "6"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 76ab28e8e70c0b8a222f6772a763a93252f2c413
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/20/2017
---
# <a name="step-3a-receive-salesforce-opportunity-notification-into-biztalk-server"></a><span data-ttu-id="954e2-102">Étape 3 a : recevoir une Notification d’opportunité de Salesforce dans BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="954e2-102">Step 3a: Receive Salesforce Opportunity Notification into BizTalk Server</span></span>
<span data-ttu-id="954e2-103">Dans cette étape, nous commençons la création d'un serveur [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="954e2-103">In this step, we start creating a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span></span> <span data-ttu-id="954e2-104">Nous devons d'abord comprendre le schéma de message pour le message de notification des opportunités que nous recevrons de Salesforce et, ensuite, commencer à créer une orchestration pour traiter le message.</span><span class="sxs-lookup"><span data-stu-id="954e2-104">We should first include the message schema for the opportunities notification message that we’ll get from Salesforce and then start creating an orchestration to process the message.</span></span>  
  
### <a name="to-include-the-salesforce-opportunities-notification-schema"></a><span data-ttu-id="954e2-105">Pour comprendre le schéma de notification des opportunités Salesforce</span><span class="sxs-lookup"><span data-stu-id="954e2-105">To include the Salesforce opportunities notification schema</span></span>  
  
1.  <span data-ttu-id="954e2-106">Connectez-vous au portail Salesforce.com.</span><span class="sxs-lookup"><span data-stu-id="954e2-106">Login to the Salesforce.com portal.</span></span> <span data-ttu-id="954e2-107">Dans le portail Salesforce, cliquez sur votre nom de connexion à l’angle supérieur droit de la page, puis cliquez sur **le programme d’installation**.</span><span class="sxs-lookup"><span data-stu-id="954e2-107">On the Salesforce portal, click your login name at the top right corner of the page, and then click **Setup**.</span></span>  
  
2.  <span data-ttu-id="954e2-108">Dans le volet gauche, sous **programme d’installation de l’application**, développez **créer**, développez **Workflow & approbations**, puis cliquez sur **les règles de flux de travail**.</span><span class="sxs-lookup"><span data-stu-id="954e2-108">In the left pane, under **App Setup**, expand **Create**, expand **Workflow & Approvals**, and then click **Workflow Rules**.</span></span>  
  
3.  <span data-ttu-id="954e2-109">Dans le **toutes les règles de flux de travail** , cliquez sur le **opportunité fermée** flux de travail que vous avez créé précédemment.</span><span class="sxs-lookup"><span data-stu-id="954e2-109">In the **All Workflow Rules** page, click the **Closed Opportunity** workflow that you created earlier.</span></span>  
  
4.  <span data-ttu-id="954e2-110">Dans le **opportunité fermée** page de la règle de flux de travail, cliquez sur **NewOp1** action de flux de travail de message sortant.</span><span class="sxs-lookup"><span data-stu-id="954e2-110">In the **Closed Opportunity** workflow rule page, click **NewOp1** outbound message workflow action.</span></span>  
  
5.  <span data-ttu-id="954e2-111">Dans le **NewOp1** action de flux de travail de message sortant page, cliquez sur le lien **cliquer pour WSDL**, cliquez sur **enregistrer la cible sous**, puis spécifiez l’emplacement où vous souhaitez enregistrer le WSDL.</span><span class="sxs-lookup"><span data-stu-id="954e2-111">In the **NewOp1** outbound message workflow action page, right-click the link **Click for WSDL**, click **Save target as**, and then specify the location where you want to save the WSDL.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="954e2-112">Vous devez enregistrer le fichier avec une extension .wsdl.</span><span class="sxs-lookup"><span data-stu-id="954e2-112">You must save the file with a .wsdl extension.</span></span>  
  
6.  <span data-ttu-id="954e2-113">Créez un serveur [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] dans [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="954e2-113">Create a [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] in [!INCLUDE[btsVStudioNoVersion](../includes/btsvstudionoversion-md.md)].</span></span> <span data-ttu-id="954e2-114">Pour ce didacticiel, Nommons le projet en tant que `BtsSalesforceIntegration`.</span><span class="sxs-lookup"><span data-stu-id="954e2-114">For this tutorial, let us name the project as `BtsSalesforceIntegration`.</span></span>  
  
7.  <span data-ttu-id="954e2-115">Avec le bouton droit le [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] de projet dans l’Explorateur de solutions, pointez sur **ajouter**, puis cliquez sur **ajouter les éléments générés**.</span><span class="sxs-lookup"><span data-stu-id="954e2-115">Right-click the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] project in the Solution Explorer, point to **Add**, and then click **Add Generated Items**.</span></span>  
  
8.  <span data-ttu-id="954e2-116">Dans le **ajouter les éléments générés** boîte de dialogue, cliquez sur **utiliser le Service WCF**, puis cliquez sur **ajouter** pour lancer le **BizTalk WCF Service consommation**Assistant.</span><span class="sxs-lookup"><span data-stu-id="954e2-116">In the **Add Generated Items** dialog box, click **Consume WCF Service**, and then click **Add** to launch the **BizTalk WCF Service Consuming** wizard.</span></span> <span data-ttu-id="954e2-117">Dans la page d’accueil, cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="954e2-117">On the welcome page, click **Next**.</span></span>  
  
9. <span data-ttu-id="954e2-118">Sur le **Source des métadonnées** page, sélectionnez le **des fichiers de métadonnées (WSDL et XSD)** option, puis cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="954e2-118">On the **Metadata Source** page, select the **Metadata Files (WSDL and XSD)** option, and then click **Next**.</span></span>  
  
10. <span data-ttu-id="954e2-119">Sur le **des fichiers de métadonnées** , cliquez sur **ajouter**, puis accédez à l’emplacement où vous avez enregistré le fichier WSDL téléchargé à partir du portail Salesforce.</span><span class="sxs-lookup"><span data-stu-id="954e2-119">On the **Metadata Files** page, click **Add**, and then navigate to the location where you saved the WSDL file downloaded from the Salesforce portal.</span></span> <span data-ttu-id="954e2-120">Sélectionnez le fichier WSDL, puis cliquez **suivant**.</span><span class="sxs-lookup"><span data-stu-id="954e2-120">Select the WSDL file and then click **Next**.</span></span>  
  
11. <span data-ttu-id="954e2-121">Dans la page suivante, définissez l’espace de noms `NotificationService` puis cliquez sur **importation**.</span><span class="sxs-lookup"><span data-stu-id="954e2-121">In the next page, set the namespace as `NotificationService` and then click **Import**.</span></span> <span data-ttu-id="954e2-122">L'assistant ajoute les fichiers de schéma et une orchestration au projet [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="954e2-122">The wizard adds the schema files and an orchestration to the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] project.</span></span> <span data-ttu-id="954e2-123">Le schéma de message pour recevoir des notifications d’opportunité de Salesforce est **NotificationService_soap_sforce_com_2005_09_outbound.xsd**.</span><span class="sxs-lookup"><span data-stu-id="954e2-123">The message schema for receiving opportunity notifications from Salesforce is **NotificationService_soap_sforce_com_2005_09_outbound.xsd**.</span></span>  
  
### <a name="to-create-an-orchestration-to-receive-the-notification-message"></a><span data-ttu-id="954e2-124">Pour créer une orchestration pour recevoir le message de notification</span><span class="sxs-lookup"><span data-stu-id="954e2-124">To create an orchestration to receive the notification message</span></span>  
  
1.  <span data-ttu-id="954e2-125">Après avoir terminé la **consommation de Service WCF BizTalk** Assistant, une orchestration (**NotificationService.odx**, dans cet exemple) est ajouté à la [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] projet.</span><span class="sxs-lookup"><span data-stu-id="954e2-125">After you complete the **BizTalk WCF Service Consuming** wizard, an orchestration (**NotificationService.odx**, in this example) is added to the [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] project.</span></span>  
  
2.  <span data-ttu-id="954e2-126">Ouvrez le fichier d'orchestration et dans la vue de l'orchestration, ajoutez deux nouvelles variables de message.</span><span class="sxs-lookup"><span data-stu-id="954e2-126">Open the orchestration file and in the Orchestration view, add two new message variables.</span></span> <span data-ttu-id="954e2-127">Nommez-les `NotificationMessage` et `NotificationAck`.</span><span class="sxs-lookup"><span data-stu-id="954e2-127">Name them `NotificationMessage` and `NotificationAck`.</span></span> <span data-ttu-id="954e2-128">Définissez le type de message pour ces variables de message comme suit :</span><span class="sxs-lookup"><span data-stu-id="954e2-128">Set the message type for these message variables as follows:</span></span>  
  
    1.  <span data-ttu-id="954e2-129">Définissez **NotificationMessage** à *NotificationService.NotificationService_soap_sforce_com_2005_09_outbound.notifications*.</span><span class="sxs-lookup"><span data-stu-id="954e2-129">Set **NotificationMessage** to *NotificationService.NotificationService_soap_sforce_com_2005_09_outbound.notifications*.</span></span> <span data-ttu-id="954e2-130">Cette variable de message représente le message de notification d'opportunité reçu de Salesforce.</span><span class="sxs-lookup"><span data-stu-id="954e2-130">This message variable represents the opportunity notification message received from Salesforce.</span></span>  
  
    2.  <span data-ttu-id="954e2-131">Définissez **NotificationAck** à *NotificationService.NotificationService_soap_sforce_com_2005_09_outbound.notificationsResponse*.</span><span class="sxs-lookup"><span data-stu-id="954e2-131">Set **NotificationAck** to *NotificationService.NotificationService_soap_sforce_com_2005_09_outbound.notificationsResponse*.</span></span> <span data-ttu-id="954e2-132">Cette variable de message représente le message d'accusé de réception de notification d'opportunité renvoyé à Salesforce.</span><span class="sxs-lookup"><span data-stu-id="954e2-132">This message variable represents the opportunity notification acknowledgement message sent back to Salesforce.</span></span>  
  
3.  <span data-ttu-id="954e2-133">Ajoutez une forme de réception à l'orchestration.</span><span class="sxs-lookup"><span data-stu-id="954e2-133">Add a receive shape to the orchestration.</span></span> <span data-ttu-id="954e2-134">Définissez les propriétés suivantes sur la forme :</span><span class="sxs-lookup"><span data-stu-id="954e2-134">Set the following properties on the shape:</span></span>  
  
    1.  <span data-ttu-id="954e2-135">Définissez **activer** à **True**.</span><span class="sxs-lookup"><span data-stu-id="954e2-135">Set **Activate** to **True**.</span></span>  
  
    2.  <span data-ttu-id="954e2-136">Définissez **nom** à *ReceiveNotificationMessage*.</span><span class="sxs-lookup"><span data-stu-id="954e2-136">Set **Name** to *ReceiveNotificationMessage*.</span></span>  
  
    3.  <span data-ttu-id="954e2-137">Définissez **Message** à *NotificationMessage*.</span><span class="sxs-lookup"><span data-stu-id="954e2-137">Set **Message** to *NotificationMessage*.</span></span>  
  
4.  <span data-ttu-id="954e2-138">Ajoutez une forme Construire un message après la forme Réception.</span><span class="sxs-lookup"><span data-stu-id="954e2-138">Add a Construct Message shape after the Receive shape.</span></span> <span data-ttu-id="954e2-139">Nom de la forme de message `ConstructNotificationResponse` et définir le **Messages construits** propriété `NotificationAck`.</span><span class="sxs-lookup"><span data-stu-id="954e2-139">Name the message shape as `ConstructNotificationResponse` and set the **Messages Constructed** property to `NotificationAck`.</span></span> <span data-ttu-id="954e2-140">Dans le cadre du message Construire, nous allons également créer un mappage pour générer un message d'accusé de réception de la notification à renvoyer à Salesforce.</span><span class="sxs-lookup"><span data-stu-id="954e2-140">As part of the construct message, we’ll also create a map to generate a notification acknowledgement message to be sent back to Salesforce.</span></span>  
  
    1.  <span data-ttu-id="954e2-141">Dans la forme Construire un message, ajoutez une forme Transformer.</span><span class="sxs-lookup"><span data-stu-id="954e2-141">Within the Construct Message shape, add a Transform shape.</span></span> <span data-ttu-id="954e2-142">Double-cliquez sur la forme Transformer et dans la boîte de dialogue, sélectionnez le **nouveau mappage** option.</span><span class="sxs-lookup"><span data-stu-id="954e2-142">Double-click the Transform shape and in the Transform Configuration dialog box, select the **New Map** option.</span></span>  
  
    2.  <span data-ttu-id="954e2-143">Spécifiez le nom de mappage `BtsSalesforceIntegration.MapNotificationResponse`.</span><span class="sxs-lookup"><span data-stu-id="954e2-143">Specify the map name as `BtsSalesforceIntegration.MapNotificationResponse`.</span></span>  
  
    3.  <span data-ttu-id="954e2-144">Définissez la Source **NotificationMessage** et de Destination en tant que **NotificationAck**.</span><span class="sxs-lookup"><span data-stu-id="954e2-144">Set Source as **NotificationMessage** and Destination as **NotificationAck**.</span></span>  
  
    4.  <span data-ttu-id="954e2-145">Assurez-vous que la case à cocher **après avoir cliqué sur OK, lancer le Mappeur BizTalk** est sélectionnée.</span><span class="sxs-lookup"><span data-stu-id="954e2-145">Make sure the check box **When I click OK, launch the BizTalk Mapper** is selected.</span></span>  
  
    5.  <span data-ttu-id="954e2-146">Dans **MapNotificationResponse.btm**, nous allons créer une réponse de notification à renvoyer à Salesforce.</span><span class="sxs-lookup"><span data-stu-id="954e2-146">In **MapNotificationResponse.btm**, we’ll create a notification response to be sent back to Salesforce.</span></span> <span data-ttu-id="954e2-147">Chaque fois que Salesforce envoie une notification, il attend un accusé de réception en retour.</span><span class="sxs-lookup"><span data-stu-id="954e2-147">Every time Salesforce sends a notification, it expects an acknowledgement in return.</span></span> <span data-ttu-id="954e2-148">Le schéma du message de réponse de notification indique que le **l’accusé de réception** élément dans la réponse est de type booléen.</span><span class="sxs-lookup"><span data-stu-id="954e2-148">The schema of the notification response message shows that the **Ack** element in the response is of type Boolean.</span></span> <span data-ttu-id="954e2-149">Par conséquent, dans le mappage, vous devez supprimer un **mappage** fonctoid et définissez ses deux valeurs d’entrée (Condition et Result) à `true`.</span><span class="sxs-lookup"><span data-stu-id="954e2-149">So, in the map, you must drop a **Value Mapping** functoid and set its two input values (Condition and Result) to `true`.</span></span> <span data-ttu-id="954e2-150">Cliquez sur **OK** pour enregistrer le fonctoid.</span><span class="sxs-lookup"><span data-stu-id="954e2-150">Click **OK** to save the functoid.</span></span>  
  
    6.  <span data-ttu-id="954e2-151">Connecter le **mappage** fonctoid à la **l’accusé de réception** élément dans le schéma de destination.</span><span class="sxs-lookup"><span data-stu-id="954e2-151">Connect the **Value Mapping** functoid to the **Ack** element in the destination schema.</span></span>  
  
5.  <span data-ttu-id="954e2-152">Dans l'orchestration, après la forme Construire un message, ajoutez une forme Envoyer qui sera utilisée pour renvoyer l'accusé de réception à Salesforce.</span><span class="sxs-lookup"><span data-stu-id="954e2-152">In the orchestration, after the Construct Message shape, add a Send shape that will be used to send the acknowledgement back to Salesforce.</span></span>  
  
    -   <span data-ttu-id="954e2-153">Définissez **nom** à *SendNotificationAck*.</span><span class="sxs-lookup"><span data-stu-id="954e2-153">Set **Name** to *SendNotificationAck*.</span></span>  
  
    -   <span data-ttu-id="954e2-154">Définissez **Message** à *NotificationAck*.</span><span class="sxs-lookup"><span data-stu-id="954e2-154">Set **Message** to *NotificationAck*.</span></span>  
  
6.  <span data-ttu-id="954e2-155">Dans l'orchestration, ajoutez un port pour recevoir le message de notification Salesforce et envoyer l'accusé de réception en réponse.</span><span class="sxs-lookup"><span data-stu-id="954e2-155">In the orchestration, add a port to receive Salesforce notification message and send the acknowledgement in response.</span></span> <span data-ttu-id="954e2-156">Dans l'assistant Configuration du port, sélectionnez les options suivantes :</span><span class="sxs-lookup"><span data-stu-id="954e2-156">In the Port Configuration wizard, select the following options:</span></span>  
  
    -   <span data-ttu-id="954e2-157">Spécifiez le nom de port `SalesforceNotificationPort`.</span><span class="sxs-lookup"><span data-stu-id="954e2-157">Specify the port name as `SalesforceNotificationPort`.</span></span>  
  
    -   <span data-ttu-id="954e2-158">Sélectionnez l'option pour créer un nouveau type de port.</span><span class="sxs-lookup"><span data-stu-id="954e2-158">Select the option to create a new port type.</span></span>  
  
    -   <span data-ttu-id="954e2-159">Définissez **modèle de Communication** à *demande-réponse*.</span><span class="sxs-lookup"><span data-stu-id="954e2-159">Set **Communication Pattern** to *Request-Response*.</span></span>  
  
    -   <span data-ttu-id="954e2-160">Définir **direction de communication du Port** à *j’être reçoit une demande et envoyer une réponse* et définissez **liaison de Port** à *spécifierultérieure*.</span><span class="sxs-lookup"><span data-stu-id="954e2-160">Set **Port direction of communication** to *I’ll be receiving a request and sending a response* and set **Port binding** to *Specify later*.</span></span>  
  
     <span data-ttu-id="954e2-161">Connecter le **demande** opération du port à la forme réception (*ReceiveNotificationMessage*) et le **réponse** opération du port sur la forme envoi (*SendNotificationAck*).</span><span class="sxs-lookup"><span data-stu-id="954e2-161">Connect the **Request** operation of port to the Receive shape (*ReceiveNotificationMessage*) and the **Response** operation of the port to the Send shape (*SendNotificationAck*).</span></span> <span data-ttu-id="954e2-162">La capture d'écran ci-dessous illustre la partie de l'orchestration qui reçoit une notification d'opportunité de Salesforce et renvoie un accusé de réception :</span><span class="sxs-lookup"><span data-stu-id="954e2-162">The following screenshot depicts the part of the orchestration that receives an opportunity notification from Salesforce and sends an acknowledgement back:</span></span>  
  
     <span data-ttu-id="954e2-163">![Recevoir une notification d’opportunité et envoyer une réponse](../core/media/bts-sf-recvnotificationorch.jpg "BTS_SF_RecvNotificationOrch")</span><span class="sxs-lookup"><span data-stu-id="954e2-163">![Receive opportunity notification and send response](../core/media/bts-sf-recvnotificationorch.jpg "BTS_SF_RecvNotificationOrch")</span></span>  
  
 <span data-ttu-id="954e2-164">À l'heure actuelle, nous avons mis en place la solution dans laquelle une notification d'opportunité est reçue de Salesforce et un accusé de réception est renvoyé.</span><span class="sxs-lookup"><span data-stu-id="954e2-164">By now, we have set up the solution where an opportunity notification is received from Salesforce and an acknowledgement is sent back.</span></span> <span data-ttu-id="954e2-165">Dans les rubriques suivantes, nous allons nous baser sur cette solution pour commencer le traitement de la notification d'opportunité afin d'obtenir plus de détails sur le genre d'opportunité de vente disponible.</span><span class="sxs-lookup"><span data-stu-id="954e2-165">In the subsequent topics, we’ll build on this solution to start processing the opportunity notification to get more details about the kind of sales opportunity available.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="954e2-166">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="954e2-166">See Also</span></span>  
 [<span data-ttu-id="954e2-167">Étape 3 : Créer la Solution BizTalk Server dans Visual Studio</span><span class="sxs-lookup"><span data-stu-id="954e2-167">Step 3: Create the BizTalk Server Solution in Visual Studio</span></span>](../core/step-3-create-the-biztalk-server-solution-in-visual-studio.md)