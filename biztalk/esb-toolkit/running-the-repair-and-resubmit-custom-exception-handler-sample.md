---
title: Exécution de l’exemple de gestionnaire d’Exception personnalisé réparation et soumettez à nouveau | Documents Microsoft
ms.custom: ''
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 7363c440-44aa-4d08-8290-72787d17ac60
caps.latest.revision: ''
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: b8b33765cbe3ca1c8c0c7c3e7679e543678325af
ms.sourcegitcommit: 8418b1a8f38b7f56979cd6e203f0b591e2f40fe1
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/28/2018
---
# <a name="running-the-repair-and-resubmit-custom-exception-handler-sample"></a><span data-ttu-id="320ad-102">L’exemple de gestionnaire d’exceptions personnalisée réparation et soumettez à nouveau en cours d’exécution</span><span class="sxs-lookup"><span data-stu-id="320ad-102">Running the Repair and Resubmit Custom Exception Handler Sample</span></span>
<span data-ttu-id="320ad-103">L’exemple de réparation et soumettez à nouveau gestionnaire d’exceptions personnalisé montre une technique extrêmement efficace permettant d’intégrer une intervention humaine dans ESB et Microsoft application basée sur BizTalk traite et implémente un modèle de conception utiles.</span><span class="sxs-lookup"><span data-stu-id="320ad-103">The Repair and Resubmit Custom Exception Handler sample demonstrates an extremely effective technique for integrating human intervention into ESB and Microsoft BizTalk–based application processes and implements a useful design pattern.</span></span> <span data-ttu-id="320ad-104">L’exemple de code s’intègre en toute transparence dans le système de gestion d’exception ESB.</span><span class="sxs-lookup"><span data-stu-id="320ad-104">The sample code integrates seamlessly into the ESB exception management system.</span></span>  
  
 <span data-ttu-id="320ad-105">L’exemple montre comment vous pouvez utiliser un gestionnaire d’exceptions personnalisé dans une orchestration.</span><span class="sxs-lookup"><span data-stu-id="320ad-105">The sample shows how you can use a custom exception handler in an orchestration.</span></span> <span data-ttu-id="320ad-106">Lorsqu’un processus dans l’orchestration (EAIProcess.odx) rencontre une erreur, le Gestionnaire d’exceptions génère et publie un message d’erreur ESB.</span><span class="sxs-lookup"><span data-stu-id="320ad-106">When a process in the orchestration (EAIProcess.odx) encounters an error, the exception handler generates and publishes an ESB fault message.</span></span> <span data-ttu-id="320ad-107">Ce message d’erreur inclut dans sa charge utile les messages (y compris leurs propriétés de contexte de BizTalk liées) qui ont été « en vol » lorsque l’exception s’est produite et l’instance actuelle de System.Exception interceptée par le moteur d’Orchestration BizTalk.</span><span class="sxs-lookup"><span data-stu-id="320ad-107">This fault message includes in its payload the messages (including their BizTalk-related context properties) that were "in flight" when the exception occurred and the current System.Exception instance caught by the BizTalk Orchestration engine.</span></span> <span data-ttu-id="320ad-108">Lorsque cela se produit, un message « Refusé » et un message « Approved » sont conservées avec le message d’erreur.</span><span class="sxs-lookup"><span data-stu-id="320ad-108">When this occurs, a "Denied" message and an "Approved" message are persisted with the fault message.</span></span>  
  
 <span data-ttu-id="320ad-109">Une deuxième orchestration nommée EAIProcessHandler.odx, qui est déployé dans une méthode découplée et agit comme un gestionnaire d’exceptions personnalisées, s’abonne au code d’erreur spécifique généré dans l’orchestration EAIProcess.odx et consomme le message d’erreur.</span><span class="sxs-lookup"><span data-stu-id="320ad-109">A second orchestration named EAIProcessHandler.odx, which is deployed in a decoupled manner and acts as a custom exception handler, subscribes to the specific fault code generated in the EAIProcess.odx orchestration and consumes the fault message.</span></span> <span data-ttu-id="320ad-110">Ce gestionnaire d’exceptions extrait les messages d’origine (comme des documents typés) et les instances de System.Exception persistantes à l’origine dans le message d’erreur.</span><span class="sxs-lookup"><span data-stu-id="320ad-110">This exception handler extracts the original messages (as typed documents) and the System.Exception instances originally persisted in the fault message.</span></span>  
  
 <span data-ttu-id="320ad-111">Désormais, les messages d’origine deviennent disponibles pour le traitement avec toutes leurs propriétés de contexte d’origine.</span><span class="sxs-lookup"><span data-stu-id="320ad-111">The original messages now become available for processing with all their original context properties.</span></span> <span data-ttu-id="320ad-112">Le Gestionnaire d’exceptions personnalisé (EAIProcessHandler.odx) écrit ensuite le « Denied » et les messages « Approved » au système de fichiers dans les emplacements suivants :</span><span class="sxs-lookup"><span data-stu-id="320ad-112">The custom exception handler (EAIProcessHandler.odx) then writes both the "Denied" and the "Approved" messages to the file system in the following locations:</span></span>  
  
-   <span data-ttu-id="320ad-113">Message approuvé :</span><span class="sxs-lookup"><span data-stu-id="320ad-113">Approved message:</span></span>  
  
    -   <span data-ttu-id="320ad-114">\Source\Samples\Exception Handling\Test\Filedrop\EAIProcess.PostApproval</span><span class="sxs-lookup"><span data-stu-id="320ad-114">\Source\Samples\Exception Handling\Test\Filedrop\EAIProcess.PostApproval</span></span>  
  
-   <span data-ttu-id="320ad-115">Message de refus de la réparation et soumettez à nouveau :</span><span class="sxs-lookup"><span data-stu-id="320ad-115">Denied message for repair and resubmit:</span></span>  
  
    -   <span data-ttu-id="320ad-116">\Source\Samples\Exception Handling\Test\Filedrop\EAIProcessHandler.RepairSubmit</span><span class="sxs-lookup"><span data-stu-id="320ad-116">\Source\Samples\Exception Handling\Test\Filedrop\EAIProcessHandler.RepairSubmit</span></span>  
  
-   <span data-ttu-id="320ad-117">Message de refus :</span><span class="sxs-lookup"><span data-stu-id="320ad-117">Denied message:</span></span>  
  
    -   <span data-ttu-id="320ad-118">\Source\Samples\Exception Handling\Test\Filedrop\EAIProcessHandler.PostDecline</span><span class="sxs-lookup"><span data-stu-id="320ad-118">\Source\Samples\Exception Handling\Test\Filedrop\EAIProcessHandler.PostDecline</span></span>  
  
 <span data-ttu-id="320ad-119">Le Gestionnaire d’exceptions sérialise le message « Denied » pour la réparation et soumettez à nouveau au système de fichiers à l’aide d’une instruction de traitement Microsoft InfoPath.</span><span class="sxs-lookup"><span data-stu-id="320ad-119">The exception handler serializes the "Denied" message for Repair and Resubmit to the file system using a Microsoft InfoPath processing instruction.</span></span> <span data-ttu-id="320ad-120">Un modèle InfoPath permet à l’utilisateur à modifier le formulaire et soumettez à nouveau le résultat (voir Figure 1), qui démarre l’orchestration EAIProcess.odx qui valide le message.</span><span class="sxs-lookup"><span data-stu-id="320ad-120">An InfoPath template allows the user to edit the form and resubmit the result (see Figure 1), which starts the EAIProcess.odx orchestration that validates the message.</span></span>  
  
 <span data-ttu-id="320ad-121">![Soumettez à nouveau de réparer](../esb-toolkit/media/ch6-repairresubmit.gif "§ 6-RepairResubmit")</span><span class="sxs-lookup"><span data-stu-id="320ad-121">![Repair Resubmit](../esb-toolkit/media/ch6-repairresubmit.gif "Ch6-RepairResubmit")</span></span>  
  
 <span data-ttu-id="320ad-122">**Figure 1**</span><span class="sxs-lookup"><span data-stu-id="320ad-122">**Figure 1**</span></span>  
  
 <span data-ttu-id="320ad-123">**Un message de test généré par la réparation d’InfoPath et soumettez à nouveau modèle**</span><span class="sxs-lookup"><span data-stu-id="320ad-123">**A test message generated by the InfoPath Repair and Resubmit template**</span></span>  
  
 <span data-ttu-id="320ad-124">En outre, il est un port d’envoi générique appelé tous. Exceptions_FILE qui est configuré pour utiliser le pipeline GlobalFaultProcessor.</span><span class="sxs-lookup"><span data-stu-id="320ad-124">Additionally, there is a generic send port named ALL.Exceptions_FILE that is configured to use the GlobalFaultProcessor pipeline.</span></span> <span data-ttu-id="320ad-125">Ce port s’abonne à toutes les exceptions dans le système, les deux BizTalk Échec de routage des messages de message et les messages d’erreur ESB.</span><span class="sxs-lookup"><span data-stu-id="320ad-125">This port subscribes to all exceptions in the system, both BizTalk failed message routing messages and ESB fault messages.</span></span> <span data-ttu-id="320ad-126">L’infrastructure de gestion d’Exception les normalise toutes dans un format unique et sérialise à l’aide d’une instruction de traitement InfoPath pour le dossier \Source\Samples\Exception Handling\Test\Filedrop\All_Exceptions.</span><span class="sxs-lookup"><span data-stu-id="320ad-126">The Exception Management Framework normalizes them all to a single format and serializes them using an InfoPath processing instruction to the folder \Source\Samples\Exception Handling\Test\Filedrop\All_Exceptions.</span></span>  
  
## <a name="installation"></a><span data-ttu-id="320ad-127">Installation</span><span class="sxs-lookup"><span data-stu-id="320ad-127">Installation</span></span>  
 <span data-ttu-id="320ad-128">Tous les exemples de gestion d’exception utilisent le même jeu de services principaux et les artefacts de l’application BizTalk.</span><span class="sxs-lookup"><span data-stu-id="320ad-128">All the exception management samples use the same set of core services and BizTalk application artifacts.</span></span> <span data-ttu-id="320ad-129">Par conséquent, vous devez installer les artefacts d’exemple de gestion d’exception qu’une seule fois pour être en mesure d’exécuter tous les l’exception des exemples de gestion.</span><span class="sxs-lookup"><span data-stu-id="320ad-129">Therefore, you have to install the exception management sample artifacts only once to be able to run all the exception management samples.</span></span> <span data-ttu-id="320ad-130">Pour plus d’informations sur la façon d’installer les exemples de gestion des exceptions, consultez [installant les exemples de gestion des exceptions](../esb-toolkit/installing-the-exception-management-samples.md).</span><span class="sxs-lookup"><span data-stu-id="320ad-130">For information about how to install the exception management samples, see [Installing the Exception Management Samples](../esb-toolkit/installing-the-exception-management-samples.md).</span></span>  
  
## <a name="running-the-sample-application"></a><span data-ttu-id="320ad-131">Exécution de l'exemple d'application</span><span class="sxs-lookup"><span data-stu-id="320ad-131">Running the Sample Application</span></span>  
 <span data-ttu-id="320ad-132">**Pour exécuter l’exemple de réparation et soumettez à nouveau gestionnaire d’exceptions personnalisées**</span><span class="sxs-lookup"><span data-stu-id="320ad-132">**To run the Repair and Resubmit Custom Exception Handler sample**</span></span>  
  
1.  <span data-ttu-id="320ad-133">Avant d’exécuter cet exemple pour la première fois, assurez-vous que l’emplacement de réception et l’URL de port d’envoi pointent vers les répertoires appropriés dans le dossier \Source\Samples\Exception Handling\Test\Filedrop.</span><span class="sxs-lookup"><span data-stu-id="320ad-133">Before you run this sample for the first time, make sure that the receive location and send port URLs point to the appropriate directories in the \Source\Samples\Exception Handling\Test\Filedrop folder.</span></span> <span data-ttu-id="320ad-134">L’emplacement de réception doit spécifier le dossier EAIProcess.RequestPort, et les URL de port d’envoi doivent spécifier les dossiers EAIProcess.PostApproval et EAIProcessHandler.PostDecline.</span><span class="sxs-lookup"><span data-stu-id="320ad-134">The receive location should specify the folder EAIProcess.RequestPort, and the send port URLs should specify the folders EAIProcess.PostApproval and EAIProcessHandler.PostDecline.</span></span>  
  
2.  <span data-ttu-id="320ad-135">Si l’application GlobalBank.ESB n’est pas déjà en cours d’exécution, utilisez la Console Administration de BizTalk pour le démarrer.</span><span class="sxs-lookup"><span data-stu-id="320ad-135">If the GlobalBank.ESB application is not already running, use the BizTalk Administration Console to start it.</span></span>  
  
3.  <span data-ttu-id="320ad-136">Démarrer l’exemple en copiant le fichier d’exemple nommé Request_EAIProcessHandler.xml, situé dans le dossier \Source\Samples\Exception Handling\Test\Data, dans le dossier spécifié pour l’emplacement de réception de la EAIProcess.RequestPort_FILE : \Source\Samples\ Exception Handling\Test\Filedrop\EAIProcess.RequestPort.</span><span class="sxs-lookup"><span data-stu-id="320ad-136">Start the sample by copying the sample file named Request_EAIProcessHandler.xml, located in the \Source\Samples\Exception Handling\Test\Data folder, to the folder specified for the EAIProcess.RequestPort_FILE receive location: \Source\Samples\Exception Handling\Test\Filedrop\EAIProcess.RequestPort.</span></span>  
  
4.  <span data-ttu-id="320ad-137">Ouvrez le dossier nommé EAIProcessHandler.PostDecline (dans le dossier \Source\Samples\Exception Handling\Test\Filedrop).</span><span class="sxs-lookup"><span data-stu-id="320ad-137">Open the folder named EAIProcessHandler.PostDecline (in the \Source\Samples\Exception Handling\Test\Filedrop folder).</span></span> <span data-ttu-id="320ad-138">Vous verrez le message « Refusé \* » généré par l’orchestration d’exceptions.</span><span class="sxs-lookup"><span data-stu-id="320ad-138">You will see the "Declined\*" message generated by the exception handling orchestration.</span></span>  
  
5.  <span data-ttu-id="320ad-139">Ouvrez le dossier nommé EAIProcessHandler.RepairSubmit (dans le dossier \Source\Samples\Exception Handling\Test\Filedrop).</span><span class="sxs-lookup"><span data-stu-id="320ad-139">Open the folder named EAIProcessHandler.RepairSubmit (in the \Source\Samples\Exception Handling\Test\Filedrop folder).</span></span> <span data-ttu-id="320ad-140">Vous verrez un message « RepairSubmit » généré par l’orchestration de gestion des exceptions.</span><span class="sxs-lookup"><span data-stu-id="320ad-140">You will see a "RepairSubmit" message generated by the exception handling orchestration.</span></span>  
  
6.  <span data-ttu-id="320ad-141">Double-cliquez sur le fichier RepairSubmit pour l’ouvrir dans le modèle InfoPath approprié.</span><span class="sxs-lookup"><span data-stu-id="320ad-141">Double-click the RepairSubmit file to open it in the appropriate InfoPath template.</span></span> <span data-ttu-id="320ad-142">Vous verrez le message prêt pour la modifier et nouvelle soumission.</span><span class="sxs-lookup"><span data-stu-id="320ad-142">You will see the message ready for edit and resubmission.</span></span>  
  
7.  <span data-ttu-id="320ad-143">Modifiez la valeur de la **prix unitaire** champ **0** à **2**, puis cliquez sur le **envoyer** situé dans la barre d’outils d’InfoPath formulaire à envoyer le document modifié dans BizTalk pour le traitement.</span><span class="sxs-lookup"><span data-stu-id="320ad-143">Change the value of the **Unit Price** field from **0** to **2**, and then click the **Submit** button located on the toolbar of the InfoPath form to submit the edited document back to BizTalk for processing.</span></span> <span data-ttu-id="320ad-144">Emplacement de réception de la soumission process utilise un HTTP configuré BizTalk.</span><span class="sxs-lookup"><span data-stu-id="320ad-144">The submit process uses a BizTalk-configured HTTP receive location.</span></span>  
  
8.  <span data-ttu-id="320ad-145">Accédez au dossier EAIProcess.PostApproval (dans le dossier \Source\Samples\Exception Handling\Test\Filedrop).</span><span class="sxs-lookup"><span data-stu-id="320ad-145">Navigate to the EAIProcess.PostApproval folder (in the \Source\Samples\Exception Handling\Test\Filedrop folder).</span></span> <span data-ttu-id="320ad-146">Vous voyez maintenant le document « Approbation \* » qui contient la valeur mise à jour pour le prix unitaire.</span><span class="sxs-lookup"><span data-stu-id="320ad-146">You will now see the "Approval\*" document containing the updated value for the unit price.</span></span>  
  
## <a name="how-the-sample-works"></a><span data-ttu-id="320ad-147">Fonctionne de l’exemple</span><span class="sxs-lookup"><span data-stu-id="320ad-147">How the Sample Works</span></span>  
 <span data-ttu-id="320ad-148">Le message que vous envoyez Active l’orchestration EAIProcess.</span><span class="sxs-lookup"><span data-stu-id="320ad-148">The message you submit activates the EAIProcess orchestration.</span></span> <span data-ttu-id="320ad-149">Lorsque l’orchestration EAIProcess traite le message, il tente de diviser 1 par le prix unitaire.</span><span class="sxs-lookup"><span data-stu-id="320ad-149">When the EAIProcess orchestration processes the message, it attempts to divide 1 by the unit price.</span></span> <span data-ttu-id="320ad-150">Étant donné que le prix unitaire est égal à zéro, une exception de division par zéro se produit.</span><span class="sxs-lookup"><span data-stu-id="320ad-150">Because the unit price is zero, a divide-by-zero exception occurs.</span></span> <span data-ttu-id="320ad-151">Code du Gestionnaire d’événements de l’orchestration intercepte cette exception et crée un message d’erreur.</span><span class="sxs-lookup"><span data-stu-id="320ad-151">Code in the event handler of the orchestration catches this exception and creates a fault message.</span></span> <span data-ttu-id="320ad-152">La quantité commandée dans le message est supérieure à 10, donc la logique métier en décide que cette exception a un **FaultCode** champ à la valeur de **1000**.</span><span class="sxs-lookup"><span data-stu-id="320ad-152">The order quantity in the message is greater than 10, so the business logic dictates that this exception has a **FaultCode** field value of **1000**.</span></span>  
  
 <span data-ttu-id="320ad-153">L’orchestration EAIProcess publie le message d’erreur dans la boîte de Message BizTalk via un port à liaison directe, et l’orchestration se termine.</span><span class="sxs-lookup"><span data-stu-id="320ad-153">The EAIProcess orchestration then publishes the fault message to the BizTalk Message Box through a direct-bound port, and the orchestration ends.</span></span>  
  
 <span data-ttu-id="320ad-154">Une orchestration de gestionnaire d’erreur personnalisée nommée EAIProcessHandler, qui s’abonne aux messages avec un **FaultCode** champ à la valeur de **1000**, récupère le message d’erreur.</span><span class="sxs-lookup"><span data-stu-id="320ad-154">A custom fault handler orchestration named EAIProcessHandler, which subscribes to messages with a **FaultCode** field value of **1000**, picks up the new fault message.</span></span> <span data-ttu-id="320ad-155">Le code de l’orchestration crée le message « Denied » et le fichier InfoPath, puis il place dans les dossiers EAIProcessHandler.PostDecline et EAIProcessHandler.RepairSubmit prêt pour une intervention humaine.</span><span class="sxs-lookup"><span data-stu-id="320ad-155">The code in the orchestration creates the "Denied" message and the InfoPath file, and then it places this into the EAIProcessHandler.PostDecline and EAIProcessHandler.RepairSubmit folders ready for human intervention.</span></span>