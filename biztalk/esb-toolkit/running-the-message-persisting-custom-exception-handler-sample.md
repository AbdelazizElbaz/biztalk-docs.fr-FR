---
title: "Le Message de persistance d’exemple de gestionnaire d’exceptions personnalisé en cours d’exécution | Documents Microsoft"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: a0a4c819-f6bd-4dea-8be9-e3006337665f
caps.latest.revision: "2"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: f6d7927357e4c2be03ecd8b2e77d45558b5bc692
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/20/2017
---
# <a name="running-the-message-persisting-custom-exception-handler-sample"></a><span data-ttu-id="6bd35-102">Le Message de persistance d’exemple de gestionnaire d’exceptions personnalisé en cours d’exécution</span><span class="sxs-lookup"><span data-stu-id="6bd35-102">Running the Message Persisting Custom Exception Handler Sample</span></span>
<span data-ttu-id="6bd35-103">L’exemple de gestionnaire d’exceptions personnalisé persistance Message montre un gestionnaire générique, faiblement couplé, qui reçoit des messages d’erreur, extrait les messages de Microsoft BizTalk qu’ils contiennent et les écrit en tant que fichiers de disque dans le système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="6bd35-103">The Message Persisting Custom Exception Handler sample demonstrates a loosely coupled, generic handler that receives fault messages, extracts the Microsoft BizTalk messages they contain, and writes them as disk files to the file system.</span></span>  
  
 <span data-ttu-id="6bd35-104">L’exemple montre comment vous pouvez utiliser un gestionnaire d’exceptions personnalisé dans une orchestration.</span><span class="sxs-lookup"><span data-stu-id="6bd35-104">The sample shows how you can use a custom exception handler in an orchestration.</span></span> <span data-ttu-id="6bd35-105">Lorsqu’un processus dans l’orchestration (EAIProcess.odx) rencontre une erreur, le Gestionnaire d’exceptions génère et publie un message d’erreur ESB.</span><span class="sxs-lookup"><span data-stu-id="6bd35-105">When a process in the orchestration (EAIProcess.odx) encounters an error, the exception handler generates and publishes an ESB fault message.</span></span> <span data-ttu-id="6bd35-106">Ce message d’erreur inclut dans sa charge utile les messages (y compris leurs propriétés de contexte de BizTalk liées) qui ont été « en vol » lorsque l’exception s’est produite, ainsi que l’instance actuelle de System.Exception interceptée par le moteur d’Orchestration BizTalk.</span><span class="sxs-lookup"><span data-stu-id="6bd35-106">This fault message includes in its payload the messages (including their BizTalk-related context properties) that were "in flight" when the exception occurred, as well as the current System.Exception instance caught by the BizTalk Orchestration engine.</span></span> <span data-ttu-id="6bd35-107">Lorsque cela se produit, un message « Refusé » et un message « Approved » sont conservées avec le message d’erreur.</span><span class="sxs-lookup"><span data-stu-id="6bd35-107">When this occurs, a "Denied" message and an "Approved" message are persisted with the fault message.</span></span>  
  
 <span data-ttu-id="6bd35-108">Une deuxième orchestration nommée EAIGenericHandler.odx, qui est déployé dans une méthode découplée et agit comme un gestionnaire d’exceptions personnalisées, s’abonne au code d’erreur spécifique généré dans l’orchestration EAIGenericHandler.odx et consomme le message d’erreur.</span><span class="sxs-lookup"><span data-stu-id="6bd35-108">A second orchestration named EAIGenericHandler.odx, which is deployed in a decoupled manner and acts as a custom exception handler, subscribes to the specific fault code generated in the EAIGenericHandler.odx orchestration and consumes the fault message.</span></span> <span data-ttu-id="6bd35-109">Ce gestionnaire d’exceptions extrait les messages d’origine (comme des documents de type sans) et les instances de System.Exception persistantes à l’origine dans le message d’erreur.</span><span class="sxs-lookup"><span data-stu-id="6bd35-109">This exception handler extracts the original messages (as type-less documents) and the System.Exception instances originally persisted in the fault message.</span></span>  
  
 <span data-ttu-id="6bd35-110">L’exemple de gestionnaire d’exceptions personnalisé persistance Message diffère de l’exemple de réparation et soumettez à nouveau gestionnaire d’exceptions personnalisé l’orchestration EAIGenericHandler.odx utilisée dans cet exemple ne dispose pas d’une dépendance sur les schémas utilisés dans la publication de l’erreur processus d’orchestration (EAIProcess.odx).</span><span class="sxs-lookup"><span data-stu-id="6bd35-110">The Message Persisting Custom Exception Handler sample differs from the Repair and Resubmit Custom Exception Handler sample in that the EAIGenericHandler.odx orchestration used in this sample does not have a dependency on the schemas used in the fault publishing orchestration process (EAIProcess.odx).</span></span> <span data-ttu-id="6bd35-111">Plus précisément, l’orchestration EAIGenericHandler.odx récupère les messages d’origine à partir du message d’erreur en tant qu’instances System.Xml.XmlDocument au lieu de messages typés selon les schémas utilisés dans l’orchestration EAIProcess.odx.</span><span class="sxs-lookup"><span data-stu-id="6bd35-111">Specifically, the EAIGenericHandler.odx orchestration retrieves the original messages from the fault message as System.Xml.XmlDocument instances instead of typed messages based on the schemas used in the EAIProcess.odx orchestration.</span></span> <span data-ttu-id="6bd35-112">Il renvoie également les messages sous forme de collection qui code peut énumérer facilement.</span><span class="sxs-lookup"><span data-stu-id="6bd35-112">It also returns the messages as a collection that code can easily enumerate.</span></span>  
  
 <span data-ttu-id="6bd35-113">Le Gestionnaire d’exceptions personnalisé (EAIGenericHandler.odx) écrit ensuite le « Denied » et les messages « Approved » pour le fichier système emplacement \Source\Samples\Exception Handling\Test\Filedrop\EAIGenericHandler.PostTmpMsg.</span><span class="sxs-lookup"><span data-stu-id="6bd35-113">The custom exception handler (EAIGenericHandler.odx) then writes both the "Denied" and the "Approved" messages to the file system location \Source\Samples\Exception Handling\Test\Filedrop\EAIGenericHandler.PostTmpMsg.</span></span>  
  
 <span data-ttu-id="6bd35-114">En outre, il est un port d’envoi générique appelé tous. Exceptions_FILE configuré pour utiliser le pipeline GlobalFaultProcessor installé dans le cadre de la [!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)] infrastructure de gestion des exceptions.</span><span class="sxs-lookup"><span data-stu-id="6bd35-114">Additionally, there is a generic send port named ALL.Exceptions_FILE configured to use the GlobalFaultProcessor pipeline installed as part of the [!INCLUDE[esbToolkit](../includes/esbtoolkit-md.md)] Exception Management Framework.</span></span> <span data-ttu-id="6bd35-115">Ce port s’abonne à toutes les exceptions dans le système, les deux BizTalk Échec de routage des messages de message et les messages d’erreur ESB.</span><span class="sxs-lookup"><span data-stu-id="6bd35-115">This port subscribes to all exceptions in the system, both BizTalk failed message routing messages and ESB fault messages.</span></span> <span data-ttu-id="6bd35-116">L’infrastructure de gestion d’Exception les normalise toutes dans un format unique et sérialise à l’aide d’une instruction de traitement InfoPath de Microsoft à l’emplacement \Source\Samples\Exception Handling\Test\Filedrop\All_Exceptions.</span><span class="sxs-lookup"><span data-stu-id="6bd35-116">The Exception Management Framework normalizes them all to a single format and serializes them using a Microsoft InfoPath processing instruction to the location \Source\Samples\Exception Handling\Test\Filedrop\All_Exceptions.</span></span>  
  
## <a name="installation"></a><span data-ttu-id="6bd35-117">Installation</span><span class="sxs-lookup"><span data-stu-id="6bd35-117">Installation</span></span>  
 <span data-ttu-id="6bd35-118">Tous les exemples de gestion d’exception utilisent le même jeu de services principaux et les artefacts de l’application BizTalk.</span><span class="sxs-lookup"><span data-stu-id="6bd35-118">All the exception management samples use the same set of core services and BizTalk application artifacts.</span></span> <span data-ttu-id="6bd35-119">Par conséquent, vous devez installer les artefacts d’exemple de gestion d’exception qu’une seule fois pour être en mesure d’exécuter tous les l’exception des exemples de gestion.</span><span class="sxs-lookup"><span data-stu-id="6bd35-119">Therefore, you have to install the exception management sample artifacts only once to be able to run all the exception management samples.</span></span> <span data-ttu-id="6bd35-120">Pour plus d’informations sur la façon d’installer les exemples de gestion des exceptions, consultez [installant les exemples de gestion des exceptions](../esb-toolkit/installing-the-exception-management-samples.md).</span><span class="sxs-lookup"><span data-stu-id="6bd35-120">For information about how to install the exception management samples, see [Installing the Exception Management Samples](../esb-toolkit/installing-the-exception-management-samples.md).</span></span>  
  
## <a name="running-the-sample-application"></a><span data-ttu-id="6bd35-121">Exécution de l'exemple d'application</span><span class="sxs-lookup"><span data-stu-id="6bd35-121">Running the Sample Application</span></span>  
 <span data-ttu-id="6bd35-122">**Pour exécuter l’exemple de gestionnaire d’exceptions Message persistance personnalisée**</span><span class="sxs-lookup"><span data-stu-id="6bd35-122">**To run the Message Persisting Custom Exception Handler sample**</span></span>  
  
1.  <span data-ttu-id="6bd35-123">Avant d’exécuter cet exemple pour la première fois, assurez-vous que la réception emplacement et envoyer une URL de port pointant vers les répertoires appropriés dans le dossier \Source\Samples\Exception Handling\Test\Filedrop.</span><span class="sxs-lookup"><span data-stu-id="6bd35-123">Before you run this sample for the first time, make sure that the receive location and send port URL point to the appropriate directories in the \Source\Samples\Exception Handling\Test\Filedrop folder.</span></span> <span data-ttu-id="6bd35-124">L’emplacement de réception doit spécifier le dossier EAIProcess.RequestPort, et l’URL de port d’envoi doit spécifier le dossier EAIGenericHandler.PostTmpMsg.</span><span class="sxs-lookup"><span data-stu-id="6bd35-124">The receive location should specify the folder EAIProcess.RequestPort, and the send port URL should specify the folder EAIGenericHandler.PostTmpMsg.</span></span>  
  
2.  <span data-ttu-id="6bd35-125">Si l’application GlobalBank.ESB n’est pas déjà en cours d’exécution, utilisez la Console Administration de BizTalk pour le démarrer.</span><span class="sxs-lookup"><span data-stu-id="6bd35-125">If the GlobalBank.ESB application is not already running, use the BizTalk Administration Console to start it.</span></span>  
  
3.  <span data-ttu-id="6bd35-126">Démarrer l’exemple en copiant le fichier d’exemple nommé Request_EAIGenericHandler.xml, situé dans le dossier \Source\Samples\Exception Handling\Test\Data, dans le dossier spécifié pour l’emplacement de réception de la EAIProcess.RequestPort_FILE : \Source\Samples\ Exception Handling\Test\Filedrop\EAIProcess.RequestPort.</span><span class="sxs-lookup"><span data-stu-id="6bd35-126">Start the sample by copying the sample file named Request_EAIGenericHandler.xml, located in the \Source\Samples\Exception Handling\Test\Data folder, to the folder specified for the EAIProcess.RequestPort_FILE receive location: \Source\Samples\Exception Handling\Test\Filedrop\EAIProcess.RequestPort.</span></span>  
  
4.  <span data-ttu-id="6bd35-127">Ouvrez le dossier nommé EAIGenericHandler.PostTmpMsg (dans le dossier \Source\Samples\Exception Handling\Test\Filedrop\).</span><span class="sxs-lookup"><span data-stu-id="6bd35-127">Open the folder named EAIGenericHandler.PostTmpMsg (in the \Source\Samples\Exception Handling\Test\Filedrop\ folder).</span></span> <span data-ttu-id="6bd35-128">Vous verrez le message d’origine.</span><span class="sxs-lookup"><span data-stu-id="6bd35-128">You will see the original message.</span></span>  
  
## <a name="how-the-sample-works"></a><span data-ttu-id="6bd35-129">Fonctionne de l’exemple</span><span class="sxs-lookup"><span data-stu-id="6bd35-129">How the Sample Works</span></span>  
 <span data-ttu-id="6bd35-130">Le message que vous envoyez Active l’orchestration EAIProcess.</span><span class="sxs-lookup"><span data-stu-id="6bd35-130">The message you submit activates the EAIProcess orchestration.</span></span> <span data-ttu-id="6bd35-131">Lorsque l’orchestration EAIProcess traite le message, il tente de diviser 1 par le prix unitaire.</span><span class="sxs-lookup"><span data-stu-id="6bd35-131">When the EAIProcess orchestration processes the message, it attempts to divide 1 by the unit price.</span></span> <span data-ttu-id="6bd35-132">Étant donné que le prix unitaire est égal à zéro, une exception de division par zéro se produit.</span><span class="sxs-lookup"><span data-stu-id="6bd35-132">Because the unit price is zero, a divide-by-zero exception occurs.</span></span> <span data-ttu-id="6bd35-133">Code du Gestionnaire d’événements de l’orchestration intercepte cette exception et crée un message d’erreur.</span><span class="sxs-lookup"><span data-stu-id="6bd35-133">Code in the event handler of the orchestration catches this exception and creates a fault message.</span></span> <span data-ttu-id="6bd35-134">La quantité commandée dans le message est inférieure à 10, la logique métier en décide que cette exception a un **FaultCode** champ à la valeur de **2000**.</span><span class="sxs-lookup"><span data-stu-id="6bd35-134">The order quantity in the message is less than 10, so the business logic dictates that this exception has a **FaultCode** field value of **2000**.</span></span>  
  
 <span data-ttu-id="6bd35-135">L’orchestration EAIProcess publie le message d’erreur dans la boîte de Message BizTalk via un port à liaison directe, et l’orchestration se termine.</span><span class="sxs-lookup"><span data-stu-id="6bd35-135">The EAIProcess orchestration then publishes the fault message to the BizTalk Message Box through a direct-bound port, and the orchestration ends.</span></span>  
  
 <span data-ttu-id="6bd35-136">Une orchestration de gestionnaire d’erreur personnalisée nommée EAIGenericHandler, qui s’abonne aux messages avec un **FaultCode** champ à la valeur de **2000**, récupère le message d’erreur.</span><span class="sxs-lookup"><span data-stu-id="6bd35-136">A custom fault handler orchestration named EAIGenericHandler, which subscribes to messages with a **FaultCode** field value of **2000**, picks up the new fault message.</span></span> <span data-ttu-id="6bd35-137">Le code dans l’orchestration extrait tous les messages à partir du message d’exception (erreur) et les écrit dans les fichiers de disque.</span><span class="sxs-lookup"><span data-stu-id="6bd35-137">The code in the orchestration extracts all the messages from the exception (fault) message and writes them to disk files.</span></span>