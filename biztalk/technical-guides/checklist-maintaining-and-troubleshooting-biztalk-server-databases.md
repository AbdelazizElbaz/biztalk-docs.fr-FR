---
title: "Liste de vérification : Gestion et résolution des problèmes de bases de données BizTalk Server | Documents Microsoft"
ms.custom: 
ms.date: 06/29/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 58931faf-fc84-46fe-8359-506da94c3756
caps.latest.revision: "4"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 3e5ef7cdc4fb136a9fc80b04a04cdbe4f1e064e3
ms.sourcegitcommit: cb908c540d8f1a692d01dc8f313e16cb4b4e696d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/20/2017
---
# <a name="checklist-maintaining-and-troubleshooting-biztalk-server-databases"></a>Liste de vérification : Gestion et résolution des problèmes de bases de données BizTalk Server
[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]bases de données et leur intégrité sont très importants pour la réussite [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] environnement de messagerie de base de données. Cette rubrique répertorie les étapes que vous devez suivre lors de la maintenance ou la résolution des problèmes du [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] bases de données.  
  
-   [Maintenance des bases de données BizTalk Server](../technical-guides/checklist-maintaining-and-troubleshooting-biztalk-server-databases.md#BKMK_MaintainDB)  
  
-   [Résolution des problèmes de bases de données BizTalk Server](../technical-guides/checklist-maintaining-and-troubleshooting-biztalk-server-databases.md#BKMK_Troubleshoot)  
  
<a name="BKMK_MaintainDB"></a>   
## <a name="maintaining-biztalk-server-databases"></a>Maintenance des bases de données BizTalk Server  
  
|Étapes|Référence|  
|-----------|---------------|  
|Désactiver la **mise à jour automatique des statistiques** et **création automatique des statistiques** Options (applicable uniquement aux [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] bases de données MessageBox).|**Remarque :** effectués de ces paramètres par défaut dans le cadre de la [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] configuration. Vous ne devez pas modifier ces paramètres. <br /><br /> Vous devez désactiver le **création automatique des statistiques** et **mise à jour automatique des statistiques** options. Pour déterminer si ces paramètres sont désactivés, exécutez les procédures stockées suivantes dans SQL Server :<br /><br /> EXEC sp_dboption « BizTalkMsgBoxDB', 'Création automatique des statistiques' exec, sp_dboption « BizTalkMsgBoxDB », « statistiques de mise à jour automatique »<br /><br /> La valeur retournée pour **CurrentSetting** doit avoir la valeur OFF. Si cette valeur est retournée pour **CurrentSetting** a la valeur ON, remplacez-le par OFF en exécutant les procédures stockées suivantes dans SQL Server :<br /><br /> EXEC sp_dboption 'BizTalkMsgBoxDB', 'Création automatique des statistiques', 'off' exec sp_dboption 'BizTalkMsgBoxDB', 'update statistics automatique', 'off'<br /><br /> Pour plus d’informations sur ces paramètres, consultez les articles suivants de la Base de connaissances Microsoft :<br /><br /> -   **917845**:[« Vous rencontrez blocage, blocage des conditions ou autres problèmes SQL Server lorsque vous essayez de vous connecter à la base de données BizTalkMsgBoxDb de BizTalk Server »](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429).<br />-   **912262**:[« l’option de statistiques de mise à jour automatique, création automatique des statistiques, et le paramétrage du parallélisme sont désactivés dans l’instance de base de données SQL Server qui héberge la base de données BizTalkMsgBoxDB de BizTalk Server »](http://go.microsoft.com/fwlink/?LinkId=153430) (http://go.microsoft.com/fwlink/?LinkId=153430).|  
|Définir le Max Degree of propriété de parallélisme|**Remarque :** effectués de ces paramètres par défaut dans le cadre de la [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] configuration. Vous ne devez pas modifier ces paramètres. <br /><br /> Définir le Max Degree of Parallelism **run_value** et **config_value** propriétés à une valeur d’un (1) sur le [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] des instances qui hébergent les [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] bases de données Messagebox. Pour vérifier le Max Degree of paramétrage du parallélisme, exécutez la procédure stockée sur le maître dans la base de données [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]:<br /><br /> EXEC sp_configure « max degree of parallelism »<br /><br /> Si le **run_value** et **config_value** ne sont pas une valeur d’un (1), exécutez la procédure stockée suivante dans SQL Server :<br /><br /> EXEC sp_configure 'max degree of parallelism', '1' reconfigure avec remplacement<br /><br /> Pour plus d’informations sur les effets de le Max Degree of paramétrage du parallélisme [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], consultez les articles suivants de la Base de connaissances Microsoft :<br /><br /> -   **899000**:[« Pour l’instance de SQL Server lorsque vous configurez BizTalk Server le paramétrage du parallélisme »](http://go.microsoft.com/fwlink/?LinkId=153432) (http://go.microsoft.com/fwlink/?LinkId=153432).<br />-   **917845**:[« Vous rencontrez blocage, blocage des conditions ou autres problèmes SQL Server lorsque vous essayez de vous connecter à la base de données BizTalkMsgBoxDb de BizTalk Server »](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429).|  
|Déterminer quand vous pouvez reconstruire [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] index|La plupart des index [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] bases de données sont en cluster (ID d’index : 1). La commande DBCC SHOWCONTIG peut être utilisée pour afficher les informations de fragmentation pour les tables dans le [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] bases de données. Ces index étant basé sur des GUID il est normal que la fragmentation se produise. Si la valeur de densité d’analyse de DBCC SHOWCONTIG est inférieure à 30 %, les index peuvent être reconstruits pendant le temps d’arrêt. De nombreuses tables dans le [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] bases de données contiennent des colonnes qui utilisent des définitions de type de données dans laquelle l’indexation en ligne ne peut pas être effectuée. Par conséquent, les index des tables dans le [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] bases de données ne doivent jamais être reconstruits lors du traitement de données BizTalk. Pour plus d’informations sur la façon de reconstruire les index de BizTalk, consultez l’article suivant de la Base de connaissances Microsoft :<br /><br /> -   **917845**:[« Vous rencontrez blocage, blocage des conditions ou autres problèmes SQL Server lorsque vous essayez de vous connecter à la base de données BizTalkMsgBoxDb de BizTalk Server »](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429).<br /><br /> Pour plus d’informations sur les types de charge de travail et de fragmentation d’index, consultez le livre blanc [Microsoft SQL Server 2000 Index meilleures pratiques de défragmentation](http://go.microsoft.com/fwlink/?LinkId=101580) (http://go.microsoft.com/fwlink/?LinkId=101580). **Remarque :** vous pouvez également utiliser la fonction sys.dm_db_index_physical_stats pour rechercher des informations de fragmentation dans [!INCLUDE[btsSQLServer2005](../includes/btssqlserver2005-md.md)] et [!INCLUDE[btsSQLServer2008](../includes/btssqlserver2008-md.md)]. Pour plus d’informations, consultez [sys.dm_db_index_physical_stats (Transact-SQL)](http://go.microsoft.com/fwlink/?LinkId=158493) (http://go.microsoft.com/fwlink/?LinkId=158493).|  
|Moniteur de la base de données pour les verrous, des blocs ou des blocages|Il est un comportement attendu pour les verrous et les blocs ne se produise sur le [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] bases de données utilisées par [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]. Toutefois, il est peu probable pour que ces verrous ou les blocs se poursuivent pendant une période prolongée. Étendue de blocage et de blocage sur le [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] bases de données utilisées par [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] sont des indicateurs d’un problème potentiel. Pour actuel connu entraîne de blocage et de blocage sur le [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] bases de données utilisées par [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)], consultez l’article suivant de la Base de connaissances Microsoft :<br /><br /> -   **917845**:[« Vous rencontrez blocage, blocage des conditions ou autres problèmes SQL Server lorsque vous essayez de vous connecter à la base de données BizTalkMsgBoxDb de BizTalk Server »](http://go.microsoft.com/fwlink/?LinkId=153429) (http://go.microsoft.com/fwlink/?LinkId=153429).|  
|Contrôler la taille des bases de données et des tables|La taille de la [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] base de données Messagebox doit être généralement pas dépasser environ 5 Go.  La base de données BizTalkMsgBoxDb ne doit pas être contenant des données et doit être considérée comme une mémoire tampon jusqu'à ce que les données sont traitées ou déplacées vers la base de données BizTalkDTADb. Un environnement avec un serveur principal de SQL Server puissant et plusieurs orchestrations en cours d’exécution longue peut avoir une base de données BizTalkMsgBoxDb plu de 5 Go. Un environnement de volume élevé avec aucune orchestration longue doit avoir un [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] beaucoup plus petite que 5 Go de la base de données Messagebox. Le [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] de base de données de suivi peut varier considérablement la taille, mais si les performances des requêtes diminuent considérablement, puis la base de données de suivi est probablement trop grande. En règle générale, un [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] supérieure à 15 à 20 Go est considérée comme trop volumineux et peut nuire aux performances de la base de données de suivi. Les problèmes suivants peuvent être attribués à [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] bases de données qui sont trop volumineux :<br /><br /> -La [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] base de données Messagebox continue de croître pendant que la taille des données (pas seulement le fichier journal) est grande. [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]prend plus de temps que d’habitude pour traiter même un scénario de flux de message simple.<br />-Les requêtes de concentrateur de groupe prennent plus de temps que d’habitude et peuvent même dépasser le délai.<br />-Le fichier journal de base de données obtient jamais tronqué.<br />-Les travaux de l’Agent SQL de BizTalk s’exécuter plus lentement que la normale.<br />-Certaines tables sont relativement volumineux ou aient trop de lignes par rapport à la normale.<br /><br /> Le [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] bases de données peuvent devenir volumineux pour plusieurs raisons, notamment :<br /><br /> Travaux de l’Agent SQL BizTalk ne pas en cours d’exécution.<br />-Instances de service ou de message suspendu excessive<br />-Défaillances de disque<br />-Hauts niveaux de suivi<br />-   [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]la limitation<br />-Médiocres [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] performances<br />-Problèmes de latence réseau<br /><br /> De même, vous pouvez avoir trop de lignes dans une table. Il n’existe aucun numéro de l’ensemble de lignes qui sont trop nombreux. En outre, ce nombre de lignes varie en fonction du type de données est stocké dans la table. Par exemple, un *dta_DebugTrace* table qui comporte plus de 1 million de lignes probablement a trop de lignes. A *HostNameQ_Suspended* table qui comporte plus de 200 000 lignes probablement a trop de lignes.<br /><br /> Assurez-vous que vous savez ce qui est attendu dans votre environnement pour déterminer si un problème de données se produit.|  
|Activer le suivi sur [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] hôte|Par défaut, le suivi est activé sur l’hôte par défaut. BizTalk requiert le **autoriser le suivi de hôte** option est activée sur un seul hôte. Lorsque le suivi est activé, le suivi des données décoder Service TDDS () déplace le suivi des données d’événement à partir de la [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] base de données Messagebox le [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] de base de données de suivi. Si aucun [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] hôtes sont configurés avec l’option de **autoriser le suivi des hôtes** ou si l’hôte de suivi est arrêté, le service TDDS ne s’exécute pas et les tables TrackingData_x_x dans le [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] base de données Messagebox grossit désactivée . Par conséquent, dédié [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] hôte doit être configuré avec l’option de **autoriser suivi de l’hôte**. Pour plus d’informations sur la configuration d’un hôte de suivi dédié, consultez [configuration d’un hôte dédié de suivi](~/technical-guides/configuring-a-dedicated-tracking-host.md). **Remarque :** pour autoriser le service TDDS conserver les nouveaux événements de suivi dans les scénarios à volume élevé, vous pouvez créer plusieurs instances d’hôte de suivi unique, mais pas plus d’un ordinateur hôte doit être configuré pour le suivi.|  
|Utilisez les travaux BizTalk SQL Server Agent corrects|L’exécution de la [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] travaux SQL Agent est cruciaux pour la gestion de la [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] bases de données et pour maintenir des performances optimales.<br /><br /> -La **sauvegarde [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]**  travail SQL Server Agent est la seule méthode prise en charge pour sauvegarder le [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] bases de données. Cette tâche, vous devez configurer tous les [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] bases de données à utiliser un mode de récupération complète. Vous devez configurer ce travail pour l’état de fonctionnement normal [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] environnement. Vous pouvez utiliser les méthodes de SQL Server pour sauvegarder le [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] uniquement si le service SQL Server est arrêté et si toutes les bases de données [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] processus sont arrêtés. **Remarque :** pour plus d’informations sur l’utilisation du mode de récupération complète de SQL Server lors de la configuration de la sauvegarde de l’Agent SQL [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] de la tâche, consultez [journaux](http://go.microsoft.com/fwlink/?LinkId=153450) (http://go.Microsoft.com/fwlink/?) LinkId = 153450) ou [sauvegarde en mode de récupération complète](http://go.microsoft.com/fwlink/?LinkId=156509) (http://go.Microsoft.com/fwlink/?) LinkId = 156509).<br />-La **MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb** des travaux de l’Agent SQL Server sont conçu pour s’exécuter indéfiniment. Par conséquent l’historique des travaux SQL Agent peut ne pas indique que ce travail de l’Agent SQL s’est terminée avec succès ; Ce comportement est normal. En cas de panne, le travail redémarre une minute et continuer à s’exécuter sans interruption. Par conséquent, des notifications d’échec pour cette tâche peuvent généralement être ignorées. Si l’historique des travaux pour le travail MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb SQL Server Agent indique que ce travail est constamment échouent et redémarrer plus approfondi de la cause du cycle échec/redémarrage peut être nécessaire.<br />-La **MessageBox_Message_Cleanup_BizTalkMsgBoxDb** travail SQL Server Agent est la seule tâche de ne doit pas être activée manuellement, car il est initialisé par le travail MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb.<br />-La **DTA Purge and Archive** des travaux de l’Agent SQL Server gère le [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] base de données de suivi par purge et archivage des messages suivis. Ce travail lit chaque ligne dans la table et compare l’horodatage de chaque ligne afin de déterminer si l’enregistrement doit être supprimé. **Remarque :** lors du dépannage de le [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] travaux de l’Agent SQL Server, vérifiez que tous les travaux de l’Agent SQL, à l’exception de la MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb sont se termine sans erreurs. <br /><br /> Pour plus d’informations sur la [!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)] des travaux de l’Agent SQL utilisés dans [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)]:<br /><br /> -Découvrez [Structure et les travaux de base de données](http://go.microsoft.com/fwlink/?LinkId=153451) (http://go.microsoft.com/fwlink/?LinkId=153451).<br />-Découvrez [travaux de Description de l’Agent SQL Server dans BizTalk Server](http://go.microsoft.com/fwlink/?LinkId=153452) (http://go.microsoft.com/fwlink/?LinkId=153452).|  
|Surveiller et arrêter les instances suspendues|Instances de service peuvent être suspendus (peut être repris) ou suspendus (ne peut être repris). Ces instances de service peuvent être la messagerie, Orchestration ou Port. [!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)]prend en charge la suppression de ces instances et de terminaison à l’aide de la page Hub du groupe dans le [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] Console d’Administration ou via le script Terminate.vbs. Pour plus d’informations sur le script Terminate.vbs, consultez [suppression de l’Instance de Service suspendue](http://go.microsoft.com/fwlink/?LinkId=153453) (http://go.microsoft.com/fwlink/?LinkId=153453). **Conseil :** vous pouvez également utiliser l’outil de marque de fin pour supprimer les instances suspendues. Le [outil de marque de fin](http://go.microsoft.com/fwlink/?LinkId=151931) est disponible à l’adresse [http://go.microsoft.com/fwlink/?LinkId=151931](http://go.microsoft.com/fwlink/?LinkId=151931). Utilisation de cet outil n’est pas prise en charge par Microsoft et Microsoft n’apporte aucune garantie quant à l’adéquation de ce programme. L'utilisation de ce programme relève de votre seule responsabilité. <br /><br /> Les termes « qu’orphelins » et « zombies » sont souvent interchangeables. Un message orphelin ou zombie est un message qui n’a pas une instance de service associé, généralement parce que l’instance de service est arrêté avant que le message a été reçu. Un service orphelin ou zombie est un service qui n’a pas de tous les messages associés. Pour plus d’informations sur les messages inactifs et les instances de service dans [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] consultez [Zombies dans BizTalk Server](http://go.microsoft.com/fwlink/?LinkId=153454) (http://go.microsoft.com/fwlink/?LinkId=153454).|  
|Surveiller les compteurs de performance de la **PhysicalDisk** objet de performance|[!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)]effectue un grand nombre de transactions courtes et très rapides à SQL Server en une minute. Si le serveur SQL Server ne peut pas supporter cette activité, vous pouvez rencontrer [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] les problèmes de performances. Analyse le **moy. Disque s/lecture**, **moy. Disque s/transfert**, et **moy. Disque s/écriture** des compteurs de l’Analyseur de performances dans le **PhysicalDisk** objet de performance. La valeur optimale est inférieure à 10 ms (millisecondes). Une valeur de 20 ms ou supérieure est considéré comme des performances médiocres.<br /><br /> -Pour plus d’informations sur les performances de SQL Server 2005, consultez [résolution des problèmes de performances dans SQL Server 2005](http://go.microsoft.com/fwlink/?LinkID=153585) (http://go.microsoft.com/fwlink/?LinkID=153585).<br />-Pour plus d’informations sur les performances de SQL Server 2008, consultez [résolution des problèmes de performances dans SQL Server 2008](http://go.microsoft.com/fwlink/?LinkID=153586) (http://go.microsoft.com/fwlink/?LinkID=153586).<br />-Pour plus d’informations sur [!INCLUDE[btsBizTalkServer2006r3](../includes/btsbiztalkserver2006r3-md.md)] haute disponibilité de base de données, consultez [fournir une haute disponibilité pour les bases de données BizTalk Server](http://go.microsoft.com/fwlink/?LinkId=153587) (http://go.microsoft.com/fwlink/?LinkId=153587).<br /><br /> Vous pouvez également consulter les articles suivants de la Base de connaissances Microsoft pour plus d’informations sur les performances de SQL Server :<br /><br /> -   **298475** – [« Comment résoudre les problèmes de performances de SQL Server »](http://go.microsoft.com/fwlink/?LinkId=153588) (http://go.microsoft.com/fwlink/?LinkId=153588).<br />-   **271509 de la** – [« Comment analyser des blocages dans SQL Server 2005 »](http://go.microsoft.com/fwlink/?LinkId=153589) (http://go.microsoft.com/fwlink/?LinkId=153589).|  
|Suivez les meilleures pratiques pour [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] bases de données.|Consultez [meilleures pratiques pour la maintenance des bases de données BizTalk Server](~/technical-guides/best-practices-for-maintaining-biztalk-server-databases.md).|  
  
<a name="BKMK_Troubleshoot"></a>   
## <a name="troubleshooting-biztalk-server-databases"></a>Résolution des problèmes de bases de données BizTalk Server  
 Effectuer les tâches suivantes pour résoudre les problèmes liés aux [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] bases de données.  
  
|Étapes|Référence|  
|-----------|---------------|  
|Vérifier tous les requis travaux BizTalk SQL Server Agent est activés et en cours d’exécution|Travaux de tous les BizTalk SQL Server Agent à l’exception de la **MessageBox_Message_ManageRefCountLog_BizTalkMsgBoxDb** travail doit être activé et en cours d’exécution avec succès. Ne désactivez pas n’importe quel autre travail.<br /><br /> Si une défaillance se produit, utilisez le **afficher l’historique** option dans SQL Server pour afficher les informations d’erreur, puis résoudre le problème en conséquence. N’oubliez pas que le **MessageBox _Message_ManageRefCountLog_BizTalkMsgBoxDb** travail SQL Server Agent s’exécute à l’infini. Par conséquent, vous devez uniquement être concernées si l’historique des travaux signale que la tâche échoue en permanence et redémarre.|  
|Utilisez l’outil MsgBoxViewer pour analyser la BizTalk MessageBox et autres bases de données|**Important :** utilisation de cet outil n’est pas prise en charge par Microsoft et Microsoft n’apporte aucune garantie quant à l’adéquation de ce programme. L'utilisation de ce programme relève de votre seule responsabilité. <br /><br /> L’outil MsgBoxViewer est disponible à partir de [http://go.microsoft.com/fwlink/?LinkId=151930](http://go.microsoft.com/fwlink/?LinkId=151930) (http://go.microsoft.com/fwlink/?LinkId=151930). L’outil MsgBoxViewer est utile pour le dépannage, car elle fournit un rapport HTML qui comporte des informations sur le nombre de lignes et les tailles de tables détaillées. Le rapport peut également aider à déterminer si [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] est la limitation. En outre, l’outil fournit un instantané de la [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] bases de données et la [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] configuration.<br /><br /> Lorsque [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] est en cours d’exécution plus lentement que prévu, exécutez l’outil MsgBoxViewer, cliquez sur pour sélectionner toutes les requêtes sur le **requêtes facultatif** onglet et examinez le rapport HTML généré pour tous les problèmes. Le **rapport Résumé** section répertorie les avertissements en jaunes et les éventuels problèmes en rouge.<br /><br /> En outre, vous pouvez utiliser l’outil MsgBoxViewer pour déterminer quelles tables sont le plus grand et la plupart des enregistrements. Pour obtenir la liste des tables qui en général la croissance la larges et pour obtenir des instructions sur la gestion de ces tables, consultez [grand croissance Tables de base de données du serveur BizTalk](~/technical-guides/large-growing-biztalk-server-database-tables.md).|  
|Utilisez l’outil de marque de fin pour résoudre les problèmes si elle existe, identifié par l’outil MsgBoxViewer|**Important :** utilisation de cet outil n’est pas prise en charge par Microsoft et Microsoft n’apporte aucune garantie quant à l’adéquation de ce programme. L'utilisation de ce programme relève de votre seule responsabilité. <br /><br /> Exécutez l’outil de terminaison disponible à l’adresse [terminateur](http://go.microsoft.com/fwlink/?LinkId=151931) (http://go.microsoft.com/fwlink/?LinkId=151931). Cet outil permet aux utilisateurs de facilement résoudre les problèmes identifiés par l’outil BizTalk MsgBoxViewer. Pour plus d’informations sur la façon dont l’outil de marque de fin s’intègre avec l’outil BizTalk MsgBoxViewer, consultez [à l’aide de BizTalk Terminator pour résoudre les problèmes identifiés par BizTalk MsgBoxViewer](http://go.microsoft.com/fwlink/?LinkId=151932) (http://go.microsoft.com/fwlink/?LinkId=151932).|  
|Examiner les scénarios de blocage|Dans un scénario de blocage, activez le traçage de DBCC sur le serveur SQL Server, afin que les informations de blocage sont écrit dans le journal SQLERROR.<br /><br /> Dans SQL Server 2008 ou SQL Server 2005, exécutez l’instruction suivante pour activer le traçage de DBCC pour les scénarios de blocage :<br /><br /> DBCC TRACEON (1222, -1)<br /><br /> Vous pouvez également utiliser l’utilitaire PSSDIAG pour collecter des données sur le **Lock : Deadlock** événement et le **Lock : Deadlock Chain** événement. Pour plus d’informations sur l’utilitaire PSSDIAG, consultez [utilitaire de collecte de données PSSDIAG](http://go.microsoft.com/fwlink/?LinkId=153627) (http://go.microsoft.com/fwlink/?LinkId=153627).<br /><br /> La base de données BizTalkMsgBoxDB est une base de données de traitement transactionnel en ligne (OLTP) élevées et haute-transaction. Ces bases de données, certaines un interblocage est attendu, et ce blocage est géré en interne par le [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] moteur. Lorsque ce comportement se produit, aucune erreur n’est répertoriés dans les journaux d’erreurs. Lorsque vous examinez une situation de blocage, le blocage que vous recherchez dans la sortie doit être mis en corrélation avec une erreur dans les journaux des événements de blocage.|  
|Recherchez les processus bloqués|Vous pouvez utiliser le moniteur d’activité dans SQL Server pour obtenir l’identificateur de processus serveur (SPID) d’un processus de système de verrouillage. Vous pouvez ensuite exécuter le Générateur de profils SQL pour déterminer l’instruction SQL qui s’exécute dans le SPID de blocage. Vous pouvez utiliser l’utilitaire PSSDIAG pour résoudre les problèmes de verrouillage et de blocage dans SQL Server. L’utilitaire de capture tous les événements Transact-SQL qui ont activé le script de blocage. Pour plus d’informations sur l’utilitaire PSSDIAG, consultez [utilitaire de collecte de données PSSDIAG](http://go.microsoft.com/fwlink/?LinkId=153627) (http://go.microsoft.com/fwlink/?LinkId=153627).<br /><br /> Dans SQL Server 2005 et versions ultérieures, vous pouvez spécifier le **seuil de processus bloqué** paramètre pour déterminer les SPID ou SPID bloquent plus longtemps que le seuil que vous spécifiez. Pour plus d’informations sur l’option de seuil de processus bloqué, consultez [seuil de processus Option bloqué](http://go.microsoft.com/fwlink/?LinkId=153628) (http://go.microsoft.com/fwlink/?LinkId=153628). **Remarque :** lorsque vous rencontrez un problème de verrouillage ou de blocage dans SQL Server, nous vous recommandons de contacter le Support technique de Microsoft. Services de Support technique Microsoft peut vous aider à configurer les options de l’utilitaire PSSDiag correctes.|  
|Supprimer toutes les données indésirables|Si les bases de données ont augmenté de devenir trop volumineux et si les données contenues dans les bases de données ne sera pas nécessaires plus, la méthode recommandée consiste à supprimer les données. **Attention :** n’utilisez pas cette méthode dans les environnements où les données sont critiques ou si les données sont requises. <br /><br /> **Pour purger la base de données BizTalkMsgBox**<br /> 1.  Téléchargez et installez l’outil à la marque de fin [Biztalk Terminator](http://go.microsoft.com/fwlink/?LinkId=220869) (http://go.microsoft.com/fwlink/?LinkId=220869).<br />2.  Suivez les étapes décrites dans la rubrique [comment vider les données manuellement à partir de la base de données MessageBox dans un environnement de Test](http://go.microsoft.com/fwlink/?LinkID=158064) (http://go.microsoft.com/fwlink/?LinkID=158064) pour créer le bts_CleanupMsgbox de procédure stockée dans la base de données MessageBox de BizTalk.<br />3.  Utilisez l’outil de marque de fin pour exécuter la procédure stockée bts_CleanupMsgbox et de purge de la base de données MessageBox de BizTalk. **Avertissement :** n’exécutez pas la procédure stockée bts_CleanupMsgbox sur un serveur de production qui est en cours d’exécution BizTalk Server. Vous devez uniquement exécuter la procédure stockée bts_CleanupMsgbox dans un environnement de test. L'exécution de la procédure stockée bts_CleanupMsgbox dans un environnement de production n'est pas prise en charge.<br />4.  Redémarrez tous les ordinateurs hôtes et [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] services.<br /><br /> **Pour purger la base de données BizTalkDTADb**<br /> <ul><li>**Méthode 1**<br /><br /> <ol><li>Sauvegardez tous les [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] bases de données.</li><li>Exécutez le **dtasp_PurgeAllCompletedTrackingData** procédure stockée. Pour plus d’informations sur la procédure stockée, consultez [comment vider les données manuellement à partir de la base de données de suivi BizTalk](http://go.microsoft.com/fwlink/?LinkId=153635) (http://go.microsoft.com/fwlink/?LinkId=153635).</li></ol></li><li>**Méthode 2**. Utilisez cette option uniquement si la base de données BizTalkDTADb contient de nombreuses instances incomplètes qui doivent être supprimés.<br /><br /> <ol><li>Sauvegardez tous les [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] bases de données.</li><li>Arrêter tous les hôtes BizTalk, les services et les adaptateurs isolés personnalisés. Si vous utilisez HTTP ou l’adaptateur SOAP, redémarrez les services IIS.</li><li>Exécutez le **dtasp_CleanHMData** procédure stockée sur la base de données BizTalkDTADb.</li><li>Redémarrez tous les ordinateurs hôtes et [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] services.</li></ol></li></ul> **Remarque :** si vous devez avoir les données de suivi, sauvegardez la base de données BizTalkDTADb, restaurez la base de données vers un autre serveur SQL et puis de purger la base de données BizTalkDTADb d’origine.|  
  
 Si vous souhaitez une aide à analyser les données de MsgBoxViewer ou de la sortie PSSDIAG, contactez le Support technique de Microsoft. Avant de contacter le Support technique, compressez les données MsgBoxViewer, la sortie PSSDIAG et les journaux des événements mis à jour (fichiers .evt). Vous devrez peut-être envoyer ces fichiers à un [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] ingénieur du support technique  
  
## <a name="in-this-section"></a>Dans cette section  
  
-   [Meilleures pratiques pour la maintenance des bases de données BizTalk Server](~/technical-guides/best-practices-for-maintaining-biztalk-server-databases.md)  
  
-   [Grand croissance des Tables de base de données BizTalk Server](~/technical-guides/large-growing-biztalk-server-database-tables.md)  
  
-   [Outils et utilitaires de résolution des problèmes](../technical-guides/tools-and-utilities-for-troubleshooting.md)  
  
## <a name="see-also"></a>Voir aussi  
 [Paramètres de SQL Server qui ne doivent pas être modifiés.](~/technical-guides/sql-server-settings-that-should-not-be-changed.md)