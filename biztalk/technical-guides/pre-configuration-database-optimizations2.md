---
title: "Base de données de la Configuration préalable Optimizations2 | Documents Microsoft"
ms.custom: 
ms.date: 06/08/2017
ms.prod: biztalk-server
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 8c525c3a-249c-4694-b287-a8c35a6aa524
caps.latest.revision: "17"
author: MandiOhlinger
ms.author: mandia
manager: anneta
ms.openlocfilehash: 2f863ae780dd99a7f0aa7d9acc3884f860686c86
ms.sourcegitcommit: dd7c54feab783ae2f8fe75873363fe9ffc77cd66
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/07/2017
---
# <a name="pre-configuration-database-optimizations"></a><span data-ttu-id="47eb8-102">Optimisations de la base de données de la Configuration préalable</span><span class="sxs-lookup"><span data-stu-id="47eb8-102">Pre-Configuration Database Optimizations</span></span>
<span data-ttu-id="47eb8-103">Le rôle critique que SQL Server joue dans n’importe quel environnement BizTalk Server, il est vital que SQL Server soit configuré/paramétrés pour des performances optimales.</span><span class="sxs-lookup"><span data-stu-id="47eb8-103">Because of the critical role that SQL Server plays in any BizTalk Server environment, it is of paramount importance that SQL Server be configured/tuned for optimal performance.</span></span> <span data-ttu-id="47eb8-104">Si SQL Server n’est pas paramétrée pour effectuer correctement, puis les bases de données utilisées par BizTalk Server devient un goulot d’étranglement et les performances globales de l’environnement BizTalk Server seront affectées.</span><span class="sxs-lookup"><span data-stu-id="47eb8-104">If SQL Server is not tuned to perform well, then the databases used by BizTalk Server will become a bottleneck and the overall performance of the BizTalk Server environment will suffer.</span></span> <span data-ttu-id="47eb8-105">Cette rubrique décrit plusieurs optimisations de performances de SQL Server qui doivent être suivies avant d’installer BizTalk Server et de configurer les bases de données BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="47eb8-105">This topic describes several SQL Server performance optimizations that should be followed before installing BizTalk Server and configuring the BizTalk Server databases.</span></span>  
  
## <a name="set-ntfs-file-allocation-unit"></a><span data-ttu-id="47eb8-106">Définir l’unité d’Allocation de fichier NTFS</span><span class="sxs-lookup"><span data-stu-id="47eb8-106">Set NTFS File Allocation Unit</span></span>  
 <span data-ttu-id="47eb8-107">SQL Server stocke ses données dans **étendues**, qui sont des collections de huit pages physiquement contiguës de 8 Ko, soit 64 Ko.</span><span class="sxs-lookup"><span data-stu-id="47eb8-107">SQL Server stores its data in **Extents**, which are collections of eight physically contiguous 8K pages, or 64 KB.</span></span> <span data-ttu-id="47eb8-108">Par conséquent, pour optimiser les performances du disque, définir la taille d’unité d’Allocation NTFS à 64 Ko comme décrit dans le « disque meilleures pratiques de Configuration » à [meilleures pratiques de déploiement préalable d’e/s](https://msdn.microsoft.com/library/cc966412.aspx).</span><span class="sxs-lookup"><span data-stu-id="47eb8-108">Therefore, to optimize disk performance, set the NTFS Allocation Unit size to 64KB as described in the “Disk Configuration Best Practices” at  [Predeployment I/O Best Practices](https://msdn.microsoft.com/library/cc966412.aspx).</span></span>  
  
## <a name="considerations-for-the-version-and-edition-of-sql-server"></a><span data-ttu-id="47eb8-109">Considérations relatives à la version et l’édition de SQL Server</span><span class="sxs-lookup"><span data-stu-id="47eb8-109">Considerations for the version and edition of SQL Server</span></span>  
 <span data-ttu-id="47eb8-110">Différentes versions et éditions de [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] fournissent des fonctionnalités différentes qui peuvent affecter les performances de votre [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] environnement.</span><span class="sxs-lookup"><span data-stu-id="47eb8-110">Various versions and editions of [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] provide different features that can affect the performance of your [!INCLUDE[btsBizTalkServerNoVersion](../includes/btsbiztalkservernoversion-md.md)] environment.</span></span> <span data-ttu-id="47eb8-111">Par exemple, dans des conditions de forte charge, le nombre de verrous de base de données qui sont disponibles pour la version 32 bits de [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] risque d’être dépassée, c'est-à-dire nuit aux performances de la solution BizTalk.</span><span class="sxs-lookup"><span data-stu-id="47eb8-111">For example, under high-load conditions, the number of database locks that are available for the 32-bit version of [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] might be exceeded, which is detrimental to the performance of the BizTalk solution.</span></span> <span data-ttu-id="47eb8-112">Envisagez d’héberger votre base de données MessageBox sur une version 64 bits de SQL Server si vous rencontrez des erreurs « insuffisant de verrous » dans votre environnement de test.</span><span class="sxs-lookup"><span data-stu-id="47eb8-112">Consider housing your MessageBox database on a 64-bit version of SQL Server if you are experiencing "out of lock" errors in your test environment.</span></span> <span data-ttu-id="47eb8-113">Le nombre de verrous disponibles est nettement supérieur sur cette version.</span><span class="sxs-lookup"><span data-stu-id="47eb8-113">The number of available locks is significantly higher on the 64-bit version of SQL Server.</span></span>  
  
 <span data-ttu-id="47eb8-114">Examinez le tableau suivant lorsque vous choisissez les fonctionnalités du moteur de base de données dont vous aurez besoin pour votre environnement BizTalk.</span><span class="sxs-lookup"><span data-stu-id="47eb8-114">Consider the following table when deciding on the database engine features that you will need for your BizTalk environment.</span></span> <span data-ttu-id="47eb8-115">Pour à grande échelle, solutions au niveau de l’entreprise qui nécessitent de clustering prennent en charge, la prise en charge, de copie des journaux de BizTalk Server ou Analysis Services prend en charge, puis vous avez besoin de SQL Server Enterprise Edition pour héberger le [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] bases de données.</span><span class="sxs-lookup"><span data-stu-id="47eb8-115">For large scale, enterprise-level solutions that require clustering support, BizTalk Server log shipping support, or Analysis Services support, then you need SQL Server Enterprise Edition to host the [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] databases.</span></span>   

 <span data-ttu-id="47eb8-116">Pour obtenir une liste complète des fonctionnalités prises en charge par les éditions de SQL Server, consultez [éditions de SQL Server et les fonctionnalités prises en charge](https://docs.microsoft.com/sql/sql-server/editions-and-components-of-sql-server-2016).</span><span class="sxs-lookup"><span data-stu-id="47eb8-116">For a complete list of the features supported by the SQL Server editions, see [SQL Server Editions and supported features](https://docs.microsoft.com/sql/sql-server/editions-and-components-of-sql-server-2016).</span></span>
  
## <a name="database-planning-considerations"></a><span data-ttu-id="47eb8-117">Planification des considérations relatives à la base de données</span><span class="sxs-lookup"><span data-stu-id="47eb8-117">Database planning considerations</span></span>  
 <span data-ttu-id="47eb8-118">Nous vous recommandons d’héberger vos bases de données SQL Server sur un stockage rapide (par exemple, des disques SAN rapides ou des disques SCSI rapides).</span><span class="sxs-lookup"><span data-stu-id="47eb8-118">We recommend that you host your SQL Server databases on fast storage (for example, fast SAN disks or fast SCSI disks).</span></span> <span data-ttu-id="47eb8-119">Nous vous recommandons de RAID 10 (1 + 0) au lieu de RAID 5 étant donné que raid 5 est plus lente à l’écriture.</span><span class="sxs-lookup"><span data-stu-id="47eb8-119">We recommend RAID 10 (1+0) instead of RAID 5 since raid 5 is slower at writing.</span></span> <span data-ttu-id="47eb8-120">Des disques SAN plus récentes ont les caches mémoire très importantes, dans ces cas, la sélection raid n’est pas aussi importante.</span><span class="sxs-lookup"><span data-stu-id="47eb8-120">Newer SAN disks have very large memory caches, so in these cases the raid selection is not as important.</span></span> <span data-ttu-id="47eb8-121">Pour améliorer les performances, les bases de données et leurs fichiers journaux peuvent résider sur différents disques physiques.</span><span class="sxs-lookup"><span data-stu-id="47eb8-121">To increase performance, databases and their log files can reside on different physical disks.</span></span>  
  
 <span data-ttu-id="47eb8-122">Envisagez également de réglage de la profondeur de file d’attente host bus adapter (HBA) si vous utilisez un réseau de zone de stockage (SAN).</span><span class="sxs-lookup"><span data-stu-id="47eb8-122">Also consider tuning the host bus adapter (HBA) queue depth if using a storage area network (SAN).</span></span> <span data-ttu-id="47eb8-123">Cela peut affecter considérablement le débit d’e/s et les valeurs hors de la zone peuvent être insuffisants pour SQL Server.</span><span class="sxs-lookup"><span data-stu-id="47eb8-123">This can significantly impact I/O throughput and out-of-the box values can be insufficient for SQL Server.</span></span> <span data-ttu-id="47eb8-124">Test est requis pour déterminer la valeur optimale, bien que la profondeur de file d’attente de 64 est généralement considéré comme un bon point de départ en l’absence de recommandations de n’importe quel fournisseur spécifique</span><span class="sxs-lookup"><span data-stu-id="47eb8-124">Testing is required to determine optimal value, although queue depth of 64 is generally accepted as a good starting point in the absence of any specific vendor recommendations</span></span>  
  
## <a name="install-the-latest-service-pack-and-cumulative-updates-for-sql-server"></a><span data-ttu-id="47eb8-125">Installez le dernier service pack et les mises à jour cumulatives pour SQL Server</span><span class="sxs-lookup"><span data-stu-id="47eb8-125">Install the latest service pack and cumulative updates for SQL Server</span></span>  
 <span data-ttu-id="47eb8-126">Installez les derniers service packs et dernières mises à jour cumulatives pour SQL Server, ainsi que les derniers service packs pour .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="47eb8-126">Install the latest service packs and the latest cumulative updates for SQL Server as well as the latest .NET Framework service packs.</span></span>  
  
## <a name="install-sql-service-packs-and-cumulative-updates-on-both-biztalk-server-and-sql-server"></a><span data-ttu-id="47eb8-127">Installer les mises à jour cumulatives et les Service Packs SQL sur BizTalk Server et SQL Server</span><span class="sxs-lookup"><span data-stu-id="47eb8-127">Install SQL Service Packs and cumulative updates on both BizTalk Server and SQL Server</span></span>  
 <span data-ttu-id="47eb8-128">Lors de l’installation des service packs ou mises à jour cumulatives pour SQL Server, également installer le service pack ou une mise à jour cumulative sur l’ordinateur BizTalk Server.</span><span class="sxs-lookup"><span data-stu-id="47eb8-128">When installing service packs or cumulative updates for SQL Server, also install the service pack or cumulative update on the BizTalk Server computer.</span></span> <span data-ttu-id="47eb8-129">BizTalk Server utilise les composants du Client SQL sont mises à jour par SQL Server service packs et mises à jour cumulatives.</span><span class="sxs-lookup"><span data-stu-id="47eb8-129">BizTalk Server uses SQL Client components that are updated by SQL Server service packs and cumulative updates.</span></span>  
  
## <a name="consider-using-a-fast-solid-state-drive-ssd-to-house-the-sql-server-tembdb"></a><span data-ttu-id="47eb8-130">Envisagez d’utiliser un lecteur d’accélérée solid state Drive (SSD) pour héberger le tembdb de SQL Server</span><span class="sxs-lookup"><span data-stu-id="47eb8-130">Consider using a fast solid state drive (SSD) to house the SQL Server tembdb</span></span>  
 <span data-ttu-id="47eb8-131">Envisagez d’utiliser un ou plusieurs lecteurs de disque d’état solide (SSD) pour héberger la base de données TempDB.</span><span class="sxs-lookup"><span data-stu-id="47eb8-131">Consider using one or more Solid State Disk (SSD) drives to house the TempDB.</span></span> <span data-ttu-id="47eb8-132">Lecteurs SSD offrent les avantages de performances sur les disques durs traditionnels déposer sont rapidement dans prix lorsqu’ils entrent des marchés grand public.</span><span class="sxs-lookup"><span data-stu-id="47eb8-132">SSD drives offer significant performance advantages over traditional hard drives and are quickly dropping in price as they enter mainstream markets.</span></span> <span data-ttu-id="47eb8-133">Étant donné que les performances de TempDB sont souvent un facteur clé global [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] les performances, le coût initial ajouté des lecteurs est souvent être rapidement amorti par globaux augmenté [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] des performances, surtout lors de l’exécution d’applications d’entreprise pour lequel [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] performances sont critiques.</span><span class="sxs-lookup"><span data-stu-id="47eb8-133">Because TempDB performance is often a key factor for overall [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] performance, the added initial cost of the drives will often be quickly recouped by the overall increased [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] performance, especially when running enterprise applications for which [!INCLUDE[btsSQLServerNoVersion](../includes/btssqlservernoversion-md.md)] performance is critical.</span></span>  
  
## <a name="consider-implementing-the-sql-server-2008-r2-data-collector-and-management-data-warehouse"></a><span data-ttu-id="47eb8-134">Envisagez d’implémenter le collecteur de données SQL Server 2008 R2 et l’entrepôt de données de gestion</span><span class="sxs-lookup"><span data-stu-id="47eb8-134">Consider implementing the SQL Server 2008 R2 Data Collector and Management Data Warehouse</span></span>  
 <span data-ttu-id="47eb8-135">SQL Server 2008 R2 prend en charge l’utilisation du nouveau collecteur de données et de l’entrepôt de données de gestion pour collecter les performances de l’environnement/base de données des données de test et analyse des tendances liées.</span><span class="sxs-lookup"><span data-stu-id="47eb8-135">SQL Server 2008 R2 accommodates the use of the new Data Collector and Management Data Warehouse to collect environment/database performance related data for test and trend analysis.</span></span> <span data-ttu-id="47eb8-136">Le collecteur de données persistantes toutes les données collectées dans l’entrepôt de données de gestion spécifié.</span><span class="sxs-lookup"><span data-stu-id="47eb8-136">The Data Collector persists all collected data to the specified Management Data Warehouse.</span></span> <span data-ttu-id="47eb8-137">Bien que cela ne soit pas une optimisation des performances, cela sera utile pour l’analyse des problèmes de performances.</span><span class="sxs-lookup"><span data-stu-id="47eb8-137">While this is not a performance optimization this will be useful for analysis of any performance issues.</span></span>  
  
## <a name="grant-the-account-which-is-used-for-sql-server-the-windows-lock-pages-in-memory-privilege"></a><span data-ttu-id="47eb8-138">Accordez au compte qui est utilisé pour le verrouillage de Windows des Pages dans le privilège de la mémoire de SQL Server</span><span class="sxs-lookup"><span data-stu-id="47eb8-138">Grant the account which is used for SQL Server the Windows Lock Pages In Memory privilege</span></span>  
 <span data-ttu-id="47eb8-139">Accordez le verrouillage de Pages dans le privilège de la mémoire pour le compte de service SQL Server.</span><span class="sxs-lookup"><span data-stu-id="47eb8-139">Grant the Windows Lock Pages in Memory privilege to the SQL Server service account.</span></span> <span data-ttu-id="47eb8-140">Cela doit être effectuée pour empêcher le système d’exploitation Windows à partir de la pagination de la mémoire de pool de mémoire tampon du processus SQL Server en verrouillant la mémoire allouée pour le pool de mémoires tampons en mémoire physique.</span><span class="sxs-lookup"><span data-stu-id="47eb8-140">This should be done to prevent the Windows operating system from paging out the buffer pool memory of the SQL Server process by locking memory that is allocated for the buffer pool in physical memory.</span></span>  
  
 <span data-ttu-id="47eb8-141">Dans notre environnement de laboratoire, la stratégie Windows **Lock Pages in Memory** option a été activée par défaut.</span><span class="sxs-lookup"><span data-stu-id="47eb8-141">In our lab environment, the Windows policy **Lock Pages in Memory** option was enabled by default.</span></span> <span data-ttu-id="47eb8-142">Consultez [activer l’Option Lock Pages in mémoire](https://docs.microsoft.com/sql/database-engine/configure-windows/enable-the-lock-pages-in-memory-option-windows).</span><span class="sxs-lookup"><span data-stu-id="47eb8-142">See [Enable the Lock Pages in Memory Option](https://docs.microsoft.com/sql/database-engine/configure-windows/enable-the-lock-pages-in-memory-option-windows).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="47eb8-143">Certaines limitations s’appliquent lorsque vous accordez le compte de service SQL Server le verrouillage de Pages dans le privilège de la mémoire.</span><span class="sxs-lookup"><span data-stu-id="47eb8-143">Certain limitations apply when granting the SQL Server service account the Windows Lock Pages in Memory privilege.</span></span> <span data-ttu-id="47eb8-144">Consultez les rubriques suivantes :</span><span class="sxs-lookup"><span data-stu-id="47eb8-144">See the following:</span></span> 
>   
> - [<span data-ttu-id="47eb8-145">Extension du pool de mémoires tampons</span><span class="sxs-lookup"><span data-stu-id="47eb8-145">Buffer Pool Extension</span></span>](https://docs.microsoft.com/sql/database-engine/configure-windows/buffer-pool-extension)  
> - [<span data-ttu-id="47eb8-146">Activer les Lock Pages in Memory (Option)</span><span class="sxs-lookup"><span data-stu-id="47eb8-146">Enable the Lock Pages in Memory Option </span></span>](https://docs.microsoft.com/sql/database-engine/configure-windows/enable-the-lock-pages-in-memory-option-windows)  
  
## <a name="grant-the-semanagevolumename-right-to-the-sql-server-service-account"></a><span data-ttu-id="47eb8-147">Accorder l’autorisation SE_MANAGE_VOLUME_NAME à droite pour le compte de Service SQL Server</span><span class="sxs-lookup"><span data-stu-id="47eb8-147">Grant the SE_MANAGE_VOLUME_NAME right to the SQL Server Service Account</span></span>  
 <span data-ttu-id="47eb8-148">Vérifiez le compte exécutant le service SQL Server dispose du privilège « Effectuer des tâches de Maintenance de Volume » Windows ou de vous assurer qu’il appartient à un groupe.</span><span class="sxs-lookup"><span data-stu-id="47eb8-148">Ensure the account running the SQL Server service has the ‘Perform Volume Maintenance Tasks’ Windows privilege or ensure it belongs to a group that does.</span></span> <span data-ttu-id="47eb8-149">Cela permettra instantanée des fichiers d’initialisation garantir des performances optimales si une base de données à croissance automatique.</span><span class="sxs-lookup"><span data-stu-id="47eb8-149">This will allow instant file Initialization ensuring optimum performance if a database has to Auto-grow.</span></span>  
  
## <a name="set-min-and-max-server-memory"></a><span data-ttu-id="47eb8-150">Valeur Min et Max Server Memory</span><span class="sxs-lookup"><span data-stu-id="47eb8-150">Set Min and Max Server Memory</span></span>  
 <span data-ttu-id="47eb8-151">Les ordinateurs exécutant SQL Server qui hébergent les bases de données BizTalk Server doivent être dédiés à l’exécution de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="47eb8-151">The computers running SQL Server that host the BizTalk Server databases should be dedicated to running SQL Server.</span></span> <span data-ttu-id="47eb8-152">Lorsque les ordinateurs exécutant SQL Server qui hébergent les bases de données BizTalk Server sont dédiés à SQL Server en cours d’exécution, nous recommandons de définir les options « max server memory » sur chaque instance de SQL Server « min server memory » pour spécifier la quantité fixe de mémoire à allouer à SQL Server.</span><span class="sxs-lookup"><span data-stu-id="47eb8-152">When the computers running SQL Server that host the BizTalk Server databases are dedicated to running SQL Server, we recommend that the 'min server memory' and 'max server memory' options on each SQL Server instance are set to specify the fixed amount of memory to allocate to SQL Server.</span></span> <span data-ttu-id="47eb8-153">Dans ce cas, vous devez définir la « min server memory » et « max server memory » sur la même valeur (égal à la quantité maximale de mémoire physique qui utilise SQL Server).</span><span class="sxs-lookup"><span data-stu-id="47eb8-153">In this case, you should set the “min server memory” and “max server memory” to the same value (equal to the maximum amount of physical memory that SQL Server will use).</span></span> <span data-ttu-id="47eb8-154">Cela va réduire les frais généraux qui serait sinon utilisé par SQL Server de gestion dynamique de ces valeurs.</span><span class="sxs-lookup"><span data-stu-id="47eb8-154">This will reduce overhead that would otherwise be used by SQL Server dynamically managing these values.</span></span> <span data-ttu-id="47eb8-155">Exécutez les commandes T-SQL suivantes sur chaque ordinateur exécutant SQL Server pour spécifier la quantité fixe de mémoire à allouer à SQL Server :</span><span class="sxs-lookup"><span data-stu-id="47eb8-155">Run the following T-SQL commands on each computer running SQL Server to specify the fixed amount of memory to allocate to SQL Server:</span></span>  
  
```  
sp_configure ‘Max Server memory (MB)’,(max size in MB)  
sp_configure ‘Min Server memory (MB)’,(min size in MB)  
```  
  
 <span data-ttu-id="47eb8-156">Avant de définir la quantité de mémoire pour SQL Server, déterminez le paramètre approprié de mémoire en soustrayant la mémoire requise pour Windows Server à partir de la mémoire physique totale.</span><span class="sxs-lookup"><span data-stu-id="47eb8-156">Before you set the amount of memory for SQL Server, determine the appropriate memory setting by subtracting the memory required for Windows Server from the total physical memory.</span></span> <span data-ttu-id="47eb8-157">Il s’agit de la quantité maximale de mémoire que pouvant être allouée à SQL Server.</span><span class="sxs-lookup"><span data-stu-id="47eb8-157">This is the maximum amount of memory you can assign to SQL Server.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="47eb8-158">Si les ordinateurs exécutant SQL Server qui hébergent les bases de données BizTalk Server hébergent également l’entreprise seule l’authentification serveur de secret principal, il vous faudra peut-être modifier cette valeur pour vous assurer qu’il existe suffisamment de mémoire disponible pour exécuter l’Enterprise Single Sign-On Service.</span><span class="sxs-lookup"><span data-stu-id="47eb8-158">If the computers running SQL Server that host the BizTalk Server databases also host the Enterprise Single Sign-On Master Secret Server, then you may need to adjust this value to ensure that there is sufficient memory available to run the Enterprise Single Sign-On Service.</span></span> <span data-ttu-id="47eb8-159">Il n’est pas une pratique peu courante pour exécuter une instance en cluster du service Enterprise Single Sign-On sur un cluster de SQL Server pour fournir une haute disponibilité pour le serveur de secret principal.</span><span class="sxs-lookup"><span data-stu-id="47eb8-159">It is not an uncommon practice to run a clustered instance of the Enterprise Single Sign-On service on a SQL Server cluster to provide high availability for the Master Secret Server.</span></span> <span data-ttu-id="47eb8-160">Consultez [Clustering du serveur de secret principal](../technical-guides/clustering-the-master-secret-server.md)</span><span class="sxs-lookup"><span data-stu-id="47eb8-160">See [Clustering the Master Secret Server](../technical-guides/clustering-the-master-secret-server.md)</span></span>  
  
## <a name="split-the-tempdb-database-into-multiple-data-files-of-equal-size-on-each-sql-server-instance-used-by-biztalk-server"></a><span data-ttu-id="47eb8-161">Fractionner la base de données tempdb en plusieurs fichiers de données de taille égale sur chaque instance de SQL Server utilisée par BizTalk Server</span><span class="sxs-lookup"><span data-stu-id="47eb8-161">Split the tempdb database into multiple data files of equal size on each SQL Server instance used by BizTalk Server</span></span>  
 <span data-ttu-id="47eb8-162">Il est essentiel de s’assurer que les fichiers de données utilisés pour la base de données tempdb sont de taille égale, car l’algorithme de remplissage proportionnel utilisé par SQL Server est basée sur la taille des fichiers de données.</span><span class="sxs-lookup"><span data-stu-id="47eb8-162">Ensuring that the data files used for the tempdb are of equal size is critical because the proportional fill algorithm used by SQL Server is based on the size of the data files.</span></span> <span data-ttu-id="47eb8-163">Si les fichiers de données sont créés avec la taille inégale, l’algorithme de remplissage proportionnel utilisera le plus grand fichier plus pour les allocations GAM plutôt qu’en se propageant les allocations entre tous les fichiers, invalidant ainsi le but de créer plusieurs fichiers de données.</span><span class="sxs-lookup"><span data-stu-id="47eb8-163">If data files are created with unequal sizes, the proportional fill algorithm will use the largest file more for GAM allocations rather than spreading the allocations between all the files, thereby defeating the purpose of creating multiple data files.</span></span> <span data-ttu-id="47eb8-164">Le nombre optimal de fichiers de données tempdb varie selon le degré de contention de verrou dans tempdb.</span><span class="sxs-lookup"><span data-stu-id="47eb8-164">The optimal number of tempdb data files depends on the degree of latch contention seen in tempdb.</span></span> <span data-ttu-id="47eb8-165">En règle générale, le nombre de fichiers de données doit être inférieur ou égal au nombre de cœurs de processeur/processeurs où le nombre de processeurs est 8.</span><span class="sxs-lookup"><span data-stu-id="47eb8-165">As a general rule of thumb, the number of data files should be equal to number of processor cores/CPUs where number of CPUs is 8 or less.</span></span> <span data-ttu-id="47eb8-166">Pour les serveurs avec plus de 8 processeurs, créer des fichiers de données pour la moitié du nombre de processeurs (là encore, seulement vous avez une contention de verrouillage).</span><span class="sxs-lookup"><span data-stu-id="47eb8-166">For servers with more than 8 CPUs, create data files for half the number of CPUs (again, only you have latch contention).</span></span>  
  
 <span data-ttu-id="47eb8-167">Dans notre environnement de laboratoire, nous avons utilisé le script ci-dessous pour créer des fichiers de données TempDB 8 chacune d’elles a une taille de 1 024 Mo, avec une croissance de 100 Mo et un fichier journal de 512 Mo avec une croissance de 100 Mo.</span><span class="sxs-lookup"><span data-stu-id="47eb8-167">In our lab environment, we used the script below to create 8 TempDB data files each of which had a file size of 1024 MB with 100 MB growth and a log file of 512 MB with 100 MB growth.</span></span> <span data-ttu-id="47eb8-168">Les fichiers de données sont déplacées vers le lecteur H: et fichier journal sont déplacées vers le lecteur i.</span><span class="sxs-lookup"><span data-stu-id="47eb8-168">The data files are moved to drive H: and log file are moved to drive I:.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="47eb8-169">Ce script est fourni « en l’état, » est destinée uniquement à titre éducatif de démonstration ou et doit être utilisé à vos propres risques.</span><span class="sxs-lookup"><span data-stu-id="47eb8-169">This script is provided “as is,” is intended for demo or educational purposes only, and is to be used at your own risk.</span></span> <span data-ttu-id="47eb8-170">Utilisation de ce script n’est pas prise en charge par Microsoft et Microsoft n’apporte aucune garantie quant à l’adéquation de ce script.</span><span class="sxs-lookup"><span data-stu-id="47eb8-170">Use of this script is not supported by Microsoft, and Microsoft makes no guarantees about the suitability of this script.</span></span>  
  
```  
--<<<<<<<<<<----------------------------------------------------------------->>>>>>>>>>--  
-- Use of included script samples are subject to the terms specified at   
-- http://www.microsoft.com/info/cpyright.htm  
--<<<<<<<<<<----------------------------------------------------------------->>>>>>>>>>--  
--***Instructions***  
-- 1. If running the script from a remote server, change the context in SSMS to target instance  
-- 2. Enable SQLCMD mode (add & click toolbar button or toggle by clicking Query > SQLCMD Mode)  
-- 3. Commence execution of scripts (recommend running statements discretely to more easily remedy potential problems)  
-- 4. Examine servername & temp configuration  
-- 5. If necessary, 1) Replace instance name in path to reflect target instance *all throughout script*  
      --            2) Modify root drives to reflect drives designated for data & log (folder creation *and* ALTER DB statements)  
-- 6. Resume script execution  
-- 7. If necessary, create new folders  
-- 8. Modify/Add data & log files   
-- 9. Recycle SQL service using sqlservermanager10.msc  
--10. Examine results & if appropriate, delete original tempdb data log files   
 --(if they were "moved", the original files aren't automatically deleted)  
  
--<<<<<<<<<<----------------------------------------------------------------->>>>>>>>>>--  
--1. If running the script from a remote server, change the context in SSMS to target instance  
--2. Enable SQLCMD mode (add & click toolbar button or toggle by clicking Query > SQLCMD Mode)  
--3. Commence execution of scripts (recommend running statements discretely to more easily remedy potential problems)  
--4. Examine servername & temp configuration  
SELECT @@SERVERNAME  
EXEC dbo.sp_helpdb tempdb  
--tempdev   1   C:\tempdb.mdf   PRIMARY  8192 KB  Unlimited  10%  data only  
--templog   2   C:\templog.ldf  NULL      512 KB  Unlimited  10%  log only  
GO  
--5. If necessary, 1) Replace instance name in path to reflect target instance *all throughout script*  
     --            2) Modify root drives to reflect drives designated for data & log (folder creation *and* ALTER DB statements)  
--6. Resume script execution  
--7. If necessary, create new folders  
--!!md H:\MSSQL10.<instance>  
--!!md H:\MSSQL10.<instance>\MSSQL  
--!!md H:\MSSQL10.<instance>\MSSQL\DATA  
GO  
-- 8. Modify/Add data & log files   
 --note: even if the out-of-box mdf is already where it needs to be,   
   --the first command is necessary to modify size & filegrowth  
ALTER DATABASE tempdb MODIFY FILE (NAME = tempdev  , FILENAME = 'H:\tempdb.mdf'   , SIZE = 1024MB , FILEGROWTH = 100MB)  
ALTER DATABASE tempdb ADD FILE    (NAME = tempdat2 , FILENAME = 'H:\tempdat2.ndf' , SIZE = 1024MB , FILEGROWTH = 100MB)  
ALTER DATABASE tempdb ADD FILE    (NAME = tempdat3 , FILENAME = 'H:\tempdat3.ndf' , SIZE = 1024MB , FILEGROWTH = 100MB)  
ALTER DATABASE tempdb ADD FILE    (NAME = tempdat4 , FILENAME = 'H:\tempdat4.ndf' , SIZE = 1024MB , FILEGROWTH = 100MB)  
ALTER DATABASE tempdb ADD FILE    (NAME = tempdat5 , FILENAME = 'H:\tempdat5.ndf' , SIZE = 1024MB , FILEGROWTH = 100MB)  
ALTER DATABASE tempdb ADD FILE    (NAME = tempdat6 , FILENAME = 'H:\tempdat6.ndf' , SIZE = 1024MB , FILEGROWTH = 100MB)  
ALTER DATABASE tempdb ADD FILE    (NAME = tempdat7 , FILENAME = 'H:\tempdat7.ndf' , SIZE = 1024MB , FILEGROWTH = 100MB)  
ALTER DATABASE tempdb ADD FILE    (NAME = tempdat8 , FILENAME = 'H:\tempdat8.ndf' , SIZE = 1024MB , FILEGROWTH = 100MB)  
GO  
ALTER DATABASE tempdb MODIFY FILE (NAME = templog , FILENAME = 'I:\templog.ldf', SIZE =  512MB , FILEGROWTH = 100MB)  
GO  
--8b. Modify log file:  modify drive & instance name to reflect designated destination for tempdb log   
--!!md I:\MSSQL10.<instance>  
--!!md I:\MSSQL10.<instance>\MSSQL  
--!!md I:\MSSQL10.<instance>\MSSQL\DATA  
GO  
-- 9. Recycle SQL service in SQL Server Services node of sqlservermanager10.msc  
    --note, if running script from a UNC share, SSMS will report an error,   
      --but SQL Server Configuration Manager will open if its location is in %path%  
!!sqlservermanager10.msc  
  
--10. Examine results & if appropriate, delete original tempdb data log files   
 --(if they were "moved", the original files aren't automatically deleted)  
EXEC dbo.sp_helpdb tempdb  
--!!del C:\tempdb.mdf     
--!!del C:\templog.ldf  
GO  
  
```  
  
 <span data-ttu-id="47eb8-171">Utiliser le moniteur d’activité SQL Server 2008 ou les rapports du tableau de bord SQL Server 2005 performances décrits dans [d’analyse des performances SQL Server](../technical-guides/monitoring-sql-server-performance.md) pour identifier les problèmes de contention de verrou.</span><span class="sxs-lookup"><span data-stu-id="47eb8-171">Use the SQL Server 2008 Activity Monitor or the SQL Server 2005 Performance Dashboard Reports described in [Monitoring SQL Server Performance](../technical-guides/monitoring-sql-server-performance.md) to identify problems with latch contention.</span></span>  
  
## <a name="manually-set-sql-server-process-affinity"></a><span data-ttu-id="47eb8-172">Définir manuellement l’affinité de processus SQL Server</span><span class="sxs-lookup"><span data-stu-id="47eb8-172">Manually set SQL Server Process Affinity</span></span>  
 <span data-ttu-id="47eb8-173">L’option d’affinité de processus peut fournir des améliorations des performances dans les environnements de haut de gamme, de niveau entreprise de SQL Server qui sont exécutent sur des ordinateurs non-NUMA avec 16 processeurs ou plus.</span><span class="sxs-lookup"><span data-stu-id="47eb8-173">The Process Affinity option can provide performance enhancements in high-end, enterprise-level SQL Server environments that are running on non-NUMA computers with 16 or more CPUs.</span></span> <span data-ttu-id="47eb8-174">Cela est particulièrement vrai dans les environnements de BizTalk à débit élevé où vous avez à une contention sur les tables partagées dans la base de données MessageBox.</span><span class="sxs-lookup"><span data-stu-id="47eb8-174">This is especially true in high-throughput BizTalk environments where you have contention on shared tables in the MessageBox database.</span></span> <span data-ttu-id="47eb8-175">Étant donné que les ordinateurs SQL Server qui ont été utilisés dans notre environnement de laboratoire n’ont pas étaient prenant en charge NUMA et avaient 16 cœurs, pour optimiser les performances, nous avons utilisé les commandes ci-dessous pour définir l’affinité du processus :</span><span class="sxs-lookup"><span data-stu-id="47eb8-175">Because the SQL Server computers that were used in our lab environment were not NUMA-enabled and had 16 cores, to optimize performance, we used the commands below to set process affinity:</span></span>  
  
 <span data-ttu-id="47eb8-176">**Pour définir manuellement l’affinité du processus SQL Server à partir de 0 à 15**</span><span class="sxs-lookup"><span data-stu-id="47eb8-176">**To manually set the SQL Server Process Affinity from 0 to 15**</span></span>  
  
```  
ALTER SERVER CONFIGURATION  
SET PROCESS AFFINITY CPU = 0 to 15  
```  
  
 <span data-ttu-id="47eb8-177">Pour plus d’informations, consultez [ALTER SERVER CONFIGURATION (Transact-SQL)](https://docs.microsoft.com/sql/t-sql/statements/alter-server-configuration-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="47eb8-177">For more information, see [ALTER SERVER CONFIGURATION (Transact-SQL)](https://docs.microsoft.com/sql/t-sql/statements/alter-server-configuration-transact-sql).</span></span>
  
## <a name="configure-msdtc"></a><span data-ttu-id="47eb8-178">Configurer MSDTC</span><span class="sxs-lookup"><span data-stu-id="47eb8-178">Configure MSDTC</span></span>  
 <span data-ttu-id="47eb8-179">Pour faciliter les transactions entre SQL Server et BizTalk Server, vous devez activer Microsoft Distributed Transaction Coordinator (MS DTC).</span><span class="sxs-lookup"><span data-stu-id="47eb8-179">To facilitate transactions between SQL Server and BizTalk Server, you must enable Microsoft Distributed Transaction Coordinator (MS DTC).</span></span> <span data-ttu-id="47eb8-180">Pour configurer MSDTC sur SQL Server, consultez la rubrique [recommandations générales pour améliorer les performances de système d’exploitation](../technical-guides/general-guidelines-for-improving-operating-system-performance.md).</span><span class="sxs-lookup"><span data-stu-id="47eb8-180">To configure MSDTC on SQL Server, see the topic [General Guidelines for Improving Operating System Performance](../technical-guides/general-guidelines-for-improving-operating-system-performance.md).</span></span>  
  
## <a name="enable-trace-flag-t1118-as-a-startup-parameter-for-all-instances-of-sql-server"></a><span data-ttu-id="47eb8-181">Activer T1118 d’indicateur de Trace en tant que paramètre de démarrage pour toutes les instances de SQL Server</span><span class="sxs-lookup"><span data-stu-id="47eb8-181">Enable Trace Flag T1118 as a startup parameter for all instances of SQL Server</span></span>  
 <span data-ttu-id="47eb8-182">Mise en œuvre de la Trace à l’indicateur-T1118 permet de réduire la contention parmi les instances de SQL Server en supprimant presque toutes les allocations de page unique.</span><span class="sxs-lookup"><span data-stu-id="47eb8-182">Implementing Trace Flag –T1118 helps reduce contention across the SQL Server instances by removing almost all single page allocations.</span></span> <span data-ttu-id="47eb8-183">Pour plus d’informations, consultez [Ko 328551 : PRB : améliorations de la concurrence pour la base de données tempdb](https://support.microsoft.com/help/328551/concurrency-enhancements-for-the-tempdb-database).</span><span class="sxs-lookup"><span data-stu-id="47eb8-183">For more information, see [KB 328551: PRB: Concurrency enhancements for the tempdb database](https://support.microsoft.com/help/328551/concurrency-enhancements-for-the-tempdb-database).</span></span>
  
## <a name="do-not-change-default-sql-server-settings-for-max-degree-of-parallelism-sql-server-statistics-or-database-index-rebuilds-and-defragmentation"></a><span data-ttu-id="47eb8-184">Ne modifiez pas les paramètres de SQL Server par défaut pour le degré maximal de parallélisme, les statistiques SQL Server, ou les reconstructions d’index de base de données et la défragmentation</span><span class="sxs-lookup"><span data-stu-id="47eb8-184">Do not change default SQL Server settings for max degree of parallelism, SQL Server statistics, or database index rebuilds and defragmentation</span></span>  
 <span data-ttu-id="47eb8-185">Si une instance de SQL Server va héberger les bases de données BizTalk Server, il existe certains paramètres de SQL Server ne doivent pas être modifiés.</span><span class="sxs-lookup"><span data-stu-id="47eb8-185">If a SQL Server instance will house BizTalk Server databases, then there are certain SQL Server settings that should not be changed.</span></span> <span data-ttu-id="47eb8-186">Plus précisément, les statistiques de SQL Server sur la base de données MessageBox et les paramètres pour l’index de base de données de le SQL Server max degree of parallelism, reconstruit et défragmentation ne doit pas être modifiée.</span><span class="sxs-lookup"><span data-stu-id="47eb8-186">Specifically, the SQL Server max degree of parallelism, the SQL Server statistics on the MessageBox database, and the settings for the database index rebuilds and defragmentation should not be modified.</span></span> <span data-ttu-id="47eb8-187">Consultez [des paramètres SQL Server ne doivent pas être modifiés](../technical-guides/sql-server-settings-that-should-not-be-changed.md).</span><span class="sxs-lookup"><span data-stu-id="47eb8-187">See [SQL Server Settings That Should Not Be Changed](../technical-guides/sql-server-settings-that-should-not-be-changed.md).</span></span>
  
## <a name="see-also"></a><span data-ttu-id="47eb8-188">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="47eb8-188">See Also</span></span>  
 [<span data-ttu-id="47eb8-189">Optimisation des performances des bases de données</span><span class="sxs-lookup"><span data-stu-id="47eb8-189">Optimizing Database Performance</span></span>](../technical-guides/optimizing-database-performance.md)
